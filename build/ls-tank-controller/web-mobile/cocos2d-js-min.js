!function t(e,i,n){function r(o,a){if(!i[o]){if(!e[o]){var c="function"==typeof require&&require;if(!a&&c)return c(o,!0);if(s)return s(o,!0);var l=new Error("Cannot find module '"+o+"'");throw l.code="MODULE_NOT_FOUND",l}var h=i[o]={exports:{}};e[o][0].call(h.exports,function(t){var i=e[o][1][t];return r(i?i:t)},h,h.exports,t,e,i,n)}return i[o].exports}for(var s="function"==typeof require&&require,o=0;o<n.length;o++)r(n[o]);return r}({1:[function(t,e,i){cc._tmp=cc._tmp||{},cc._LogInfos=cc._LogInfos||{};var n=window;if(n.gl,n.WebGLRenderingContext,n.DeviceOrientationEvent,n.DeviceMotionEvent,n.AudioContext,!n.AudioContext)n.webkitAudioContext;n.mozAudioContext,n=Object.prototype,n._super,n.ctor,n=null;var r;r="1.0.0",window.CocosEngine=cc.ENGINE_VERSION=r,cc._drawingUtil=null,cc._renderContext=null,cc._supportRender=!1,cc._canvas=null,cc.container=null,cc._gameDiv=null,cc.isEditor="undefined"!=typeof Editor,t("./cocos2d/core/utils"),t("./cocos2d/core/platform/CCSys"),function(){function t(t){var e=cc.game.CONFIG_KEY,i=parseInt(t[e.renderMode])||0;if(isNaN(i)||i>2||0>i)t[e.renderMode]=0;if(cc._renderType=cc.game.RENDER_TYPE_CANVAS,cc._supportRender=!1,0===i){if(cc.sys.capabilities.opengl)cc._renderType=cc.game.RENDER_TYPE_WEBGL,cc._supportRender=!0;else if(cc.sys.capabilities.canvas)cc._renderType=cc.game.RENDER_TYPE_CANVAS,cc._supportRender=!0}else if(1===i&&cc.sys.capabilities.canvas)cc._renderType=cc.game.RENDER_TYPE_CANVAS,cc._supportRender=!0;else if(2===i&&cc.sys.capabilities.opengl)cc._renderType=cc.game.RENDER_TYPE_WEBGL,cc._supportRender=!0}function e(t,i,n){if(s[i])return null;n=n||"";var r=[],o=t[i];if(!o)throw new Error("can not find module ["+i+"]");for(var a=cc.path,c=0,l=o.length;l>c;c++){var h=o[c];if(!s[h]){var u=a.extname(h);if(!u){var d=e(t,h,n);if(d)r=r.concat(d)}else if(".js"===u.toLowerCase())r.push(a.join(n,h));s[h]=1}else;}return r}function i(t){if(cc._initDebugSetting(t[cc.game.CONFIG_KEY.debugMode]),cc._engineLoaded=!0,cc.log(cc.ENGINE_VERSION),a)a()}function n(t){var n=cc.game.CONFIG_KEY,r=t[n.engineDir],s=cc.loader;if(cc._Class)i(t);else{var o=cc.path.join(r,"moduleConfig.json");s.load(o,function(n,o){if(n)throw new Error(n);var a=t.modules||[],c=o.module,l=[];if(cc.sys.capabilities.opengl&&a.indexOf("base4webgl")<0)a.splice(0,0,"base4webgl");else if(a.indexOf("core")<0)a.splice(0,0,"core");for(var h=0,u=a.length;u>h;h++){var d=e(c,a[h],r);if(d)l=l.concat(d)}s.load(l,function(e){if(e)throw new Error(JSON.stringify(e));i(t)})})}}function r(){window.removeEventListener("load",r,!1),n(cc.game.config)}var s={},o=!1,a=null;cc._engineLoaded=!1,cc.initEngine=function(e,i){if(o){var s=a;return void(a=function(){s&&s(),i&&i()})}if(a=i,!cc.game.config&&e)cc.game.config=e;else if(!cc.game.config)cc.game._loadConfig();e=cc.game.config,t(e),document.body?n(e):window.addEventListener("load",r,!1),o=!0}}()},{"./cocos2d/core/platform/CCSys":95,"./cocos2d/core/utils":125}],2:[function(t,e,i){function n(t){if(cc.js.isObject(t))try{return JSON.stringify(t)}catch(e){return""}else return t}if(cc._LogInfos={ActionManager:{addAction:"cc.ActionManager.addAction(): action must be non-null",removeAction:"cocos2d: removeAction: Target not found",removeActionByTag:"cc.ActionManager.removeActionByTag(): an invalid tag",removeActionByTag_2:"cc.ActionManager.removeActionByTag(): target must be non-null",getActionByTag:"cc.ActionManager.getActionByTag(): an invalid tag",getActionByTag_2:"cocos2d : getActionByTag(tag = %s): Action not found"},configuration:{dumpInfo:"cocos2d: **** WARNING **** CC_ENABLE_PROFILERS is defined. Disable it when you finish profiling (from CCMacro.js)",loadConfigFile:"Expected 'data' dict, but not found. Config file: %s",loadConfigFile_2:"Please load the resource first : %s"},Director:{resume:"cocos2d: Director: Error in gettimeofday",setProjection:"cocos2d: Director: unrecognized projection",popToSceneStackLevel:"cocos2d: Director: unrecognized projection",popToSceneStackLevel_2:"cocos2d: Director: Error in gettimeofday",popScene:"running scene should not null",pushScene:"the scene should not null"},Array:{verifyType:"element type is wrong!"},deprecated:'"%s" is deprecated, please use "%s" instead.',Scheduler:{scheduleCallbackForTarget:"CCSheduler#scheduleCallback. Callback already scheduled. Updating interval from:%s to %s",scheduleCallbackForTarget_2:"cc.scheduler.scheduleCallbackForTarget(): callback_fn should be non-null.",scheduleCallbackForTarget_3:"cc.scheduler.scheduleCallbackForTarget(): target should be non-null.",pauseTarget:"cc.Scheduler.pauseTarget():target should be non-null",resumeTarget:"cc.Scheduler.resumeTarget():target should be non-null",isTargetPaused:"cc.Scheduler.isTargetPaused():target should be non-null"},Node:{getZOrder:"getZOrder is deprecated. Please use getLocalZOrder instead.",setZOrder:"setZOrder is deprecated. Please use setLocalZOrder instead.",getRotation:"RotationX != RotationY. Don't know which one to return",getScale:"ScaleX != ScaleY. Don't know which one to return",addChild:"An Node can't be added as a child of itself.",addChild_2:"child already added. It can't be added again",addChild_3:"child must be non-null",removeFromParentAndCleanup:"removeFromParentAndCleanup is deprecated. Use removeFromParent instead",boundingBox:"boundingBox is deprecated. Use getBoundingBox instead",removeChildByTag:"argument tag is an invalid tag",removeChildByTag_2:"cocos2d: removeChildByTag(tag = %s): child not found!",removeAllChildrenWithCleanup:"removeAllChildrenWithCleanup is deprecated. Use removeAllChildren instead",stopActionByTag:"cc.Node.stopActionBy(): argument tag an invalid tag",getActionByTag:"cc.Node.getActionByTag(): argument tag is an invalid tag",reumeSchedulerAndActions:"resumeSchedulerAndActions is deprecated, please use resume instead.",pauseSchedulerAndActions:"pauseSchedulerAndActions is deprecated, please use pause instead.",_arrayMakeObjectsPerformSelector:"Unknown callback function",reorderChild:"child must be non-null",runAction:"cc.Node.runAction(): action must be non-null",schedule:"callback function must be non-null",schedule_2:"interval must be positive",initWithTexture:"cocos2d: Could not initialize cc.AtlasNode. Invalid Texture.",_requestDirtyFlag:"_ccsg.Node._requestDirtyFlag: failed to satisfy the request, key (%s) for flag have already been taken"},AtlasNode:{_updateAtlasValues:"cc.AtlasNode.updateAtlasValues(): Shall be overridden in subclasses",_initWithTileFile:"",_initWithTexture:"cocos2d: Could not initialize cc.AtlasNode. Invalid Texture."},_checkEventListenerAvailable:{keyboard:"cc._EventListenerKeyboard.checkAvailable(): Invalid EventListenerKeyboard!",touchOneByOne:"cc._EventListenerTouchOneByOne.checkAvailable(): Invalid EventListenerTouchOneByOne!",touchAllAtOnce:"cc._EventListenerTouchAllAtOnce.checkAvailable(): Invalid EventListenerTouchAllAtOnce!",acceleration:"cc._EventListenerAcceleration.checkAvailable(): _onAccelerationEvent must be non-nil"},EventListener:{create:"Invalid parameter."},__getListenerID:"Don't call this method if the event is for touch.",LayerMultiplex:{initWithLayers:"parameters should not be ending with null in Javascript",switchTo:"Invalid index in MultiplexLayer switchTo message",switchToAndReleaseMe:"Invalid index in MultiplexLayer switchTo message",addLayer:"cc.Layer.addLayer(): layer should be non-null"},view:{setDesignResolutionSize:"Resolution not valid",setDesignResolutionSize_2:"should set resolutionPolicy"},inputManager:{handleTouchesBegin:"The touches is more than MAX_TOUCHES, nUnusedIndex = %s"},checkGLErrorDebug:"WebGL error %s",spriteFrameAnimationCache:{_addAnimationsWithDictionary:"cocos2d: cc.SpriteFrameAnimationCache: No animations were found in provided dictionary.",_addAnimationsWithDictionary_2:"cc.SpriteFrameAnimationCache. Invalid animation format",addAnimations:"cc.SpriteFrameAnimationCache.addAnimations(): File could not be found",_parseVersion1:"cocos2d: cc.SpriteFrameAnimationCache: Animation '%s' found in dictionary without any frames - cannot add to animation cache.",_parseVersion1_2:"cocos2d: cc.SpriteFrameAnimationCache: Animation '%s' refers to frame '%s' which is not currently in the cc.SpriteFrameCache. This frame will not be added to the animation.",_parseVersion1_3:"cocos2d: cc.SpriteFrameAnimationCache: None of the frames for animation '%s' were found in the cc.SpriteFrameCache. Animation is not being added to the Animation Cache.",_parseVersion1_4:"cocos2d: cc.SpriteFrameAnimationCache: An animation in your dictionary refers to a frame which is not in the cc.SpriteFrameCache. Some or all of the frames for the animation '%s' may be missing.",_parseVersion2:"cocos2d: CCAnimationCache: Animation '%s' found in dictionary without any frames - cannot add to animation cache.",_parseVersion2_2:"cocos2d: cc.SpriteFrameAnimationCache: Animation '%s' refers to frame '%s' which is not currently in the cc.SpriteFrameCache. This frame will not be added to the animation.",addAnimations_2:"cc.SpriteFrameAnimationCache.addAnimations(): Invalid texture file name"},Sprite:{reorderChild:"cc.Sprite.reorderChild(): this child is not in children list",ignoreAnchorPointForPosition:"cc.Sprite.ignoreAnchorPointForPosition(): it is invalid in cc.Sprite when using SpriteBatchNode",setDisplayFrameWithAnimationName:"cc.Sprite.setDisplayFrameWithAnimationName(): Frame not found",setDisplayFrameWithAnimationName_2:"cc.Sprite.setDisplayFrameWithAnimationName(): Invalid frame index",setDisplayFrame:"setDisplayFrame is deprecated, please use setSpriteFrame instead.",_updateBlendFunc:"cc.Sprite._updateBlendFunc(): _updateBlendFunc doesn't work when the sprite is rendered using a cc.CCSpriteBatchNode",initWithSpriteFrame:"cc.Sprite.initWithSpriteFrame(): spriteFrame should be non-null",initWithSpriteFrameName:"cc.Sprite.initWithSpriteFrameName(): spriteFrameName should be non-null",initWithSpriteFrameName1:" is null, please check.",initWithFile:"cc.Sprite.initWithFile(): filename should be non-null",setDisplayFrameWithAnimationName_3:"cc.Sprite.setDisplayFrameWithAnimationName(): animationName must be non-null",reorderChild_2:"cc.Sprite.reorderChild(): child should be non-null",addChild:"cc.Sprite.addChild(): cc.Sprite only supports cc.Sprites as children when using cc.SpriteBatchNode",addChild_2:"cc.Sprite.addChild(): cc.Sprite only supports a sprite using same texture as children when using cc.SpriteBatchNode",addChild_3:"cc.Sprite.addChild(): child should be non-null",setTexture:"cc.Sprite.texture setter: Batched sprites should use the same texture as the batchnode",updateQuadFromSprite:"cc.SpriteBatchNode.updateQuadFromSprite(): cc.SpriteBatchNode only supports cc.Sprites as children",insertQuadFromSprite:"cc.SpriteBatchNode.insertQuadFromSprite(): cc.SpriteBatchNode only supports cc.Sprites as children",addChild_4:"cc.SpriteBatchNode.addChild(): cc.SpriteBatchNode only supports cc.Sprites as children",addChild_5:"cc.SpriteBatchNode.addChild(): cc.Sprite is not using the same texture",initWithTexture:"Sprite.initWithTexture(): Argument must be non-nil ",setSpriteFrame:"Invalid spriteFrameName",setTexture_2:"Invalid argument: cc.Sprite.texture setter expects a CCTexture2D.",updateQuadFromSprite_2:"cc.SpriteBatchNode.updateQuadFromSprite(): sprite should be non-null",insertQuadFromSprite_2:"cc.SpriteBatchNode.insertQuadFromSprite(): sprite should be non-null"},SpriteBatchNode:{addSpriteWithoutQuad:"cc.SpriteBatchNode.addQuadFromSprite(): SpriteBatchNode only supports cc.Sprites as children",increaseAtlasCapacity:"cocos2d: CCSpriteBatchNode: resizing TextureAtlas capacity from %s to %s.",increaseAtlasCapacity_2:"cocos2d: WARNING: Not enough memory to resize the atlas",reorderChild:"cc.SpriteBatchNode.addChild(): Child doesn't belong to Sprite",removeChild:"cc.SpriteBatchNode.addChild(): sprite batch node should contain the child",addSpriteWithoutQuad_2:"cc.SpriteBatchNode.addQuadFromSprite(): child should be non-null",reorderChild_2:"cc.SpriteBatchNode.addChild(): child should be non-null",updateQuadFromSprite:"cc.SpriteBatchNode.updateQuadFromSprite(): cc.SpriteBatchNode only supports cc.Sprites as children",insertQuadFromSprite:"cc.SpriteBatchNode.insertQuadFromSprite(): cc.SpriteBatchNode only supports cc.Sprites as children",addChild:"cc.SpriteBatchNode.addChild(): cc.SpriteBatchNode only supports cc.Sprites as children",initWithTexture:"Sprite.initWithTexture(): Argument must be non-nil ",addChild_2:"cc.Sprite.addChild(): child should be non-null",setSpriteFrame:"Invalid spriteFrameName",setTexture:"Invalid argument: cc.Sprite texture setter expects a CCTexture2D.",updateQuadFromSprite_2:"cc.SpriteBatchNode.updateQuadFromSprite(): sprite should be non-null",insertQuadFromSprite_2:"cc.SpriteBatchNode.insertQuadFromSprite(): sprite should be non-null",addChild_3:"cc.SpriteBatchNode.addChild(): child should be non-null"},spriteFrameCache:{_getFrameConfig:"cocos2d: WARNING: originalWidth/Height not found on the cc.SpriteFrame. AnchorPoint won't work as expected. Regenrate the .plist",addSpriteFrames:"cocos2d: WARNING: an alias with name %s already exists",_checkConflict:"cocos2d: WARNING: Sprite frame: %s has already been added by another source, please fix name conflit",getSpriteFrame:"cocos2d: cc.SpriteFrameCahce: Frame %s not found",_getFrameConfig_2:"Please load the resource first : %s",addSpriteFrames_2:"cc.SpriteFrameCache.addSpriteFrames(): plist should be non-null",addSpriteFrames_3:"Argument must be non-nil"},TextureAtlas:{initWithFile:"cocos2d: Could not open file: %s",insertQuad:"cc.TextureAtlas.insertQuad(): invalid totalQuads",initWithTexture:"cc.TextureAtlas.initWithTexture():texture should be non-null",updateQuad:"cc.TextureAtlas.updateQuad(): quad should be non-null",updateQuad_2:"cc.TextureAtlas.updateQuad(): Invalid index",insertQuad_2:"cc.TextureAtlas.insertQuad(): Invalid index",insertQuads:"cc.TextureAtlas.insertQuad(): Invalid index + amount",insertQuadFromIndex:"cc.TextureAtlas.insertQuadFromIndex(): Invalid newIndex",insertQuadFromIndex_2:"cc.TextureAtlas.insertQuadFromIndex(): Invalid fromIndex",removeQuadAtIndex:"cc.TextureAtlas.removeQuadAtIndex(): Invalid index",removeQuadsAtIndex:"cc.TextureAtlas.removeQuadsAtIndex(): index + amount out of bounds",moveQuadsFromIndex:"cc.TextureAtlas.moveQuadsFromIndex(): move is out of bounds",moveQuadsFromIndex_2:"cc.TextureAtlas.moveQuadsFromIndex(): Invalid newIndex",moveQuadsFromIndex_3:"cc.TextureAtlas.moveQuadsFromIndex(): Invalid oldIndex"},textureCache:{addPVRTCImage:"TextureCache:addPVRTCImage does not support on HTML5",addETCImage:"TextureCache:addPVRTCImage does not support on HTML5",textureForKey:"textureForKey is deprecated. Please use getTextureForKey instead.",addPVRImage:"addPVRImage does not support on HTML5",addUIImage:"cocos2d: Couldn't add UIImage in TextureCache",dumpCachedTextureInfo:"cocos2d: '%s' id=%s %s x %s",dumpCachedTextureInfo_2:"cocos2d: '%s' id= HTMLCanvasElement %s x %s",dumpCachedTextureInfo_3:"cocos2d: TextureCache dumpDebugInfo: %s textures, HTMLCanvasElement for %s KB (%s MB)",addUIImage_2:"cc.Texture.addUIImage(): image should be non-null",invalidKey:"TextureCache: url should be non-null"},Texture2D:{initWithETCFile:"initWithETCFile does not support on HTML5",initWithPVRFile:"initWithPVRFile does not support on HTML5",initWithPVRTCData:"initWithPVRTCData does not support on HTML5",addImage:"cc.Texture.addImage(): path should be non-null",initWithImage:"cocos2d: cc.Texture2D. Can't create Texture. UIImage is nil",initWithImage_2:"cocos2d: WARNING: Image (%s x %s) is bigger than the supported %s x %s",initWithString:"initWithString isn't supported on cocos2d-html5",initWithETCFile_2:"initWithETCFile does not support on HTML5",initWithPVRFile_2:"initWithPVRFile does not support on HTML5",initWithPVRTCData_2:"initWithPVRTCData does not support on HTML5",bitsPerPixelForFormat:"bitsPerPixelForFormat: %s, cannot give useful result, it's a illegal pixel format",_initPremultipliedATextureWithImage:"cocos2d: cc.Texture2D: Using RGB565 texture since image has no alpha",addImage_2:"cc.Texture.addImage(): path should be non-null",initWithData:"NSInternalInconsistencyException"},MissingFile:"Missing file: %s",RectWidth:"Rect width exceeds maximum margin: %s",RectHeight:"Rect height exceeds maximum margin: %s",EventManager:{addListener:"0 priority is forbidden for fixed priority since it's used for scene graph based priority.",removeListeners:"Invalid listener type!",setPriority:"Can't set fixed priority with scene graph based listener.",addListener_2:"Invalid parameters.",addListener_3:"listener must be a cc.EventListener object when adding a fixed priority listener",addListener_4:"The listener has been registered, please don't register it again.",_forceAddEventListener:"Invalid scene graph priority!",_updateListeners:"If program goes here, there should be event in dispatch.",_updateListeners_2:"_inDispatch should be 1 here."}},!1)cc._LogInfos.Editor={Class:{callSuperCtor:"cc.Class will automatically call super constructor of %s, you should not call it manually."}};cc._logToWebPage=function(t){if(cc._canvas){var e=cc._logList,i=document;if(!e){var n=i.createElement("Div"),r=n.style;n.setAttribute("id","logInfoDiv"),cc._canvas.parentNode.appendChild(n),n.setAttribute("width","200"),n.setAttribute("height",cc._canvas.height),r.zIndex="99999",r.position="absolute",r.top="0",r.left="0",e=cc._logList=i.createElement("textarea");var s=e.style;e.setAttribute("rows","20"),e.setAttribute("cols","30"),e.setAttribute("disabled",!0),n.appendChild(e),s.backgroundColor="transparent",s.borderBottom="1px solid #cccccc",s.borderRightWidth="0px",s.borderLeftWidth="0px",s.borderTopWidth="0px",s.borderTopStyle="none",s.borderRightStyle="none",s.borderLeftStyle="none",s.padding="0px",s.margin=0}e.value=e.value+t+"\r\n",e.scrollTop=e.scrollHeight}};var r=t("./cocos2d/core/value-types/CCEnum");cc.DebugMode=r({NONE:0,INFO:1,WARN:2,ERROR:3,INFO_FOR_WEB_PAGE:4,WARN_FOR_WEB_PAGE:5,ERROR_FOR_WEB_PAGE:6});var s=cc.log||console.log;cc._initDebugSetting=function(t){if(cc.log=cc.warn=cc.error=cc._throw=cc.assert=function(){},t!==cc.DebugMode.NONE){var e;if(t>cc.DebugMode.ERROR){if(e=cc._logToWebPage.bind(cc),cc.error=function(){e("ERROR :  "+cc.js.formatStr.apply(cc,arguments))},cc.assert=function(t,i){"use strict";if(!t&&i){for(var r=2;r<arguments.length;r++)i=i.replace(/(%s)|(%d)/,n(arguments[r]));e("Assert: "+i)}},t!==cc.DebugMode.ERROR_FOR_WEB_PAGE)cc.warn=function(){e("WARN :  "+cc.js.formatStr.apply(cc,arguments))};if(t===cc.DebugMode.INFO_FOR_WEB_PAGE)cc.log=cc.info=function(){e(cc.js.formatStr.apply(cc,arguments))}}else if(console&&console.log.apply){if(!console.error)console.error=console.log;if(!console.warn)console.warn=console.log;if(!1)cc.error=Editor.error;else if(console.error.bind)cc.error=console.error.bind(console);else cc.error=function(){return console.error.apply(console,arguments)};if(cc.assert=function(t,e){if(!t&&e){for(var i=2;i<arguments.length;i++)e=e.replace(/(%s)|(%d)/,n(arguments[i]));throw new Error(e)}},t!==cc.DebugMode.ERROR)if(!1)cc.warn=Editor.warn;else if(console.warn.bind)cc.warn=console.warn.bind(console);else cc.warn=function(){return console.warn.apply(console,arguments)};if(!1)cc.log=Editor.log,cc.info=Editor.info;else if(t===cc.DebugMode.INFO){if(!1)cc.log=s;else if(console.log.bind)cc.log=console.log.bind(console);else cc.log=function(){return console.log.apply(console,arguments)};cc.info=function(){(console.info||console.log).apply(console,arguments)}}}cc._throw=function(t){cc.error(t.stack||t)}}}},{"./cocos2d/core/value-types/CCEnum":130}],3:[function(t,e,n){(function(e,n,r,s){function o(t){return t.charAt(0).toUpperCase()+t.slice(1)}function a(t,e){t.shaderProgram=e;var i=t.children;if(i)for(var n=0;n<i.length;n++)a(i[n],e)}function c(t){if(t.length%4!==0)return null;for(var e=t.length/4,i=window.Uint32Array?new Uint32Array(e):[],n=0;e>n;n++){var r=4*n;i[n]=t[r]+256*t[r+1]+65536*t[r+2]+t[r+3]*(1<<24)}return i}e._tmp.PrototypeCCNode=function(){var t=_ccsg.Node.prototype;e.defineGetterSetter(t,"x",t.getPositionX,t.setPositionX),e.defineGetterSetter(t,"y",t.getPositionY,t.setPositionY),t.width,e.defineGetterSetter(t,"width",t._getWidth,t._setWidth),t.height,e.defineGetterSetter(t,"height",t._getHeight,t._setHeight),t.anchorX,e.defineGetterSetter(t,"anchorX",t._getAnchorX,t._setAnchorX),t.anchorY,e.defineGetterSetter(t,"anchorY",t._getAnchorY,t._setAnchorY),t.skewX,e.defineGetterSetter(t,"skewX",t.getSkewX,t.setSkewX),t.skewY,e.defineGetterSetter(t,"skewY",t.getSkewY,t.setSkewY),t.zIndex,e.defineGetterSetter(t,"zIndex",t.getLocalZOrder,t.setLocalZOrder),t.vertexZ,e.defineGetterSetter(t,"vertexZ",t.getVertexZ,t.setVertexZ),t.rotation,e.defineGetterSetter(t,"rotation",t.getRotation,t.setRotation),t.rotationX,e.defineGetterSetter(t,"rotationX",t.getRotationX,t.setRotationX),t.rotationY,e.defineGetterSetter(t,"rotationY",t.getRotationY,t.setRotationY),t.scale,e.defineGetterSetter(t,"scale",t.getScale,t.setScale),t.scaleX,e.defineGetterSetter(t,"scaleX",t.getScaleX,t.setScaleX),t.scaleY,e.defineGetterSetter(t,"scaleY",t.getScaleY,t.setScaleY),t.children,e.defineGetterSetter(t,"children",t.getChildren),t.childrenCount,e.defineGetterSetter(t,"childrenCount",t.getChildrenCount),t.parent,e.defineGetterSetter(t,"parent",t.getParent,t.setParent),t.visible,e.defineGetterSetter(t,"visible",t.isVisible,t.setVisible),t.running,e.defineGetterSetter(t,"running",t.isRunning),t.ignoreAnchor,e.defineGetterSetter(t,"ignoreAnchor",t.isIgnoreAnchorPointForPosition,t.ignoreAnchorPointForPosition),t.tag,t.userData,t.userObject,t.arrivalOrder,t.actionManager,e.defineGetterSetter(t,"actionManager",t.getActionManager,t.setActionManager),t.scheduler,e.defineGetterSetter(t,"scheduler",t.getScheduler,t.setScheduler),t.shaderProgram,e.defineGetterSetter(t,"shaderProgram",t.getShaderProgram,t.setShaderProgram),t.opacity,e.defineGetterSetter(t,"opacity",t.getOpacity,t.setOpacity),t.opacityModifyRGB,e.defineGetterSetter(t,"opacityModifyRGB",t.isOpacityModifyRGB),t.cascadeOpacity,e.defineGetterSetter(t,"cascadeOpacity",t.isCascadeOpacityEnabled,t.setCascadeOpacityEnabled),t.color,e.defineGetterSetter(t,"color",t.getColor,t.setColor),t.cascadeColor,e.defineGetterSetter(t,"cascadeColor",t.isCascadeColorEnabled,t.setCascadeColorEnabled)},e.s_globalOrderOfArrival=1,_ccsg.Node=e.Class({name:"ccsg.Node",properties:{_localZOrder:0,_globalZOrder:0,_vertexZ:0,_rotationX:0,_rotationY:0,_scaleX:1,_scaleY:1,_position:e.p(0,0),_skewX:0,_skewY:0,_children:[],_visible:!0,_anchorPoint:e.p(0,0),_contentSize:e.size(0,0),_parent:null,_ignoreAnchorPointForPosition:!1,tag:e.macro.NODE_TAG_INVALID,_showNode:!1,_name:"",_realOpacity:255,_realColor:e.Color.WHITE,_cascadeColorEnabled:!1,_cascadeOpacityEnabled:!1},ctor:function(){arguments[0];this.__instanceId=e.ClassManager.getNewInstanceId(),this._running=!1,this._reorderChildDirty=!1,this._shaderProgram=null,this.arrivalOrder=0,this._additionalTransformDirty=!1,this._isTransitionFinished=!1;var t=e.director;this._actionManager=t.getActionManager(),this._scheduler=t.getScheduler(),this._additionalTransform=e.affineTransformMakeIdentity(),this._initRendererCmd()},init:function(){return!0},_arrayMakeObjectsPerformSelector:function(t,i){if(t&&0!==t.length){var n,r,s=t.length,o=_ccsg.Node._stateCallbackType;switch(i){case o.onEnter:for(n=0;s>n;n++)if(r=t[n])r.onEnter();break;case o.onExit:for(n=0;s>n;n++)if(r=t[n])r.onExit();break;case o.onEnterTransitionDidFinish:for(n=0;s>n;n++)if(r=t[n])r.onEnterTransitionDidFinish();break;case o.cleanup:for(n=0;s>n;n++)if(r=t[n])r.cleanup();break;case o.updateTransform:for(n=0;s>n;n++)if(r=t[n])r.updateTransform();break;case o.onExitTransitionDidStart:for(n=0;s>n;n++)if(r=t[n])r.onExitTransitionDidStart();break;case o.sortAllChildren:for(n=0;s>n;n++)if(r=t[n])r.sortAllChildren();break;default:e.assert(0,e._LogInfos.Node._arrayMakeObjectsPerformSelector)}}},attr:function(t){for(var e in t)this[e]=t[e]},getSkewX:function(){return this._skewX},setSkewX:function(t){this._skewX=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},getSkewY:function(){return this._skewY},setSkewY:function(t){this._skewY=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},setLocalZOrder:function(t){if(this._localZOrder=t,this._parent)this._parent.reorderChild(this,t);e.eventManager._setDirtyForNode(this)},_setLocalZOrder:function(t){this._localZOrder=t},getLocalZOrder:function(){return this._localZOrder},getZOrder:function(){return e.log(e._LogInfos.Node.getZOrder),this.getLocalZOrder()},setZOrder:function(t){e.log(e._LogInfos.Node.setZOrder),this.setLocalZOrder(t)},setGlobalZOrder:function(t){if(this._globalZOrder!==t)this._globalZOrder=t,e.eventManager._setDirtyForNode(this)},getGlobalZOrder:function(){return this._globalZOrder},getVertexZ:function(){return this._vertexZ},setVertexZ:function(t){this._vertexZ=t},getRotation:function(){if(this._rotationX!==this._rotationY)e.log(e._LogInfos.Node.getRotation);return this._rotationX},setRotation:function(t){this._rotationX=this._rotationY=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},getRotationX:function(){return this._rotationX},setRotationX:function(t){this._rotationX=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},getRotationY:function(){return this._rotationY},setRotationY:function(t){this._rotationY=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},getScale:function(){if(this._scaleX!==this._scaleY)e.log(e._LogInfos.Node.getScale);return this._scaleX},setScale:function(t,e){this._scaleX=t,this._scaleY=e||0===e?e:t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},getScaleX:function(){return this._scaleX},setScaleX:function(t){this._scaleX=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},getScaleY:function(){return this._scaleY},setScaleY:function(t){this._scaleY=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},setPosition:function(t,e){var i=this._position;if(void 0===e){if(i.x===t.x&&i.y===t.y)return;i.x=t.x,i.y=t.y}else{if(i.x===t&&i.y===e)return;i.x=t,i.y=e}this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},getPosition:function(){return e.p(this._position)},getPositionX:function(){return this._position.x},setPositionX:function(t){this._position.x=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},getPositionY:function(){return this._position.y},setPositionY:function(t){this._position.y=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},getChildrenCount:function(){return this._children.length},getChildren:function(){return this._children},isVisible:function(){return this._visible},setVisible:function(t){if(this._visible!==t)this._visible=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty),e.renderer.childrenOrderDirty=!0},getAnchorPoint:function(){return e.p(this._anchorPoint)},setAnchorPoint:function(t,e){var i=this._anchorPoint;if(void 0===e){if(t.x===i.x&&t.y===i.y)return;i.x=t.x,i.y=t.y}else{if(t===i.x&&e===i.y)return;i.x=t,i.y=e}this._renderCmd._updateAnchorPointInPoint()},_getAnchorX:function(){return this._anchorPoint.x},_setAnchorX:function(t){if(this._anchorPoint.x!==t)this._anchorPoint.x=t,this._renderCmd._updateAnchorPointInPoint()},_getAnchorY:function(){return this._anchorPoint.y},_setAnchorY:function(t){if(this._anchorPoint.y!==t)this._anchorPoint.y=t,this._renderCmd._updateAnchorPointInPoint()},getAnchorPointInPoints:function(){return this._renderCmd.getAnchorPointInPoints()},_getWidth:function(){return this._contentSize.width},_setWidth:function(t){this._contentSize.width=t,this._renderCmd._updateAnchorPointInPoint()},_getHeight:function(){return this._contentSize.height},_setHeight:function(t){this._contentSize.height=t,this._renderCmd._updateAnchorPointInPoint()},getContentSize:function(){return e.size(this._contentSize)},setContentSize:function(t,e){var i=this._contentSize;if(void 0===e){if(t.width===i.width&&t.height===i.height)return;i.width=t.width,i.height=t.height}else{if(t===i.width&&e===i.height)return;i.width=t,i.height=e}this._renderCmd._updateAnchorPointInPoint()},isRunning:function(){return this._running},getParent:function(){return this._parent},setParent:function(t){this._parent=t},isIgnoreAnchorPointForPosition:function(){return this._ignoreAnchorPointForPosition},ignoreAnchorPointForPosition:function(t){if(t!==this._ignoreAnchorPointForPosition)this._ignoreAnchorPointForPosition=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},getTag:function(){return this.tag},setTag:function(t){this.tag=t},setName:function(t){this._name=t},getName:function(){return this._name},getOrderOfArrival:function(){return this.arrivalOrder},setOrderOfArrival:function(t){this.arrivalOrder=t},getActionManager:function(){if(!this._actionManager)this._actionManager=e.director.getActionManager();return this._actionManager},setActionManager:function(t){if(this._actionManager!==t)this.stopAllActions(),this._actionManager=t},getScheduler:function(){if(!this._scheduler)this._scheduler=e.director.getScheduler();return this._scheduler},setScheduler:function(t){if(this._scheduler!==t)this.unscheduleAllCallbacks(),this._scheduler=t},boundingBox:function(){return e.log(e._LogInfos.Node.boundingBox),this.getBoundingBox()},getBoundingBox:function(){var t=e.rect(0,0,this._contentSize.width,this._contentSize.height);return e._rectApplyAffineTransformIn(t,this.getNodeToParentTransform())},cleanup:function(){this.stopAllActions(),this.unscheduleAllCallbacks(),e.eventManager.removeListeners(this),this._arrayMakeObjectsPerformSelector(this._children,_ccsg.Node._stateCallbackType.cleanup)},getChildByTag:function(t){var e=this._children;if(null!==e)for(var i=0;i<e.length;i++){var n=e[i];if(n&&n.tag===t)return n}return null},getChildByName:function(t){if(!t)return e.log("Invalid name"),null;for(var i=this._children,n=0,r=i.length;r>n;n++)if(i[n]._name===t)return i[n];return null},addChild:function(t,i,n){i=void 0===i?t._localZOrder:i;var r,s=!1;if(e.js.isUndefined(n))n=void 0,r=t._name;else if(e.js.isString(n))r=n,n=void 0;else if(e.js.isNumber(n))s=!0,r="";e.assert(t,e._LogInfos.Node.addChild_3),e.assert(null===t._parent,"child already added. It can't be added again"),this._addChildHelper(t,i,n,r,s)},_addChildHelper:function(t,i,n,r,s){if(!this._children)this._children=[];if(this._insertChild(t,i),s)t.setTag(n);else t.setName(r);if(t.setParent(this),t.setOrderOfArrival(e.s_globalOrderOfArrival++),this._running)if(t.onEnter(),this._isTransitionFinished)t.onEnterTransitionDidFinish();if(this._cascadeColorEnabled)t._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.colorDirty);if(this._cascadeOpacityEnabled)t._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.opacityDirty)},removeFromParent:function(t){if(this._parent){if(void 0===t)t=!0;this._parent.removeChild(this,t)}},removeFromParentAndCleanup:function(t){e.log(e._LogInfos.Node.removeFromParentAndCleanup),this.removeFromParent(t)},removeChild:function(t,i){if(0!==this._children.length){if(void 0===i)i=!0;if(this._children.indexOf(t)>-1)this._detachChild(t,i);e.renderer.childrenOrderDirty=!0}},removeChildByTag:function(t,i){if(t===e.macro.NODE_TAG_INVALID)e.log(e._LogInfos.Node.removeChildByTag);var n=this.getChildByTag(t);if(!n)e.log(e._LogInfos.Node.removeChildByTag_2,t);else this.removeChild(n,i)},removeAllChildrenWithCleanup:function(t){this.removeAllChildren(t)},removeAllChildren:function(t){var i=this._children;if(null!==i){if(void 0===t)t=!0;for(var n=0;n<i.length;n++){var r=i[n];if(r){if(this._running)r.onExitTransitionDidStart(),r.onExit();if(t)r.cleanup();r.parent=null,r._renderCmd.detachFromParent()}}this._children.length=0,e.renderer.childrenOrderDirty=!0}},_detachChild:function(t,i){if(this._running)t.onExitTransitionDidStart(),t.onExit();if(i)t.cleanup();t.parent=null,t._renderCmd.detachFromParent(),e.js.array.remove(this._children,t);
},_insertChild:function(t,i){e.renderer.childrenOrderDirty=this._reorderChildDirty=!0,this._children.push(t),t._setLocalZOrder(i)},setNodeDirty:function(){this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},reorderChild:function(t,i){e.assert(t,e._LogInfos.Node.reorderChild),e.renderer.childrenOrderDirty=this._reorderChildDirty=!0,t.arrivalOrder=e.s_globalOrderOfArrival,e.s_globalOrderOfArrival++,t._setLocalZOrder(i)},sortAllChildren:function(){if(this._reorderChildDirty){var t,e,i,n=this._children,r=n.length;for(t=1;r>t;t++){for(i=n[t],e=t-1;e>=0;){if(i._localZOrder<n[e]._localZOrder)n[e+1]=n[e];else if(i._localZOrder===n[e]._localZOrder&&i.arrivalOrder<n[e].arrivalOrder)n[e+1]=n[e];else break;e--}n[e+1]=i}this._reorderChildDirty=!1}},draw:function(t){},transformAncestors:function(){if(null!==this._parent)this._parent.transformAncestors(),this._parent.transform()},onEnter:function(){this._isTransitionFinished=!1,this._running=!0,this._arrayMakeObjectsPerformSelector(this._children,_ccsg.Node._stateCallbackType.onEnter),this.resume()},onEnterTransitionDidFinish:function(){this._isTransitionFinished=!0,this._arrayMakeObjectsPerformSelector(this._children,_ccsg.Node._stateCallbackType.onEnterTransitionDidFinish)},onExitTransitionDidStart:function(){this._arrayMakeObjectsPerformSelector(this._children,_ccsg.Node._stateCallbackType.onExitTransitionDidStart)},onExit:function(){this._running=!1,this.pause(),this._arrayMakeObjectsPerformSelector(this._children,_ccsg.Node._stateCallbackType.onExit)},runAction:function(t){return e.assert(t,e._LogInfos.Node.runAction),this.actionManager.addAction(t,this,!this._running),t},stopAllActions:function(){this.actionManager&&this.actionManager.removeAllActionsFromTarget(this)},stopAction:function(t){this.actionManager.removeAction(t)},stopActionByTag:function(t){if(t===e.Action.TAG_INVALID)return void e.log(e._LogInfos.Node.stopActionByTag);else return void this.actionManager.removeActionByTag(t,this)},getActionByTag:function(t){if(t===e.Action.TAG_INVALID)return e.log(e._LogInfos.Node.getActionByTag),null;else return this.actionManager.getActionByTag(t,this)},getNumberOfRunningActions:function(){return this.actionManager.numberOfRunningActionsInTarget(this)},scheduleUpdate:function(){this.scheduleUpdateWithPriority(0)},scheduleUpdateWithPriority:function(t){this.scheduler.scheduleUpdate(this,t,!this._running)},unscheduleUpdate:function(){this.scheduler.unscheduleUpdate(this)},schedule:function(t,i,n,r,s){var o=arguments.length;if("function"==typeof t){if(1===o)i=0,n=e.macro.REPEAT_FOREVER,r=0,s=this.__instanceId;else if(2===o)if("number"==typeof i)n=e.macro.REPEAT_FOREVER,r=0,s=this.__instanceId;else s=i,i=0,n=e.macro.REPEAT_FOREVER,r=0;else if(3===o){if("string"==typeof n)s=n,n=e.macro.REPEAT_FOREVER;else s=this.__instanceId;r=0}else if(4===o)s=this.__instanceId}else if(1===o)i=0,n=e.macro.REPEAT_FOREVER,r=0;else if(2===o)n=e.macro.REPEAT_FOREVER,r=0;e.assert(t,e._LogInfos.Node.schedule),e.assert(i>=0,e._LogInfos.Node.schedule_2),i=i||0,n=null==n?e.macro.REPEAT_FOREVER:n,r=r||0,this.scheduler.schedule(t,this,i,n,r,!this._running,s)},scheduleOnce:function(t,e,i){if(void 0===i)i=this.__instanceId;this.schedule(t,0,0,e,i)},unschedule:function(t){if(t)this.scheduler.unschedule(t,this)},unscheduleAllCallbacks:function(){this.scheduler.unscheduleAllForTarget(this)},resumeSchedulerAndActions:function(){e.log(e._LogInfos.Node.resumeSchedulerAndActions),this.resume()},resume:function(){this.scheduler.resumeTarget(this),this.actionManager&&this.actionManager.resumeTarget(this),e.eventManager.resumeTarget(this)},pauseSchedulerAndActions:function(){e.log(e._LogInfos.Node.pauseSchedulerAndActions),this.pause()},pause:function(){this.scheduler.pauseTarget(this),this.actionManager&&this.actionManager.pauseTarget(this),e.eventManager.pauseTarget(this)},setAdditionalTransform:function(t){if(void 0===t)return this._additionalTransformDirty=!1;else return this._additionalTransform=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty),void(this._additionalTransformDirty=!0)},getParentToNodeTransform:function(){return this._renderCmd.getParentToNodeTransform()},parentToNodeTransform:function(){return this.getParentToNodeTransform()},getNodeToWorldTransform:function(){var t;if(this._renderCmd&&e._renderType===e.game.RENDER_TYPE_CANVAS)t=this._renderCmd._worldTransform;else{t=this.getNodeToParentTransform();for(var i=this._parent;null!==i;i=i.parent)t=e.affineTransformConcat(t,i.getNodeToParentTransform())}return t},nodeToWorldTransform:function(){return this.getNodeToWorldTransform()},getWorldToNodeTransform:function(){return e.affineTransformInvert(this.getNodeToWorldTransform())},worldToNodeTransform:function(){return this.getWorldToNodeTransform()},convertToNodeSpace:function(t){return e.pointApplyAffineTransform(t,this.getWorldToNodeTransform())},convertToWorldSpace:function(t){return t=t||e.p(0,0),e.pointApplyAffineTransform(t,this.getNodeToWorldTransform())},convertToNodeSpaceAR:function(t){return e.pSub(this.convertToNodeSpace(t),this._renderCmd.getAnchorPointInPoints())},convertToWorldSpaceAR:function(t){t=t||e.p(0,0);var i=e.pAdd(t,this._renderCmd.getAnchorPointInPoints());return this.convertToWorldSpace(i)},_convertToWindowSpace:function(t){var i=this.convertToWorldSpace(t);return e.director.convertToUI(i)},convertTouchToNodeSpace:function(t){var e=t.getLocation();return this.convertToNodeSpace(e)},convertTouchToNodeSpaceAR:function(t){var i=e.director.convertToGL(t.getLocation());return this.convertToNodeSpaceAR(i)},updateTransform:function(){this._arrayMakeObjectsPerformSelector(this._children,_ccsg.Node._stateCallbackType.updateTransform)},retain:function(){},release:function(){},visit:function(t){this._renderCmd.visit(t)},transform:function(t,e){this._renderCmd.transform(t,e)},nodeToParentTransform:function(){return this.getNodeToParentTransform()},getNodeToParentTransform:function(t){var i=this._renderCmd.getNodeToParentTransform();if(t){for(var n={a:i.a,b:i.b,c:i.c,d:i.d,tx:i.tx,ty:i.ty},r=this._parent;null!=r&&r!=t;r=r.getParent())e.affineTransformConcatIn(n,r.getNodeToParentTransform());return n}else return i},getNodeToParentAffineTransform:function(t){return this.getNodeToParentTransform(t)},getShaderProgram:function(){return this._renderCmd.getShaderProgram()},setShaderProgram:function(t){this._renderCmd.setShaderProgram(t)},getGLServerState:function(){return 0},setGLServerState:function(t){},getBoundingBoxToWorld:function(){var t=e.rect(0,0,this._contentSize.width,this._contentSize.height),i=this.getNodeToWorldTransform();if(e._rectApplyAffineTransformIn(t,i),!this._children)return t;for(var n=this._children,r=0;r<n.length;r++){var s=n[r];if(s&&s._visible){var o=s._getBoundingBoxToCurrentNode(i);if(o)t=e.rectUnion(t,o)}}return t},_getBoundingBoxToCurrentNode:function(t){var i=e.rect(0,0,this._contentSize.width,this._contentSize.height),n=void 0===t?this.getNodeToParentTransform():e.affineTransformConcat(this.getNodeToParentTransform(),t);if(e._rectApplyAffineTransformIn(i,n),!this._children)return i;for(var r=this._children,s=0;s<r.length;s++){var o=r[s];if(o&&o._visible){var a=o._getBoundingBoxToCurrentNode(n);if(a)i=e.rectUnion(i,a)}}return i},getOpacity:function(){return this._realOpacity},getDisplayedOpacity:function(){return this._renderCmd.getDisplayedOpacity()},setOpacity:function(t){this._realOpacity=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.opacityDirty)},updateDisplayedOpacity:function(t){this._renderCmd._updateDisplayOpacity(t)},isCascadeOpacityEnabled:function(){return this._cascadeOpacityEnabled},setCascadeOpacityEnabled:function(t){if(this._cascadeOpacityEnabled!==t)this._cascadeOpacityEnabled=t,this._renderCmd.setCascadeOpacityEnabledDirty()},getColor:function(){var t=this._realColor;return e.color(t.r,t.g,t.b,t.a)},getDisplayedColor:function(){return this._renderCmd.getDisplayedColor()},setColor:function(t){var e=this._realColor;e.r=t.r,e.g=t.g,e.b=t.b,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.colorDirty)},updateDisplayedColor:function(t){this._renderCmd._updateDisplayColor(t)},isCascadeColorEnabled:function(){return this._cascadeColorEnabled},setCascadeColorEnabled:function(t){if(this._cascadeColorEnabled!==t)this._cascadeColorEnabled=t,this._renderCmd.setCascadeColorEnabledDirty()},setOpacityModifyRGB:function(t){},isOpacityModifyRGB:function(){return!1},_initRendererCmd:function(){this._renderCmd=e.renderer.getRenderCmd(this)},_createRenderCmd:function(){if(e._renderType===e.game.RENDER_TYPE_CANVAS)return new _ccsg.Node.CanvasRenderCmd(this);else return new _ccsg.Node.WebGLRenderCmd(this)}}),_ccsg.Node.extend=function(t){return e._Class.extend.call(_ccsg.Node,t)},_ccsg.Node.prototype.ctor=_ccsg.Node,_ccsg.Node._stateCallbackType={onEnter:1,onExit:2,cleanup:3,onEnterTransitionDidFinish:4,updateTransform:5,onExitTransitionDidStart:6,sortAllChildren:7},e.assert(e.js.isFunction(e._tmp.PrototypeCCNode),e._LogInfos.MissingFile,"BaseNodesPropertyDefine.js"),e._tmp.PrototypeCCNode(),delete e._tmp.PrototypeCCNode,e.CustomRenderCmd=function(t,e){this._needDraw=!0,this._target=t,this._callback=e,this.rendering=function(t,e,i){if(this._callback)this._callback.call(this._target,t,e,i)}},_ccsg.Node._dirtyFlags={transformDirty:1,visibleDirty:2,colorDirty:4,opacityDirty:8,cacheDirty:16,orderDirty:32,textDirty:64,gradientDirty:128,COUNT:8},e.js.get(_ccsg.Node._dirtyFlags,"all",function(){var t=_ccsg.Node._dirtyFlags.COUNT;return(1<<t)-1},!1),_ccsg.Node._requestDirtyFlag=function(t){e.assert(!_ccsg.Node._dirtyFlags[t],e._LogInfos.Node._requestDirtyFlag,t);var i=_ccsg.Node._dirtyFlags.COUNT,n=1<<i;return _ccsg.Node._dirtyFlags[t]=n,_ccsg.Node._dirtyFlags.COUNT++,n},_ccsg.Node.RenderCmd=function(t){this._dirtyFlag=1,e.renderer.pushDirtyNode(this),this._node=t,this._needDraw=!1,this._anchorPointInPoints=new e.Vec2(0,0),this._transform={a:1,b:0,c:0,d:1,tx:0,ty:0},this._worldTransform={a:1,b:0,c:0,d:1,tx:0,ty:0},this._inverse={a:1,b:0,c:0,d:1,tx:0,ty:0},this._displayedOpacity=255,this._displayedColor=e.color(255,255,255,255),this._cascadeColorEnabledDirty=!1,this._cascadeOpacityEnabledDirty=!1,this._curLevel=-1},_ccsg.Node.RenderCmd.prototype={constructor:_ccsg.Node.RenderCmd,getAnchorPointInPoints:function(){return e.p(this._anchorPointInPoints)},getDisplayedColor:function(){var t=this._displayedColor;return e.color(t.r,t.g,t.b,t.a)},getDisplayedOpacity:function(){return this._displayedOpacity},setCascadeColorEnabledDirty:function(){this._cascadeColorEnabledDirty=!0,this.setDirtyFlag(_ccsg.Node._dirtyFlags.colorDirty)},setCascadeOpacityEnabledDirty:function(){this._cascadeOpacityEnabledDirty=!0,this.setDirtyFlag(_ccsg.Node._dirtyFlags.opacityDirty)},getParentToNodeTransform:function(){if(this._dirtyFlag&_ccsg.Node._dirtyFlags.transformDirty)this._inverse=e.affineTransformInvert(this.getNodeToParentTransform());return this._inverse},detachFromParent:function(){},_updateAnchorPointInPoint:function(){var t=this._anchorPointInPoints,e=this._node._contentSize,i=this._node._anchorPoint;t.x=e.width*i.x,t.y=e.height*i.y,this.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},setDirtyFlag:function(t){if(0===this._dirtyFlag&&0!==t)e.renderer.pushDirtyNode(this);this._dirtyFlag|=t},getParentRenderCmd:function(){if(this._node&&this._node._parent&&this._node._parent._renderCmd)return this._node._parent._renderCmd;else return null},_updateDisplayColor:function(t){var i,n,r,s,o=this._node,a=this._displayedColor,c=o._realColor;if(this._cascadeColorEnabledDirty&&!o._cascadeColorEnabled){a.r=c.r,a.g=c.g,a.b=c.b;var l=new e.Color(255,255,255,255);for(r=o._children,i=0,n=r.length;n>i;i++)if(s=r[i],s&&s._renderCmd)s._renderCmd._updateDisplayColor(l);this._cascadeColorEnabledDirty=!1}else{if(void 0===t){var h=o._parent;if(h&&h._cascadeColorEnabled)t=h.getDisplayedColor();else t=e.Color.WHITE}if(a.r=0|c.r*t.r/255,a.g=0|c.g*t.g/255,a.b=0|c.b*t.b/255,o._cascadeColorEnabled)for(r=o._children,i=0,n=r.length;n>i;i++)if(s=r[i],s&&s._renderCmd)s._renderCmd._updateDisplayColor(a),s._renderCmd._updateColor()}this._dirtyFlag=this._dirtyFlag&_ccsg.Node._dirtyFlags.colorDirty^this._dirtyFlag},_updateDisplayOpacity:function(t){var e,i,n,r,s=this._node;if(this._cascadeOpacityEnabledDirty&&!s._cascadeOpacityEnabled){for(this._displayedOpacity=s._realOpacity,n=s._children,e=0,i=n.length;i>e;e++)if(r=n[e],r&&r._renderCmd)r._renderCmd._updateDisplayOpacity(255);this._cascadeOpacityEnabledDirty=!1}else{if(void 0===t){var o=s._parent;if(t=255,o&&o._cascadeOpacityEnabled)t=o.getDisplayedOpacity()}if(this._displayedOpacity=s._realOpacity*t/255,s._cascadeOpacityEnabled)for(n=s._children,e=0,i=n.length;i>e;e++)if(r=n[e],r&&r._renderCmd)r._renderCmd._updateDisplayOpacity(this._displayedOpacity),r._renderCmd._updateColor()}this._dirtyFlag=this._dirtyFlag&_ccsg.Node._dirtyFlags.opacityDirty^this._dirtyFlag},_syncDisplayColor:function(t){var i=this._node,n=this._displayedColor,r=i._realColor;if(void 0===t){var s=i._parent;if(s&&s._cascadeColorEnabled)t=s.getDisplayedColor();else t=e.Color.WHITE}n.r=0|r.r*t.r/255,n.g=0|r.g*t.g/255,n.b=0|r.b*t.b/255},_syncDisplayOpacity:function(t){var e=this._node;if(void 0===t){var i=e._parent;if(t=255,i&&i._cascadeOpacityEnabled)t=i.getDisplayedOpacity()}this._displayedOpacity=e._realOpacity*t/255},_updateColor:function(){},updateStatus:function(){var t=_ccsg.Node._dirtyFlags,e=this._dirtyFlag,i=e&t.colorDirty,n=e&t.opacityDirty;if(i)this._updateDisplayColor();if(n)this._updateDisplayOpacity();if(i||n)this._updateColor();if(e&t.transformDirty)this.transform(this.getParentRenderCmd(),!0),this._dirtyFlag=this._dirtyFlag&_ccsg.Node._dirtyFlags.transformDirty^this._dirtyFlag},getNodeToParentTransform:function(){var t=this._node;if(this._dirtyFlag&_ccsg.Node._dirtyFlags.transformDirty){var i=this._transform;i.tx=t._position.x,i.ty=t._position.y;var n=1,r=0,s=0,o=1;if(t._rotationX){var a=.017453292519943295*t._rotationX;s=Math.sin(a),o=Math.cos(a)}if(t._rotationY){var c=.017453292519943295*t._rotationY;n=Math.cos(c),r=-Math.sin(c)}i.a=n,i.b=r,i.c=s,i.d=o;var l=t._scaleX,h=t._scaleY,u=this._anchorPointInPoints.x,d=this._anchorPointInPoints.y,f=1e-6>l&&l>-1e-6?1e-6:l,_=1e-6>h&&h>-1e-6?1e-6:h;if(1!==l||1!==h)n=i.a*=f,r=i.b*=f,s=i.c*=_,o=i.d*=_;if(t._skewX||t._skewY){var p=Math.tan(-t._skewX*Math.PI/180),g=Math.tan(-t._skewY*Math.PI/180);if(p===1/0)p=99999999;if(g===1/0)g=99999999;var m=d*p,v=u*g;i.a=n-s*g,i.b=r-o*g,i.c=s-n*p,i.d=o-r*p,i.tx+=n*m+s*v,i.ty+=r*m+o*v}if(i.tx-=n*u+s*d,i.ty-=r*u+o*d,t._ignoreAnchorPointForPosition)i.tx+=u,i.ty+=d;if(t._additionalTransformDirty)this._transform=e.affineTransformConcat(i,t._additionalTransform)}return this._transform},_syncStatus:function(t){var e=_ccsg.Node._dirtyFlags,i=this._dirtyFlag,n=t?t._node:null;if(n&&n._cascadeColorEnabled&&t._dirtyFlag&e.colorDirty)i|=e.colorDirty;if(n&&n._cascadeOpacityEnabled&&t._dirtyFlag&e.opacityDirty)i|=e.opacityDirty;if(t&&t._dirtyFlag&e.transformDirty)i|=e.transformDirty;var r=i&e.colorDirty,s=i&e.opacityDirty,o=i&e.transformDirty;if(this._dirtyFlag=i,r)this._syncDisplayColor();if(s)this._syncDisplayOpacity();if(r)this._updateColor();if(o)this.transform(t,!0)},visitChildren:function(){var t,i,n=this._node,r=n._children,s=r.length;if(s>0){for(n.sortAllChildren(),t=0;s>t&&(i=r[t],i._localZOrder<0);t++)i._renderCmd.visit(this);for(e.renderer.pushRenderCommand(this);s>t;t++)r[t]._renderCmd.visit(this)}else e.renderer.pushRenderCommand(this);this._dirtyFlag=0}},_ccsg.Node.CanvasRenderCmd=function(t){_ccsg.Node.RenderCmd.call(this,t),this._cachedParent=null,this._cacheDirty=!1};var l=_ccsg.Node.CanvasRenderCmd.prototype=Object.create(_ccsg.Node.RenderCmd.prototype);l.constructor=_ccsg.Node.CanvasRenderCmd,l.transform=function(t,e){var i=this.getNodeToParentTransform(),n=this._worldTransform;if(this._cacheDirty=!0,t){var r=t._worldTransform;n.a=i.a*r.a+i.b*r.c,n.b=i.a*r.b+i.b*r.d,n.c=i.c*r.a+i.d*r.c,n.d=i.c*r.b+i.d*r.d,n.tx=r.a*i.tx+r.c*i.ty+r.tx,n.ty=r.d*i.ty+r.ty+r.b*i.tx}else n.a=i.a,n.b=i.b,n.c=i.c,n.d=i.d,n.tx=i.tx,n.ty=i.ty;if(e){var s=this._node._children;if(!s||0===s.length)return;var o,a;for(o=0,a=s.length;a>o;o++)s[o]._renderCmd.transform(this,e)}},l.visit=function(t){var e=this._node;if(e._visible){if(t=t||this.getParentRenderCmd())this._curLevel=t._curLevel+1;this._syncStatus(t),this.visitChildren()}},l.setDirtyFlag=function(t,e){if(_ccsg.Node.RenderCmd.prototype.setDirtyFlag.call(this,t,e),this._setCacheDirty(e),this._cachedParent)this._cachedParent.setDirtyFlag(t,!0)},l._setCacheDirty=function(){if(this._cacheDirty===!1){this._cacheDirty=!0;var t=this._cachedParent;t&&t!==this&&t._setNodeDirtyForCache&&t._setNodeDirtyForCache()}},l._setCachedParent=function(t){if(this._cachedParent!==t){this._cachedParent=t;for(var e=this._node._children,i=0,n=e.length;n>i;i++)e[i]._renderCmd._setCachedParent(t)}},l.detachFromParent=function(){this._cachedParent=null;for(var t,e=this._node._children,i=0,n=e.length;n>i;i++)if(t=e[i],t&&t._renderCmd)t._renderCmd.detachFromParent()},l.setShaderProgram=function(t){},l.getShaderProgram=function(){return null},_ccsg.Node.CanvasRenderCmd._getCompositeOperationByBlendFunc=function(t){if(!t)return"source-over";else if(t.src===e.macro.SRC_ALPHA&&t.dst===e.macro.ONE||t.src===e.macro.ONE&&t.dst===e.macro.ONE)return"lighter";else if(t.src===e.macro.ZERO&&t.dst===e.macro.SRC_ALPHA)return"destination-in";else if(t.src===e.macro.ZERO&&t.dst===e.macro.ONE_MINUS_SRC_ALPHA)return"destination-out";else return"source-over"};var h=e.math;_ccsg.Node.WebGLRenderCmd=function(t){_ccsg.Node.RenderCmd.call(this,t);var e=new h.Matrix4,i=e.mat;i[2]=i[3]=i[6]=i[7]=i[8]=i[9]=i[11]=i[14]=0,i[10]=i[15]=1,this._transform4x4=e,this._stackMatrix=new h.Matrix4,this._shaderProgram=null,this._camera=null};var l=_ccsg.Node.WebGLRenderCmd.prototype=Object.create(_ccsg.Node.RenderCmd.prototype);l.constructor=_ccsg.Node.WebGLRenderCmd,l._updateColor=function(){},l.visit=function(t){var i=this._node;if(i._visible){if(t=t||this.getParentRenderCmd(),i._parent&&i._parent._renderCmd)this._curLevel=i._parent._renderCmd._curLevel+1;var n=e.current_stack;n.stack.push(n.top),this._syncStatus(t),n.top=this._stackMatrix,this.visitChildren(),n.top=n.stack.pop()}},l.transform=function(t,i){var n=this._transform4x4,r=this._stackMatrix,s=this._node;t=t||this.getParentRenderCmd();var o=t?t._stackMatrix:e.current_stack.top,a=this.getNodeToParentTransform();this._dirtyFlag=this._dirtyFlag&_ccsg.Node._dirtyFlags.transformDirty^this._dirtyFlag;var c=n.mat;if(c[0]=a.a,c[4]=a.c,c[12]=a.tx,c[1]=a.b,c[5]=a.d,c[13]=a.ty,c[14]=s._vertexZ,h.mat4Multiply(r,o,n),i&&s._children&&0!==s._children.length){var l,u,d=s._children;for(l=0,u=d.length;u>l;l++)d[l]._renderCmd.transform(this,i)}},l.setShaderProgram=function(t){this._shaderProgram=t},l.getShaderProgram=function(){return this._shaderProgram},_ccsg.Scene=_ccsg.Node.extend({_className:"Scene",ctor:function(){_ccsg.Node.prototype.ctor.call(this),this._ignoreAnchorPointForPosition=!0,this.setAnchorPoint(.5,.5),this.setContentSize(e.director.getWinSize())}}),e.LoaderScene=_ccsg.Scene.extend({_interval:null,_label:null,_className:"LoaderScene",_onProjectionChange:null,cb:null,target:null,init:function(){var t=this,i=160,n=200,r=t._bgLayer=new e.LayerColor(e.color(32,32,32,255));t.addChild(r,0);var s=24,o=-n/2+100;if(e._loaderImage){var a=new Image;a.src=e._loaderImage,i=a.width,n=a.height,t._initStage(a,e.visibleRect.center),s=14,o=-n/2-10}var c=t._label=new e.LabelTTF("Loading... 0%","Arial",s);return c.setPosition(e.pAdd(e.visibleRect.center,e.p(0,o))),c.setColor(e.color(180,180,180)),r.addChild(this._label,10),!0},_initStage:function(t,i){var n=this,r=n._texture2d=new e.Texture2D;r.initWithElement(t),r.handleLoadedTexture();var s=n._logo=new _ccsg.Sprite(r);s.x=i.x,s.y=i.y,n._bgLayer.addChild(s,10)},onEnter:function(){var t=this;_ccsg.Node.prototype.onEnter.call(t),t.schedule(t._startLoading,.3),this._onProjectionChange=function(){t._updateTransform()},e.director.on(e.Director.EVENT_PROJECTION_CHANGED,this._onProjectionChange)},onExit:function(){e.director.off(e.Director.EVENT_PROJECTION_CHANGED,this._onProjectionChange),_ccsg.Node.prototype.onExit.call(this);var t="Loading... 0%";this._label.setString(t)},initWithResources:function(t,i,n){if(e.js.isString(t))t=[t];this.resources=t||[],this.cb=i,this.target=n},_startLoading:function(){var t=this;t.unschedule(t._startLoading);var i=t.resources;e.loader.load(i,function(e,i){var n=e/i*100|0;n=Math.min(n,100),t._label.setString("Loading... "+n+"%")},function(e,i){if(t.cb)t.cb.call(t.target,e,i)})},_updateTransform:function(){this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty),this._bgLayer._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty),this._label._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty),this._logo._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)}}),e.LoaderScene.preload=function(t,i,n){var r=e;if(!r.loaderScene)r.loaderScene=new e.LoaderScene,r.loaderScene.init();return r.loaderScene.initWithResources(t,i,n),e.director.runScene(r.loaderScene),r.loaderScene},e.Layer=_ccsg.Node.extend({_className:"Layer",ctor:function(){var t=_ccsg.Node.prototype;t.ctor.call(this),this._ignoreAnchorPointForPosition=!0,t.setAnchorPoint.call(this,.5,.5),t.setContentSize.call(this,e.winSize)},init:function(){var t=this;return t._ignoreAnchorPointForPosition=!0,t.setAnchorPoint(.5,.5),t.setContentSize(e.winSize),t._cascadeColorEnabled=!1,t._cascadeOpacityEnabled=!1,!0},bake:function(){this._renderCmd.bake()},unbake:function(){this._renderCmd.unbake()},isBaked:function(){return this._renderCmd._isBaked},addChild:function(t,e,i){_ccsg.Node.prototype.addChild.call(this,t,e,i),this._renderCmd._bakeForAddChild(t)},_createRenderCmd:function(){if(e._renderType===e.game.RENDER_TYPE_CANVAS)return new e.Layer.CanvasRenderCmd(this);else return new e.Layer.WebGLRenderCmd(this)}}),e.LayerColor=e.Layer.extend({_blendFunc:null,_className:"LayerColor",getBlendFunc:function(){return this._blendFunc},changeWidthAndHeight:function(t,e){this.width=t,this.height=e},changeWidth:function(t){this.width=t},changeHeight:function(t){this.height=t},setOpacityModifyRGB:function(t){},isOpacityModifyRGB:function(){return!1},ctor:function(t,i,n){e.Layer.prototype.ctor.call(this),this._blendFunc=new e.BlendFunc(e.macro.SRC_ALPHA,e.macro.ONE_MINUS_SRC_ALPHA),e.LayerColor.prototype.init.call(this,t,i,n)},init:function(t,i,n){if(e._renderType!==e.game.RENDER_TYPE_CANVAS)this.shaderProgram=e.shaderCache.programForKey(e.macro.SHADER_POSITION_COLOR);var r=e.director.getWinSize();t=t||e.color(0,0,0,255),i=void 0===i?r.width:i,n=void 0===n?r.height:n;var s=this._realColor;return s.r=t.r,s.g=t.g,s.b=t.b,this._realOpacity=t.a,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.colorDirty|_ccsg.Node._dirtyFlags.opacityDirty),e.LayerColor.prototype.setContentSize.call(this,i,n),!0},setBlendFunc:function(t,e){var i=this._blendFunc;if(void 0===e)i.src=t.src,i.dst=t.dst;else i.src=t,i.dst=e;this._renderCmd.updateBlendFunc(i)},_setWidth:function(t){_ccsg.Node.prototype._setWidth.call(this,t),this._renderCmd._updateSquareVerticesWidth(t)},_setHeight:function(t){_ccsg.Node.prototype._setHeight.call(this,t),this._renderCmd._updateSquareVerticesHeight(t)},setContentSize:function(t,i){e.Layer.prototype.setContentSize.call(this,t,i),this._renderCmd._updateSquareVertices(t,i)},_createRenderCmd:function(){if(e._renderType===e.game.RENDER_TYPE_CANVAS)return new e.LayerColor.CanvasRenderCmd(this);else return new e.LayerColor.WebGLRenderCmd(this)}}),function(){var t=e.LayerColor.prototype;e.defineGetterSetter(t,"width",t._getWidth,t._setWidth),e.defineGetterSetter(t,"height",t._getHeight,t._setHeight)}(),e.LayerGradient=e.LayerColor.extend({_endColor:null,_startOpacity:255,_endOpacity:255,_alongVector:null,_compressedInterpolation:!1,_className:"LayerGradient",_colorStops:[],ctor:function(t,i,n,r){if(e.LayerColor.prototype.ctor.call(this),this._endColor=e.color(0,0,0,255),this._alongVector=e.p(0,-1),this._startOpacity=255,this._endOpacity=255,r&&r instanceof Array)this._colorStops=r,r.splice(0,0,{p:0,color:t||e.Color.BLACK}),r.push({p:1,color:i||e.Color.BLACK});else this._colorStops=[{p:0,color:t||e.Color.BLACK},{p:1,color:i||e.Color.BLACK}];e.LayerGradient.prototype.init.call(this,t,i,n,r)},init:function(t,i,n,r){t=t||e.color(0,0,0,255),i=i||e.color(0,0,0,255),n=n||e.p(0,-1);var s=this,o=s._endColor;return s._startOpacity=t.a,o.r=i.r,o.g=i.g,o.b=i.b,s._endOpacity=i.a,s._alongVector=n,s._compressedInterpolation=!0,e.LayerColor.prototype.init.call(s,e.color(t.r,t.g,t.b,255)),this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.colorDirty|_ccsg.Node._dirtyFlags.opacityDirty|_ccsg.Node._dirtyFlags.gradientDirty),!0},setContentSize:function(t,i){e.LayerColor.prototype.setContentSize.call(this,t,i),this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.gradientDirty)},_setWidth:function(t){e.LayerColor.prototype._setWidth.call(this,t),this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.gradientDirty)},_setHeight:function(t){e.LayerColor.prototype._setHeight.call(this,t),this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.gradientDirty)},getStartColor:function(){return e.color(this._realColor)},setStartColor:function(t){this.color=t;var e=this._colorStops;if(e&&e.length>0){var i=e[0].color;i.r=t.r,i.g=t.g,i.b=t.b}},setEndColor:function(t){var e=this._endColor;e.r=t.r,e.g=t.g,e.b=t.b;var i=this._colorStops;if(i&&i.length>0){var n=i[i.length-1].color;n.r=t.r,n.g=t.g,n.b=t.b}this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.colorDirty)},getEndColor:function(){return e.color(this._endColor)},setStartOpacity:function(t){this._startOpacity=t;var e=this._colorStops;if(e&&e.length>0)e[0].color.a=t;this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.opacityDirty)},getStartOpacity:function(){return this._startOpacity},setEndOpacity:function(t){this._endOpacity=t;var e=this._colorStops;if(e&&e.length>0)e[e.length-1].color.a=t;this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.opacityDirty)},getEndOpacity:function(){return this._endOpacity},setVector:function(t){this._alongVector.x=t.x,this._alongVector.y=t.y,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.gradientDirty)},getVector:function(){return e.p(this._alongVector.x,this._alongVector.y)},isCompressedInterpolation:function(){return this._compressedInterpolation},setCompressedInterpolation:function(t){this._compressedInterpolation=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.gradientDirty)},getColorStops:function(){return this._colorStops},setColorStops:function(t){this._colorStops=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.colorDirty|_ccsg.Node._dirtyFlags.opacityDirty|_ccsg.Node._dirtyFlags.gradientDirty)},_createRenderCmd:function(){if(e._renderType===e.game.RENDER_TYPE_CANVAS)return new e.LayerGradient.CanvasRenderCmd(this);else return new e.LayerGradient.WebGLRenderCmd(this)}}),function(){var t=e.LayerGradient.prototype;t.startColor,e.defineGetterSetter(t,"startColor",t.getStartColor,t.setStartColor),t.endColor,e.defineGetterSetter(t,"endColor",t.getEndColor,t.setEndColor),t.startOpacity,e.defineGetterSetter(t,"startOpacity",t.getStartOpacity,t.setStartOpacity),t.endOpacity,e.defineGetterSetter(t,"endOpacity",t.getEndOpacity,t.setEndOpacity),t.vector,e.defineGetterSetter(t,"vector",t.getVector,t.setVector),t.colorStops,e.defineGetterSetter(t,"colorStops",t.getColorStops,t.setColorStops)}(),e.LayerMultiplex=e.Layer.extend({_enabledLayer:0,_layers:null,_className:"LayerMultiplex",ctor:function(t){if(e.Layer.prototype.ctor.call(this),t instanceof Array)e.LayerMultiplex.prototype.initWithLayers.call(this,t);else e.LayerMultiplex.prototype.initWithLayers.call(this,Array.prototype.slice.call(arguments))},initWithLayers:function(t){if(t.length>0&&null==t[t.length-1])e.log(e._LogInfos.LayerMultiplex.initWithLayers);return this._layers=t,this._enabledLayer=0,this.addChild(this._layers[this._enabledLayer]),!0},switchTo:function(t){if(t>=this._layers.length)return void e.log(e._LogInfos.LayerMultiplex.switchTo);else return this.removeChild(this._layers[this._enabledLayer],!0),this._enabledLayer=t,void this.addChild(this._layers[t])},switchToAndReleaseMe:function(t){if(t>=this._layers.length)return void e.log(e._LogInfos.LayerMultiplex.switchToAndReleaseMe);else return this.removeChild(this._layers[this._enabledLayer],!0),this._layers[this._enabledLayer]=null,this._enabledLayer=t,void this.addChild(this._layers[t])},addLayer:function(t){if(!t)return void e.log(e._LogInfos.LayerMultiplex.addLayer);else return void this._layers.push(t)}}),function(){e.Layer.CanvasRenderCmd=function(t){_ccsg.Node.CanvasRenderCmd.call(this,t),this._isBaked=!1,this._bakeSprite=null,this._updateCache=2};var t=e.Layer.CanvasRenderCmd.prototype=Object.create(_ccsg.Node.CanvasRenderCmd.prototype);t.constructor=e.Layer.CanvasRenderCmd,t._setCacheDirty=function(t){if(t&&0===this._updateCache)this._updateCache=2;if(this._cacheDirty===!1){this._cacheDirty=!0;var e=this._cachedParent;e&&e!==this&&e._setNodeDirtyForCache&&e._setNodeDirtyForCache()}},t.transform=function(t,e){var i=this._worldTransform,n=i.a,r=i.b,s=i.c,o=i.d;i.tx,i.ty;if(_ccsg.Node.CanvasRenderCmd.prototype.transform.call(this,t,e),(i.a!==n||i.b!==r||i.c!==s||i.d!==o)&&0===this._updateCache)this._updateCache=2},t.bake=function(){if(!this._isBaked){if(this._needDraw=!0,e.renderer.childrenOrderDirty=!0,this._isBaked=this._cacheDirty=!0,0===this._updateCache)this._updateCache=2;for(var t=this._node._children,i=0,n=t.length;n>i;i++)t[i]._renderCmd._setCachedParent(this);if(!this._bakeSprite)this._bakeSprite=new e.BakeSprite,this._bakeSprite.setAnchorPoint(0,0)}},t.unbake=function(){if(this._isBaked){if(e.renderer.childrenOrderDirty=!0,this._needDraw=!1,this._isBaked=!1,this._cacheDirty=!0,0===this._updateCache)this._updateCache=2;for(var t=this._node._children,i=0,n=t.length;n>i;i++)t[i]._renderCmd._setCachedParent(null)}},t.isBaked=function(){return this._isBaked},t.rendering=function(){if(this._cacheDirty){var t=this._node,i=t._children,n=this._bakeSprite;this.transform(this.getParentRenderCmd(),!0);var r=this._getBoundingBoxForBake();r.width=0|r.width+.5,r.height=0|r.height+.5;var s=n.getCacheContext(),o=s.getContext();if(n.setPosition(r.x,r.y),this._updateCache>0){n.resetCanvasSize(r.width,r.height),s.setOffset(0-r.x,o.canvas.height-r.height+r.y),t.sortAllChildren(),e.renderer._turnToCacheMode(this.__instanceId);for(var a=0,c=i.length;c>a;a++)i[a].visit(this);e.renderer._renderingToCacheCanvas(s,this.__instanceId),n.transform(),this._updateCache--}this._cacheDirty=!1}},t.visit=function(t){if(!this._isBaked)return void _ccsg.Node.CanvasRenderCmd.prototype.visit.call(this,t);var i=this._node,n=i._children,r=n.length;if(i._visible&&0!==r){if(this._syncStatus(t),e.renderer.pushRenderCommand(this),this._cacheDirty=!0,0===this._updateCache)this._updateCache=2;this._bakeSprite.visit(this),this._dirtyFlag=0}},t._bakeForAddChild=function(t){if(t._parent===this._node&&this._isBaked)t._renderCmd._setCachedParent(this)},t._getBoundingBoxForBake=function(){var t=null,i=this._node;if(!i._children||0===i._children.length)return e.rect(0,0,10,10);for(var n=i.getNodeToWorldTransform(),r=i._children,s=0,o=r.length;o>s;s++){var a=r[s];if(a&&a._visible)if(t){var c=a._getBoundingBoxToCurrentNode(n);if(c)t=e.rectUnion(t,c)}else t=a._getBoundingBoxToCurrentNode(n)}return t}}(),function(){e.LayerColor.CanvasRenderCmd=function(t){e.Layer.CanvasRenderCmd.call(this,t),this._needDraw=!0,this._blendFuncStr="source-over",this._bakeRenderCmd=new e.CustomRenderCmd(this,this._bakeRendering)};var t=e.LayerColor.CanvasRenderCmd.prototype=Object.create(e.Layer.CanvasRenderCmd.prototype);t.constructor=e.LayerColor.CanvasRenderCmd,t.unbake=function(){e.Layer.CanvasRenderCmd.prototype.unbake.call(this),this._needDraw=!0},t.rendering=function(t,i,n){var r=t||e._renderContext,s=r.getContext(),o=this._node,a=this._displayedColor,c=this._displayedOpacity/255,l=o._contentSize.width,h=o._contentSize.height;
if(0!==c)r.setCompositeOperation(this._blendFuncStr),r.setGlobalAlpha(c),r.setFillStyle("rgba("+(0|a.r)+","+(0|a.g)+","+(0|a.b)+", 1)"),r.setTransform(this._worldTransform,i,n),s.fillRect(0,0,l*i,-h*n),e.g_NumberOfDraws++},t.updateBlendFunc=function(t){this._blendFuncStr=_ccsg.Node.CanvasRenderCmd._getCompositeOperationByBlendFunc(t)},t._updateSquareVertices=t._updateSquareVerticesWidth=t._updateSquareVerticesHeight=function(){},t._bakeRendering=function(){if(this._cacheDirty){var t,i=this._node,n=this._bakeSprite,r=i._children,s=r.length;this.transform(this.getParentRenderCmd(),!0);var o=this._getBoundingBoxForBake();o.width=0|o.width+.5,o.height=0|o.height+.5;var a=n.getCacheContext(),c=a.getContext();if(n.setPosition(o.x,o.y),this._updateCache>0){c.fillStyle=a._currentFillStyle,n.resetCanvasSize(o.width,o.height),a.setOffset(0-o.x,c.canvas.height-o.height+o.y);var l;if(e.renderer._turnToCacheMode(this.__instanceId),s>0){for(i.sortAllChildren(),t=0;s>t&&(l=r[t],l._localZOrder<0);t++)l._renderCmd.visit(this);for(e.renderer.pushRenderCommand(this);s>t;t++)r[t]._renderCmd.visit(this)}else e.renderer.pushRenderCommand(this);e.renderer._renderingToCacheCanvas(a,this.__instanceId),n.transform(),this._updateCache--}this._cacheDirty=!1}},t.visit=function(t){if(!this._isBaked)return void _ccsg.Node.CanvasRenderCmd.prototype.visit.call(this,t);var i=this._node;if(i._visible)this._syncStatus(t),e.renderer.pushRenderCommand(this._bakeRenderCmd),this._bakeSprite._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty),this._bakeSprite.visit(this),this._dirtyFlag=0},t._getBoundingBoxForBake=function(){var t=this._node,i=e.rect(0,0,t._contentSize.width,t._contentSize.height),n=t.getNodeToWorldTransform();if(i=e.rectApplyAffineTransform(i,t.getNodeToWorldTransform()),!t._children||0===t._children.length)return i;for(var r=t._children,s=0;s<r.length;s++){var o=r[s];if(o&&o._visible){var a=o._getBoundingBoxToCurrentNode(n);i=e.rectUnion(i,a)}}return i}}(),function(){e.LayerGradient.RenderCmd={updateStatus:function(){var t=_ccsg.Node._dirtyFlags,e=this._dirtyFlag,i=e&t.colorDirty,n=e&t.opacityDirty;if(i)this._updateDisplayColor();if(n)this._updateDisplayOpacity();if(i||n||e&t.gradientDirty)this._updateColor();if(e&t.transformDirty)this.transform(this.getParentRenderCmd(),!0);this._dirtyFlag=0}}}(),function(){e.LayerGradient.CanvasRenderCmd=function(t){e.LayerColor.CanvasRenderCmd.call(this,t),this._needDraw=!0,this._startPoint=e.p(0,0),this._endPoint=e.p(0,0),this._startStopStr=null,this._endStopStr=null};var t=e.LayerGradient.CanvasRenderCmd.prototype=Object.create(e.LayerColor.CanvasRenderCmd.prototype);e.js.mixin(t,e.LayerGradient.RenderCmd),t.constructor=e.LayerGradient.CanvasRenderCmd,t.rendering=function(t,i,n){var r=t||e._renderContext,s=r.getContext(),o=this._node,a=this._displayedOpacity/255;if(0!==a){var c=o._contentSize.width,l=o._contentSize.height;r.setCompositeOperation(this._blendFuncStr),r.setGlobalAlpha(a);var h=s.createLinearGradient(this._startPoint.x*i,this._startPoint.y*n,this._endPoint.x*i,this._endPoint.y*n);if(o._colorStops)for(var u=0;u<o._colorStops.length;u++){var d=o._colorStops[u];h.addColorStop(d.p,this._colorStopsStr[u])}else h.addColorStop(0,this._startStopStr),h.addColorStop(1,this._endStopStr);r.setFillStyle(h),r.setTransform(this._worldTransform,i,n),s.fillRect(0,0,c*i,-l*n),e.g_NumberOfDraws++}},t._syncStatus=function(t){var e=_ccsg.Node._dirtyFlags,i=this._dirtyFlag,n=t?t._node:null;if(n&&n._cascadeColorEnabled&&t._dirtyFlag&e.colorDirty)i|=e.colorDirty;if(n&&n._cascadeOpacityEnabled&&t._dirtyFlag&e.opacityDirty)i|=e.opacityDirty;if(t&&t._dirtyFlag&e.transformDirty)i|=e.transformDirty;var r=i&e.colorDirty,s=i&e.opacityDirty;if(this._dirtyFlag=i,r)this._syncDisplayColor();if(s)this._syncDisplayOpacity();if(i&e.transformDirty)this.transform(t);if(r||s||i&e.gradientDirty)this._updateColor()},t._updateColor=function(){var t=this._node,i=t._contentSize,n=.5*i.width,r=.5*i.height;this._dirtyFlag=this._dirtyFlag&_ccsg.Node._dirtyFlags.gradientDirty^this._dirtyFlag;var s=e.pAngleSigned(e.p(0,-1),t._alongVector),o=e.pRotateByAngle(e.p(0,-1),e.p(0,0),s),a=Math.min(Math.abs(1/o.x),Math.abs(1/o.y));this._startPoint.x=n*(-o.x*a)+n,this._startPoint.y=r*(o.y*a)-r,this._endPoint.x=n*(o.x*a)+n,this._endPoint.y=r*(-o.y*a)-r;var c=this._displayedColor,l=t._endColor,h=t._startOpacity/255,u=t._endOpacity/255;if(this._startStopStr="rgba("+Math.round(c.r)+","+Math.round(c.g)+","+Math.round(c.b)+","+h.toFixed(4)+")",this._endStopStr="rgba("+Math.round(l.r)+","+Math.round(l.g)+","+Math.round(l.b)+","+u.toFixed(4)+")",t._colorStops){this._startOpacity=0,this._endOpacity=0,this._colorStopsStr=[];for(var d=0;d<t._colorStops.length;d++){var f=t._colorStops[d].color,_=null==f.a?1:f.a/255;this._colorStopsStr.push("rgba("+Math.round(f.r)+","+Math.round(f.g)+","+Math.round(f.b)+","+_.toFixed(4)+")")}}}}(),function(){e.Layer.WebGLRenderCmd=function(t){_ccsg.Node.WebGLRenderCmd.call(this,t)};var t=e.Layer.WebGLRenderCmd.prototype=Object.create(_ccsg.Node.WebGLRenderCmd.prototype);t.constructor=e.Layer.WebGLRenderCmd,t.bake=function(){},t.unbake=function(){},t._bakeForAddChild=function(){}}(),function(){e.LayerColor.WebGLRenderCmd=function(t){e.Layer.WebGLRenderCmd.call(this,t),this._needDraw=!0;var i=this;i._squareVerticesAB=new ArrayBuffer(32),i._squareColorsAB=new ArrayBuffer(16);var n=i._squareVerticesAB,r=i._squareColorsAB,s=e.Vertex2F.BYTES_PER_ELEMENT,o=e.WebGLColor.BYTES_PER_ELEMENT;i._squareVertices=[new e.Vertex2F(0,0,n,0),new e.Vertex2F(0,0,n,s),new e.Vertex2F(0,0,n,2*s),new e.Vertex2F(0,0,n,3*s)],i._squareColors=[new e.WebGLColor(0,0,0,255,r,0),new e.WebGLColor(0,0,0,255,r,o),new e.WebGLColor(0,0,0,255,r,2*o),new e.WebGLColor(0,0,0,255,r,3*o)],i._verticesFloat32Buffer=e._renderContext.createBuffer(),i._colorsUint8Buffer=e._renderContext.createBuffer()};var t=e.LayerColor.WebGLRenderCmd.prototype=Object.create(e.Layer.WebGLRenderCmd.prototype);t.constructor=e.LayerColor.WebGLRenderCmd,t.rendering=function(t){var i=t||e._renderContext,n=this._node;this._shaderProgram.use(),this._shaderProgram._setUniformForMVPMatrixWithMat4(this._stackMatrix),e.gl.enableVertexAttribs(e.macro.VERTEX_ATTRIB_FLAG_POSITION|e.macro.VERTEX_ATTRIB_FLAG_COLOR),e.gl.blendFunc(n._blendFunc.src,n._blendFunc.dst),i.bindBuffer(i.ARRAY_BUFFER,this._verticesFloat32Buffer),i.vertexAttribPointer(e.macro.VERTEX_ATTRIB_POSITION,2,i.FLOAT,!1,0,0),i.bindBuffer(i.ARRAY_BUFFER,this._colorsUint8Buffer),i.vertexAttribPointer(e.macro.VERTEX_ATTRIB_COLOR,4,i.UNSIGNED_BYTE,!0,0,0),i.drawArrays(i.TRIANGLE_STRIP,0,this._squareVertices.length)},t._updateSquareVertices=function(t,e){var i=this._squareVertices;if(void 0===e)i[1].x=t.width,i[2].y=t.height,i[3].x=t.width,i[3].y=t.height;else i[1].x=t,i[2].y=e,i[3].x=t,i[3].y=e;this._bindLayerVerticesBufferData()},t._updateSquareVerticesWidth=function(t){var e=this._squareVertices;e[1].x=t,e[3].x=t,this._bindLayerVerticesBufferData()},t._updateSquareVerticesHeight=function(t){var e=this._squareVertices;e[2].y=t,e[3].y=t,this._bindLayerVerticesBufferData()},t._updateColor=function(){for(var t=this._displayedColor,e=this._displayedOpacity,i=this._squareColors,n=0;4>n;n++)i[n].r=t.r,i[n].g=t.g,i[n].b=t.b,i[n].a=e;this._bindLayerColorsBufferData()},t._bindLayerVerticesBufferData=function(){var t=e._renderContext;t.bindBuffer(t.ARRAY_BUFFER,this._verticesFloat32Buffer),t.bufferData(t.ARRAY_BUFFER,this._squareVerticesAB,t.STATIC_DRAW)},t._bindLayerColorsBufferData=function(){var t=e._renderContext;t.bindBuffer(t.ARRAY_BUFFER,this._colorsUint8Buffer),t.bufferData(t.ARRAY_BUFFER,this._squareColorsAB,t.STATIC_DRAW)},t.updateBlendFunc=function(t){}}(),function(){e.LayerGradient.WebGLRenderCmd=function(t){e.LayerColor.WebGLRenderCmd.call(this,t),this._needDraw=!0,this._clipRect=new e.Rect,this._clippingRectDirty=!1};var t=e.LayerGradient.WebGLRenderCmd.prototype=Object.create(e.LayerColor.WebGLRenderCmd.prototype);e.js.mixin(t,e.LayerGradient.RenderCmd),t.constructor=e.LayerGradient.WebGLRenderCmd,t._syncStatus=function(t){var e=_ccsg.Node._dirtyFlags,i=this._dirtyFlag,n=t?t._node:null;if(n&&n._cascadeColorEnabled&&t._dirtyFlag&e.colorDirty)i|=e.colorDirty;if(n&&n._cascadeOpacityEnabled&&t._dirtyFlag&e.opacityDirty)i|=e.opacityDirty;if(t&&t._dirtyFlag&e.transformDirty)i|=e.transformDirty;var r=i&e.colorDirty,s=i&e.opacityDirty;if(this._dirtyFlag=i,r)this._syncDisplayColor();if(s)this._syncDisplayOpacity();if(this.transform(t),r||s||i&e.gradientDirty)this._updateColor()},t._updateColor=function(){this._dirtyFlag=this._dirtyFlag&_ccsg.Node._dirtyFlags.gradientDirty^this._dirtyFlag;var t=this._node,i=t._colorStops;if(i&&!(i.length<2)){this._clippingRectDirty=!0;var n,r=i.length,s=2*r,o=t._contentSize;this._squareVerticesAB=new ArrayBuffer(8*s),this._squareColorsAB=new ArrayBuffer(4*s);var a=this._squareVertices,c=this._squareColors;a.length=0,c.length=0;var l=this._squareVerticesAB,h=this._squareColorsAB,u=e.Vertex2F.BYTES_PER_ELEMENT,d=e.WebGLColor.BYTES_PER_ELEMENT;for(n=0;s>n;n++)a.push(new e.Vertex2F(0,0,l,u*n)),c.push(new e.WebGLColor(0,0,0,255,h,d*n));var f=Math.PI+e.pAngleSigned(e.p(0,-1),t._alongVector),_=e.p(o.width/2,o.height/2),p=Math.round(e.radiansToDegrees(f)),g=e.affineTransformMake(1,0,0,1,_.x,_.y);g=e.affineTransformRotate(g,f);var m,v;if(90>p)m=e.p(-_.x,_.y),v=e.p(_.x,_.y);else if(180>p)m=e.p(_.x,_.y),v=e.p(_.x,-_.y);else if(270>p)m=e.p(_.x,-_.y),v=e.p(-_.x,-_.y);else m=e.p(-_.x,-_.y),v=e.p(-_.x,_.y);var y=Math.sin(f),T=Math.cos(f),C=Math.abs((m.x*T-m.y*y)/_.x),x=Math.abs((v.x*y+v.y*T)/_.y);for(g=e.affineTransformScale(g,C,x),n=0;r>n;n++){var S=i[n],b=S.p*o.height,E=e.pointApplyAffineTransform(-_.x,b-_.y,g);a[2*n].x=E.x,a[2*n].y=E.y;var A=e.pointApplyAffineTransform(o.width-_.x,b-_.y,g);a[2*n+1].x=A.x,a[2*n+1].y=A.y}var w=this._displayedOpacity/255;for(n=0;r>n;n++){var O=i[n].color,I=c[2*n],R=c[2*n+1];I.r=O.r,I.g=O.g,I.b=O.b,I.a=O.a*w,R.r=O.r,R.g=O.g,R.b=O.b,R.a=O.a*w}this._bindLayerVerticesBufferData(),this._bindLayerColorsBufferData()}},t.rendering=function(t){var i=t||e._renderContext,n=this._node,r=this._getClippingRect();i.enable(i.SCISSOR_TEST),e.view.setScissorInPoints(r.x,r.y,r.width,r.height),this._shaderProgram.use(),this._shaderProgram._setUniformForMVPMatrixWithMat4(this._stackMatrix),e.gl.enableVertexAttribs(e.macro.VERTEX_ATTRIB_FLAG_POSITION|e.macro.VERTEX_ATTRIB_FLAG_COLOR),e.gl.blendFunc(n._blendFunc.src,n._blendFunc.dst),i.bindBuffer(i.ARRAY_BUFFER,this._verticesFloat32Buffer),i.vertexAttribPointer(e.macro.VERTEX_ATTRIB_POSITION,2,i.FLOAT,!1,0,0),i.bindBuffer(i.ARRAY_BUFFER,this._colorsUint8Buffer),i.vertexAttribPointer(e.macro.VERTEX_ATTRIB_COLOR,4,i.UNSIGNED_BYTE,!0,0,0),i.drawArrays(i.TRIANGLE_STRIP,0,this._squareVertices.length),i.disable(i.SCISSOR_TEST)},t._getClippingRect=function(){if(this._clippingRectDirty){var t=this._node,i=e.rect(0,0,t._contentSize.width,t._contentSize.height),n=t.getNodeToWorldTransform();this._clipRect=e._rectApplyAffineTransformIn(i,n)}return this._clipRect}}(),e._tmp.PrototypeSprite=function(){var t=_ccsg.Sprite.prototype;e.defineGetterSetter(t,"opacityModifyRGB",t.isOpacityModifyRGB,t.setOpacityModifyRGB),e.defineGetterSetter(t,"opacity",t.getOpacity,t.setOpacity),e.defineGetterSetter(t,"color",t.getColor,t.setColor),t.dirty,t.flippedX,e.defineGetterSetter(t,"flippedX",t.isFlippedX,t.setFlippedX),t.flippedY,e.defineGetterSetter(t,"flippedY",t.isFlippedY,t.setFlippedY),t.offsetX,e.defineGetterSetter(t,"offsetX",t._getOffsetX),t.offsetY,e.defineGetterSetter(t,"offsetY",t._getOffsetY),t.atlasIndex,t.texture,e.defineGetterSetter(t,"texture",t.getTexture,t.setTexture),t.textureRectRotated,e.defineGetterSetter(t,"textureRectRotated",t.isTextureRectRotated),t.textureAtlas,t.batchNode,e.defineGetterSetter(t,"batchNode",t.getBatchNode,t.setBatchNode),t.quad,e.defineGetterSetter(t,"quad",t.getQuad)};var u=t("../cocos2d/core/event/event-target");_ccsg.Sprite=_ccsg.Node.extend({dirty:!1,atlasIndex:0,textureAtlas:null,_batchNode:null,_recursiveDirty:null,_hasChildren:null,_shouldBeHidden:!1,_transformToBatch:null,_blendFunc:null,_texture:null,_rect:null,_rectRotated:!1,_offsetPosition:null,_unflippedOffsetPositionFromCenter:null,_opacityModifyRGB:!1,_flippedX:!1,_flippedY:!1,_textureLoaded:!1,_className:"Sprite",ctor:function(t,i,n){var r=this;_ccsg.Node.prototype.ctor.call(r),u.call(r),r._shouldBeHidden=!1,r._offsetPosition=e.p(0,0),r._unflippedOffsetPositionFromCenter=e.p(0,0),r._blendFunc={src:e.macro.BLEND_SRC,dst:e.macro.BLEND_DST},r._rect=e.rect(0,0,0,0),r._softInit(t,i,n)},textureLoaded:function(){return this._textureLoaded},addLoadedEventListener:function(t,e){this.once("load",t,e)},isDirty:function(){return this.dirty},setDirty:function(t){this.dirty=t},isTextureRectRotated:function(){return this._rectRotated},getAtlasIndex:function(){return this.atlasIndex},setAtlasIndex:function(t){this.atlasIndex=t},getTextureRect:function(){return e.rect(this._rect)},getTextureAtlas:function(){return this.textureAtlas},setTextureAtlas:function(t){this.textureAtlas=t},getOffsetPosition:function(){return e.p(this._offsetPosition)},_getOffsetX:function(){return this._offsetPosition.x},_getOffsetY:function(){return this._offsetPosition.y},getBlendFunc:function(){return this._blendFunc},initWithSpriteFrame:function(t){if(e.assert(t,e._LogInfos.Sprite.initWithSpriteFrame),!t.textureLoaded())this._textureLoaded=!1,t.once("load",this._renderCmd._spriteFrameLoadedCallback,this._renderCmd);var i=e._renderType===e.game.RENDER_TYPE_CANVAS?!1:t._rotated,n=this.initWithTexture(t.getTexture(),t.getRect(),i);return this.setSpriteFrame(t),n},initWithSpriteFrameName:function(t){e.assert(t,e._LogInfos.Sprite.initWithSpriteFrameName);var i=e.spriteFrameCache.getSpriteFrame(t);return e.assert(i,t+e._LogInfos.Sprite.initWithSpriteFrameName1),this.initWithSpriteFrame(i)},useBatchNode:function(t){this.textureAtlas=t.getTextureAtlas(),this._batchNode=t},setVertexRect:function(t){var e=this._rect;e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height},sortAllChildren:function(){if(this._reorderChildDirty){var t,e,i,n=this._children,r=n.length;for(t=1;r>t;t++){for(i=n[t],e=t-1;e>=0;){if(i._localZOrder<n[e]._localZOrder)n[e+1]=n[e];else if(i._localZOrder===n[e]._localZOrder&&i.arrivalOrder<n[e].arrivalOrder)n[e+1]=n[e];else break;e--}n[e+1]=i}if(this._batchNode)this._arrayMakeObjectsPerformSelector(n,_ccsg.Node._stateCallbackType.sortAllChildren);this._reorderChildDirty=!1}},reorderChild:function(t,i){if(e.assert(t,e._LogInfos.Sprite.reorderChild_2),-1===this._children.indexOf(t))return void e.log(e._LogInfos.Sprite.reorderChild);if(i!==t.zIndex){if(this._batchNode&&!this._reorderChildDirty)this._setReorderChildDirtyRecursively(),this._batchNode.reorderBatch(!0);_ccsg.Node.prototype.reorderChild.call(this,t,i)}},removeChild:function(t,e){if(this._batchNode)this._batchNode.removeSpriteFromAtlas(t);_ccsg.Node.prototype.removeChild.call(this,t,e)},setVisible:function(t){_ccsg.Node.prototype.setVisible.call(this,t),this._renderCmd.setDirtyRecursively(!0)},removeAllChildren:function(t){var e=this._children,i=this._batchNode;if(i&&null!=e)for(var n=0,r=e.length;r>n;n++)i.removeSpriteFromAtlas(e[n]);_ccsg.Node.prototype.removeAllChildren.call(this,t),this._hasChildren=!1},ignoreAnchorPointForPosition:function(t){if(this._batchNode)return void e.log(e._LogInfos.Sprite.ignoreAnchorPointForPosition);else return void _ccsg.Node.prototype.ignoreAnchorPointForPosition.call(this,t)},setFlippedX:function(t){if(this._flippedX!==t)this._flippedX=t,this.setTextureRect(this._rect,this._rectRotated,this._contentSize),this.setNodeDirty(!0)},setFlippedY:function(t){if(this._flippedY!==t)this._flippedY=t,this.setTextureRect(this._rect,this._rectRotated,this._contentSize),this.setNodeDirty(!0)},isFlippedX:function(){return this._flippedX},isFlippedY:function(){return this._flippedY},setOpacityModifyRGB:function(t){if(this._opacityModifyRGB!==t)this._opacityModifyRGB=t,this._renderCmd._setColorDirty()},isOpacityModifyRGB:function(){return this._opacityModifyRGB},setDisplayFrameWithAnimationName:function(t,i){e.assert(t,e._LogInfos.Sprite.setDisplayFrameWithAnimationName_3);var n=e.spriteFrameAnimationCache.getAnimation(t);if(!n)return void e.log(e._LogInfos.Sprite.setDisplayFrameWithAnimationName);var r=n.getFrames()[i];if(!r)return void e.log(e._LogInfos.Sprite.setDisplayFrameWithAnimationName_2);else return void this.setSpriteFrame(r.getSpriteFrame())},getBatchNode:function(){return this._batchNode},_setReorderChildDirtyRecursively:function(){if(!this._reorderChildDirty){this._reorderChildDirty=!0;for(var t=this._parent;t&&t!==this._batchNode;)t._setReorderChildDirtyRecursively(),t=t.parent}},getTexture:function(){return this._texture},_softInit:function(t,i,n){if(void 0===t)_ccsg.Sprite.prototype.init.call(this);else if(e.js.isString(t))if("#"===t[0]){var r=t.substr(1,t.length-1),s=e.spriteFrameCache.getSpriteFrame(r);if(s)this.initWithSpriteFrame(s);else e.log("%s does not exist",t)}else _ccsg.Sprite.prototype.init.call(this,t,i);else if("object"==typeof t)if(t instanceof e.Texture2D)this.initWithTexture(t,i,n);else if(t instanceof e.SpriteFrame)this.initWithSpriteFrame(t);else if(t instanceof HTMLImageElement||t instanceof HTMLCanvasElement){var o=new e.Texture2D;o.initWithElement(t),o.handleLoadedTexture(),this.initWithTexture(o)}},getQuad:function(){return this._renderCmd.getQuad()},setBlendFunc:function(t,e){var i=this._blendFunc;if(void 0===e)i.src=t.src,i.dst=t.dst;else i.src=t,i.dst=e;this._renderCmd.updateBlendFunc(i)},init:function(){var t=this;if(arguments.length>0)return t.initWithFile(arguments[0],arguments[1]);else return _ccsg.Node.prototype.init.call(t),t.dirty=t._recursiveDirty=!1,t._blendFunc.src=e.macro.BLEND_SRC,t._blendFunc.dst=e.macro.BLEND_DST,t.texture=null,t._flippedX=t._flippedY=!1,t.anchorX=.5,t.anchorY=.5,t._offsetPosition.x=0,t._offsetPosition.y=0,t._hasChildren=!1,this._renderCmd._init(),t.setTextureRect(e.rect(0,0,0,0),!1,e.size(0,0)),!0},initWithFile:function(t,i){e.assert(t,e._LogInfos.Sprite.initWithFile);var n=e.textureCache.getTextureForKey(t);if(!n)return n=e.textureCache.addImage(t),this.initWithTexture(n,i||e.rect(0,0,n._contentSize.width,n._contentSize.height));else{if(!i){var r=n.getContentSize();i=e.rect(0,0,r.width,r.height)}return this.initWithTexture(n,i)}},initWithTexture:function(t,i,n,r){var s=this;if(e.assert(0!==arguments.length,e._LogInfos.SpriteBatchNode.initWithTexture),n=n||!1,t=this._renderCmd._handleTextureForRotatedTexture(t,i,n,r),!_ccsg.Node.prototype.init.call(s))return!1;s._batchNode=null,s._recursiveDirty=!1,s.dirty=!1,s._opacityModifyRGB=!0,s._blendFunc.src=e.macro.BLEND_SRC,s._blendFunc.dst=e.macro.BLEND_DST,s._flippedX=s._flippedY=!1,s.setAnchorPoint(.5,.5),s._offsetPosition.x=0,s._offsetPosition.y=0,s._hasChildren=!1,this._renderCmd._init();var o=t.isLoaded();if(s._textureLoaded=o,!o){if(s._rectRotated=n,i)s._rect.x=i.x,s._rect.y=i.y,s._rect.width=i.width,s._rect.height=i.height;if(s.texture)s.texture.off("load",s._renderCmd._textureLoadedCallback,s._renderCmd);return t.once("load",s._renderCmd._textureLoadedCallback,s._renderCmd),s.setTexture(t),!0}if(!i)i=e.rect(0,0,t.width,t.height);return this._renderCmd._checkTextureBoundary(t,i,n),s.setTexture(t),s.setTextureRect(i,n),s.setBatchNode(null),this.emit("load"),!0},setTextureRect:function(t,e,i){var n=this;n._rectRotated=e||!1,n.setContentSize(i||t),n.setVertexRect(t),n._renderCmd._setTextureCoords(t);var r=n._unflippedOffsetPositionFromCenter.x,s=n._unflippedOffsetPositionFromCenter.y;if(n._flippedX)r=-r;if(n._flippedY)s=-s;var o=n._rect;if(n._offsetPosition.x=r+(n._contentSize.width-o.width)/2,n._offsetPosition.y=s+(n._contentSize.height-o.height)/2,n._batchNode)n.dirty=!0;else this._renderCmd._resetForBatchNode()},updateTransform:function(){this._renderCmd.updateTransform()},addChild:function(t,i,n){if(e.assert(t,e._LogInfos.SpriteBatchNode.addChild_2),null==i)i=t._localZOrder;if(null==n)n=t.tag;if(this._renderCmd._setBatchNodeForAddChild(t))_ccsg.Node.prototype.addChild.call(this,t,i,n),this._hasChildren=!0},setSpriteFrame:function(t){var i=this;if(e.js.isString(t))t=e.spriteFrameCache.getSpriteFrame(t),e.assert(t,e._LogInfos.Sprite.setSpriteFrame);this.setNodeDirty(!0);var n=t.getOffset();i._unflippedOffsetPositionFromCenter.x=n.x,i._unflippedOffsetPositionFromCenter.y=n.y;var r=t.getTexture(),s=t.textureLoaded();if(!s){if(r!==i._texture)i.setTexture(r);i._textureLoaded=!1,t.once("load",function(t){var e=t.currentTarget;i._textureLoaded=!0,i.setTextureRect(e.getRect(),e.isRotated(),e.getOriginalSize()),i.emit("load"),i.setColor(i.color)},i)}else{if(r!==i._texture)i.setTexture(r);i.setTextureRect(t.getRect(),t.isRotated(),t.getOriginalSize())}this._renderCmd._updateForSetSpriteFrame(r)},setDisplayFrame:function(t){e.log(e._LogInfos.Sprite.setDisplayFrame),this.setSpriteFrame(t)},isFrameDisplayed:function(t){return this._renderCmd.isFrameDisplayed(t)},displayFrame:function(){return this.getSpriteFrame()},getSpriteFrame:function(){return new e.SpriteFrame(this._texture,this._rect,this._rectRotated,this._unflippedOffsetPositionFromCenter,this._contentSize)},setBatchNode:function(t){var i=this;if(i._batchNode=t,!i._batchNode)i.atlasIndex=_ccsg.Sprite.INDEX_NOT_INITIALIZED,i.textureAtlas=null,i._recursiveDirty=!1,i.dirty=!1,this._renderCmd._resetForBatchNode();else i._transformToBatch=e.affineTransformIdentity(),i.textureAtlas=i._batchNode.getTextureAtlas()},setTexture:function(t){if(!t)return this._renderCmd._setTexture(null);var i=e.js.isString(t);if(i)t=e.textureCache.addImage(t);if(t._textureLoaded)this._setTexture(t,i),this.setColor(this._realColor),this._textureLoaded=!0,this.emit("load");else this._renderCmd._setTexture(t),t.once("load",function(e){this._setTexture(t,i),this.setColor(this._realColor),this._textureLoaded=!0,this.emit("load")},this)},_setTexture:function(t,e){if(this._renderCmd._setTexture(t),e)this._changeRectWithTexture(t)},_changeRectWithTexture:function(t){var i=t._contentSize,n=e.rect(0,0,i.width,i.height);this.setTextureRect(n)},_createRenderCmd:function(){if(e._renderType===e.game.RENDER_TYPE_CANVAS)return new _ccsg.Sprite.CanvasRenderCmd(this);else return new _ccsg.Sprite.WebGLRenderCmd(this)}}),_ccsg.Sprite.INDEX_NOT_INITIALIZED=-1,e.js.addon(_ccsg.Sprite.prototype,u.prototype),e.assert(e.js.isFunction(e._tmp.PrototypeSprite),e._LogInfos.MissingFile,"SpritesPropertyDefine.js"),e._tmp.PrototypeSprite(),delete e._tmp.PrototypeSprite,_ccsg.Sprite.CanvasRenderCmd=function(t){_ccsg.Node.CanvasRenderCmd.call(this,t),this._needDraw=!0,this._textureCoord={renderX:0,renderY:0,x:0,y:0,width:0,height:0,validRect:!1},this._blendFuncStr="source-over",this._colorized=!1,this._textureToRender=null};var l=_ccsg.Sprite.CanvasRenderCmd.prototype=Object.create(_ccsg.Node.CanvasRenderCmd.prototype);l.constructor=_ccsg.Sprite.CanvasRenderCmd,l._init=function(){},l.setDirtyRecursively=function(t){},l._resetForBatchNode=function(){},l._setTexture=function(t){var e=this._node;if(e._texture!==t){if(t)e._textureLoaded=t._textureLoaded;else e._textureLoaded=!1;e._texture=t,this._updateColor()}},l._setColorDirty=function(){this.setDirtyFlag(_ccsg.Node._dirtyFlags.colorDirty|_ccsg.Node._dirtyFlags.opacityDirty)},l.isFrameDisplayed=function(t){var i=this._node;if(t.getTexture()!==i._texture)return!1;else return e.rectEqualToRect(t.getRect(),i._rect)},l.updateBlendFunc=function(t){this._blendFuncStr=_ccsg.Node.CanvasRenderCmd._getCompositeOperationByBlendFunc(t)},l._setBatchNodeForAddChild=function(t){return!0},l._handleTextureForRotatedTexture=function(t,i,n,r){if(n&&t.isLoaded()){var s=t.getHtmlElementObj();s=_ccsg.Sprite.CanvasRenderCmd._cutRotateImageToCanvas(s,i,r);var o=new e.Texture2D;o.initWithElement(s),o.handleLoadedTexture(),t=o,i.x=i.y=0,this._node._rect=e.rect(0,0,i.width,i.height)}return t},l._checkTextureBoundary=function(t,i,n){if(t&&t.url){var r=i.x+i.width,s=i.y+i.height;if(r>t.width)e.error(e._LogInfos.RectWidth,t.url);if(s>t.height)e.error(e._LogInfos.RectHeight,t.url)}},l.rendering=function(t,i,n){var r=this._node,s=this._textureCoord,o=this._displayedOpacity/255,a=this._textureToRender||r._texture;if((!a||0!==s.width&&0!==s.height&&a._textureLoaded)&&0!==o){var c,l=t||e._renderContext,h=l.getContext(),u=r._offsetPosition.x,d=r._rect.height,f=r._rect.width,_=-r._offsetPosition.y-d;if(l.setTransform(this._worldTransform,i,n),l.setCompositeOperation(this._blendFuncStr),l.setGlobalAlpha(o),r._flippedX||r._flippedY)l.save();if(r._flippedX)u=-u-f,h.scale(-1,1);if(r._flippedY)_=r._offsetPosition.y,h.scale(1,-1);var p,g,m,v,y,T,C,x;if(this._colorized)p=0,g=0;else p=s.renderX,g=s.renderY;if(m=s.width,v=s.height,y=u*i,T=_*n,C=f*i,x=d*n,a)if(c=a._htmlElementObj,""!==a._pattern)l.setFillStyle(h.createPattern(c,a._pattern)),h.fillRect(y,T,C,x);else h.drawImage(c,p,g,m,v,y,T,C,x);else{var S=r._contentSize;if(s.validRect){var b=this._displayedColor;l.setFillStyle("rgba("+b.r+","+b.g+","+b.b+",1)"),h.fillRect(y,T,S.width*i,S.height*n)}}if(r._flippedX||r._flippedY)l.restore();e.g_NumberOfDraws++}},l._updateColor=function(){var t=this._node,e=t._texture,i=this._textureCoord,n=this._displayedColor;if(e)if(255!==n.r||255!==n.g||255!==n.b)this._textureToRender=e._generateColorTexture(n.r,n.g,n.b,i),this._colorized=!0;else if(e)this._textureToRender=e,this._colorized=!1},l.getQuad=function(){return null},l._updateForSetSpriteFrame=function(t,e){if(this._colorized=!1,this._textureCoord.renderX=this._textureCoord.x,this._textureCoord.renderY=this._textureCoord.y,e=e||t._textureLoaded){var i=this._node.getColor();if(255!==i.r||255!==i.g||255!==i.b)this._updateColor()}},l.updateTransform=function(){var t=this,i=this._node;if(i.dirty){var n=i._parent;if(!i._visible||n&&n!==i._batchNode&&n._shouldBeHidden)i._shouldBeHidden=!0;else if(i._shouldBeHidden=!1,!n||n===i._batchNode)i._transformToBatch=t.getNodeToParentTransform();else i._transformToBatch=e.affineTransformConcat(t.getNodeToParentTransform(),n._transformToBatch);i._recursiveDirty=!1,i.dirty=!1}if(i._hasChildren)i._arrayMakeObjectsPerformSelector(i._children,_ccsg.Node._stateCallbackType.updateTransform)},l._updateDisplayColor=function(t){_ccsg.Node.CanvasRenderCmd.prototype._updateDisplayColor.call(this,t)},l._spriteFrameLoadedCallback=function(t){var e=this._node,i=t.currentTarget;e.setTextureRect(i.getRect(),i.isRotated(),i.getOriginalSize()),this._updateColor(),e.emit("load")},l._textureLoadedCallback=function(t){var i=this._node,n=t.currentTarget;if(!i._textureLoaded){i._textureLoaded=!0;var r=(i._texture,i._rect);if(!r)r=e.rect(0,0,n.width,n.height);else if(e._rectEqualToZero(r))r.width=n.width,r.height=n.height;i.texture=n,i.setTextureRect(r,i._rectRotated);var s=this._displayedColor;if(255!==s.r||255!==s.g||255!==s.b)this._updateColor();i.setBatchNode(i._batchNode),i.emit("load")}},l._setTextureCoords=function(t){var e=this._textureCoord;e.renderX=e.x=0|t.x,e.renderY=e.y=0|t.y,e.width=0|t.width,e.height=0|t.height,e.validRect=!(0===e.width||0===e.height||e.x<0||e.y<0)},_ccsg.Sprite.CanvasRenderCmd._cutRotateImageToCanvas=function(t,e,i){if(!t)return null;if(!e)return t;i=null==i?!0:i;var n=document.createElement("canvas");n.width=e.width,n.height=e.height;var r=n.getContext("2d");if(r.translate(n.width/2,n.height/2),i)r.rotate(-1.5707963267948966);else r.rotate(1.5707963267948966);return r.drawImage(t,e.x,e.y,e.height,e.width,-e.height/2,-e.width/2,e.height,e.width),n};var d=e.macro,f=e.gl;_ccsg.Sprite.WebGLRenderCmd=function(t){_ccsg.Node.WebGLRenderCmd.call(this,t),this._needDraw=!0,this._quad=new e.V3F_C4B_T2F_Quad,this._quadWebBuffer=e._renderContext.createBuffer(),this._quadDirty=!0,this._dirty=!1,this._recursiveDirty=!1};var l=_ccsg.Sprite.WebGLRenderCmd.prototype=Object.create(_ccsg.Node.WebGLRenderCmd.prototype);l.constructor=_ccsg.Sprite.WebGLRenderCmd,l.updateBlendFunc=function(t){},l.setDirtyFlag=function(t){_ccsg.Node.WebGLRenderCmd.prototype.setDirtyFlag.call(this,t),this._dirty=!0},l.setDirtyRecursively=function(t){this._recursiveDirty=t,this._dirty=t;for(var e,i=this._node._children,n=i?i.length:0,r=0;n>r;r++)e=i[r],e instanceof _ccsg.Sprite&&e._renderCmd.setDirtyRecursively(t)},l._setBatchNodeForAddChild=function(t){var i=this._node;if(i._batchNode){if(!(t instanceof _ccsg.Sprite))return e.log(e._LogInfos.Sprite.addChild),!1;if(t.texture._webTextureObj!==i.textureAtlas.texture._webTextureObj)e.log(e._LogInfos.Sprite_addChild_2);if(i._batchNode.appendChild(t),!i._reorderChildDirty)i._setReorderChildDirtyRecursively()}return!0},l._handleTextureForRotatedTexture=function(t){return t},l.isFrameDisplayed=function(t){var i=this._node;return e.rectEqualToRect(t.getRect(),i._rect)&&t.getTexture().getName()===i._texture.getName()&&e.pointEqualToPoint(t.getOffset(),i._unflippedOffsetPositionFromCenter)},l._init=function(){var t={r:255,g:255,b:255,a:255},e=this._quad;e.bl.colors=t,e.br.colors=t,e.tl.colors=t,e.tr.colors=t,this._quadDirty=!0},l._resetForBatchNode=function(){var t=this._node,e=t._offsetPosition.x,i=t._offsetPosition.y,n=e+t._rect.width,r=i+t._rect.height,s=this._quad;s.bl.vertices={x:e,y:i,z:0},s.br.vertices={x:n,y:i,z:0},s.tl.vertices={x:e,y:r,z:0},s.tr.vertices={x:n,y:r,z:0},this._quadDirty=!0},l.getQuad=function(){return this._quad},l._updateForSetSpriteFrame=function(){},l._spriteFrameLoadedCallback=function(t){var e=t.currentTarget;this._node.setTextureRect(e.getRect(),e.isRotated(),e.getOriginalSize()),this._node.emit("load")},l._textureLoadedCallback=function(t){var i=this._node,n=t.currentTarget;if(!i._textureLoaded){i._textureLoaded=!0;var r=i._rect;if(!r)r=e.rect(0,0,n.width,n.height);else if(e._rectEqualToZero(r))r.width=n.width,r.height=n.height;i.texture=n,i.setTextureRect(r,i._rectRotated),i.setBatchNode(i._batchNode),this._quadDirty=!0,i.emit("load")}},l._setTextureCoords=function(t){var e=this._node,i=e._batchNode?e.textureAtlas.texture:e._texture;if(i){var n,r,s,o,a,c=i.pixelWidth,l=i.pixelHeight,h=this._quad;if(e._rectRotated){if(d.FIX_ARTIFACTS_BY_STRECHING_TEXEL)n=(2*t.x+1)/(2*c),r=n+(2*t.height-2)/(2*c),s=(2*t.y+1)/(2*l),o=s+(2*t.width-2)/(2*l);else n=t.x/c,r=(t.x+t.height)/c,s=t.y/l,o=(t.y+t.width)/l;if(e._flippedX)a=s,s=o,o=a;if(e._flippedY)a=n,n=r,r=a;h.bl.texCoords.u=n,h.bl.texCoords.v=s,h.br.texCoords.u=n,h.br.texCoords.v=o,h.tl.texCoords.u=r,h.tl.texCoords.v=s,h.tr.texCoords.u=r,h.tr.texCoords.v=o}else{if(d.FIX_ARTIFACTS_BY_STRECHING_TEXEL)n=(2*t.x+1)/(2*c),r=n+(2*t.width-2)/(2*c),s=(2*t.y+1)/(2*l),o=s+(2*t.height-2)/(2*l);else n=t.x/c,r=(t.x+t.width)/c,s=t.y/l,o=(t.y+t.height)/l;if(e._flippedX)a=n,n=r,r=a;if(e._flippedY)a=s,s=o,o=a;h.bl.texCoords.u=n,h.bl.texCoords.v=o,h.br.texCoords.u=r,h.br.texCoords.v=o,h.tl.texCoords.u=n,h.tl.texCoords.v=s,h.tr.texCoords.u=r,h.tr.texCoords.v=s}this._quadDirty=!0}},l.transform=function(t,e){_ccsg.Node.WebGLRenderCmd.prototype.transform.call(this,t,e),this._dirty=!0},l._setColorDirty=function(){},l._updateColor=function(){var t=this._node,e=this._displayedColor,i=e.r,n=e.g,r=e.b,s=e.a=this._displayedOpacity;if(t._opacityModifyRGB)e.r*=s/255,e.g*=s/255,e.b*=s/255;var o=this._quad;if(o.bl.colors=e,o.br.colors=e,o.tl.colors=e,o.tr.colors=e,e.r=i,e.g=n,e.b=r,t._batchNode)if(t.atlasIndex!==_ccsg.Sprite.INDEX_NOT_INITIALIZED)t.textureAtlas.updateQuad(o,t.atlasIndex);else this._dirty=!0;this._quadDirty=!0},l._updateBlendFunc=function(){if(this._batchNode)return void e.log(e._LogInfos.Sprite__updateBlendFunc);var t=this._node;if(!t._texture||!t._texture.hasPremultipliedAlpha())t._blendFunc.src=d.SRC_ALPHA,t._blendFunc.dst=d.ONE_MINUS_SRC_ALPHA,t.opacityModifyRGB=!1;else t._blendFunc.src=d.BLEND_SRC,t._blendFunc.dst=d.BLEND_DST,t.opacityModifyRGB=!0},l._setTexture=function(t){var i=this._node;if(i._batchNode){if(i._batchNode.texture!==t)return void e.log(e._LogInfos.Sprite_setTexture)}else if(i._texture!==t)i._textureLoaded=t?t._textureLoaded:!1,i._texture=t,this._updateBlendFunc();if(t)this._shaderProgram=e.shaderCache.programForKey(d.SHADER_POSITION_TEXTURECOLOR);else this._shaderProgram=e.shaderCache.programForKey(d.SHADER_POSITION_COLOR);
},l.updateTransform=function(){var t=this,i=this._node;if(this._dirty){var n=t._quad,r=i._parent;if(!i._visible||r&&r!==i._batchNode&&r._shouldBeHidden)n.br.vertices=n.tl.vertices=n.tr.vertices=n.bl.vertices={x:0,y:0,z:0},i._shouldBeHidden=!0;else{if(i._shouldBeHidden=!1,0!==this._dirtyFlag)this.updateStatus(),this._dirtyFlag=0;if(!r||r===i._batchNode)i._transformToBatch=t.getNodeToParentTransform();else i._transformToBatch=e.affineTransformConcat(t.getNodeToParentTransform(),r._transformToBatch);var s=i._transformToBatch,o=i._rect,a=i._offsetPosition.x,c=i._offsetPosition.y,l=a+o.width,h=c+o.height,u=s.tx,f=s.ty,_=s.a,p=s.b,g=s.d,m=-s.c,v=a*_-c*m+u,y=a*p+c*g+f,T=l*_-c*m+u,C=l*p+c*g+f,x=l*_-h*m+u,S=l*p+h*g+f,b=a*_-h*m+u,E=a*p+h*g+f,A=i._vertexZ;if(!d.SPRITEBATCHNODE_RENDER_SUBPIXEL)v=0|v,y=0|y,T=0|T,C=0|C,x=0|x,S=0|S,b=0|b,E=0|E;n.bl.vertices={x:v,y:y,z:A},n.br.vertices={x:T,y:C,z:A},n.tl.vertices={x:b,y:E,z:A},n.tr.vertices={x:x,y:S,z:A}}i.textureAtlas.updateQuad(n,i.atlasIndex),i._recursiveDirty=!1,this._dirty=!1}if(i._hasChildren)i._arrayMakeObjectsPerformSelector(i._children,_ccsg.Node._stateCallbackType.updateTransform)},l._checkTextureBoundary=function(t,i,n){if(t&&t.url){var r,s;if(n)r=i.x+i.height,s=i.y+i.width;else r=i.x+i.width,s=i.y+i.height;if(r>t.width)e.error(e._LogInfos.RectWidth,t.url);if(s>t.height)e.error(e._LogInfos.RectHeight,t.url)}},l.rendering=function(t){var i=this._node,n=i._texture;if((!n||n._textureLoaded)&&0!==this._displayedOpacity){var r=t||e._renderContext;if(n){if(n._textureLoaded){if(this._shaderProgram.use(),this._shaderProgram._setUniformForMVPMatrixWithMat4(this._stackMatrix),f.blendFunc(i._blendFunc.src,i._blendFunc.dst),f.bindTexture2DN(0,n),f.enableVertexAttribs(d.VERTEX_ATTRIB_FLAG_POS_COLOR_TEX),r.bindBuffer(r.ARRAY_BUFFER,this._quadWebBuffer),this._quadDirty)r.bufferData(r.ARRAY_BUFFER,this._quad.arrayBuffer,r.DYNAMIC_DRAW),this._quadDirty=!1;r.vertexAttribPointer(0,3,r.FLOAT,!1,24,0),r.vertexAttribPointer(1,4,r.UNSIGNED_BYTE,!0,24,12),r.vertexAttribPointer(2,2,r.FLOAT,!1,24,16),r.drawArrays(r.TRIANGLE_STRIP,0,4)}}else{if(this._shaderProgram.use(),this._shaderProgram._setUniformForMVPMatrixWithMat4(this._stackMatrix),f.blendFunc(i._blendFunc.src,i._blendFunc.dst),f.bindTexture2D(null),f.enableVertexAttribs(d.VERTEX_ATTRIB_FLAG_POSITION|d.VERTEX_ATTRIB_FLAG_COLOR),r.bindBuffer(r.ARRAY_BUFFER,this._quadWebBuffer),this._quadDirty)r.bufferData(r.ARRAY_BUFFER,this._quad.arrayBuffer,r.STATIC_DRAW),this._quadDirty=!1;r.vertexAttribPointer(d.VERTEX_ATTRIB_POSITION,3,r.FLOAT,!1,24,0),r.vertexAttribPointer(d.VERTEX_ATTRIB_COLOR,4,r.UNSIGNED_BYTE,!0,24,12),r.drawArrays(r.TRIANGLE_STRIP,0,4)}if(e.g_NumberOfDraws++,0!==d.SPRITE_DEBUG_DRAW||i._showNode){if(e.math.glMatrixMode(e.math.KM_GL_MODELVIEW),e.current_stack.stack.push(e.current_stack.top),e.current_stack.top=this._stackMatrix,1===d.SPRITE_DEBUG_DRAW||i._showNode){var s=this._quad,o=[e.p(s.tl.vertices.x,s.tl.vertices.y),e.p(s.bl.vertices.x,s.bl.vertices.y),e.p(s.br.vertices.x,s.br.vertices.y),e.p(s.tr.vertices.x,s.tr.vertices.y)];e._drawingUtil.drawPoly(o,4,!0)}else if(2===d.SPRITE_DEBUG_DRAW){var a=i.getTextureRect(),c=i.getOffsetPosition(),l=[e.p(c.x,c.y),e.p(c.x+a.width,c.y),e.p(c.x+a.width,c.y+a.height),e.p(c.x,c.y+a.height)];e._drawingUtil.drawPoly(l,4,!0)}e.current_stack.top=e.current_stack.stack.pop()}}},e.BakeSprite=_ccsg.Sprite.extend({_cacheCanvas:null,_cacheContext:null,ctor:function(){_ccsg.Sprite.prototype.ctor.call(this);var t=document.createElement("canvas");t.width=t.height=10,this._cacheCanvas=t,this._cacheContext=new e.CanvasContextWrapper(t.getContext("2d"));var i=new e.Texture2D;i.initWithElement(t),i.handleLoadedTexture(),this.setTexture(i)},getCacheContext:function(){return this._cacheContext},getCacheCanvas:function(){return this._cacheCanvas},resetCanvasSize:function(t,i){var n=this._cacheCanvas,r=this._cacheContext,s=r._context.strokeStyle,o=r._context.fillStyle;if(void 0===i)i=t.height,t=t.width;if(n.width=t,n.height=i,s!==r._context.strokeStyle)r._context.strokeStyle=s;if(o!==r._context.fillStyle)r._context.fillStyle=o;this.getTexture().handleLoadedTexture(),this.setTextureRect(e.rect(0,0,t,i),!1,null,!1)}}),e.SpriteBatchNode=_ccsg.Node.extend({_blendFunc:null,_descendants:null,_className:"SpriteBatchNode",ctor:function(t,i){_ccsg.Node.prototype.ctor.call(this),this._descendants=[],this._blendFunc=new e.BlendFunc(e.macro.BLEND_SRC,e.macro.BLEND_DST);var n;if(i=i||e.SpriteBatchNode.DEFAULT_CAPACITY,e.js.isString(t)){if(n=e.textureCache.getTextureForKey(t),!n)n=e.textureCache.addImage(t)}else if(t instanceof e.Texture2D)n=t;n&&this.initWithTexture(n,i)},addSpriteWithoutQuad:function(t,i,n){if(e.assert(t,e._LogInfos.SpriteBatchNode.addSpriteWithoutQuad_2),!(t instanceof _ccsg.Sprite))return e.log(e._LogInfos.SpriteBatchNode.addSpriteWithoutQuad),null;t.atlasIndex=i;var r,s=0,o=this._descendants;if(o&&o.length>0)for(s=0,r=o.length;r>s;s++){var a=o[s];if(a&&a.atlasIndex>=i)break}return o.splice(s,0,t),_ccsg.Node.prototype.addChild.call(this,t,i,n),this.reorderBatch(!1),this},getTextureAtlas:function(){return this._renderCmd.getTextureAtlas()},setTextureAtlas:function(t){this._renderCmd.getTextureAtlas(t)},getDescendants:function(){return this._descendants},initWithFile:function(t,i){var n=e.textureCache.getTextureForKey(t);if(!n)n=e.textureCache.addImage(t);return this.initWithTexture(n,i)},_setNodeDirtyForCache:function(){if(this._renderCmd&&this._renderCmd._setNodeDirtyForCache)this._renderCmd._setNodeDirtyForCache()},init:function(t,i){var n=e.textureCache.getTextureForKey(t);if(!n)n=e.textureCache.addImage(t);return this.initWithTexture(n,i)},increaseAtlasCapacity:function(){this._renderCmd.increaseAtlasCapacity()},removeChildAtIndex:function(t,e){this.removeChild(this._children[t],e)},rebuildIndexInOrder:function(t,e){var i=t.children;if(i&&i.length>0)for(var n=0;n<i.length;n++){var r=i[n];if(r&&r.zIndex<0)e=this.rebuildIndexInOrder(r,e)}if(!t===this)t.atlasIndex=e,e++;if(i&&i.length>0)for(n=0;n<i.length;n++)if(r=i[n],r&&r.zIndex>=0)e=this.rebuildIndexInOrder(r,e);return e},highestAtlasIndexInChild:function(t){var e=t.children;if(!e||0===e.length)return t.atlasIndex;else return this.highestAtlasIndexInChild(e[e.length-1])},lowestAtlasIndexInChild:function(t){var e=t.children;if(!e||0===e.length)return t.atlasIndex;else return this.lowestAtlasIndexInChild(e[e.length-1])},atlasIndexForChild:function(t,i){var n=t.parent,r=n.children,s=r.indexOf(t),o=n===this,a=null;if(s>0&&s<e.macro.UINT_MAX)a=r[s-1];if(o)if(0===s)return 0;else return this.highestAtlasIndexInChild(a)+1;if(0===s)if(0>i)return n.atlasIndex;else return n.atlasIndex+1;else if(a.zIndex<0&&0>i||a.zIndex>=0&&i>=0)return this.highestAtlasIndexInChild(a)+1;else return n.atlasIndex+1},reorderBatch:function(t){this._reorderChildDirty=t},setBlendFunc:function(t,e){if(void 0===e)this._blendFunc=t;else this._blendFunc={src:t,dst:e}},getBlendFunc:function(){return new e.BlendFunc(this._blendFunc.src,this._blendFunc.dst)},reorderChild:function(t,i){if(e.assert(t,e._LogInfos.SpriteBatchNode.reorderChild_2),-1===this._children.indexOf(t))return void e.log(e._LogInfos.SpriteBatchNode.reorderChild);if(i!==t.zIndex)_ccsg.Node.prototype.reorderChild.call(this,t,i)},removeChild:function(t,i){if(null!=t){if(-1===this._children.indexOf(t))return void e.log(e._LogInfos.SpriteBatchNode.removeChild);this.removeSpriteFromAtlas(t),_ccsg.Node.prototype.removeChild.call(this,t,i)}},updateQuadFromSprite:function(t,i){if(e.assert(t,e._LogInfos.SpriteBatchNode.updateQuadFromSprite_2),!(t instanceof _ccsg.Sprite))return void e.log(e._LogInfos.SpriteBatchNode.updateQuadFromSprite);else return this._renderCmd.checkAtlasCapacity(),t.batchNode=this,t.atlasIndex=i,t.dirty=!0,void t.updateTransform()},insertQuadFromSprite:function(t,i){if(e.assert(t,e._LogInfos.SpriteBatchNode.insertQuadFromSprite_2),!(t instanceof _ccsg.Sprite))return void e.log(e._LogInfos.SpriteBatchNode.insertQuadFromSprite);else return this._renderCmd.insertQuad(t,i),t.batchNode=this,t.atlasIndex=i,t.dirty=!0,t.updateTransform(),void this._renderCmd.cutting(t,i)},initWithTexture:function(t,i){return this._children.length=0,this._descendants.length=0,i=i||e.SpriteBatchNode.DEFAULT_CAPACITY,this._renderCmd.initWithTexture(t,i),!0},insertChild:function(t,e){t.batchNode=this,t.atlasIndex=e,t.dirty=!0,this._renderCmd.insertQuad(t,e),this._descendants.splice(e,0,t);var i=e+1,n=this._descendants;if(n&&n.length>0)for(;i<n.length;i++)n[i].atlasIndex++;var r,s,o=t.children;if(o)for(i=0,s=o.length||0;s>i;i++)if(r=o[i]){var a=this.atlasIndexForChild(r,r.zIndex);this.insertChild(r,a)}},appendChild:function(t){this._reorderChildDirty=!0,t.batchNode=this,t.dirty=!0,this._descendants.push(t);var e=this._descendants.length-1;t.atlasIndex=e,this._renderCmd.insertQuad(t,e);for(var i=t.children,n=0,r=i.length||0;r>n;n++)this.appendChild(i[n])},removeSpriteFromAtlas:function(t){this._renderCmd.removeQuadAtIndex(t.atlasIndex),t.batchNode=null;var e=this._descendants,i=e.indexOf(t);if(-1!==i){e.splice(i,1);for(var n=e.length;n>i;++i){var r=e[i];r.atlasIndex--}}var s=t.children;if(s)for(var o=0,a=s.length||0;a>o;o++)s[o]&&this.removeSpriteFromAtlas(s[o])},getTexture:function(){return this._renderCmd.getTexture()},setTexture:function(t){this._renderCmd.setTexture(t)},addChild:function(t,i,n){if(e.assert(null!=t,e._LogInfos.SpriteBatchNode.addChild_3),this._renderCmd.isValidChild(t))i=null==i?t.zIndex:i,n=null==n?t.tag:n,_ccsg.Node.prototype.addChild.call(this,t,i,n),this.appendChild(t)},removeAllChildren:function(t){var e=this._descendants;if(e&&e.length>0)for(var i=0,n=e.length;n>i;i++)if(e[i])e[i].batchNode=null;_ccsg.Node.prototype.removeAllChildren.call(this,t),this._descendants.length=0,this._renderCmd.removeAllQuads()},sortAllChildren:function(){if(this._reorderChildDirty){var t,e,i=this._children,n=0,r=i.length;for(t=1;r>t;t++){var s=i[t];for(n=t-1,e=i[n];n>=0&&(s._localZOrder<e._localZOrder||s._localZOrder===e._localZOrder&&s.arrivalOrder<e.arrivalOrder);)i[n+1]=e,n-=1,e=i[n];i[n+1]=s}if(i.length>0)this._arrayMakeObjectsPerformSelector(i,_ccsg.Node._stateCallbackType.sortAllChildren),this._renderCmd.updateChildrenAtlasIndex(i);this._reorderChildDirty=!1}},_createRenderCmd:function(){if(e._renderType===e.game.RENDER_TYPE_CANVAS)return new e.SpriteBatchNode.CanvasRenderCmd(this);else return new e.SpriteBatchNode.WebGLRenderCmd(this)}});var _=e.SpriteBatchNode.prototype;e.defineGetterSetter(_,"texture",_.getTexture,_.setTexture),e.defineGetterSetter(_,"textureAtlas",_.getTextureAtlas,_.setTextureAtlas),_.descendants,e.defineGetterSetter(_,"descendants",_.getDescendants),e.SpriteBatchNode.DEFAULT_CAPACITY=29,e.SpriteBatchNode.CanvasRenderCmd=function(t){_ccsg.Node.CanvasRenderCmd.call(this,t),this._texture=null,this._textureToRender=null};var l=e.SpriteBatchNode.CanvasRenderCmd.prototype=Object.create(_ccsg.Node.CanvasRenderCmd.prototype);l.constructor=e.SpriteBatchNode.CanvasRenderCmd,l.checkAtlasCapacity=function(){},l.isValidChild=function(t){if(!(t instanceof _ccsg.Sprite))return e.log(e._LogInfos.Sprite.addChild_4),!1;else return!0},l.initWithTexture=function(t,e){this._textureToRender=this._texture=t},l.insertQuad=function(t,e){},l.increaseAtlasCapacity=function(){},l.removeQuadAtIndex=function(){},l.removeAllQuads=function(){},l.getTexture=function(){return this._texture},l.setTexture=function(t){this._texture=t;for(var e=this._node._children,i=0;i<e.length;i++)e[i].setTexture(t)},l.updateChildrenAtlasIndex=function(t){this._node._descendants.length=0;for(var e=0,i=t.length;i>e;e++)this._updateAtlasIndex(t[e])},l._updateAtlasIndex=function(t){var e,i=this._node._descendants,n=t.children,r=n.length;for(e=0;r>e&&n[e]._localZOrder<0;e++)i.push(n[e]);for(i.push(t);r>e;e++)i.push(n[e])},l.getTextureAtlas=function(){},l.setTextureAtlas=function(t){},l.cutting=function(t,e){var i=this._node;i._children.splice(e,0,t)},e.SpriteBatchNode.WebGLRenderCmd=function(t){_ccsg.Node.WebGLRenderCmd.call(this,t),this._needDraw=!0,this._textureAtlas=null};var l=e.SpriteBatchNode.WebGLRenderCmd.prototype=Object.create(_ccsg.Node.WebGLRenderCmd.prototype);l.constructor=e.SpriteBatchNode.WebGLRenderCmd,l.isValidChild=function(t){if(!(t instanceof _ccsg.Sprite))return e.log(e._LogInfos.Sprite.addChild_4),!1;if(t.texture!=this.getTexture())return e.log(e._LogInfos.Sprite.addChild_5),!1;else return!0},l.rendering=function(){var t=this._node;if(0!==this._textureAtlas.totalQuads)this._shaderProgram.use(),this._shaderProgram._setUniformForMVPMatrixWithMat4(this._stackMatrix),t._arrayMakeObjectsPerformSelector(t._children,_ccsg.Node._stateCallbackType.updateTransform),e.gl.blendFunc(t._blendFunc.src,t._blendFunc.dst),this._textureAtlas.drawQuads()},l.visit=function(t){var i=this._node;if(i._visible){if(i._parent&&i._parent._renderCmd)this._curLevel=i._parent._renderCmd._curLevel+1;var n=e.current_stack;if(n.stack.push(n.top),!(this._dirtyFlag&_ccsg.Node._dirtyFlags.transformDirty))this.transform(t);this.updateStatus(t),n.top=this._stackMatrix,i.sortAllChildren(),e.renderer.pushRenderCommand(this),this._dirtyFlag=0,n.top=n.stack.pop()}},l.checkAtlasCapacity=function(t){for(var e=this._textureAtlas;t>=e.capacity||e.capacity===e.totalQuads;)this.increaseAtlasCapacity()},l.increaseAtlasCapacity=function(){var t=this._textureAtlas.capacity,i=Math.floor(4*(t+1)/3);if(e.log(e._LogInfos.SpriteBatchNode.increaseAtlasCapacity,t,i),!this._textureAtlas.resizeCapacity(i))e.log(e._LogInfos.SpriteBatchNode.increaseAtlasCapacity_2)},l.initWithTexture=function(t,i){this._textureAtlas=new e.TextureAtlas,this._textureAtlas.initWithTexture(t,i),this._updateBlendFunc(),this._shaderProgram=e.shaderCache.programForKey(e.macro.SHADER_POSITION_TEXTURECOLOR)},l.insertQuad=function(t,e){var i=this._textureAtlas;if(i.totalQuads>=i.capacity)this.increaseAtlasCapacity();i.insertQuad(t.quad,e)},l.removeQuadAtIndex=function(t){this._textureAtlas.removeQuadAtIndex(t)},l.getTexture=function(){return this._textureAtlas.texture},l.setTexture=function(t){if(this._textureAtlas.setTexture(t),t)this._updateBlendFunc()},l.removeAllQuads=function(){this._textureAtlas.removeAllQuads()},l._swap=function(t,i){var n=this._node._descendants,r=this._textureAtlas,s=r.quads,o=n[t],a=e.V3F_C4B_T2F_QuadCopy(s[t]);n[i].atlasIndex=t,n[t]=n[i],r.updateQuad(s[i],t),n[i]=o,r.updateQuad(a,i)},l._updateAtlasIndex=function(t,e){var i=0,n=t.children;if(n)i=n.length;var r=0;if(0===i){if(r=t.atlasIndex,t.atlasIndex=e,t.arrivalOrder=0,r!==e)this._swap(r,e);e++}else{var s=!0;if(n[0].zIndex>=0){if(r=t.atlasIndex,t.atlasIndex=e,t.arrivalOrder=0,r!==e)this._swap(r,e);e++,s=!1}for(var o=0;o<n.length;o++){var a=n[o];if(s&&a.zIndex>=0){if(r=t.atlasIndex,t.atlasIndex=e,t.arrivalOrder=0,r!==e)this._swap(r,e);e++,s=!1}e=this._updateAtlasIndex(a,e)}if(s){if(r=t.atlasIndex,t.atlasIndex=e,t.arrivalOrder=0,r!==e)this._swap(r,e);e++}}return e},l.updateChildrenAtlasIndex=function(t){for(var e=0,i=0;i<t.length;i++)e=this._updateAtlasIndex(t[i],e)},l._updateBlendFunc=function(){if(!this._textureAtlas.texture.hasPremultipliedAlpha()){var t=this._node._blendFunc;t.src=e.macro.SRC_ALPHA,t.dst=e.macro.ONE_MINUS_SRC_ALPHA}},l.getTextureAtlas=function(){return this._textureAtlas},l.setTextureAtlas=function(t){if(t!==this._textureAtlas)this._textureAtlas=t},l.cutting=function(){},u=t("../cocos2d/core/event/event-target");var p={_rebuildQuads_base:function(t,i,n,r){var s,o=[],a=this._calculateVertices(t,i,r),c=this._calculateUVs(t);if(s=e.pool.getFromPool(e.V3F_C4B_T2F_Quad)||new e.V3F_C4B_T2F_Quad,s._bl.colors=n,s._br.colors=n,s._tl.colors=n,s._tr.colors=n,s._bl.vertices=new e.Vertex3F(a[0].x,a[0].y,0),s._br.vertices=new e.Vertex3F(a[1].x,a[0].y,0),s._tl.vertices=new e.Vertex3F(a[0].x,a[1].y,0),s._tr.vertices=new e.Vertex3F(a[1].x,a[1].y,0),!t._rotated)s._bl.texCoords=new e.Tex2F(c[0].x,c[0].y),s._br.texCoords=new e.Tex2F(c[1].x,c[0].y),s._tl.texCoords=new e.Tex2F(c[0].x,c[1].y),s._tr.texCoords=new e.Tex2F(c[1].x,c[1].y);else s._bl.texCoords=new e.Tex2F(c[0].x,c[1].y),s._br.texCoords=new e.Tex2F(c[0].x,c[0].y),s._tl.texCoords=new e.Tex2F(c[1].x,c[1].y),s._tr.texCoords=new e.Tex2F(c[1].x,c[0].y);return o.push(s),o},_calculateVertices:function(t,i,n){var r,s,o,a;if(n)r=0,s=i.width,o=0,a=i.height;else{var c=t.getOriginalSize(),l=t.getRect(),h=t.getOffset(),u=i.width/c.width,d=i.height/c.height,f=h.x+(c.width-l.width)/2,_=h.x-(c.width-l.width)/2,p=h.y+(c.height-l.height)/2,g=h.y-(c.height-l.height)/2;r=f*u,s=i.width+_*u,o=p*d,a=i.height+g*d}var m=[];return m.push(e.p(r,o)),m.push(e.p(s,a)),m},_calculateUVs:function(t){var i,n,r,s,o=t._texture.getPixelWidth(),a=t._texture.getPixelHeight(),c=t.getRect();if(t._rotated)i=c.x/o,n=(c.x+c.height)/o,r=c.y/a,s=(c.y+c.width)/a;else i=c.x/o,n=(c.x+c.width)/o,r=c.y/a,s=(c.y+c.height)/a;var l=[];return l.push(e.p(i,s)),l.push(e.p(n,r)),l}},g={_rebuildQuads_base:function(t,i,n,r,s,o,a){for(var c,l=[],h=this._calculateVertices(t,i,r,s,o,a),u=this._calculateUVs(t,r,s,o,a),d=0;3>d;++d)for(var f=0;3>f;++f){if(c=e.pool.getFromPool(e.V3F_C4B_T2F_Quad)||new e.V3F_C4B_T2F_Quad,c._bl.colors=n,c._br.colors=n,c._tl.colors=n,c._tr.colors=n,c._bl.vertices=new e.Vertex3F(h[d].x,h[f].y,0),c._br.vertices=new e.Vertex3F(h[d+1].x,h[f].y,0),c._tl.vertices=new e.Vertex3F(h[d].x,h[f+1].y,0),c._tr.vertices=new e.Vertex3F(h[d+1].x,h[f+1].y,0),!t._rotated)c._bl.texCoords=new e.Tex2F(u[d].x,u[f].y),c._br.texCoords=new e.Tex2F(u[d+1].x,u[f].y),c._tl.texCoords=new e.Tex2F(u[d].x,u[f+1].y),c._tr.texCoords=new e.Tex2F(u[d+1].x,u[f+1].y);else c._bl.texCoords=new e.Tex2F(u[f].x,u[3-d].y),c._br.texCoords=new e.Tex2F(u[f].x,u[3-(d+1)].y),c._tl.texCoords=new e.Tex2F(u[f+1].x,u[3-d].y),c._tr.texCoords=new e.Tex2F(u[f+1].x,u[3-(d+1)].y);l.push(c)}return l},_calculateVertices:function(t,i,n,r,s,o){var a,c,l,h,u,d,f=t._rect;a=n,l=r,c=f.width-a-l,h=s,d=o,u=f.height-h-d;var _=i,p=_.width-a-l,g=_.height-h-d,m=_.width/(a+l),v=_.height/(h+d);m=m>1?1:m,v=v>1?1:v,p=0>p?0:p,g=0>g?0:g;var y,T,C,x,S,b,E,A;y=0,T=a*m,C=T+p,x=_.width,S=0,b=d*v,E=b+g,A=_.height;var w=[];return w.push(e.p(y,S)),w.push(e.p(T,b)),w.push(e.p(C,E)),w.push(e.p(x,A)),w},_calculateUVs:function(t,i,n,r,s){var o,a,c,l,h,u,d=t._rect,f=t._texture.getPixelWidth(),_=t._texture.getPixelHeight();o=i,c=n,a=d.width-o-c,l=r,u=s,h=d.height-l-u;var p,g,m,v,y,T,C,x,S=t.getRect();if(t._rotated)p=S.x/f,g=(u+S.x)/f,m=(u+h+S.x)/f,v=(S.x+S.height)/f,y=S.y/_,T=(o+S.y)/_,C=(o+a+S.y)/_,x=(S.y+S.width)/_;else p=S.x/f,g=(o+S.x)/f,m=(o+a+S.x)/f,v=(S.x+S.width)/f,y=S.y/_,T=(l+S.y)/_,C=(l+h+S.y)/_,x=(S.y+S.height)/_;var b=[];return b.push(e.p(p,x)),b.push(e.p(g,C)),b.push(e.p(m,T)),b.push(e.p(v,y)),b}},m={_rebuildQuads_base:function(t,i,n){for(var r=[],s=this._calculateUVs(t),o=s[0].x,a=s[0].y,c=s[1].x,l=s[1].y,h=t.getRect().width,u=t.getRect().height,d=i.width/h,f=i.height/u,_=0;_<Math.ceil(d);++_)for(var p=0;p<Math.ceil(f);++p){var g;if(g=e.pool.getFromPool(e.V3F_C4B_T2F_Quad)||new e.V3F_C4B_T2F_Quad,g._bl.colors=n,g._br.colors=n,g._tl.colors=n,g._tr.colors=n,g._bl.vertices=new e.Vertex3F(h*_,u*p,0),g._br.vertices=new e.Vertex3F(h*Math.min(_+1,d),u*p,0),g._tl.vertices=new e.Vertex3F(h*_,u*Math.min(p+1,f),0),g._tr.vertices=new e.Vertex3F(h*Math.min(_+1,d),u*Math.min(p+1,f),0),!t._rotated)g._bl.texCoords=new e.Tex2F(o,a),g._br.texCoords=new e.Tex2F(o+(c-o)*Math.min(1,d-_),a),g._tl.texCoords=new e.Tex2F(o,a+(l-a)*Math.min(1,f-p)),g._tr.texCoords=new e.Tex2F(o+(c-o)*Math.min(1,d-_),a+(l-a)*Math.min(1,f-p));else g._bl.texCoords=new e.Tex2F(o,l),g._br.texCoords=new e.Tex2F(o,l+(a-l)*Math.min(1,d-_)),g._tl.texCoords=new e.Tex2F(o+(c-o)*Math.min(1,f-p),l),g._tr.texCoords=new e.Tex2F(o+(c-o)*Math.min(1,f-p),l+(a-l)*Math.min(1,d-_));r.push(g)}return r},_calculateUVs:function(t){var i,n,r,s,o=t._texture.getPixelWidth(),a=t._texture.getPixelHeight(),c=t.getRect();if(t._rotated)i=c.x/o,n=(c.x+c.height)/o,r=c.y/a,s=(c.y+c.width)/a;else i=c.x/o,n=(c.x+c.width)/o,r=c.y/a,s=(c.y+c.height)/a;var l=[];return l.push(e.p(i,s)),l.push(e.p(n,r)),l}},v={_rebuildQuads_base:function(t,i,n,r,s,o){var a,c=this._calculateVertices(t,i),l=this._calculateUVs(t),h=e.pool.getFromPool(e.V3F_C4B_T2F_Quad)||new e.V3F_C4B_T2F_Quad;h._bl.colors=n,h._br.colors=n,h._tl.colors=n,h._tr.colors=n,h._bl.vertices.x=h._tl.vertices.x=c[0].x,h._br.vertices.x=h._tr.vertices.x=c[1].x,h._bl.vertices.y=h._br.vertices.y=c[0].y,h._tl.vertices.y=h._tr.vertices.y=c[1].y;var u=[null,null,null,null];if(!t._rotated)u[0]=new e.Tex2F(l[0].x,l[0].y),u[1]=new e.Tex2F(l[1].x,l[0].y),u[2]=new e.Tex2F(l[0].x,l[1].y),u[3]=new e.Tex2F(l[1].x,l[1].y);else u[0]=new e.Tex2F(l[0].x,l[1].y),u[1]=new e.Tex2F(l[0].x,l[0].y),u[2]=new e.Tex2F(l[1].x,l[1].y),u[3]=new e.Tex2F(l[1].x,l[0].y);s=s>1?1:s,s=0>s?0:s,o=0>o?0:o,a=s+o,a=a>1?1:a;var d,f;switch(r){case e.Scale9Sprite.FillType.HORIZONTAL:d=c[0].x+(c[1].x-c[0].x)*s,f=c[0].x+(c[1].x-c[0].x)*a,h._bl.vertices.x=d,h._tl.vertices.x=d,h._br.vertices.x=f,h._tr.vertices.x=f,h._bl.texCoords.u=u[0].u+(u[1].u-u[0].u)*s,h._bl.texCoords.v=u[0].v+(u[1].v-u[0].v)*s,h._tl.texCoords.u=u[2].u+(u[3].u-u[2].u)*s,h._tl.texCoords.v=u[2].v+(u[3].v-u[2].v)*s,h._br.texCoords.u=u[0].u+(u[1].u-u[0].u)*a,h._br.texCoords.v=u[0].v+(u[1].v-u[0].v)*a,h._tr.texCoords.u=u[2].u+(u[3].u-u[2].u)*a,h._tr.texCoords.v=u[2].v+(u[3].v-u[2].v)*a;break;case e.Scale9Sprite.FillType.VERTICAL:d=c[0].y+(c[1].y-c[0].y)*s,f=c[0].y+(c[1].y-c[0].y)*a,h._bl.vertices.y=d,h._br.vertices.y=d,h._tl.vertices.y=f,h._tr.vertices.y=f,h._bl.texCoords.u=u[0].u+(u[2].u-u[0].u)*s,h._bl.texCoords.v=u[0].v+(u[2].v-u[0].v)*s,h._br.texCoords.u=u[1].u+(u[3].u-u[1].u)*s,h._br.texCoords.v=u[1].v+(u[3].v-u[1].v)*s,h._tl.texCoords.u=u[0].u+(u[2].u-u[0].u)*a,h._tl.texCoords.v=u[0].v+(u[2].v-u[0].v)*a,h._tr.texCoords.u=u[1].u+(u[3].u-u[1].u)*a,h._tr.texCoords.v=u[1].v+(u[3].v-u[1].v)*a;break;default:e.error("Unrecognized fill type in bar fill")}return[h]},_calculateVertices:function(t,i){var n,r,s,o;return n=0,r=i.width,s=0,o=i.height,[e.p(n,s),e.p(r,o)]},_calculateUVs:function(t){var i,n,r,s,o=t._texture.getPixelWidth(),a=t._texture.getPixelHeight(),c=t.getRect();if(t._rotated)i=c.x/o,n=(c.x+c.height)/o,r=c.y/a,s=(c.y+c.width)/a;else i=c.x/o,n=(c.x+c.width)/o,r=c.y/a,s=(c.y+c.height)/a;return[e.p(i,s),e.p(n,r)]}},y={_rebuildQuads_base:function(t,i,n,r,s,o){for(;s>=1;)s-=1;for(;0>s;)s+=1;var a=e.v2(r);a.x*=i.width,a.y*=i.height,s*=2*Math.PI,o*=2*Math.PI;var c=s+o;if(!this._inited)this._inited=!0,this._vertPos=[e.v2(0,0),e.v2(0,0),e.v2(0,0),e.v2(0,0)],this._vertices=[e.v2(0,0),e.v2(0,0)],this._uvs=[e.v2(0,0),e.v2(0,0)],this._intersectPoint_1=[e.v2(0,0),e.v2(0,0),e.v2(0,0),e.v2(0,0)],this._intersectPoint_2=[e.v2(0,0),e.v2(0,0),e.v2(0,0),e.v2(0,0)];if(this._calculateVertices(t,i),this._calculateUVs(t),this._vertPos[0].x=this._vertPos[3].x=this._vertices[0].x,this._vertPos[1].x=this._vertPos[2].x=this._vertices[1].x,this._vertPos[0].y=this._vertPos[1].y=this._vertices[0].y,this._vertPos[2].y=this._vertPos[3].y=this._vertices[1].y,a.x>this._vertices[1].x)a.x=this._vertices[1].x;if(a.x<this._vertices[0].x)a.x=this._vertices[0].x;if(a.y<this._vertices[0].y)a.y=this._vertices[0].y;if(a.y>this._vertices[1].y)a.y=this._vertices[1].y;var l;if(l=e.pool.getFromPool(e.V3F_C4B_T2F_Quad)||new e.V3F_C4B_T2F_Quad,l._bl.colors=n,l._br.colors=n,l._tl.colors=n,l._tr.colors=n,l._bl.vertices.x=l._tl.vertices.x=this._vertices[0].x,l._br.vertices.x=l._tr.vertices.x=this._vertices[1].x,l._bl.vertices.y=l._br.vertices.y=this._vertices[0].y,l._tl.vertices.y=l._tr.vertices.y=this._vertices[1].y,!t._rotated)l._bl.texCoords.u=l._tl.texCoords.u=this._uvs[0].x,l._bl.texCoords.v=l._br.texCoords.v=this._uvs[0].y,l._br.texCoords.u=l._tr.texCoords.u=this._uvs[1].x,l._tl.texCoords.v=l._tr.texCoords.v=this._uvs[1].y;else l._bl.texCoords.u=l._br.texCoords.u=this._uvs[0].x,l._tl.texCoords.u=l._tr.texCoords.u=this._uvs[1].x,l._br.texCoords.v=l._tr.texCoords.v=this._uvs[0].y,l._bl.texCoords.v=l._tl.texCoords.v=this._uvs[1].y;var h=[null,null,null,null];if(a.x!==this._vertices[0].x)h[0]=[3,0];if(a.x!==this._vertices[1].x)h[2]=[1,2];if(a.y!==this._vertices[0].y)h[1]=[0,1];if(a.y!==this._vertices[1].y)h[3]=[2,3];this._getInsectedPoints(this._vertices[0].x,this._vertices[1].x,this._vertices[0].y,this._vertices[1].y,a,s,this._intersectPoint_1),this._getInsectedPoints(this._vertices[0].x,this._vertices[1].x,this._vertices[0].y,this._vertices[1].y,a,s+o,this._intersectPoint_2);for(var u=[],d=0;4>d;++d){var f=h[d];if(null!==f)if(!(o>=2*Math.PI)){var _=this._getVertAngle(a,this._vertPos[f[0]]),p=this._getVertAngle(a,this._vertPos[f[1]]);if(_>p)p+=2*Math.PI;_-=2*Math.PI,p-=2*Math.PI;for(var g=0;3>g;++g){if(_>=c);else if(_>=s)if(p>=c)u.push(this._generateTriangle(l,a,this._vertPos[f[0]],this._intersectPoint_2[d],n));else u.push(this._generateTriangle(l,a,this._vertPos[f[0]],this._vertPos[f[1]],n));else if(s>=p);else if(c>=p)u.push(this._generateTriangle(l,a,this._intersectPoint_1[d],this._vertPos[f[1]],n));else u.push(this._generateTriangle(l,a,this._intersectPoint_1[d],this._intersectPoint_2[d],n));_+=2*Math.PI,p+=2*Math.PI}}else u.push(this._generateTriangle(l,a,this._vertPos[f[0]],this._vertPos[f[1]],n));else;}var m={};return m.quad=u,m.rawQuad=l,m},_generateTriangle:function(t,i,n,r,s){var o,a,c=t._bl,l=t._br,h=t._tl,u=t._tr,d=c.vertices.x,f=c.vertices.y,_=u.vertices.x,p=u.vertices.y,g=e.pool.getFromPool(e.V3F_C4B_T2F_Quad)||new e.V3F_C4B_T2F_Quad;return g._tl.vertices.x=i.x,g._tl.vertices.y=i.y,g._bl.vertices.x=n.x,g._bl.vertices.y=n.y,g._tr.vertices.x=r.x,g._tr.vertices.y=r.y,g._tl.colors=s,g._bl.colors=s,g._tr.colors=s,o=(i.x-d)/(_-d),a=(i.y-f)/(p-f),this._generateUV(o,a,c.texCoords,l.texCoords,u.texCoords,h.texCoords,g._tl.texCoords),o=(n.x-d)/(_-d),a=(n.y-f)/(p-f),this._generateUV(o,a,c.texCoords,l.texCoords,u.texCoords,h.texCoords,g._bl.texCoords),o=(r.x-d)/(_-d),a=(r.y-f)/(p-f),this._generateUV(o,a,c.texCoords,l.texCoords,u.texCoords,h.texCoords,g._tr.texCoords),g},_isAngleIn:function(t,e,i){for(var n=2*Math.PI;e>t||t>=e+n;){if(e>t)t+=n;if(t>=e+n)t-=n}return e+i>=t},_getVertAngle:function(t,e){var i,n;if(i=e.x-t.x,n=e.y-t.y,0!==i||0!==n)if(0===i)if(n>0)return.5*Math.PI;else return 1.5*Math.PI;else{var r=Math.atan(n/i);if(0>i)r+=Math.PI;return r}},_getInsectedPoints:function(t,e,i,n,r,s,o){var a,c,l=[null,null,null,null],h=Math.sin(s),u=Math.cos(s);if(0!==Math.cos(s)){if(a=h/u,(t-r.x)*u>0){var d=r.y+a*(t-r.x);o[0].x=t,o[0].y=d}if((e-r.x)*u>0){var f=r.y+a*(e-r.x);o[2].x=e,o[2].y=f}}if(0!==Math.sin(s)){if(c=u/h,(n-r.y)*h>0){var _=r.x+c*(n-r.y);o[3].x=_,o[3].y=n}if((i-r.y)*h>0){var p=r.x+c*(i-r.y);o[1].x=p,o[1].y=i}}return l},_generateUV:function(t,e,i,n,r,s,o){var a=i.u+(n.u-i.u)*t,c=s.u+(r.u-s.u)*t,l=i.v+(n.v-i.v)*t,h=s.v+(r.v-s.v)*t;o.u=a+(c-a)*e,o.v=l+(h-l)*e},_calculateVertices:function(t,e){var i,n,r,s;i=0,n=e.width,r=0,s=e.height,this._vertices[0].x=i,this._vertices[0].y=r,this._vertices[1].x=n,this._vertices[1].y=s},_calculateUVs:function(t){var e,i,n,r,s=t._texture.getPixelWidth(),o=t._texture.getPixelHeight(),a=t.getRect();if(t._rotated)e=a.x/s,i=(a.x+a.height)/s,n=a.y/o,r=(a.y+a.width)/o;else e=a.x/s,i=(a.x+a.width)/s,n=a.y/o,r=(a.y+a.height)/o;this._uvs[0].x=e,this._uvs[0].y=r,this._uvs[1].x=i,this._uvs[1].y=n}};e.Scale9Sprite=_ccsg.Node.extend({_spriteFrame:null,_insetLeft:0,_insetRight:0,_insetTop:0,_insetBottom:0,_blendFunc:null,_renderingType:1,_brightState:0,_quads:[],_quadsDirty:!0,_rawQuad:null,_isTriangle:!1,_isTrimmedContentSize:!0,_fillType:0,_fillCenter:null,_fillStart:0,_fillRange:2*Math.PI,ctor:function(t){if(_ccsg.Node.prototype.ctor.call(this),this._renderCmd.setState(this._brightState),this._blendFunc=e.BlendFunc._alphaNonPremultiplied(),this._fillCenter=e.v2(0,0),this.setAnchorPoint(e.p(.5,.5)),"string"==typeof t){var i=e.spriteFrameCache.getSpriteFrame(t);if(i)this.initWithSpriteFrame(i);else this.initWithTexture(t)}else if(t instanceof e.SpriteFrame)this.initWithSpriteFrame(t);else if(t instanceof e.Texture2D)this.initWithTexture(t)},loaded:function(){if(null===this._spriteFrame)return!1;else return this._spriteFrame.textureLoaded()},initWithTexture:function(t){this.setTexture(t)},initWithSpriteFrame:function(t){this.setSpriteFrame(t)},setTexture:function(t){var i=new e.SpriteFrame(t);this.setSpriteFrame(i)},setSpriteFrame:function(t){var i;if(t instanceof e.SpriteFrame)i=t;else i=e.spriteFrameCache.getSpriteFrame(t);if(i){this._spriteFrame=i,this._quadsDirty=!0;var n=this,r=function(){if(e.sizeEqualToSize(n._contentSize,e.size(0,0)))n.setContentSize(n._spriteFrame.getRect())};if(i.textureLoaded())r();else i.once("load",r,this)}},setBlendFunc:function(t,i){if(void 0===i)this._blendFunc.src=t.src||e.macro.BLEND_SRC,this._blendFunc.dst=t.dst||e.macro.BLEND_DST;else this._blendFunc.src=t||e.macro.BLEND_SRC,this._blendFunc.dst=i||e.macro.BLEND_DST},getBlendFunc:function(){return new e.BlendFunc(this._blendFunc.src,this._blendFunc.dst)},setContentSize:function(t,e){if(void 0===e)e=t.height,t=t.width;if(t!==this._contentSize.width||e!==this._contentSize.height)_ccsg.Node.prototype.setContentSize.call(this,t,e),this._quadsDirty=!0},enableTrimmedContentSize:function(t){if(this._isTrimmedContentSize!==t)this._isTrimmedContentSize=t,this._quadsDirty=!0},isTrimmedContentSizeEnabled:function(){return this._isTrimmedContentSize},setState:function(t){this._brightState=t,this._renderCmd.setState(t)},getState:function(){return this._brightState},setRenderingType:function(t){if(this._renderingType!==t)this._renderingType=t,this._quadsDirty=!0},getRenderingType:function(){return this._renderingType},setInsetLeft:function(t){this._insetLeft=t,this._quadsDirty=!0},getInsetLeft:function(){return this._insetLeft},setInsetTop:function(t){this._insetTop=t,this._quadsDirty=!0},getInsetTop:function(){return this._insetTop},setInsetRight:function(t){this._insetRight=t,this._quadsDirty=!0},getInsetRight:function(){return this._insetRight},setInsetBottom:function(t){this._insetBottom=t,this._quadsDirty=!0},getInsetBottom:function(){return this._insetBottom},setFillType:function(t){if(this._fillType!==t)if(this._fillType=t,this._renderingType===e.Scale9Sprite.RenderingType.FILLED)this._quadsDirty=!0},getFillType:function(){return this._fillType},setFillCenter:function(t,i){if(this._fillCenter=e.v2(t,i),this._renderingType===e.Scale9Sprite.RenderingType.FILLED&&this._fillType===e.Scale9Sprite.FillType.RADIAL)this._quadsDirty=!0},getFillCenter:function(){return e.v2(this._fillCenter)},setFillStart:function(t){if(this._fillStart!==t)if(this._fillStart=t,this._renderingType===e.Scale9Sprite.RenderingType.FILLED)this._quadsDirty=!0},getFillStart:function(){return this._fillStart},setFillRange:function(t){if(this._fillRange!==t)if(this._fillRange=t,this._renderingType===e.Scale9Sprite.RenderingType.FILLED)this._quadsDirty=!0},getFillRange:function(){return this._fillRange},_onColorOpacityDirty:function(){var t=this.getDisplayedColor();t.a=this.getDisplayedOpacity();var e,i=this._quads.length;for(e=0;i>e;++e)this._quads[e]._bl.colors=t,this._quads[e]._br.colors=t,this._quads[e]._tl.colors=t,this._quads[e]._tr.colors=t},_rebuildQuads:function(){if(this.loaded()&&this._quadsDirty!==!1){for(var t=0;t<this._quads.length;++t)e.pool.putInPool(this._quads[t]);this._rawQuad&&e.pool.putInPool(this._rawQuad),this._rawQuad=null,this._quads=[];var i=this.getDisplayedColor();if(i.a=this.getDisplayedOpacity(),this._isTriangle=!1,this._renderingType===e.Scale9Sprite.RenderingType.SIMPLE)this._quads=p._rebuildQuads_base(this._spriteFrame,this.getContentSize(),i,this._isTrimmedContentSize);else if(this._renderingType===e.Scale9Sprite.RenderingType.SLICED)this._quads=g._rebuildQuads_base(this._spriteFrame,this.getContentSize(),i,this._insetLeft,this._insetRight,this._insetTop,this._insetBottom);else if(this._renderingType===e.Scale9Sprite.RenderingType.TILED)this._quads=m._rebuildQuads_base(this._spriteFrame,this.getContentSize(),i);else if(this._renderingType===e.Scale9Sprite.RenderingType.FILLED){var n=this._fillStart,r=this._fillRange;if(0>r)n+=r,
r=-r;if(this._fillType!==e.Scale9Sprite.FillType.RADIAL)r=n+r,n=n>1?1:n,n=0>n?0:n,r=r>1?1:r,r=0>r?0:r,r-=n,this._quads=v._rebuildQuads_base(this._spriteFrame,this.getContentSize(),i,this._fillType,n,r);else{this._isTriangle=!0;var s=y._rebuildQuads_base(this._spriteFrame,this.getContentSize(),i,this._fillCenter,n,r);this._quads=s.quad,this._rawQuad=s.rawQuad}}else this._quads=[],e.error("Can not generate quad");this._quadsDirty=!1}},_createRenderCmd:function(){if(e._renderType===e.game.RENDER_TYPE_CANVAS)return new e.Scale9Sprite.CanvasRenderCmd(this);else return new e.Scale9Sprite.WebGLRenderCmd(this)}});var _=e.Scale9Sprite.prototype;e.js.addon(_,u.prototype),_.insetLeft,e.defineGetterSetter(_,"insetLeft",_.getInsetLeft,_.setInsetLeft),_.insetTop,e.defineGetterSetter(_,"insetTop",_.getInsetTop,_.setInsetTop),_.insetRight,e.defineGetterSetter(_,"insetRight",_.getInsetRight,_.setInsetRight),_.insetBottom,e.defineGetterSetter(_,"insetBottom",_.getInsetBottom,_.setInsetBottom),_=null,e.Scale9Sprite.state={NORMAL:0,GRAY:1},e.Scale9Sprite.RenderingType=e.Enum({SIMPLE:0,SLICED:1,TILED:2,FILLED:3}),e.Scale9Sprite.FillType=e.Enum({HORIZONTAL:0,VERTICAL:1,RADIAL:2}),e.Scale9Sprite.CanvasRenderCmd=function(t){_ccsg.Node.CanvasRenderCmd.call(this,t),this._needDraw=!0,this._state=e.Scale9Sprite.state.NORMAL,this._originalTexture=this._textureToRender=null};var l=e.Scale9Sprite.CanvasRenderCmd.prototype=Object.create(_ccsg.Node.CanvasRenderCmd.prototype);l.constructor=e.Scale9Sprite.CanvasRenderCmd,l._updateDisplayOpacity=function(t){_ccsg.Node.WebGLRenderCmd.prototype._updateDisplayOpacity.call(this,t);this._node},l._updateDisplayColor=function(t){_ccsg.Node.WebGLRenderCmd.prototype._updateDisplayColor.call(this,t);this._node;this._originalTexture=this._textureToRender=null},l.setState=function(t){if(this._state!==t)this._state=t,this._originalTexture=this._textureToRender=null},l.rendering=function(t,i,n){var r=this._node,s=this._displayedOpacity,o=s/255,a=null;if(r._spriteFrame)a=r._spriteFrame._texture;if(r.loaded()&&0!==s){if(null===this._textureToRender||this._originalTexture!==a){if(this._textureToRender=this._originalTexture=a,e.Scale9Sprite.state.GRAY===this._state)this._textureToRender=this._textureToRender._generateGrayTexture();var c=r.getDisplayedColor();if(a&&(255!==c.r||255!==c.g||255!==c.b))this._textureToRender=this._textureToRender._generateColorTexture(c.r,c.g,c.b)}var l=t||e._renderContext,h=l.getContext();if(l.setTransform(this._worldTransform,i,n),l.setCompositeOperation(_ccsg.Node.CanvasRenderCmd._getCompositeOperationByBlendFunc(r._blendFunc)),l.setGlobalAlpha(o),this._textureToRender){if(r._quadsDirty)r._rebuildQuads();var u,d,f,_,p,g,m,v,y=this._textureToRender.getPixelWidth(),T=this._textureToRender.getPixelHeight(),C=this._textureToRender._htmlElementObj;if(r._isTriangle){var x=r._rawQuad;p=x._bl.vertices.x,g=x._bl.vertices.y,m=x._tr.vertices.x-x._bl.vertices.x,v=x._tr.vertices.y-x._bl.vertices.y,g=-g-v,u=x._tl.texCoords.u*y,d=x._tl.texCoords.v*T,f=(x._tr.texCoords.u-x._bl.texCoords.u)*y,_=(x._bl.texCoords.v-x._tr.texCoords.v)*T,p*=i,g*=n,m*=i,v*=n,l.save(),h.beginPath();for(var S=r._quads,b=0;b<S.length;++b)h.moveTo(S[b]._tl.vertices.x*i,-S[b]._tl.vertices.y*n),h.lineTo(S[b]._bl.vertices.x*i,-S[b]._bl.vertices.y*n),h.lineTo(S[b]._tr.vertices.x*i,-S[b]._tr.vertices.y*n);if(h.clip(),""!==this._textureToRender._pattern)l.setFillStyle(h.createPattern(C,this._textureToRender._pattern)),h.fillRect(p,g,m,v);else if(0!==f&&0!==_&&0!==m&&0!==v)h.drawImage(C,u,d,f,_,p,g,m,v);l.restore()}else for(var S=r._quads,b=0;b<S.length;++b)if(p=S[b]._bl.vertices.x,g=S[b]._bl.vertices.y,m=S[b]._tr.vertices.x-S[b]._bl.vertices.x,v=S[b]._tr.vertices.y-S[b]._bl.vertices.y,g=-g-v,u=S[b]._tl.texCoords.u*y,d=S[b]._tl.texCoords.v*T,f=(S[b]._tr.texCoords.u-S[b]._bl.texCoords.u)*y,_=(S[b]._bl.texCoords.v-S[b]._tr.texCoords.v)*T,p*=i,g*=n,m*=i,v*=n,""!==this._textureToRender._pattern)l.setFillStyle(h.createPattern(C,this._textureToRender._pattern)),h.fillRect(p,g,m,v);else if(0!==f&&0!==_&&0!==m&&0!==v)h.drawImage(C,u,d,f,_,p,g,m,v)}e.g_NumberOfDraws+=S.length}};var f=e.gl;if(_ccsg.Node.WebGLRenderCmd){e.Scale9Sprite.WebGLRenderCmd=function(t){_ccsg.Node.WebGLRenderCmd.call(this,t),this._needDraw=!0,this._cachedParent=null,this._cacheDirty=!1,this._quadWebBuffer=e._renderContext.createBuffer(),this._quadIndexBuffer=e._renderContext.createBuffer(),this._indices=new Int16Array(54),this._colorOpacityDirty=!1};var l=e.Scale9Sprite.WebGLRenderCmd.prototype=Object.create(_ccsg.Node.WebGLRenderCmd.prototype);l.constructor=e.Scale9Sprite.WebGLRenderCmd,l.rendering=function(t){var i=this._node,n=null;if(i._spriteFrame)n=i._spriteFrame._texture;if(i.loaded()&&0!==this._displayedOpacity){var r=!1;if(i._quadsDirty)i._rebuildQuads(),this._colorOpacityDirty=!1,r=!0;if(this._colorOpacityDirty)i._onColorOpacityDirty(),this._colorOpacityDirty=!1,r=!0;var s=t||e._renderContext;if(null!=n){this._shaderProgram.use(),this._shaderProgram._setUniformForMVPMatrixWithMat4(this._stackMatrix),f.blendFunc(i._blendFunc.src,i._blendFunc.dst),f.bindTexture2DN(0,n),f.enableVertexAttribs(e.macro.VERTEX_ATTRIB_FLAG_POS_COLOR_TEX),s.bindBuffer(s.ARRAY_BUFFER,this._quadWebBuffer),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,this._quadIndexBuffer);var o=i._quads,a=0,c=o.length;if(0===c)return;if(r){var l=this._indices,h=0;s.bufferData(s.ARRAY_BUFFER,o[0].arrayBuffer.byteLength*o.length,s.DYNAMIC_DRAW);for(var u=0;u<o.length;++u)if(s.bufferSubData(s.ARRAY_BUFFER,a,o[u].arrayBuffer),a+=o[u].arrayBuffer.byteLength,i._isTriangle===!0)l[h]=4*u,l[h+1]=4*u+1,l[h+2]=4*u+2,h+=3;else l[h]=4*u,l[h+1]=4*u+1,l[h+2]=4*u+2,l[h+3]=4*u+3,l[h+4]=4*u+2,l[h+5]=4*u+1,h+=6;s.bufferData(s.ELEMENT_ARRAY_BUFFER,l,s.DYNAMIC_DRAW)}s.vertexAttribPointer(0,3,s.FLOAT,!1,24,0),s.vertexAttribPointer(1,4,s.UNSIGNED_BYTE,!0,24,12),s.vertexAttribPointer(2,2,s.FLOAT,!1,24,16),s.drawElements(s.TRIANGLES,(i._isTriangle?3:6)*c,s.UNSIGNED_SHORT,0),e.g_NumberOfDraws+=1}}},l._updateDisplayOpacity=function(t){_ccsg.Node.WebGLRenderCmd.prototype._updateDisplayOpacity.call(this,t);this._node;this._colorOpacityDirty=!0},l._updateDisplayColor=function(t){_ccsg.Node.WebGLRenderCmd.prototype._updateDisplayColor.call(this,t);this._node;this._colorOpacityDirty=!0},l.setState=function(t){var i=this._node;if(t===e.Scale9Sprite.state.NORMAL)i.setShaderProgram(e.shaderCache.programForKey(e.macro.SHADER_POSITION_TEXTURECOLOR));else if(t===e.Scale9Sprite.state.GRAY)i.setShaderProgram(e.Scale9Sprite.WebGLRenderCmd._getGrayShaderProgram())},e.Scale9Sprite.WebGLRenderCmd._grayShaderProgram=null,e.Scale9Sprite.WebGLRenderCmd._getGrayShaderProgram=function(){var t=e.Scale9Sprite.WebGLRenderCmd._grayShaderProgram;if(t)return t;else return t=new e.GLProgram,t.initWithVertexShaderByteArray(e.PresetShaders.POSITION_TEXTURE_COLOR_VERT,e.Scale9Sprite.WebGLRenderCmd._grayShaderFragment),t.addAttribute(e.macro.ATTRIBUTE_NAME_POSITION,e.macro.VERTEX_ATTRIB_POSITION),t.addAttribute(e.macro.ATTRIBUTE_NAME_COLOR,e.macro.VERTEX_ATTRIB_COLOR),t.addAttribute(e.macro.ATTRIBUTE_NAME_TEX_COORD,e.macro.VERTEX_ATTRIB_TEX_COORDS),t.link(),t.updateUniforms(),e.Scale9Sprite.WebGLRenderCmd._grayShaderProgram=t,t},e.Scale9Sprite.WebGLRenderCmd._grayShaderFragment="precision lowp float;\nvarying vec4 v_fragmentColor; \nvarying vec2 v_texCoord; \nvoid main() \n{ \n    vec4 c = texture2D(CC_Texture0, v_texCoord); \n    gl_FragColor.xyz = vec3(0.2126*c.r + 0.7152*c.g + 0.0722*c.b); \n     gl_FragColor.w = c.w ; \n}"}e.configuration={ERROR:0,STRING:1,INT:2,DOUBLE:3,BOOLEAN:4,_maxTextureSize:0,_maxModelviewStackDepth:0,_supportsPVRTC:!1,_supportsNPOT:!1,_supportsBGRA8888:!1,_supportsDiscardFramebuffer:!1,_supportsShareableVAO:!1,_maxSamplesAllowed:0,_maxTextureUnits:0,_GlExtensions:"",_valueDict:{},_inited:!1,_init:function(){var t=this._valueDict;t["cocos2d.x.version"]=e.ENGINE_VERSION,t["cocos2d.x.compiled_with_profiler"]=!1,t["cocos2d.x.compiled_with_gl_state_cache"]=e.macro.ENABLE_GL_STATE_CACHE,this._inited=!0},getMaxTextureSize:function(){return this._maxTextureSize},getMaxModelviewStackDepth:function(){return this._maxModelviewStackDepth},getMaxTextureUnits:function(){return this._maxTextureUnits},supportsNPOT:function(){return this._supportsNPOT},supportsPVRTC:function(){return this._supportsPVRTC},supportsETC:function(){return!1},supportsS3TC:function(){return!1},supportsATITC:function(){return!1},supportsBGRA8888:function(){return this._supportsBGRA8888},supportsDiscardFramebuffer:function(){return this._supportsDiscardFramebuffer},supportsShareableVAO:function(){return this._supportsShareableVAO},checkForGLExtension:function(t){return this._GlExtensions.indexOf(t)>-1},getValue:function(t,e){if(!this._inited)this._init();var i=this._valueDict;if(i[t])return i[t];else return e},setValue:function(t,e){this._valueDict[t]=e},dumpInfo:function(){if(0===e.macro.ENABLE_GL_STATE_CACHE)e.log(""),e.log(e._LogInfos.configuration.dumpInfo),e.log("")},gatherGPUInfo:function(){if(e._renderType!==e.game.RENDER_TYPE_CANVAS){if(!this._inited)this._init();var t=e._renderContext,i=this._valueDict;i["gl.vendor"]=t.getParameter(t.VENDOR),i["gl.renderer"]=t.getParameter(t.RENDERER),i["gl.version"]=t.getParameter(t.VERSION),this._GlExtensions="";for(var n=t.getSupportedExtensions(),r=0;r<n.length;r++)this._GlExtensions+=n[r]+" ";this._maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),i["gl.max_texture_size"]=this._maxTextureSize,this._maxTextureUnits=t.getParameter(t.MAX_COMBINED_TEXTURE_IMAGE_UNITS),i["gl.max_texture_units"]=this._maxTextureUnits,this._supportsPVRTC=this.checkForGLExtension("GL_IMG_texture_compression_pvrtc"),i["gl.supports_PVRTC"]=this._supportsPVRTC,this._supportsNPOT=!1,i["gl.supports_NPOT"]=this._supportsNPOT,this._supportsBGRA8888=this.checkForGLExtension("GL_IMG_texture_format_BGRA888"),i["gl.supports_BGRA8888"]=this._supportsBGRA8888,this._supportsDiscardFramebuffer=this.checkForGLExtension("GL_EXT_discard_framebuffer"),i["gl.supports_discard_framebuffer"]=this._supportsDiscardFramebuffer,this._supportsShareableVAO=this.checkForGLExtension("vertex_array_object"),i["gl.supports_vertex_array_object"]=this._supportsShareableVAO,e.checkGLErrorDebug()}},loadConfigFile:function(t){if(!this._inited)this._init();var i=e.loader.getRes(t);if(!i)throw new Error("Please load the resource first : "+t);e.assert(i,e._LogInfos.configuration.loadConfigFile_2,t);var n=i.data;if(!n)return void e.log(e._LogInfos.configuration.loadConfigFile,t);for(var r in n)this._valueDict[r]=n[r]}},e.DrawingPrimitiveCanvas=e._Class.extend({_cacheArray:[],_renderContext:null,ctor:function(t){this._renderContext=t},drawPoint:function(t,i){if(!i)i=1;var n=e.view.getScaleX(),r=e.view.getScaleY(),s=e.p(t.x*n,t.y*r),o=this._renderContext.getContext();o.beginPath(),o.arc(s.x,-s.y,i*n,0,2*Math.PI,!1),o.closePath(),o.fill()},drawPoints:function(t,i,n){if(null!=t){if(!n)n=1;var r=this._renderContext.getContext(),s=e.view.getScaleX(),o=e.view.getScaleY();r.beginPath();for(var a=0,c=t.length;c>a;a++)r.arc(t[a].x*s,-t[a].y*o,n*s,0,2*Math.PI,!1);r.closePath(),r.fill()}},drawLine:function(t,i){var n=this._renderContext.getContext(),r=e.view.getScaleX(),s=e.view.getScaleY();n.beginPath(),n.moveTo(t.x*r,-t.y*s),n.lineTo(i.x*r,-i.y*s),n.closePath(),n.stroke()},drawRect:function(t,i){this.drawLine(e.p(t.x,t.y),e.p(i.x,t.y)),this.drawLine(e.p(i.x,t.y),e.p(i.x,i.y)),this.drawLine(e.p(i.x,i.y),e.p(t.x,i.y)),this.drawLine(e.p(t.x,i.y),e.p(t.x,t.y))},drawSolidRect:function(t,i,n){var r=[t,e.p(i.x,t.y),i,e.p(t.x,i.y)];this.drawSolidPoly(r,4,n)},drawPoly:function(t,i,n,r){if(r=r||!1,null!=t){if(t.length<3)throw new Error("Polygon's point must greater than 2");var s=t[0],o=this._renderContext.getContext(),a=e.view.getScaleX(),c=e.view.getScaleY();o.beginPath(),o.moveTo(s.x*a,-s.y*c);for(var l=1,h=t.length;h>l;l++)o.lineTo(t[l].x*a,-t[l].y*c);if(n)o.closePath();if(r)o.fill();else o.stroke()}},drawSolidPoly:function(t,e,i){this.setDrawColor(i.r,i.g,i.b,i.a),this.drawPoly(t,e,!0,!0)},drawCircle:function(t,i,n,r,s){s=s||!1;var o=this._renderContext.getContext(),a=e.view.getScaleX(),c=e.view.getScaleY();o.beginPath();var l=n-2*Math.PI;if(o.arc(0|t.x*a,0|-(t.y*c),i*a,-n,-l,!1),s)o.lineTo(0|t.x*a,0|-(t.y*c));o.stroke()},drawQuadBezier:function(t,i,n,r){var s=this._cacheArray;s.length=0;for(var o=0,a=0;r>a;a++){var c=Math.pow(1-o,2)*t.x+2*(1-o)*o*i.x+o*o*n.x,l=Math.pow(1-o,2)*t.y+2*(1-o)*o*i.y+o*o*n.y;s.push(e.p(c,l)),o+=1/r}s.push(e.p(n.x,n.y)),this.drawPoly(s,r+1,!1,!1)},drawCubicBezier:function(t,i,n,r,s){var o=this._cacheArray;o.length=0;for(var a=0,c=0;s>c;c++){var l=Math.pow(1-a,3)*t.x+3*Math.pow(1-a,2)*a*i.x+3*(1-a)*a*a*n.x+a*a*a*r.x,h=Math.pow(1-a,3)*t.y+3*Math.pow(1-a,2)*a*i.y+3*(1-a)*a*a*n.y+a*a*a*r.y;o.push(e.p(l,h)),a+=1/s}o.push(e.p(r.x,r.y)),this.drawPoly(o,s+1,!1,!1)},drawCatmullRom:function(t,e){this.drawCardinalSpline(t,.5,e)},drawCardinalSpline:function(t,i,n){e._renderContext.setStrokeStyle("rgba(255,255,255,1)");var r=this._cacheArray;r.length=0;for(var s,o,a=1/t.length,c=0;n+1>c;c++){var l=c/n;if(1===l)s=t.length-1,o=1;else s=0|l/a,o=(l-a*s)/a;var h=e.cardinalSplineAt(e.getControlPointAt(t,s-1),e.getControlPointAt(t,s-0),e.getControlPointAt(t,s+1),e.getControlPointAt(t,s+2),i,o);r.push(h)}this.drawPoly(r,n+1,!1,!1)},drawImage:function(t,e,i,n,r){var s=arguments.length,o=this._renderContext.getContext();switch(s){case 2:var a=t.height;o.drawImage(t,e.x,-(e.y+a));break;case 3:o.drawImage(t,e.x,-(e.y+i.height),i.width,i.height);break;case 5:o.drawImage(t,e.x,e.y,i.width,i.height,n.x,-(n.y+r.height),r.width,r.height);break;default:throw new Error("Argument must be non-nil")}},drawStar:function(t,i,n){var r=t||this._renderContext,s=r.getContext();i*=e.view.getScaleX();var o="rgba("+(0|n.r)+","+(0|n.g)+","+(0|n.b);r.setFillStyle(o+",1)");var a=i/10;s.beginPath(),s.moveTo(-i,i),s.lineTo(0,a),s.lineTo(i,i),s.lineTo(a,0),s.lineTo(i,-i),s.lineTo(0,-a),s.lineTo(-i,-i),s.lineTo(-a,0),s.lineTo(-i,i),s.closePath(),s.fill();var c=s.createRadialGradient(0,0,a,0,0,i);c.addColorStop(0,o+", 1)"),c.addColorStop(.3,o+", 0.8)"),c.addColorStop(1,o+", 0.0)"),r.setFillStyle(c),s.beginPath();var l=0,h=e.macro.PI2;s.arc(0,0,i-a,l,h,!1),s.closePath(),s.fill()},drawColorBall:function(t,i,n){var r=t||this._renderContext,s=r.getContext();i*=e.view.getScaleX();var o="rgba("+(0|n.r)+","+(0|n.g)+","+(0|n.b),a=i/10,c=s.createRadialGradient(0,0,a,0,0,i);c.addColorStop(0,o+", 1)"),c.addColorStop(.3,o+", 0.8)"),c.addColorStop(.6,o+", 0.4)"),c.addColorStop(1,o+", 0.0)"),r.setFillStyle(c),s.beginPath();var l=0,h=e.macro.PI2;s.arc(0,0,i,l,h,!1),s.closePath(),s.fill()},fillText:function(t,e,i){this._renderContext.getContext().fillText(t,e,-i)},setDrawColor:function(t,e,i,n){this._renderContext.setFillStyle("rgba("+t+","+e+","+i+","+n/255+")"),this._renderContext.setStrokeStyle("rgba("+t+","+e+","+i+","+n/255+")")},setPointSize:function(t){},setLineWidth:function(t){this._renderContext.getContext().lineWidth=t*e.view.getScaleX()}});var d=e.macro;e.DrawingPrimitiveWebGL=e._Class.extend({_renderContext:null,_initialized:!1,_shader:null,_colorLocation:-1,_colorArray:null,_pointSizeLocation:-1,_pointSize:-1,ctor:function(t){if(null==t)t=e._renderContext;if(!t instanceof WebGLRenderingContext)throw new Error("Can't initialise DrawingPrimitiveWebGL. context need is WebGLRenderingContext");this._renderContext=t,this._colorArray=new Float32Array([1,1,1,1])},lazy_init:function(){var t=this;if(!t._initialized)t._shader=e.shaderCache.programForKey(d.SHADER_POSITION_UCOLOR),t._colorLocation=t._renderContext.getUniformLocation(t._shader.getProgram(),"u_color"),t._pointSizeLocation=t._renderContext.getUniformLocation(t._shader.getProgram(),"u_pointSize"),t._initialized=!0},drawInit:function(){this._initialized=!1},drawPoint:function(t){this.lazy_init();var i=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),e.gl.enableVertexAttribs(d.VERTEX_ATTRIB_FLAG_POSITION),i.uniform4fv(this._colorLocation,this._colorArray),this._shader.setUniformLocationWith1f(this._pointSizeLocation,this._pointSize);var n=i.createBuffer();i.bindBuffer(i.ARRAY_BUFFER,n),i.bufferData(i.ARRAY_BUFFER,new Float32Array([t.x,t.y]),i.STATIC_DRAW),i.vertexAttribPointer(d.VERTEX_ATTRIB_POSITION,2,i.FLOAT,!1,0,0),i.drawArrays(i.POINTS,0,1),i.deleteBuffer(n),e.incrementGLDraws(1)},drawPoints:function(t,i){if(t&&0!==t.length){this.lazy_init();var n=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),e.gl.enableVertexAttribs(d.VERTEX_ATTRIB_FLAG_POSITION),n.uniform4fv(this._colorLocation,this._colorArray),this._shader.setUniformLocationWith1f(this._pointSizeLocation,this._pointSize);var r=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,r),n.bufferData(n.ARRAY_BUFFER,this._pointsToTypeArray(t),n.STATIC_DRAW),n.vertexAttribPointer(d.VERTEX_ATTRIB_POSITION,2,n.FLOAT,!1,0,0),n.drawArrays(n.POINTS,0,t.length),n.deleteBuffer(r),e.incrementGLDraws(1)}},_pointsToTypeArray:function(t){for(var e=new Float32Array(2*t.length),i=0;i<t.length;i++)e[2*i]=t[i].x,e[2*i+1]=t[i].y;return e},drawLine:function(t,i){this.lazy_init();var n=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),e.gl.enableVertexAttribs(d.VERTEX_ATTRIB_FLAG_POSITION),n.uniform4fv(this._colorLocation,this._colorArray);var r=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,r),n.bufferData(n.ARRAY_BUFFER,this._pointsToTypeArray([t,i]),n.STATIC_DRAW),n.vertexAttribPointer(d.VERTEX_ATTRIB_POSITION,2,n.FLOAT,!1,0,0),n.drawArrays(n.LINES,0,2),n.deleteBuffer(r),e.incrementGLDraws(1)},drawRect:function(t,i){this.drawLine(e.p(t.x,t.y),e.p(i.x,t.y)),this.drawLine(e.p(i.x,t.y),e.p(i.x,i.y)),this.drawLine(e.p(i.x,i.y),e.p(t.x,i.y)),this.drawLine(e.p(t.x,i.y),e.p(t.x,t.y))},drawSolidRect:function(t,i,n){var r=[t,e.p(i.x,t.y),i,e.p(t.x,i.y)];this.drawSolidPoly(r,4,n)},drawPoly:function(t,i,n){this.lazy_init();var r=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),e.gl.enableVertexAttribs(d.VERTEX_ATTRIB_FLAG_POSITION),r.uniform4fv(this._colorLocation,this._colorArray);var s=r.createBuffer();if(r.bindBuffer(r.ARRAY_BUFFER,s),r.bufferData(r.ARRAY_BUFFER,this._pointsToTypeArray(t),r.STATIC_DRAW),r.vertexAttribPointer(d.VERTEX_ATTRIB_POSITION,2,r.FLOAT,!1,0,0),n)r.drawArrays(r.LINE_LOOP,0,t.length);else r.drawArrays(r.LINE_STRIP,0,t.length);r.deleteBuffer(s),e.incrementGLDraws(1)},drawSolidPoly:function(t,i,n){if(this.lazy_init(),n)this.setDrawColor(n.r,n.g,n.b,n.a);var r=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),e.gl.enableVertexAttribs(d.VERTEX_ATTRIB_FLAG_POSITION),r.uniform4fv(this._colorLocation,this._colorArray);var s=r.createBuffer();r.bindBuffer(r.ARRAY_BUFFER,s),r.bufferData(r.ARRAY_BUFFER,this._pointsToTypeArray(t),r.STATIC_DRAW),r.vertexAttribPointer(d.VERTEX_ATTRIB_POSITION,2,r.FLOAT,!1,0,0),r.drawArrays(r.TRIANGLE_FAN,0,t.length),r.deleteBuffer(s),e.incrementGLDraws(1)},drawCircle:function(t,i,n,r,s){this.lazy_init();var o=1;if(s)o++;var a=2*Math.PI/r,c=new Float32Array(2*(r+2));if(c){for(var l=0;r>=l;l++){var h=l*a,u=i*Math.cos(h+n)+t.x,f=i*Math.sin(h+n)+t.y;c[2*l]=u,c[2*l+1]=f}c[2*(r+1)]=t.x,c[2*(r+1)+1]=t.y;var _=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),e.gl.enableVertexAttribs(d.VERTEX_ATTRIB_FLAG_POSITION),_.uniform4fv(this._colorLocation,this._colorArray);var p=_.createBuffer();_.bindBuffer(_.ARRAY_BUFFER,p),_.bufferData(_.ARRAY_BUFFER,c,_.STATIC_DRAW),_.vertexAttribPointer(d.VERTEX_ATTRIB_POSITION,2,_.FLOAT,!1,0,0),_.drawArrays(_.LINE_STRIP,0,r+o),_.deleteBuffer(p),e.incrementGLDraws(1)}},drawQuadBezier:function(t,i,n,r){this.lazy_init();for(var s=new Float32Array(2*(r+1)),o=0,a=0;r>a;a++)s[2*a]=Math.pow(1-o,2)*t.x+2*(1-o)*o*i.x+o*o*n.x,s[2*a+1]=Math.pow(1-o,2)*t.y+2*(1-o)*o*i.y+o*o*n.y,o+=1/r;s[2*r]=n.x,s[2*r+1]=n.y;var c=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),e.gl.enableVertexAttribs(d.VERTEX_ATTRIB_FLAG_POSITION),c.uniform4fv(this._colorLocation,this._colorArray);var l=c.createBuffer();c.bindBuffer(c.ARRAY_BUFFER,l),c.bufferData(c.ARRAY_BUFFER,s,c.STATIC_DRAW),c.vertexAttribPointer(d.VERTEX_ATTRIB_POSITION,2,c.FLOAT,!1,0,0),c.drawArrays(c.LINE_STRIP,0,r+1),c.deleteBuffer(l),e.incrementGLDraws(1)},drawCubicBezier:function(t,i,n,r,s){this.lazy_init();for(var o=new Float32Array(2*(s+1)),a=0,c=0;s>c;c++)o[2*c]=Math.pow(1-a,3)*t.x+3*Math.pow(1-a,2)*a*i.x+3*(1-a)*a*a*n.x+a*a*a*r.x,o[2*c+1]=Math.pow(1-a,3)*t.y+3*Math.pow(1-a,2)*a*i.y+3*(1-a)*a*a*n.y+a*a*a*r.y,a+=1/s;o[2*s]=r.x,o[2*s+1]=r.y;var l=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),e.gl.enableVertexAttribs(d.VERTEX_ATTRIB_FLAG_POSITION),l.uniform4fv(this._colorLocation,this._colorArray);var h=l.createBuffer();l.bindBuffer(l.ARRAY_BUFFER,h),l.bufferData(l.ARRAY_BUFFER,o,l.STATIC_DRAW),l.vertexAttribPointer(d.VERTEX_ATTRIB_POSITION,2,l.FLOAT,!1,0,0),l.drawArrays(l.LINE_STRIP,0,s+1),l.deleteBuffer(h),e.incrementGLDraws(1)},drawCatmullRom:function(t,e){this.drawCardinalSpline(t,.5,e)},drawCardinalSpline:function(t,i,n){this.lazy_init();for(var r,s,o=new Float32Array(2*(n+1)),a=1/t.length,c=0;n+1>c;c++){var l=c/n;if(1===l)r=t.length-1,s=1;else r=0|l/a,s=(l-a*r)/a;var h=e.cardinalSplineAt(e.getControlPointAt(t,r-1),e.getControlPointAt(t,r),e.getControlPointAt(t,r+1),e.getControlPointAt(t,r+2),i,s);o[2*c]=h.x,o[2*c+1]=h.y}var u=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),e.gl.enableVertexAttribs(d.VERTEX_ATTRIB_FLAG_POSITION),u.uniform4fv(this._colorLocation,this._colorArray);var f=u.createBuffer();u.bindBuffer(u.ARRAY_BUFFER,f),u.bufferData(u.ARRAY_BUFFER,o,u.STATIC_DRAW),u.vertexAttribPointer(d.VERTEX_ATTRIB_POSITION,2,u.FLOAT,!1,0,0),u.drawArrays(u.LINE_STRIP,0,n+1),u.deleteBuffer(f),e.incrementGLDraws(1)},setDrawColor:function(t,e,i,n){this._colorArray[0]=t/255,this._colorArray[1]=e/255,this._colorArray[2]=i/255,this._colorArray[3]=n/255},setPointSize:function(t){this._pointSize=t},setLineWidth:function(t){if(this._renderContext.lineWidth)this._renderContext.lineWidth(t)}});var u=t("../cocos2d/core/event/event-target"),T=function(){this._u=0,this._v=0,this._width=0,this._height=0,this._offsetX=0,this._offsetY=0,this._textureID=0,this._validDefinition=!1,this._xAdvance=0};e.FontAtlas=function(t){this._lineHeight=t.commonHeight,this._fontSize=t.fontSize,this._letterDefinitions={},this._fntConfig=t},e.FontAtlas.prototype={constructor:e.FontAtlas,setFontSize:function(t){this._fontSize=t},getOriginalFontSize:function(){return this._fntConfig.fontSize},addLetterDefinitions:function(t,e){this._letterDefinitions[t]=e},cloneLetterDefinition:function(){var t={};for(var i in this._letterDefinitions){var n=new T;e.js.mixin(n,this._letterDefinitions[i]),t[i]=n}return t},assignLetterDefinitions:function(t){for(var i in this._letterDefinitions){var n=t[i],r=this._letterDefinitions[i];e.js.mixin(r,n)}},scaleFontLetterDefinition:function(t){for(var e in this._letterDefinitions){var i=this._letterDefinitions[e];i._width*=t,i._height*=t,i._offsetX*=t,i._offsetY*=t,i._xAdvance*=t}},getLetterDefinitionForChar:function(t){var e,i=this._letterDefinitions.hasOwnProperty(t.charCodeAt(0));if(i)e=this._letterDefinitions[t.charCodeAt(0)];else e=null;return e}};var C=function(){this._char="",this._valid=!0,this._positionX=0,this._positionY=0,this._atlasIndex=0,this._lineIndex=0};_ccsg.Label=_ccsg.Node.extend({_hAlign:e.TextAlignment.LEFT,_vAlign:e.VerticalTextAlignment.TOP,_string:"",_fontSize:40,_drawFontsize:40,_overFlow:0,_isWrapText:!0,_spacingX:0,_blendFunc:null,_isUseSystemFont:!0,_labelType:0,_fontHandle:"",_lineSpacing:0,_maxLineWidth:0,_labelDimensions:e.size(0,0),_labelWidth:0,_labelHeight:0,_lineHeight:40,_className:"Label",ctor:function(t,i){u.call(this),i=i||"",this._fontHandle=i,t=t||"",this._string=t,_ccsg.Node.prototype.ctor.call(this),this.setAnchorPoint(e.p(.5,.5)),_ccsg.Node.prototype.setContentSize.call(this,e.size(128,128)),this._blendFunc=e.BlendFunc._alphaNonPremultiplied(),this.setFontFileOrFamily(i),this.setString(this._string)},_resetBMFont:function(){if(this._imageOffset=e.p(0,0),this._cascadeColorEnabled=!0,this._cascadeOpacityEnabled=!0,this._fontAtlas=null,this._config=null,this._numberOfLines=0,this._lettersInfo=[],this._linesWidth=[],this._linesOffsetX=[],this._textDesiredHeight=0,this._letterOffsetY=0,this._tailoredTopY=0,this._tailoredBottomY=0,this._config=null,this._fontAtlas=null,this._bmfontScale=1,this._additionalKerning=0,this._horizontalKernings=[],this._lineBreakWithoutSpaces=!1,this._reusedRect=e.rect(0,0,0,0),this._textureLoaded=!1,this._spriteBatchNode)this.removeChild(this._spriteBatchNode),this._spriteBatchNode=null},isSystemFontUsed:function(){return this._isUseSystemFont},setSystemFontUsed:function(t){if(this._isUseSystemFont!==t){if(t)this.setFontFileOrFamily("Arial");this._isUseSystemFont=t}},setHorizontalAlign:function(t){if(this._hAlign!==t)this._hAlign=t,this._notifyLabelSkinDirty()},getHorizontalAlign:function(){return this._hAlign},setVerticalAlign:function(t){if(this._vAlign!==t)this._vAlign=t,this._notifyLabelSkinDirty()},getVerticalAlign:function(){return this._vAlign},setString:function(t){if("string"!=typeof t)t=""+t;if(this._string!==t)this._string=t,this._notifyLabelSkinDirty()},getString:function(){return this._string},getStringLength:function(){return this._string.length},enableWrapText:function(t){if(this._isWrapText!==t)if(this._overFlow!==_ccsg.Label.Overflow.RESIZE_HEIGHT&&this._overFlow!==_ccsg.Label.Overflow.NONE)this._isWrapText=t,this._rescaleWithOriginalFontSize(),this._notifyLabelSkinDirty()},isWrapTextEnabled:function(){return this._isWrapText},getFontName:function(){return this._fontHandle},setFontSize:function(t){this._fontSize=t,this._drawFontsize=t,this._notifyLabelSkinDirty()},getFontSize:function(){return this._fontSize},_updateWrapText:function(t){if(t===_ccsg.Label.Overflow.RESIZE_HEIGHT)this._isWrapText=!0;if(t===_ccsg.Label.Overflow.NONE)this._isWrapText=!1},_setOverflowBMFont:function(){if(this._labelType===_ccsg.Label.Type.BMFont){if(this._overFlow===_ccsg.Label.Overflow.RESIZE_HEIGHT)this._setDimensions(this._labelDimensions.width,0);if(this._overFlow===_ccsg.Label.Overflow.NONE)this._setDimensions(0,0);this._rescaleWithOriginalFontSize()}},setOverflow:function(t){if(this._overFlow!==t)this._overFlow=t,this._updateWrapText(this._overFlow),this._setOverflowBMFont(),this._notifyLabelSkinDirty()},getOverflow:function(){return this._overFlow},setSpacingX:function(t){if(this._spacingX!==t)this._spacingX=t},setLineHeight:function(t){if(this._lineHeight!==t)this._lineHeight=t,this._notifyLabelSkinDirty()},setLineBreakWithoutSpace:function(t){if(this._lineBreakWithoutSpaces!==t)this._lineBreakWithoutSpaces=t,this._notifyLabelSkinDirty()},getSpacingX:function(){return this._spacingX},getLineHeight:function(){return this._lineHeight},setFontFileOrFamily:function(t){t=t||"Arial";var i=e.path.extname(t);if(this._resetBMFont(),!i)return this._fontHandle=t,this._labelType=_ccsg.Label.Type.SystemFont,this._notifyLabelSkinDirty(),this._isUseSystemFont=!0,void this.emit("load");if(this._isUseSystemFont=!1,".ttf"===i)this._labelType=_ccsg.Label.Type.TTF,this._fontHandle=this._loadTTFFont(t);else if(".fnt"===i)this._labelType=_ccsg.Label.Type.BMFont,this._initBMFontWithString(this._string,t);this._notifyLabelSkinDirty()},_loadTTFFont:function(t){var e=t.lastIndexOf(".ttf");if(-1===e)return t;var i,n=t.lastIndexOf("/");if(-1===n)i=t.substring(0,e)+"_LABEL";else i=t.substring(n+1,e)+"_LABEL";var r=this;if(window.FontFace){var s=new FontFace(i,"url('"+t+"')");s.load().then(function(t){document.fonts.add(t),r._notifyLabelSkinDirty(),r.emit("load")})}else{var o=document,a=document.createElement("style");a.type="text/css",o.body.appendChild(a);var c="";if(isNaN(i-0))c+="@font-face { font-family:"+i+"; src:";else c+="@font-face { font-family:'"+i+"'; src:";c+="url('"+t+"');",a.textContent=c+"}";var l=document.createElement("div"),h=l.style;h.fontFamily=i,l.innerHTML=".",h.position="absolute",h.left="-100px",h.top="-100px",o.body.appendChild(l),r.scheduleOnce(function(){r._notifyLabelSkinDirty(),r.emit("load")},2)}return i},setContentSize:function(t,e){if(this._overFlow!==_ccsg.Label.Overflow.NONE)this._setDimensions(t,e)},setBlendFunc:function(t,e){var i=this._blendFunc;if(void 0===e)i.src=t.src,i.dst=t.dst;else i.src=t,i.dst=e},getBlendFunc:function(){return new e.BlendFunc(this._blendFunc.src,this._blendFunc.dst)},_updateLabel:function(){if(this._labelType===_ccsg.Label.Type.BMFont)this._updateContent(),this.setColor(this.color);else if(this._labelType===_ccsg.Label.Type.TTF||this._labelType===_ccsg.Label.Type.SystemFont)this._renderCmd._bakeLabel(),this._renderCmd._prepareQuad()},_notifyLabelSkinDirty:function(){if(!1)this._updateLabel();else this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.textDirty)},_createRenderCmd:function(){if(e._renderType===e.game.RENDER_TYPE_WEBGL)return new _ccsg.Label.WebGLRenderCmd(this);else return new _ccsg.Label.CanvasRenderCmd(this)},getContentSize:function(){if(!e.sizeEqualToSize(this._contentSize,this._renderCmd._realRenderingSize))this._updateLabel();return _ccsg.Node.prototype.getContentSize.call(this)},_getWidth:function(){if(!e.sizeEqualToSize(this._contentSize,this._renderCmd._realRenderingSize))this._updateLabel();return _ccsg.Node.prototype._getWidth.call(this)},_getHeight:function(){if(!e.sizeEqualToSize(this._contentSize,this._renderCmd._realRenderingSize))this._updateLabel();return _ccsg.Node.prototype._getHeight.call(this)}}),e.BMFontHelper={_alignText:function(){var t=!0;do{if(!this._spriteBatchNode)return!0;if(this._textDesiredHeight=0,this._linesWidth=[],this._maxLineWidth>0&&!this._lineBreakWithoutSpaces)this._multilineTextWrapByWord();else this._multilineTextWrapByChar();if(this._computeAlignmentOffset(),this._overFlow===_ccsg.Label.Overflow.SHRINK){var e=this.getFontSize();if(e>0&&this._isVerticalClamp())this._shrinkLabelToContentSize(this._isVerticalClamp.bind(this))}if(!this._updateQuads()){if(t=!1,this._overFlow===_ccsg.Label.Overflow.SHRINK)this._shrinkLabelToContentSize(this._isHorizontalClamp.bind(this));break}}while(0);return t},_isHorizontalClamped:function(t,e){var i=this._linesWidth[e],n=t>this._contentSize.width||0>t;if(!this._isWrapText)return n;else return i>this._contentSize.width&&n},_updateQuads:function(){var t=!0;this._spriteBatchNode.removeAllChildren();for(var i=!1,n=0;n<this._string.length;++n)if(this._lettersInfo[n]._valid){var r=this._fontAtlas._letterDefinitions[this._lettersInfo[n]._char];this._reusedRect.height=r._height,this._reusedRect.width=r._width,this._reusedRect.x=r._u,this._reusedRect.y=r._v;var s=this._lettersInfo[n]._positionY+this._letterOffsetY;if(this._labelHeight>0){if(s>this._tailoredTopY){var o=s-this._tailoredTopY;this._reusedRect.y+=o,this._reusedRect.height-=o,s-=o}if(s-r._height*this._bmfontScale<this._tailoredBottomY)this._reusedRect.height=s<this._tailoredBottomY?0:s-this._tailoredBottomY}var a=this._lettersInfo[n]._lineIndex,c=this._lettersInfo[n]._positionX+r._width/2*this._bmfontScale+this._linesOffsetX[a];if(this._labelWidth>0)if(this._isHorizontalClamped(c,a))if(this._overFlow===_ccsg.Label.Overflow.CLAMP)this._reusedRect.width=0;else if(this._overFlow===_ccsg.Label.Overflow.SHRINK)if(this._contentSize.width>r._width){i=!0,t=!1;break}else this._reusedRect.width=0;if(this._reusedRect.height>0&&this._reusedRect.width>0){var l=this.getChildByTag(n),h=this._spriteBatchNode._renderCmd._texture||this._spriteBatchNode.textureAtlas.texture;if(!l)l=new _ccsg.Sprite,l.initWithTexture(h),l.setAnchorPoint(e.p(0,1));l.setTextureRect(this._reusedRect,!1,this._reusedRect.size);var u=this._lettersInfo[n]._positionX+this._linesOffsetX[this._lettersInfo[n]._lineIndex];
l.setPosition(u,s);var d=this._spriteBatchNode.getChildrenCount();this._lettersInfo[n]._atlasIndex=d,this._updateLetterSpriteScale(l),this._spriteBatchNode.addChild(l)}}return t},_updateLetterSpriteScale:function(t){if(this._labelType===_ccsg.Label.Type.BMFont&&this._fontSize>0)t.setScale(this._bmfontScale)},_recordPlaceholderInfo:function(t,e){if(t>=this._lettersInfo.length){var i=new C;this._lettersInfo.push(i)}this._lettersInfo[t]._char=e,this._lettersInfo[t]._valid=!1},_recordLetterInfo:function(t,e,i,n){if(i>=this._lettersInfo.length){var r=new C;this._lettersInfo.push(r)}e=e.charCodeAt(0),this._lettersInfo[i]._lineIndex=n,this._lettersInfo[i]._char=e,this._lettersInfo[i]._valid=this._fontAtlas._letterDefinitions[e]._validDefinition,this._lettersInfo[i]._positionX=t.x,this._lettersInfo[i]._positionY=t.y},_setDimensions:function(t,e){var i="number"==typeof t.width?t.width:t,n="number"==typeof t.height?t.height:e;if(_ccsg.Node.prototype.setContentSize.call(this,t,e),this._labelType===_ccsg.Label.Type.BMFont){if(this._overFlow===_ccsg.Label.Overflow.RESIZE_HEIGHT)n=0;if(this._overFlow===_ccsg.Label.Overflow.NONE)i=0,n=0}if(n!==this._labelHeight||i!==this._labelWidth){if(this._labelWidth=i,this._labelHeight=n,this._labelDimensions.width=i,this._labelDimensions.height=n,this._maxLineWidth=i,this._drawFontsize>0)this._restoreFontSize();this._notifyLabelSkinDirty()}},_restoreFontSize:function(){this._fontSize=this._drawFontsize},_multilineTextWrap:function(t){var i=this.getStringLength(),n=0,r=0,s=0,o=0,a=0,c=this._lineSpacing,l=0,h=0,u=null,d=e.p(0,0);this._updateBMFontScale();for(var f=0;i>f;){var _=this._string.charAt(f);if("\n"!==_){for(var p=t(this._string,f,i),g=l,m=h,v=a,y=r,T=!1,C=0;p>C;++C){var x=f+C;if(_=this._string.charAt(x),"\r"!==_)if(u=this._fontAtlas.getLetterDefinitionForChar(_)){var S=y+u._offsetX*this._bmfontScale;if(this._isWrapText&&this._maxLineWidth>0&&r>0&&S+u._width*this._bmfontScale>this._maxLineWidth&&!this._isspace_unicode(_)){this._linesWidth.push(a),a=0,n++,r=0,s-=this._lineHeight*this._bmfontScale+c,T=!0;break}else d.x=S;if(d.y=s-u._offsetY*this._bmfontScale,this._recordLetterInfo(d,_,x,n),x+1<this._horizontalKernings.length&&i-1>x)y+=this._horizontalKernings[x+1];if(y+=u._xAdvance*this._bmfontScale+this._additionalKerning,v=d.x+u._width*this._bmfontScale,g<d.y)g=d.y;if(m>d.y-u._height*this._bmfontScale)m=d.y-u._height*this._bmfontScale}else this._recordPlaceholderInfo(x,_),console.log("Can't find letter definition in font file for letter:"+_);else this._recordPlaceholderInfo(x,_)}if(!T){if(r=y,a=v,g>l)l=g;if(h>m)h=m;if(a>o)o=a;f+=p}else;}else this._linesWidth.push(a),a=0,n++,r=0,s-=this._lineHeight*this._bmfontScale+c,this._recordPlaceholderInfo(f,_),f++}if(this._linesWidth.push(a),this._numberOfLines=n+1,this._textDesiredHeight=this._numberOfLines*this._lineHeight*this._bmfontScale,this._numberOfLines>1)this._textDesiredHeight+=(this._numberOfLines-1)*this._lineSpacing;var b=e.size(this._labelWidth,this._labelHeight);if(this._labelWidth<=0)b.width=parseFloat(o.toFixed(2));if(this._labelHeight<=0)b.height=parseFloat(this._textDesiredHeight.toFixed(2));if(_ccsg.Node.prototype.setContentSize.call(this,b),this._tailoredTopY=b.height,this._tailoredBottomY=0,l>0)this._tailoredTopY=b.height+l;if(h<-this._textDesiredHeight)this._tailoredBottomY=this._textDesiredHeight+h;return!0},_multilineTextWrapByWord:function(){return this._multilineTextWrap(this._getFirstWordLen.bind(this))},_multilineTextWrapByChar:function(){return this._multilineTextWrap(this._getFirstCharLen.bind(this))},_isVerticalClamp:function(){if(this._textDesiredHeight>this._contentSize.height)return!0;else return!1},_isHorizontalClamp:function(){for(var t=!1,e=0;e<this.getStringLength();++e)if(this._lettersInfo[e]._valid){var i=this._fontAtlas._letterDefinitions[this._lettersInfo[e]._char],n=this._lettersInfo[e]._positionX+i._width/2*this._bmfontScale,r=this._lettersInfo[e]._lineIndex;if(this._labelWidth>0)if(!this._isWrapText){if(n>this._contentSize.width){t=!0;break}}else{var s=this._linesWidth[r];if(s>this._contentSize.width&&(n>this._contentSize.width||0>n)){t=!0;break}}}return t},_shrinkLabelToContentSize:function(t){for(var e=this.getFontSize(),i=0,n=this._fontAtlas.cloneLetterDefinition(),r=this._lineHeight,s=!0;t();){++i;var o=e-i;if(s=!1,0>=o)break;var a=o/e;if(this._fontAtlas.assignLetterDefinitions(n),this._fontAtlas.scaleFontLetterDefinition(a),this._lineHeight=r*a,this._maxLineWidth>0&&!this._lineBreakWithoutSpaces)this._multilineTextWrapByWord();else this._multilineTextWrapByChar();this._computeAlignmentOffset()}if(this._lineHeight=r,this._fontAtlas.assignLetterDefinitions(n),!s)if(e-i>=0)this._scaleFontSizeDown(e-i)},_scaleFontSizeDown:function(t){var e=!0;if(this._labelType===_ccsg.Label.Type.BMFont){if(!t)t=.1,e=!1;if(this._fontSize=t,e)this._updateContent()}},_updateContent:function(){if(this._fontAtlas)this._computeHorizontalKerningForText(this._string),this._alignText()},_computeAlignmentOffset:function(){switch(this._linesOffsetX=[],this._hAlign){case e.TextAlignment.LEFT:for(var t=0;t<this._numberOfLines;++t)this._linesOffsetX.push(0);break;case e.TextAlignment.CENTER:this._linesWidth.forEach(function(t){this._linesOffsetX.push((this._contentSize.width-t)/2)}.bind(this));break;case e.TextAlignment.RIGHT:this._linesWidth.forEach(function(t){this._linesOffsetX.push(this._contentSize.width-t)}.bind(this))}switch(this._vAlign){case e.VerticalTextAlignment.TOP:this._letterOffsetY=this._contentSize.height;break;case e.VerticalTextAlignment.CENTER:this._letterOffsetY=(this._contentSize.height+this._textDesiredHeight)/2;break;case e.VerticalTextAlignment.BOTTOM:this._letterOffsetY=this._textDesiredHeight}},_getFirstCharLen:function(t,e,i){return 1},_isCJK_unicode:function(t){var e=/^[\u4E00-\u9FFF\u3400-\u4DFF]+$/,i=/[\u3000-\u303F]|[\u3040-\u309F]|[\u30A0-\u30FF]|[\uFF00-\uFFEF]|[\u4E00-\u9FAF]|[\u2605-\u2606]|[\u2190-\u2195]|\u203B/g,n=/^[\u1100-\u11FF]|[\u3130-\u318F]|[\uA960-\uA97F]|[\uAC00-\uD7AF]|[\uD7B0-\uD7FF]+$/;return e.test(t)||i.test(t)||n.test(t)},_isspace_unicode:function(t){return t=t.charCodeAt(0),t>=9&&13>=t||32===t||133===t||160===t||5760===t||t>=8192&&8202>=t||8232===t||8233===t||8239===t||8287===t||12288===t},_getFirstWordLen:function(t,e,i){var n=t.charAt(e);if(this._isCJK_unicode(n)||"\n"===n||this._isspace_unicode(n))return 1;for(var r=1,s=e+1;i>s&&(n=t.charAt(s),"\n"!==n&&!this._isspace_unicode(n)&&!this._isCJK_unicode(n));++s)r++;return r},_updateBMFontScale:function(){if(this._labelType===_ccsg.Label.Type.BMFont){var t=this._fontAtlas._fontSize;this._bmfontScale=this._fontSize/t}else this._bmfontScale=1},_initBMFontWithString:function(t,i){var n=this;if(n._config)return e.log("_ccsg.Label._initBMFontWithString(): re-init is no longer supported"),!1;else return this._string=t,void this._setBMFontFile(i)},_createSpriteBatchNode:function(t){this._spriteBatchNode=new e.SpriteBatchNode(t,this._string.length),this._spriteBatchNode.setCascadeColorEnabled(!0),this._spriteBatchNode.setCascadeOpacityEnabled(!0),this.addChild(this._spriteBatchNode),this._updateContent(),this.setColor(this.color)},_createFontChars:function(){if(this._config){if(this._fontAtlas=new e.FontAtlas(this._config),!this._lineHeight)this._lineHeight=this._fontAtlas._lineHeight;var t=this._config,i=t.fontDefDictionary;for(var n in i){var r=new T,s=i[n].rect;r._offsetX=i[n].xOffset,r._offsetY=i[n].yOffset,r._width=s.width,r._height=s.height,r._u=s.x+this._imageOffset.x,r._v=s.y+this._imageOffset.y,r._textureID=0,r._validDefinition=!0,r._xAdvance=i[n].xAdvance,this._fontAtlas.addLetterDefinitions(n,r)}}},_rescaleWithOriginalFontSize:function(){var t=this.getFontSize();if(this._drawFontsize-t>=1&&this._overFlow===_ccsg.Label.Overflow.SHRINK)if(this._labelType===_ccsg.Label.Type.BMFont)this._scaleFontSizeDown(this._drawFontsize);else this._fontSize=this._drawFontsize},_computeHorizontalKerningForText:function(t){for(var e=this.getStringLength(),i=this._config.kerningDict,n=-1,r=0;e>r;++r){var s=this._string.charCodeAt(r),o=i[n<<16|65535&s]||0;if(e-1>r)this._horizontalKernings[r]=o;else this._horizontalKernings[r]=0;n=s}},_setBMFontFile:function(t){if(t){this._fontHandle=t;var i=this;if(this._labelType===_ccsg.Label.Type.BMFont){this._resetBMFont();var n;e.loader.load(this._fontHandle,function(t,r){if(t)e.log("_ccsg.Label._initBMFontWithString(): Impossible to create font. Please check file");i._config=r,i._createFontChars(),n=e.textureCache.addImage(i._config.atlasName);var s=n.isLoaded();if(i._textureLoaded=s,!s)n.once("load",function(t){var e=this;if(!e._spriteBatchNode)e._createSpriteBatchNode(n);e._textureLoaded=!0,e.emit("load")},i);else if(!i._spriteBatchNode)i._createSpriteBatchNode(n)})}}}};var _=_ccsg.Label.prototype;e.js.addon(_,u.prototype),e.js.mixin(_,e.BMFontHelper),_ccsg.Label.Type=e.Enum({TTF:0,BMFont:1,SystemFont:2}),_ccsg.Label.Overflow=e.Enum({NONE:0,CLAMP:1,SHRINK:2,RESIZE_HEIGHT:3}),function(){_ccsg.Label.TTFLabelBaker=function(){};var t=_ccsg.Label.TTFLabelBaker.prototype=Object.create(Object.prototype);t.updateStatus=function(){var t=_ccsg.Node._dirtyFlags,e=this._dirtyFlag,i=e&t.colorDirty,n=e&t.opacityDirty;if(i)this._updateDisplayColor();if(n)this._updateDisplayOpacity();if(i||n||e&t.textDirty)this._rebuildLabelSkin();if(this._dirtyFlag&t.transformDirty)this.transform(this.getParentRenderCmd(),!0),this._dirtyFlag=this._dirtyFlag&_ccsg.Node._dirtyFlags.transformDirty^this._dirtyFlag},t._syncStatus=function(t){var e=_ccsg.Node._dirtyFlags,i=this._dirtyFlag,n=t?t._node:null;if(n&&n._cascadeColorEnabled&&t._dirtyFlag&e.colorDirty)i|=e.colorDirty;if(n&&n._cascadeOpacityEnabled&&t._dirtyFlag&e.opacityDirty)i|=e.opacityDirty;if(t&&t._dirtyFlag&e.transformDirty)i|=e.transformDirty;var r=i&e.colorDirty,s=i&e.opacityDirty;if(this._dirtyFlag=i,r)this._syncDisplayColor();if(s)this._syncDisplayOpacity();if(r||s||i&e.textDirty)this._rebuildLabelSkin();if(i&e.transformDirty)this.transform(t)},t._getLineHeight=function(){var t=this._node.getLineHeight(),e=this._node;if(0===t)t=e._fontSize;else t=t*e._fontSize/e._drawFontsize;return 0|t},t._prepareQuad=function(){var t=this._quad,i=e.color(255,255,255,this._displayedOpacity),n=this._node._contentSize.width,r=this._node._contentSize.height;t._bl.colors=i,t._br.colors=i,t._tl.colors=i,t._tr.colors=i,t._bl.vertices=new e.Vertex3F(0,0,0),t._br.vertices=new e.Vertex3F(n,0,0),t._tl.vertices=new e.Vertex3F(0,r,0),t._tr.vertices=new e.Vertex3F(n,r,0),t._bl.texCoords=new e.Tex2F(0,1),t._br.texCoords=new e.Tex2F(1,1),t._tl.texCoords=new e.Tex2F(0,0),t._tr.texCoords=new e.Tex2F(1,0),this._quadDirty=!0};var i=!0,n=/([a-zA-Z0-9ÄÖÜäöüßéèçàùêâîôû]+|\S)/,r=/^[!,.:;}\]%\?>、‘“》？。，！]/,s=/([a-zA-Z0-9ÄÖÜäöüßéèçàùêâîôû]+|\S)$/,o=/[a-zA-Z0-9ÄÖÜäöüßéèçàùêâîôû]+$/,a=/^[a-zA-Z0-9ÄÖÜäöüßéèçàùêâîôû]/;t._fragmentText=function(t,e,c){var l=[];if(0===t.length)return l.push(""),l;for(var h=t,u=c.measureText(h).width;u>e&&h.length>1;){for(var d=h.length*(e/u)|0,f=h.substr(d),_=u-c.measureText(f).width,p=f,g=0,m=0;_>e&&m++<100;)d*=e/_,d=0|d,f=h.substr(d),_=u-c.measureText(f).width;for(m=0;e>_&&m++<100;){if(f){var v=n.exec(f);g=v?v[0].length:1,p=f}d+=g,f=h.substr(d),_=u-c.measureText(f).width}if(d-=g,0===d)d=1,p=p.substr(1);var y,T=h.substr(0,d);if(i)if(r.test(p||f)){if(y=s.exec(T),d-=y?y[0].length:0,0===d)d=1;p=h.substr(d),T=h.substr(0,d)}if(a.test(p))if(y=o.exec(T),y&&T!==y[0])d-=y[0].length,p=h.substr(d),T=h.substr(0,d);l.push(T),h=p||f,u=c.measureText(h).width}if(h.length>0)l.push(h);return l},t._calculateLabelFont=function(){var t=this._node,e=t._string.split("\n"),i=t._fontSize,n=i.toString()+"px ",r=0===t._fontHandle.length?"serif":t._fontHandle;n+=r,this._labelContext.font=n;var s=this._calculateParagraphLength(e,this._labelContext);if(_ccsg.Label.Overflow.SHRINK===t._overFlow){this._splitedStrings=e;var o;if(t._isWrapText){var a=0;for(o=0;o<e.length;++o)a+=(s[o]/this._canvasSize.width+1|0)*this._canvasSize.width;var c=this._canvasSize.width*(this._canvasSize.height/this._getLineHeight()|0)/a;t._fontSize=i*Math.min(Math.sqrt(c),1)|0,n=t._fontSize.toString()+"px "+r,this._splitedStrings=[];for(var o=0;o<e.length;++o)this._splitedStrings=this._splitedStrings.concat(this._fragmentText(e[o],this._canvasSize.width,this._labelContext))}else{var l=0,h=e.length*this._getLineHeight();for(o=0;o<e.length;++o)if(l<s[o])l=s[o];var u=this._canvasSize.width/l,d=this._canvasSize.height/h;t._fontSize=i*Math.min(1,u,d)|0,n=t._fontSize.toString()+"px "+r}}return n},t._calculateParagraphLength=function(t,e){for(var i=[],n=0;n<t.length;++n){var r=e.measureText(t[n]);i.push(r.width)}return i},t._calculateCanvasSize=function(){var t=this._node,i=t._contentSize.width,n=t._contentSize.height;if(0>=i)i=1;if(0>=n)n=1;return e.size(i,n)},t._calculateSplitedStrings=function(){var t,e=this._node,i=this._labelContext,n=e._string.split("\n");if(e._isWrapText)for(this._splitedStrings=[],t=0;t<n.length;++t)this._splitedStrings=this._splitedStrings.concat(this._fragmentText(n[t],this._canvasSize.width,i));else this._splitedStrings=n},t._updateLabelDimensions=function(){var t,e=this._node,i=e._string.split("\n"),n=this._labelContext;if(_ccsg.Label.Overflow.RESIZE_HEIGHT===e._overFlow)this._canvasSize.height=this._splitedStrings.length*this._getLineHeight(),_ccsg.Node.prototype.setContentSize.call(e,this._canvasSize);else if(_ccsg.Label.Overflow.NONE===e._overFlow){this._splitedStrings=i;var r=0,s=0;for(t=0;t<i.length;++t){var o=n.measureText(i[t]).width;r=r>o?r:o}s=this._splitedStrings.length*this._getLineHeight(),this._canvasSize.width=parseFloat(r.toFixed(2)),this._canvasSize.height=parseFloat(s.toFixed(2)),_ccsg.Node.prototype.setContentSize.call(e,this._canvasSize)}this._labelCanvas.width=this._canvasSize.width,this._labelCanvas.height=this._canvasSize.height},t._calculateFillTextStartPosition=function(){var t,i,n=this._node,r=this._getLineHeight(),s=this._splitedStrings.length;if(e.TextAlignment.RIGHT===n._hAlign)t=this._canvasSize.width;else if(e.TextAlignment.CENTER===n._hAlign)t=this._canvasSize.width/2;else t=0;if(e.VerticalTextAlignment.TOP===n._vAlign)i=0;else if(e.VerticalTextAlignment.CENTER===n._vAlign)i=this._canvasSize.height/2-r*(s-1)/2;else i=this._canvasSize.height-r*(s-1);return e.p(t,i)},t._calculateTextBaseline=function(){var t,i,n=this._node;if(e.TextAlignment.RIGHT===n._hAlign)t="right";else if(e.TextAlignment.CENTER===n._hAlign)t="center";else t="left";if(this._labelContext.textAlign=t,e.VerticalTextAlignment.TOP===n._vAlign)i="top";else if(e.VerticalTextAlignment.CENTER===n._vAlign)i="middle";else i="bottom";this._labelContext.textBaseline=i},t._bakeLabel=function(){this._node;this._canvasSize=this._calculateCanvasSize(),this._fontDesc=this._calculateLabelFont(),this._calculateSplitedStrings(),this._updateLabelDimensions(),this._calculateTextBaseline(),this._updateTexture()},t._updateTexture=function(){this._labelContext.clearRect(0,0,this._labelCanvas.width,this._labelCanvas.height),this._fontDesc=this._calculateLabelFont(),this._labelContext.font=this._fontDesc;var t=this._calculateFillTextStartPosition(),e=this._getLineHeight(),i=this._displayedColor;this._labelContext.fillStyle="rgb("+i.r+","+i.g+","+i.b+")";for(var n=0;n<this._splitedStrings.length;++n)this._labelContext.fillText(this._splitedStrings[n],t.x,t.y+n*e);this._labelTexture._textureLoaded=!1,this._labelTexture.handleLoadedTexture()},t._rebuildLabelSkin=function(){this._dirtyFlag=this._dirtyFlag&_ccsg.Node._dirtyFlags.textDirty^this._dirtyFlag;var t=this._node;this._realRenderingSize=_ccsg.Node.prototype.getContentSize.call(t),t._updateLabel()}}(),function(){_ccsg.Label.CanvasRenderCmd=function(t){_ccsg.Node.CanvasRenderCmd.call(this,t),this._needDraw=!0,this._labelTexture=new e.Texture2D,this._labelCanvas=document.createElement("canvas"),this._labelCanvas.width=1,this._labelCanvas.height=1,this._labelContext=this._labelCanvas.getContext("2d"),this._labelTexture.initWithElement(this._labelCanvas),this._quad=new e.V3F_C4B_T2F_Quad,this._quadDirty=!0,this._splitedStrings=null,this._realRenderingSize=e.size(-10,-10)};var t=_ccsg.Label.CanvasRenderCmd.prototype=Object.create(_ccsg.Node.CanvasRenderCmd.prototype);e.js.mixin(t,_ccsg.Label.TTFLabelBaker.prototype),t.constructor=_ccsg.Label.CanvasRenderCmd,t.rendering=function(t,i,n){var r=this._node;if(r._labelType===_ccsg.Label.Type.TTF||r._labelType===_ccsg.Label.Type.SystemFont){var s=this._displayedOpacity,o=s/255;if(0===s)return;var a=t||e._renderContext,c=a.getContext();if(a.setTransform(this._worldTransform,i,n),a.setCompositeOperation(_ccsg.Node.CanvasRenderCmd._getCompositeOperationByBlendFunc(r._blendFunc)),a.setGlobalAlpha(o),this._labelTexture){var l,h,u,d,f,_,p,g;f=0,_=-this._node._contentSize.height,p=this._node._contentSize.width,g=this._node._contentSize.height;var m=this._labelTexture.getPixelWidth(),v=this._labelTexture.getPixelHeight();l=0,h=0,u=m,d=v,f*=i,_*=n,p*=i,g*=n;var y=this._labelTexture._htmlElementObj;if(""!==this._labelTexture._pattern)a.setFillStyle(c.createPattern(y,this._labelTexture._pattern)),c.fillRect(f,_,p,g);else if(0!==u&&0!==d&&0!==p&&0!==g)c.drawImage(y,l,h,u,d,f,_,p,g)}e.g_NumberOfDraws=e.g_NumberOfDraws+1}}}();var f=e.gl;_ccsg.Label.WebGLRenderCmd=function(t){_ccsg.Node.WebGLRenderCmd.call(this,t),this._needDraw=!0,this._labelTexture=new e.Texture2D,this._quadWebBuffer=e._renderContext.createBuffer(),this._shaderProgram=e.shaderCache.programForKey(e.macro.SHADER_POSITION_TEXTURECOLOR),this._quad=new e.V3F_C4B_T2F_Quad,this._labelCanvas=document.createElement("canvas"),this._labelTexture.initWithElement(this._labelCanvas),this._labelContext=this._labelCanvas.getContext("2d"),this._labelCanvas.width=1,this._labelCanvas.height=1,this._quadDirty=!0,this._splitedStrings=null,this._drawFontsize=0,this._realRenderingSize=e.size(-10,-10)};var l=_ccsg.Label.WebGLRenderCmd.prototype=Object.create(_ccsg.Node.WebGLRenderCmd.prototype);e.js.mixin(l,_ccsg.Label.TTFLabelBaker.prototype),l.constructor=_ccsg.Label.WebGLRenderCmd,l.rendering=function(t){var i=this._node;if(i._labelType===_ccsg.Label.Type.TTF||i._labelType===_ccsg.Label.Type.SystemFont){var n=t||e._renderContext;if(this._shaderProgram.use(),this._shaderProgram._setUniformForMVPMatrixWithMat4(this._stackMatrix),f.blendFunc(i._blendFunc.src,i._blendFunc.dst),f.bindTexture2DN(0,this._labelTexture),f.enableVertexAttribs(e.macro.VERTEX_ATTRIB_FLAG_POS_COLOR_TEX),n.bindBuffer(n.ARRAY_BUFFER,this._quadWebBuffer),this._quadDirty)n.bufferData(n.ARRAY_BUFFER,this._quad.arrayBuffer,n.DYNAMIC_DRAW),this._quadDirty=!1;n.vertexAttribPointer(0,3,n.FLOAT,!1,24,0),n.vertexAttribPointer(1,4,n.UNSIGNED_BYTE,!0,24,12),n.vertexAttribPointer(2,2,n.FLOAT,!1,24,16),n.drawArrays(n.TRIANGLE_STRIP,0,4)}};var x=function(t){return t.replace(/(?:^|\s)\S/g,function(t){return t.toUpperCase()})},S=e.Enum({DEFAULT:0,DONE:1,SEND:2,SEARCH:3,GO:4}),b=e.Enum({ANY:0,EMAIL_ADDR:1,NUMERIC:2,PHONE_NUMBER:3,URL:4,DECIMAL:5,SINGLE_LINE:6}),E=e.Enum({PASSWORD:0,SENSITIVE:1,INITIAL_CAPS_WORD:2,INITIAL_CAPS_SENTENCE:3,INITIAL_CAPS_ALL_CHARACTERS:4});e.EditBoxDelegate=e._Class.extend({editBoxEditingDidBegan:function(t){},editBoxEditingDidEnded:function(t){},editBoxTextChanged:function(t,e){},editBoxReturn:function(t){}});var A=function(t){this._domInputSprite=null,this._spriteDOM=null,this._edTxt=null,this._edFontSize=14,this._edFontName="Arial",this._editBox=t,this._textLabel=null,this._placeholderLabel=null};A.prototype={constructor:A,createNativeControl:function(t){var i=this._domInputSprite=new _ccsg.Sprite;i.draw=function(){},this._editBox.addChild(i),this._spriteDOM=i,this._createDomTextArea(),e.DOM.convert(i),this._addDomInputControl(),this._domInputSprite.dom.showTooltipDiv=!1,this._domInputSprite.dom.style.width=t.width-6+"px",this._domInputSprite.dom.style.height=t.height-6+"px",i.canvas.remove(),this._domInputSprite.x=3,this._domInputSprite.y=3,this._createLabels()},_createLabels:function(){var t=this._editBox.getContentSize();this._textLabel=new _ccsg.Label,this._textLabel.setVisible(!1),this._textLabel.setAnchorPoint(e.p(0,1)),this._textLabel.setOverflow(_ccsg.Label.Overflow.CLAMP),this._editBox.addChild(this._textLabel,100),this._placeholderLabel=new _ccsg.Label,this._placeholderLabel.setAnchorPoint(e.p(0,1)),this._placeholderLabel.setColor(e.Color.GRAY),this._editBox.addChild(this._placeholderLabel,100),this._updateLabelPosition(t)},_updateLabelPosition:function(t){this._textLabel.setContentSize(t),this._placeholderLabel.setLineHeight(t.height);var i=this._placeholderLabel.getContentSize();if(this._editBox._editBoxInputMode===b.ANY)this._textLabel.setPosition(e.p(0,t.height)),this._placeholderLabel.setPosition(e.p(0,t.height)),this._placeholderLabel.setVerticalAlign(e.VerticalTextAlignment.TOP),this._textLabel.setVerticalAlign(e.VerticalTextAlignment.TOP),this._textLabel.enableWrapText(!0);else this._textLabel.enableWrapText(!1),this._textLabel.setPosition(e.p(0,t.height)),this._placeholderLabel.setPosition(e.p(0,(t.height+i.height)/2)),this._placeholderLabel.setVerticalAlign(e.VerticalTextAlignment.CENTER),this._textLabel.setVerticalAlign(e.VerticalTextAlignment.CENTER)},setLineHeight:function(t){this._textLabel.setLineHeight(t)},_hiddenLabels:function(){this._textLabel.setVisible(!1),this._placeholderLabel.setVisible(!1)},_updateEditBoxContentStyle:function(){var t=this._editBox._editBoxInputFlag;if(t===E.INITIAL_CAPS_ALL_CHARACTERS)this._editBox._text=this._editBox._text.toUpperCase();else if(t===E.INITIAL_CAPS_WORD)this._editBox._text=x(this._editBox._text);else if(t===E.INITIAL_CAPS_SENTENCE)this._editBox._text=o(this._editBox._text)},_updateLabelString:function(){if(this._textLabel.setVisible(!0),this._textLabel.setString(this._editBox._text),"password"===this._edTxt.type){for(var t="",e=this._editBox._text.length,i=0;e>i;++i)t+="●";this._textLabel.setString(t)}else this._updateEditBoxContentStyle(),this._textLabel.setString(this._editBox._text)},_showLabels:function(){if(this._hiddenLabels(),""===this._edTxt.value)this._placeholderLabel.setVisible(!0),this._placeholderLabel.setString(this._editBox._placeholderText);else this._updateLabelString()},registerClickEvent:function(){var t=this,e=t._edTxt.parentNode;e.style.pointerEvents="none",e.addEventListener("click",function(){if("none"===t._edTxt.style.display)t._edTxt.style.display="",t._edTxt.focus(),t._hiddenLabels()})},show:function(){var t=this._edTxt.parentNode;t.style.pointerEvents="",window.setTimeout(function(){t.click()},10)},hidden:function(){this._edTxt.style.display="none";var t=this._edTxt.parentNode;t.style.pointerEvents="none",this._showLabels()},_setFont:function(t){var i=e.LabelTTF._fontStyleRE.exec(t),n=i[2],r=parseInt(i[1]);if(i)this.setFont(n,r)},setFont:function(t,e){this._edFontName=t||this._edFontName,this._edFontSize=e||this._edFontSize,this._updateDOMFontStyle()},setFontName:function(t){this._edFontName=t||this._edFontName,this._updateDOMFontStyle()},setFontSize:function(t){this._edFontSize=t||this._edFontSize,this._updateDOMFontStyle()},setFontColor:function(t){if(this._edTxt.value!==this._editBox._placeholderText)this._edTxt.style.color=e.colorToHex(t);this._textLabel.setColor(t)},setPlaceHolder:function(t){this._placeholderLabel.setString(t)},setMaxLength:function(t){this._edTxt.maxLength=t},_updateDOMPlaceholderFontStyle:function(){this._placeholderLabel.setFontFileOrFamily(this._editBox._placeholderFontName),this._placeholderLabel.setFontSize(this._editBox._placeholderFontSize)},setPlaceholderFontColor:function(t){this._placeholderLabel.setColor(t)},setInputFlag:function(t){if(this._edTxt.value!==this._placeholderText&&t===E.PASSWORD)this._edTxt.type="password";else this._edTxt.type="text";if(this._edTxt.style.textTransform="none",t===E.INITIAL_CAPS_ALL_CHARACTERS)this._edTxt.style.textTransform="uppercase";else if(t===E.INITIAL_CAPS_WORD)this._edTxt.style.textTransform="capitalize";this._updateLabelString()},setInputMode:function(t){if(t===b.ANY)this._removeDomInputControl(),this._createDomTextArea(),this._addDomInputControl();else if(this._editBox._editBoxInputMode===b.ANY)this._removeDomInputControl(),this._createDomInput(),this._addDomInputControl()},setString:function(t){if(null!==t)if(this._edTxt.value=t,""===t)this._edTxt.type="text",this._placeholderLabel.setString(this._editBox._placeholderText),this._placeholderLabel.setColor(this._editBox._placeholderColor),this._placeholderLabel.setVisible(!0),this._textLabel.setVisible(!1);else{if(this._edTxt.style.color=e.colorToHex(this._editBox._textColor),this._textLabel.setColor(this._editBox._textColor),this._placeholderLabel.setVisible(!1),this._editBox._editBoxInputFlag===E.PASSWORD)this._edTxt.type="password";else this._edTxt.type="text";this._updateLabelString()}},_updateDOMFontStyle:function(){if(""!==this._edTxt.value)if(this._edTxt.style.fontFamily=this._edFontName,this._edTxt.style.fontSize=this._edFontSize+"px",this._editBox._editBoxInputFlag===E.PASSWORD)this._edTxt.type="password";else this._edTxt.type="text";this._textLabel.setFontSize(this._edFontSize),this._textLabel.setFontFileOrFamily(this._edFontName)},setSize:function(t,i){this._spriteDOM.dom.style.width=t-6+"px",this._spriteDOM.dom.style.height=i-6+"px",this._updateLabelPosition(e.size(t,i))},_createDomInput:function(){var t=this,i=this._edTxt=document.createElement("input");i.type="text",i.style.fontSize=this._edFontSize+"px",i.style.color="#000000",i.style.border=0,i.style.background="transparent",i.style.width="100%",i.style.height="100%",i.style.active=0,i.style.outline="medium",i.style.padding="0",i.style.textTransform="uppercase",i.style.display="none";var n=function(){i.blur()};return i.addEventListener("input",function(){var e=t._editBox;if(e._delegate&&e._delegate.editBoxTextChanged)e._text=this.value,t._updateEditBoxContentStyle(),e._delegate.editBoxTextChanged(e,e._text)}),i.addEventListener("keypress",function(i){var n=t._editBox;if(i.keyCode===e.KEY.enter){if(i.stopPropagation(),i.preventDefault(),""===this.value)this.style.fontSize=n._placeholderFontSize+"px",this.style.color=e.colorToHex(n._placeholderColor);if(n._text=this.value,t._updateEditBoxContentStyle(),t.hidden(),n._delegate&&n._delegate.editBoxReturn)n._delegate.editBoxReturn(n);e._canvas.focus()}}),i.addEventListener("focus",function(){var i=t._editBox;if(this.style.fontSize=t._edFontSize+"px",this.style.color=e.colorToHex(i._textColor),i._editBoxInputFlag===E.PASSWORD)t._edTxt.type="password";else t._edTxt.type="text";if(i._delegate&&i._delegate.editBoxEditingDidBegan)i._delegate.editBoxEditingDidBegan(i);e._canvas.addEventListener("click",n)}),i.addEventListener("blur",function(){var i=t._editBox;if(i._text=this.value,t._updateEditBoxContentStyle(),i._delegate&&i._delegate.editBoxEditingDidEnded)i._delegate.editBoxEditingDidEnded(i);if(e._canvas.removeEventListener("click",n),""===this.value)this.style.fontSize=i._placeholderFontSize+"px",this.style.color=e.colorToHex(i._placeholderColor);t.hidden()}),i},_createDomTextArea:function(){var t=this,i=this._edTxt=document.createElement("textarea");i.type="text",i.style.fontSize=this._edFontSize+"px",i.style.color="#000000",i.style.border=0,i.style.background="transparent",i.style.width="100%",i.style.height="100%",i.style.active=0,i.style.outline="medium",i.style.padding="0",i.style.resize="none",i.style.textTransform="uppercase",i.style.overflow_y="scroll",i.style.display="none";var n=function(){i.blur()};return i.addEventListener("input",function(){var e=t._editBox;if(e._delegate&&e._delegate.editBoxTextChanged)e._text=this.value,t._updateEditBoxContentStyle(),e._delegate.editBoxTextChanged(e,e._text)}),i.addEventListener("focus",function(){var i=t._editBox;if(this.style.fontSize=t._edFontSize+"px",this.style.color=e.colorToHex(i._textColor),i._delegate&&i._delegate.editBoxEditingDidBegan)i._delegate.editBoxEditingDidBegan(i);e._canvas.addEventListener("click",n)}),i.addEventListener("blur",function(){var i=t._editBox;if(i._text=this.value,t._updateEditBoxContentStyle(),i._delegate&&i._delegate.editBoxEditingDidEnded)i._delegate.editBoxEditingDidEnded(i);if(""===this.value)this.style.fontSize=i._placeholderFontSize+"px",this.style.color=e.colorToHex(i._placeholderColor);t.hidden(),e._canvas.removeEventListener("click",n)}),i},_removeDomInputControl:function(){this._domInputSprite.dom.removeChild(this._edTxt)},_addDomInputControl:function(){this._domInputSprite.dom.appendChild(this._edTxt)}},_ccsg.EditBox=_ccsg.Node.extend({_backgroundSprite:null,_delegate:null,_editBoxInputMode:b.ANY,_editBoxInputFlag:E.SENSITIVE,_keyboardReturnType:S.DEFAULT,_maxLength:50,_nativeControl:null,_text:"",_textColor:null,_placeholderText:"",_placeholderFontName:"",_placeholderFontSize:14,_placeholderColor:null,_adjustHeight:18,_tooltip:!1,_className:"EditBox",ctor:function(t,i,n,r){_ccsg.Node.prototype.ctor.call(this),this._textColor=e.Color.WHITE,this._placeholderColor=e.Color.GRAY,_ccsg.Node.prototype.setContentSize.call(this,t);var s=this._nativeControl=new A(this);s.createNativeControl(t),this._oldSetContentSize=this.setContentSize,this.setContentSize=this._updateEditBoxSize,this.initWithSizeAndBackgroundSprite(t,i),this.scheduleOnce(function(){s.registerClickEvent()},.01)},_onTouchBegan:function(t,i){var n=t.getLocation(),r=e.rect(0,0,this._contentSize.width,this._contentSize.height),s=e.rectContainsPoint(r,this.convertToNodeSpace(n));if(s)return!0;else return this._nativeControl.hidden(),!1},_onTouchEnded:function(t,e){this._nativeControl.show()},_updateBackgroundSpriteSize:function(t,e){if(this._backgroundSprite)this._backgroundSprite.setContentSize(t,e)},_updateEditBoxSize:function(t,e){this._oldSetContentSize(t,e);var i="number"==typeof t.width?t.width:t,n="number"==typeof t.height?t.height:e;this._updateBackgroundSpriteSize(i,n),this._nativeControl.setSize(i,n)},setLineHeight:function(t){this._nativeControl.setLineHeight(t)},setFont:function(t,e){this._nativeControl.setFont(t,e)},_setFont:function(t){this._nativeControl._setFont(t)},getBackgroundSprite:function(){return this._backgroundSprite},setFontName:function(t){this._nativeControl.setFontName(t)},setFontSize:function(t){this._nativeControl.setFontSize(t)},setText:function(t){e.log("Please use the setString"),this.setString(t)},setString:function(t){if(t.length>=this._maxLength)t=t.slice(0,this._maxLength);this._text=t,this._nativeControl.setString(t)},setFontColor:function(t){this._textColor=t,this._nativeControl.setFontColor(t)},setMaxLength:function(t){if(!isNaN(t)&&t>0)this._maxLength=t,this._nativeControl.setMaxLength(t)},getMaxLength:function(){return this._maxLength},setPlaceHolder:function(t){if(null!==t)this._nativeControl.setPlaceHolder(t),this._placeholderText=t},setPlaceholderFont:function(t,e){this._placeholderFontName=t,this._placeholderFontSize=e,this._nativeControl._updateDOMPlaceholderFontStyle()},_setPlaceholderFont:function(t){var i=e.LabelTTF._fontStyleRE.exec(t);if(i)this._placeholderFontName=i[2],this._placeholderFontSize=parseInt(i[1]),this._nativeControl._updateDOMPlaceholderFontStyle()},setPlaceholderFontName:function(t){this._placeholderFontName=t,this._nativeControl._updateDOMPlaceholderFontStyle()},setPlaceholderFontSize:function(t){this._placeholderFontSize=t,this._nativeControl._updateDOMPlaceholderFontStyle()},setPlaceholderFontColor:function(t){this._placeholderColor=t,this._nativeControl.setPlaceholderFontColor(t)},setInputFlag:function(t){this._editBoxInputFlag=t,this._nativeControl.setInputFlag(t)},getText:function(){return e.log("Please use the getString"),this.getString()},getString:function(){return this._text},initWithSizeAndBackgroundSprite:function(t,i){if(this._backgroundSprite)this._backgroundSprite.removeFromParent();if(this._backgroundSprite=i,this._backgroundSprite&&!this._backgroundSprite.parent)this._backgroundSprite.setAnchorPoint(e.p(0,0)),this.addChild(this._backgroundSprite),this._updateBackgroundSpriteSize(t.width,t.height);return this.x=0,this.y=0,!0},setDelegate:function(t){this._delegate=t;
},getPlaceHolder:function(){return this._placeholderText},setInputMode:function(t){if(this._editBoxInputMode!==t){var e=this.getString();this._nativeControl.setInputMode(t),this.setString(e),this._editBoxInputMode=t,this._nativeControl._updateLabelPosition(this.getContentSize())}},setReturnType:function(t){this._keyboardReturnType=t},keyboardWillShow:function(t){var i=_ccsg.EditBox.getRect(this);if(i.y-=4,!i.intersectsRect(t.end))return void e.log("needn't to adjust view layout.");else return void(this._adjustHeight=t.end.getMaxY()-i.getMinY())},initWithBackgroundColor:function(t,i){this._edWidth=t.width,this.dom.style.width=this._edWidth.toString()+"px",this._edHeight=t.height,this.dom.style.height=this._edHeight.toString()+"px",this.dom.style.backgroundColor=e.colorToHex(i)}});var _=_ccsg.EditBox.prototype;_.font,e.defineGetterSetter(_,"font",null,_._setFont),_.fontName,e.defineGetterSetter(_,"fontName",null,_.setFontName),_.fontSize,e.defineGetterSetter(_,"fontSize",null,_.setFontSize),_.fontColor,e.defineGetterSetter(_,"fontColor",null,_.setFontColor),_.string,e.defineGetterSetter(_,"string",_.getString,_.setString),_.maxLength,e.defineGetterSetter(_,"maxLength",_.getMaxLength,_.setMaxLength),_.placeHolder,e.defineGetterSetter(_,"placeholder",_.getPlaceHolder,_.setPlaceHolder),_.placeHolderFont,e.defineGetterSetter(_,"placeholderFont",null,_._setPlaceholderFont),_.placeHolderFontName,e.defineGetterSetter(_,"placeholderFontName",null,_.setPlaceholderFontName),_.placeHolderFontSize,e.defineGetterSetter(_,"placeholderFontSize",null,_.setPlaceholderFontSize),_.placeHolderFontColor,e.defineGetterSetter(_,"placeholderFontColor",null,_.setPlaceholderFontColor),_.inputFlag,e.defineGetterSetter(_,"inputFlag",null,_.setInputFlag),_.delegate,e.defineGetterSetter(_,"delegate",null,_.setDelegate),_.inputMode,e.defineGetterSetter(_,"inputMode",null,_.setInputMode),_.returnType,e.defineGetterSetter(_,"returnType",null,_.setReturnType),_=null,_ccsg.EditBox.getRect=function(t){var i=t.getContentSize(),n=e.rect(0,0,i.width,i.height);return e.rectApplyAffineTransform(n,t.getNodeToWorldTransform())},_ccsg.EditBox.InputMode=b,_ccsg.EditBox.InputFlag=E,_ccsg.EditBox.KeyboardReturnType=S,e.DOM={},e.DOM._addMethods=function(t){for(var i in e.DOM.methods)t[i]=e.DOM.methods[i];e.defineGetterSetter(t,"x",t.getPositionX,t.setPositionX),e.defineGetterSetter(t,"y",t.getPositionY,t.setPositionY),e.defineGetterSetter(t,"width",t._getWidth,t._setWidth),e.defineGetterSetter(t,"height",t._getHeight,t._setHeight),e.defineGetterSetter(t,"anchorX",t._getAnchorX,t._setAnchorX),e.defineGetterSetter(t,"anchorY",t._getAnchorY,t._setAnchorY),e.defineGetterSetter(t,"scale",t.getScale,t.setScale),e.defineGetterSetter(t,"scaleX",t.getScaleX,t.setScaleX),e.defineGetterSetter(t,"scaleY",t.getScaleY,t.setScaleY),e.defineGetterSetter(t,"rotation",t.getRotation,t.setRotation),e.defineGetterSetter(t,"skewX",t.getSkewX,t.setSkewX),e.defineGetterSetter(t,"skewY",t.getSkewY,t.setSkewY),e.defineGetterSetter(t,"visible",t.isVisible,t.setVisible),e.defineGetterSetter(t,"parent",t.getParent,t.setParent),e.defineGetterSetter(t,"opacity",t.getOpacity,t.setOpacity)},e.DOM.methods={setPosition:function(t,e){if(void 0===e)this._position.x=t.x,this._position.y=t.y;else this._position.x=t,this._position.y=e;this.setNodeDirty(),this.dom.translates(this._position.x,-this._position.y)},setPositionY:function(t){this._position.y=t,this.setNodeDirty(),this.dom.translates(this._position.x,-this._position.y)},setPositionX:function(t){this._position.x=t,this.setNodeDirty(),this.dom.translates(this._position.x,-this._position.y)},setScale:function(t,e){this._scaleX=t,this._scaleY=e||t,this.setNodeDirty(),this.dom.resize(this._scaleX,this._scaleY)},setScaleX:function(t){this._scaleX=t,this.setNodeDirty(),this.dom.resize(this._scaleX,this._scaleY)},setScaleY:function(t){this._scaleY=t,this.setNodeDirty(),this.dom.resize(this._scaleX,this._scaleY)},setAnchorPoint:function(t,i){var n=this._renderCmd,r=this._anchorPoint;if(void 0===i)r.x=t.x,r.y=t.y;else r.x=t,r.y=i;var s=n._anchorPointInPoints,o=this._contentSize;if(s.x=o.width*r.x,s.y=o.height*r.y,this.dom.style[e.$.pfx+"TransformOrigin"]=""+s.x+"px "+-s.y+"px",this.ignoreAnchor)this.dom.style.marginLeft=0,this.dom.style.marginBottom=0;else this.dom.style.marginLeft=this.isToggler?0:-s.x+"px",this.dom.style.marginBottom=-s.y+"px";this.setNodeDirty()},_setAnchorX:function(t){var i=this._anchorPoint,n=this._renderCmd;if(t!==i.x){i.x=t;var r=n._anchorPointInPoints,s=this._contentSize;if(r.x=s.width*i.x,this.dom.style[e.$.pfx+"TransformOrigin"]=""+r.x+"px "+-r.y+"px",this.ignoreAnchor)this.dom.style.marginLeft=0,this.dom.style.marginBottom=0;else this.dom.style.marginLeft=this.isToggler?0:-r.x+"px";this.setNodeDirty()}},_setAnchorY:function(t){var i=this._anchorPoint,n=this._renderCmd;if(t!==i.y){i.y=t;var r=n._anchorPointInPoints,s=this._contentSize;if(r.y=s.height*i.y,this.dom.style[e.$.pfx+"TransformOrigin"]=""+r.x+"px "+-r.y+"px",this.ignoreAnchor)this.dom.style.marginLeft=0,this.dom.style.marginBottom=0;else this.dom.style.marginBottom=-r.y+"px";this.setNodeDirty()}},setContentSize:function(t,e){var i=this._renderCmd,n=this._contentSize;if(void 0===e)n.width=t.width,n.height=t.height;else n.width=t,n.height=e;var r=i._anchorPointInPoints,s=this._anchorPoint;if(r.x=n.width*s.x,r.y=n.height*s.y,this.dom.width=n.width,this.dom.height=n.height,this.setAnchorPoint(this.getAnchorPoint()),this.canvas)this.canvas.width=n.width,this.canvas.height=n.height;this.setNodeDirty()},_setWidth:function(t){var e=this._contentSize,i=this._renderCmd;if(t!==e.width){e.width=t;var n=i._anchorPointInPoints,r=this._anchorPoint;if(n.x=e.width*r.x,this.dom.width=e.width,this.anchorX=r.x,this.canvas)this.canvas.width=e.width;this.setNodeDirty()}},_setHeight:function(t){var e=this._contentSize,i=this._renderCmd;if(t!==e.height){e.height=t;var n=i._anchorPointInPoints,r=this._anchorPoint;if(n.y=e.height*r.y,this.dom.height=e.height,this.anchorY=r.y,this.canvas)this.canvas.height=e.height;this.setNodeDirty()}},setRotation:function(t){if(this._rotation!==t)this._rotationX=this._rotationY=t,this.setNodeDirty(),this.dom.rotate(t)},setSkewX:function(t){this._skewX=t,this.setNodeDirty(),this.dom.setSkew(this._skewX,this._skewY)},setSkewY:function(t){this._skewY=t,this.setNodeDirty(),this.dom.setSkew(this._skewX,this._skewY)},setVisible:function(t){if(_ccsg.Node.prototype.setVisible.call(this,t),this._visible=t,this.setNodeDirty(),this.dom)this.dom.style.display=t?"block":"none"},_setLocalZOrder:function(t){if(this._localZOrder=t,this.setNodeDirty(),this.dom)this.dom.zIndex=t},setParent:function(t){if(this._parent=t,null!==t)t.setAnchorPoint(t.getAnchorPoint()),this.setNodeDirty(),e.DOM.parentDOM(this)},resume:function(){if(this.getScheduler().resumeTarget(this),this.getActionManager().resumeTarget(this),e.eventManager.resumeTarget(this),this.dom&&!this.dom.parentNode)if(!this.getParent())if(""===this.dom.id)e.DOM._createEGLViewDiv(this);else this.dom.appendTo(e.container);else e.DOM.parentDOM(this);if(this.dom)this.dom.style.visibility="visible"},pause:function(){if(this.getScheduler().pauseTarget(this),this.getActionManager().pauseTarget(this),e.eventManager.pauseTarget(this),this.dom)this.dom.style.visibility="hidden"},cleanup:function(){if(this.stopAllActions(),this.unscheduleAllCallbacks(),this._arrayMakeObjectsPerformSelector(this._children,_ccsg.Node._stateCallbackType.cleanup),this.dom)this.dom.remove()},removeFromParentAndCleanup:function(){this.dom.remove()},setOpacity:function(t){this._opacity=t,this.dom.style.opacity=t/255},redraw:function(){if(this.isSprite){var t=this._children;this._children=[],_ccsg.Sprite.prototype.visit.call(this,this.ctx),this._children=t}else _ccsg.Sprite.prototype.visit.call(this,this.ctx)}},e.DOM._resetEGLViewDiv=function(){var t=e.$("#EGLViewDiv");if(t){var i=e.view,n=i.getDesignResolutionSize(),r=i.getViewPortRect(),s=i.getFrameSize(),o=i.getDevicePixelRatio(),a=n.width,c=n.height;if(0===n.width&&0===n.height)a=s.width,c=s.height;var l=r.width/o;if(0===r.width&&0===r.height)l=s.width;if(t.style.position="absolute",t.style.width=a+"px",t.style.maxHeight=c+"px",t.style.margin=0,t.resize(i.getScaleX()/o,i.getScaleY()/o),i.getResolutionPolicy()===i._rpNoBorder)t.style.left=(i.getFrameSize().width-a)/2+"px",t.style.bottom=(i.getFrameSize().height-c*i.getScaleY()/o)/2+"px";else t.style.left=(a*i.getScaleX()/o-a)/2+"px",t.style.bottom="0px"}},e.DOM.parentDOM=function(t){var i=t.getParent();if(!i||!t.dom)return!1;if(!i.dom)e.DOM.placeHolder(i),i.setParent=e.DOM.methods.setParent;if(t.dom.appendTo(i.dom),i.setAnchorPoint(i.getAnchorPoint()),i.getParent())e.DOM.parentDOM(i);else if(i.isRunning()){var n=e.$("#EGLViewDiv");if(n)i.dom.appendTo(n);else e.DOM._createEGLViewDiv(i)}return!0},e.DOM._createEGLViewDiv=function(t){var i=e.$("#EGLViewDiv");if(!i)i=e.$new("div"),i.id="EGLViewDiv";var n=e.view,r=n.getDesignResolutionSize(),s=n.getViewPortRect(),o=n.getFrameSize(),a=n.getDevicePixelRatio(),c=r.width,l=r.height;if(0===r.width&&0===r.height)c=o.width,l=o.height;var h=s.width/a;if(0===s.width&&0===s.height)h=o.width;if(i.style.position="absolute",i.style.width=c+"px",i.style.maxHeight=l+"px",i.style.margin=0,i.resize(n.getScaleX()/a,n.getScaleY()/a),n.getResolutionPolicy()===n._rpNoBorder)i.style.left=(o.width-c)/2+"px",i.style.bottom=(o.height-l*n.getScaleY()/a)/2+"px";else i.style.left=(c*n.getScaleX()/a-c)/2+"px",i.style.bottom="0px";t.dom.appendTo(i),i.appendTo(e.container)},e.DOM.setTransform=function(t){if(t.ctx)if(t.ctx.translate(t.getAnchorPointInPoints().x,t.getAnchorPointInPoints().y),t.isSprite){var e=t._children;t._children=[],_ccsg.Sprite.prototype.visit.call(t),t._children=e}else _ccsg.Sprite.prototype.visit.call(t);if(t.dom){if(t.dom.position.x=t.getPositionX(),t.dom.position.y=-t.getPositionY(),t.dom.rotation=t.getRotation(),t.dom.scale={x:t.getScaleX(),y:t.getScaleY()},t.dom.skew={x:t.getSkewX(),y:t.getSkewY()},t.setAnchorPoint)t.setAnchorPoint(t.getAnchorPoint());t.dom.transforms()}},e.DOM.forSprite=function(t){t.dom=e.$new("div"),t.canvas=e.$new("canvas");var i=t.getContentSize();if(t.canvas.width=i.width,t.canvas.height=i.height,t.dom.style.position="absolute",t.dom.style.bottom=0,t.ctx=t.canvas.getContext("2d"),t.dom.appendChild(t.canvas),t.getParent())e.DOM.parentDOM(t);t.isSprite=!0},e.DOM.placeHolder=function(t){t.dom=e.$new("div"),t.dom.style.position="absolute",t.dom.style.bottom=0,t.dom.style.width=(t.getContentSize().width||e.director.getWinSize().width)+"px",t.dom.style.maxHeight=(t.getContentSize().height||e.director.getWinSize().height)+"px",t.dom.style.margin=0,e.DOM.setTransform(t),t.dom.transforms(),e.DOM._addMethods(t)},e.DOM.convert=function(t){if(arguments.length>1)return void e.DOM.convert(arguments);else if(1===arguments.length&&!arguments[0].length)return void e.DOM.convert([arguments[0]]);for(var i=arguments[0],n=0;n<i.length;n++){if(i[n]instanceof _ccsg.Sprite){if(!i[n].dom)e.DOM.forSprite(i[n])}else e.log("DOM converter only supports sprite and menuitems yet");e.DOM._addMethods(i[n]),i[n].visit=function(){},i[n].transform=function(){},e.DOM.setTransform(i[n]),i[n].setVisible(i[n].isVisible())}},e.RenderTexture=_ccsg.Node.extend({sprite:null,clearFlags:0,clearDepthVal:0,autoDraw:!1,_texture:null,_pixelFormat:0,clearStencilVal:0,_clearColor:null,_className:"RenderTexture",ctor:function(t,i,n,r){if(_ccsg.Node.prototype.ctor.call(this),this._cascadeColorEnabled=!0,this._cascadeOpacityEnabled=!0,this._pixelFormat=e.Texture2D.PIXEL_FORMAT_RGBA8888,this._clearColor=new e.Color(0,0,0,255),void 0!==t&&void 0!==i)n=n||e.Texture2D.PIXEL_FORMAT_RGBA8888,r=r||0,this.initWithWidthAndHeight(t,i,n,r);this.setAnchorPoint(0,0)},_createRenderCmd:function(){if(e._renderType===e.game.RENDER_TYPE_CANVAS)return new e.RenderTexture.CanvasRenderCmd(this);else return new e.RenderTexture.WebGLRenderCmd(this)},cleanup:function(){_ccsg.Node.prototype.onExit.call(this),this._renderCmd.cleanup()},getSprite:function(){return this.sprite},setSprite:function(t){this.sprite=t},setVirtualViewport:function(t,e,i){this._renderCmd.setVirtualViewport(t,e,i)},initWithWidthAndHeight:function(t,e,i,n){return this._renderCmd.initWithWidthAndHeight(t,e,i,n)},begin:function(){e.renderer._turnToCacheMode(this.__instanceId),this._renderCmd.begin()},beginWithClear:function(t,i,n,r,s,o){var a=e._renderContext;s=s||a.COLOR_BUFFER_BIT,o=o||a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT,this._beginWithClear(t,i,n,r,s,o,a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT|a.STENCIL_BUFFER_BIT)},_beginWithClear:function(t,e,i,n,r,s,o){this.begin(),this._renderCmd._beginWithClear(t,e,i,n,r,s,o)},end:function(){this._renderCmd.end()},clear:function(t,e,i,n){this.beginWithClear(t,e,i,n),this.end()},clearRect:function(t,e,i,n){this._renderCmd.clearRect(t,e,i,n)},clearDepth:function(t){this._renderCmd.clearDepth(t)},clearStencil:function(t){this._renderCmd.clearStencil(t)},getClearFlags:function(){return this.clearFlags},setClearFlags:function(t){this.clearFlags=t},getClearColor:function(){return this._clearColor},setClearColor:function(t){var e=this._clearColor;e.r=t.r,e.g=t.g,e.b=t.b,e.a=t.a,this._renderCmd.updateClearColor(t)},getClearDepth:function(){return this.clearDepthVal},setClearDepth:function(t){this.clearDepthVal=t},getClearStencil:function(){return this.clearStencilVal},setClearStencil:function(t){this.clearStencilVal=t},isAutoDraw:function(){return this.autoDraw},setAutoDraw:function(t){this.autoDraw=t},saveToFile:function(t,i){e.log("saveToFile isn't supported on Cocos2d-Html5")},newCCImage:function(t){return e.log("saveToFile isn't supported on cocos2d-html5"),null},listenToBackground:function(t){},listenToForeground:function(t){}});var _=e.RenderTexture.prototype;_.clearColorVal,e.defineGetterSetter(_,"clearColorVal",_.getClearColor,_.setClearColor),e.RenderTexture.create=function(t,i,n,r){return new e.RenderTexture(t,i,n,r)},e.RenderTexture.CanvasRenderCmd=function(t){_ccsg.Node.CanvasRenderCmd.call(this,t),this._needDraw=!0,this._clearColorStr="rgba(255,255,255,1)",this._cacheCanvas=document.createElement("canvas"),this._cacheContext=new e.CanvasContextWrapper(this._cacheCanvas.getContext("2d"))};var l=e.RenderTexture.CanvasRenderCmd.prototype=Object.create(_ccsg.Node.CanvasRenderCmd.prototype);l.constructor=e.RenderTexture.CanvasRenderCmd,l.cleanup=function(){this._cacheContext=null,this._cacheCanvas=null},l.clearStencil=function(t){},l.setVirtualViewport=function(t,e,i){},l.updateClearColor=function(t){this._clearColorStr="rgba("+(0|t.r)+","+(0|t.g)+","+(0|t.b)+","+t.a/255+")"},l.initWithWidthAndHeight=function(t,i,n,r){var s=this._node,o=this._cacheCanvas;o.width=0|t,o.height=0|i;var a=new e.Texture2D;a.initWithElement(o),a.handleLoadedTexture();var c=s.sprite=new _ccsg.Sprite(a);return c.setBlendFunc(e.macro.ONE,e.macro.ONE_MINUS_SRC_ALPHA),s.autoDraw=!1,s.addChild(c),!0},l.begin=function(){},l._beginWithClear=function(t,e,i,n,r,s,o){t=t||0,e=e||0,i=i||0,n=isNaN(n)?255:n;var a=this._cacheContext.getContext(),c=this._cacheCanvas;a.setTransform(1,0,0,1,0,0),this._cacheContext.setFillStyle("rgba("+(0|t)+","+(0|e)+","+(0|i)+","+n/255+")"),a.clearRect(0,0,c.width,c.height),a.fillRect(0,0,c.width,c.height)},l.end=function(){var t=this._node;e.renderer._renderingToCacheCanvas(this._cacheContext,t.__instanceId)},l.clearRect=function(t,e,i,n){this._cacheContext.clearRect(t,e,i,-n)},l.clearDepth=function(t){e.log("clearDepth isn't supported on Cocos2d-Html5")},l.visit=function(t){var e=this._node;this._syncStatus(t),e.sprite.visit(this),this._dirtyFlag=0};var w=t("../cocos2d/core/utils/misc");e.RenderTexture.WebGLRenderCmd=function(t){_ccsg.Node.WebGLRenderCmd.call(this,t),this._needDraw=!0,this._fBO=null,this._oldFBO=null,this._textureCopy=null,this._depthRenderBuffer=null,this._rtTextureRect=new e.Rect,this._fullRect=new e.Rect,this._fullViewport=new e.Rect};var l=e.RenderTexture.WebGLRenderCmd.prototype=Object.create(_ccsg.Node.WebGLRenderCmd.prototype);l.constructor=e.RenderTexture.WebGLRenderCmd,l.setVirtualViewport=function(t,e,i){this._rtTextureRect.x=t.x,this._rtTextureRect.y=t.y,this._fullRect=e,this._fullViewport=i},l.rendering=function(t){var i=t||e._renderContext,n=this._node;if(n.autoDraw){n.begin();var r=n.clearFlags;if(r){var s=[0,0,0,0],o=0,a=0;if(r&i.COLOR_BUFFER_BIT)s=i.getParameter(i.COLOR_CLEAR_VALUE),i.clearColor(n._clearColor.r/255,n._clearColor.g/255,n._clearColor.b/255,n._clearColor.a/255);if(r&i.DEPTH_BUFFER_BIT)o=i.getParameter(i.DEPTH_CLEAR_VALUE),i.clearDepth(n.clearDepthVal);if(r&i.STENCIL_BUFFER_BIT)a=i.getParameter(i.STENCIL_CLEAR_VALUE),i.clearStencil(n.clearStencilVal);if(i.clear(r),r&i.COLOR_BUFFER_BIT)i.clearColor(s[0],s[1],s[2],s[3]);if(r&i.DEPTH_BUFFER_BIT)i.clearDepth(o);if(r&i.STENCIL_BUFFER_BIT)i.clearStencil(a)}n.sortAllChildren();for(var c=n._children,l=0;l<c.length;l++){var h=c[l];if(h!==n.sprite)h._renderCmd.visit(n.sprite._renderCmd)}n.end()}},l.clearStencil=function(t){var i=e._renderContext,n=i.getParameter(i.STENCIL_CLEAR_VALUE);i.clearStencil(t),i.clear(i.STENCIL_BUFFER_BIT),i.clearStencil(n)},l.cleanup=function(){this._node;this._textureCopy=null;var t=e._renderContext;if(t.deleteFramebuffer(this._fBO),this._depthRenderBuffer)t.deleteRenderbuffer(this._depthRenderBuffer)},l.updateClearColor=function(t){},l.initWithWidthAndHeight=function(t,i,n,r){var s=this._node;if(n===e.Texture2D.PIXEL_FORMAT_A8)e.log("cc.RenderTexture._initWithWidthAndHeightForWebGL() : only RGB and RGBA formats are valid for a render texture;");var o=e._renderContext;this._fullRect=new e.Rect(0,0,t,i),this._fullViewport=new e.Rect(0,0,t,i),t=0|t,i=0|i,this._oldFBO=o.getParameter(o.FRAMEBUFFER_BINDING);var a,c;if(e.configuration.supportsNPOT())a=t,c=i;else a=w.NextPOT(t),c=w.NextPOT(i);for(var l=a*c*4,h=new Uint8Array(l),u=0;a*c*4>u;u++)h[u]=0;this._pixelFormat=n;var d=s._texture=new e.Texture2D;if(!s._texture)return!1;d.initWithData(h,s._pixelFormat,a,c,e.size(t,i));var f=o.getParameter(o.RENDERBUFFER_BINDING);if(e.configuration.checkForGLExtension("GL_QCOM")){if(this._textureCopy=new e.Texture2D,!this._textureCopy)return!1;this._textureCopy.initWithData(h,s._pixelFormat,a,c,e.size(t,i))}if(this._fBO=o.createFramebuffer(),o.bindFramebuffer(o.FRAMEBUFFER,this._fBO),o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,d._webTextureObj,0),0!==r)if(this._depthRenderBuffer=o.createRenderbuffer(),o.bindRenderbuffer(o.RENDERBUFFER,this._depthRenderBuffer),o.renderbufferStorage(o.RENDERBUFFER,r,a,c),r===o.DEPTH_STENCIL)o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_STENCIL_ATTACHMENT,o.RENDERBUFFER,this._depthRenderBuffer);else if(r===o.STENCIL_INDEX||r===o.STENCIL_INDEX8)o.framebufferRenderbuffer(o.FRAMEBUFFER,o.STENCIL_ATTACHMENT,o.RENDERBUFFER,this._depthRenderBuffer);else if(r===o.DEPTH_COMPONENT16)o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_ATTACHMENT,o.RENDERBUFFER,this._depthRenderBuffer);if(o.checkFramebufferStatus(o.FRAMEBUFFER)!==o.FRAMEBUFFER_COMPLETE)e.log("Could not attach texture to the framebuffer");d.setAliasTexParameters();var _=s.sprite=new _ccsg.Sprite(d);return _.scaleY=-1,_.setBlendFunc(o.ONE,o.ONE_MINUS_SRC_ALPHA),o.bindRenderbuffer(o.RENDERBUFFER,f),o.bindFramebuffer(o.FRAMEBUFFER,this._oldFBO),s.autoDraw=!1,s.addChild(_),!0},l.begin=function(){var t=this._node;e.math.glMatrixMode(e.math.KM_GL_PROJECTION),e.math.glPushMatrix(),e.math.glMatrixMode(e.math.KM_GL_MODELVIEW),e.math.glPushMatrix();var i=e._renderContext,n=e.director;n.setProjection(n.getProjection());var r=t._texture.getContentSizeInPixels(),s=e.director.getWinSizeInPixels(),o=s.width/r.width,a=s.height/r.height,c=e.math.Matrix4.createOrthographicProjection(-1/o,1/o,-1/a,1/a,-1,1);e.math.glMultMatrix(c);var l=new e.Rect(0,0,0,0);l.width=this._fullViewport.width,l.height=this._fullViewport.height;var h=l.width/this._fullRect.width,u=l.height/this._fullRect.height;if(l.x=(this._fullRect.x-this._rtTextureRect.x)*h,l.y=(this._fullRect.y-this._rtTextureRect.y)*u,i.viewport(l.x,l.y,l.width,l.height),this._oldFBO=i.getParameter(i.FRAMEBUFFER_BINDING),i.bindFramebuffer(i.FRAMEBUFFER,this._fBO),e.configuration.checkForGLExtension("GL_QCOM"))i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,this._textureCopy._webTextureObj,0),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,t._texture._webTextureObj,0)},l._beginWithClear=function(t,i,n,r,s,o,a){t/=255,i/=255,n/=255,r/=255;var c=e._renderContext,l=[0,0,0,0],h=0,u=0;if(a&c.COLOR_BUFFER_BIT)l=c.getParameter(c.COLOR_CLEAR_VALUE),c.clearColor(t,i,n,r);if(a&c.DEPTH_BUFFER_BIT)h=c.getParameter(c.DEPTH_CLEAR_VALUE),c.clearDepth(s);if(a&c.STENCIL_BUFFER_BIT)u=c.getParameter(c.STENCIL_CLEAR_VALUE),c.clearStencil(o);if(c.clear(a),a&c.COLOR_BUFFER_BIT)c.clearColor(l[0],l[1],l[2],l[3]);if(a&c.DEPTH_BUFFER_BIT)c.clearDepth(h);if(a&c.STENCIL_BUFFER_BIT)c.clearStencil(u)},l.end=function(){var t=this._node;e.renderer._renderingToBuffer(t.__instanceId);var i=e._renderContext,n=e.director;i.bindFramebuffer(i.FRAMEBUFFER,this._oldFBO),n.setViewport(),e.math.glMatrixMode(e.math.KM_GL_PROJECTION),e.math.glPopMatrix(),e.math.glMatrixMode(e.math.KM_GL_MODELVIEW),e.math.glPopMatrix()},l.clearRect=function(t,e,i,n){},l.clearDepth=function(t){var i=this._node;i.begin();var n=e._renderContext,r=n.getParameter(n.DEPTH_CLEAR_VALUE);n.clearDepth(t),n.clear(n.DEPTH_BUFFER_BIT),n.clearDepth(r),i.end()},l.visit=function(t){var i=this._node;if(i._visible)e.kmGLPushMatrix(),this._syncStatus(t),e.renderer.pushRenderCommand(this),i.sprite.visit(this),this._dirtyFlag=0,e.math.glPopMatrix()};var O=function(t){return{u:t.x,v:t.y}};e.DrawNode=_ccsg.Node.extend({_buffer:null,_blendFunc:null,_lineWidth:1,_drawColor:null,getBlendFunc:function(){return this._blendFunc},setBlendFunc:function(t,e){if(void 0===e)this._blendFunc.src=t.src,this._blendFunc.dst=t.dst;else this._blendFunc.src=t,this._blendFunc.dst=e},setLineWidth:function(t){this._lineWidth=t},getLineWidth:function(){return this._lineWidth},setDrawColor:function(t){var e=this._drawColor;e.r=t.r,e.g=t.g,e.b=t.b,e.a=null==t.a?255:t.a},getDrawColor:function(){return e.color(this._drawColor.r,this._drawColor.g,this._drawColor.b,this._drawColor.a)}}),e.DrawNode.TYPE_DOT=0,e.DrawNode.TYPE_SEGMENT=1,e.DrawNode.TYPE_POLY=2,e.game.once(e.game.EVENT_RENDERER_INITED,function(){if(e._renderType===e.game.RENDER_TYPE_CANVAS)e._DrawNodeElement=function(t,e,i,n,r,s,o,a,c){var l=this;l.type=t,l.verts=e||null,l.fillColor=i||null,l.lineWidth=n||0,l.lineColor=r||null,l.lineCap=s||"butt",l.isClosePolygon=o||!1,l.isFill=a||!1,l.isStroke=c||!1},e.js.mixin(e.DrawNode.prototype,{_className:"DrawNodeCanvas",ctor:function(){_ccsg.Node.prototype.ctor.call(this);var t=this._renderCmd;t._buffer=this._buffer=[],t._drawColor=this._drawColor=e.color(255,255,255,255),t._blendFunc=this._blendFunc=new e.BlendFunc(e.macro.SRC_ALPHA,e.macro.ONE_MINUS_SRC_ALPHA),this.init()},drawRect:function(t,i,n,r,s){if(r=null==r?this._lineWidth:r,s=s||this.getDrawColor(),null==s.a)s.a=255;var o=[t,e.p(i.x,t.y),i,e.p(t.x,i.y)],a=new e._DrawNodeElement(e.DrawNode.TYPE_POLY);if(a.verts=o,a.lineWidth=r,a.lineColor=s,a.isClosePolygon=!0,a.isStroke=!0,a.lineCap="butt",a.fillColor=n,n){if(null==n.a)n.a=255;a.isFill=!0}this._buffer.push(a)},drawCircle:function(t,i,n,r,s,o,a){if(o=o||this._lineWidth,a=a||this.getDrawColor(),null==a.a)a.a=255;for(var c=2*Math.PI/r,l=[],h=0;r>=h;h++){var u=h*c,d=i*Math.cos(u+n)+t.x,f=i*Math.sin(u+n)+t.y;l.push(e.p(d,f))}if(s)l.push(e.p(t.x,t.y));var _=new e._DrawNodeElement(e.DrawNode.TYPE_POLY);_.verts=l,_.lineWidth=o,_.lineColor=a,_.isClosePolygon=!0,_.isStroke=!0,this._buffer.push(_)},drawQuadBezier:function(t,i,n,r,s,o){if(s=s||this._lineWidth,o=o||this.getDrawColor(),null==o.a)o.a=255;for(var a=[],c=0,l=0;r>l;l++){var h=Math.pow(1-c,2)*t.x+2*(1-c)*c*i.x+c*c*n.x,u=Math.pow(1-c,2)*t.y+2*(1-c)*c*i.y+c*c*n.y;a.push(e.p(h,u)),c+=1/r}a.push(e.p(n.x,n.y));var d=new e._DrawNodeElement(e.DrawNode.TYPE_POLY);d.verts=a,d.lineWidth=s,d.lineColor=o,d.isStroke=!0,d.lineCap="round",this._buffer.push(d)},drawCubicBezier:function(t,i,n,r,s,o,a){if(o=o||this._lineWidth,a=a||this.getDrawColor(),null==a.a)a.a=255;for(var c=[],l=0,h=0;s>h;h++){var u=Math.pow(1-l,3)*t.x+3*Math.pow(1-l,2)*l*i.x+3*(1-l)*l*l*n.x+l*l*l*r.x,d=Math.pow(1-l,3)*t.y+3*Math.pow(1-l,2)*l*i.y+3*(1-l)*l*l*n.y+l*l*l*r.y;c.push(e.p(u,d)),l+=1/s}c.push(e.p(r.x,r.y));var f=new e._DrawNodeElement(e.DrawNode.TYPE_POLY);f.verts=c,f.lineWidth=o,f.lineColor=a,f.isStroke=!0,f.lineCap="round",this._buffer.push(f)},drawCatmullRom:function(t,e,i,n){this.drawCardinalSpline(t,.5,e,i,n)},drawCardinalSpline:function(t,i,n,r,s){if(r=r||this._lineWidth,s=s||this.getDrawColor(),null==s.a)s.a=255;for(var o,a,c=[],l=1/t.length,h=0;n+1>h;h++){var u=h/n;if(1===u)o=t.length-1,a=1;else o=0|u/l,a=(u-l*o)/l;var d=e.cardinalSplineAt(e.getControlPointAt(t,o-1),e.getControlPointAt(t,o-0),e.getControlPointAt(t,o+1),e.getControlPointAt(t,o+2),i,a);c.push(d)}var f=new e._DrawNodeElement(e.DrawNode.TYPE_POLY);f.verts=c,f.lineWidth=r,f.lineColor=s,f.isStroke=!0,f.lineCap="round",this._buffer.push(f)},drawDot:function(t,i,n){if(n=n||this.getDrawColor(),null==n.a)n.a=255;var r=new e._DrawNodeElement(e.DrawNode.TYPE_DOT);r.verts=[t],r.lineWidth=i,r.fillColor=n,this._buffer.push(r)},drawDots:function(t,e,i){if(t&&0!=t.length){if(i=i||this.getDrawColor(),null==i.a)i.a=255;for(var n=0,r=t.length;r>n;n++)this.drawDot(t[n],e,i)}},drawSegment:function(t,i,n,r){if(n=n||this._lineWidth,r=r||this.getDrawColor(),null==r.a)r.a=255;var s=new e._DrawNodeElement(e.DrawNode.TYPE_POLY);s.verts=[t,i],s.lineWidth=2*n,s.lineColor=r,s.isStroke=!0,s.lineCap="round",this._buffer.push(s)},drawPoly_:function(t,i,n,r){if(n=null==n?this._lineWidth:n,r=r||this.getDrawColor(),null==r.a)r.a=255;var s=new e._DrawNodeElement(e.DrawNode.TYPE_POLY);if(s.verts=t,s.fillColor=i,s.lineWidth=n,s.lineColor=r,s.isClosePolygon=!0,s.isStroke=!0,s.lineCap="round",i)s.isFill=!0;this._buffer.push(s)},drawPoly:function(t,i,n,r){for(var s=[],o=0;o<t.length;o++)s.push(e.p(t[o].x,t[o].y));return this.drawPoly_(s,i,n,r)},clear:function(){this._buffer.length=0},_createRenderCmd:function(){return new e.DrawNode.CanvasRenderCmd(this)}});else if(e._renderType===e.game.RENDER_TYPE_WEBGL)e.js.mixin(e.DrawNode.prototype,{_bufferCapacity:0,_trianglesArrayBuffer:null,_trianglesWebBuffer:null,_trianglesReader:null,_dirty:!1,_className:"DrawNodeWebGL",ctor:function(){_ccsg.Node.prototype.ctor.call(this),this._buffer=[],this._blendFunc=new e.BlendFunc(e.macro.SRC_ALPHA,e.macro.ONE_MINUS_SRC_ALPHA),this._drawColor=new e.WebGLColor(255,255,255,255),this.init()},init:function(){if(_ccsg.Node.prototype.init.call(this))return this.shaderProgram=e.shaderCache.programForKey(e.macro.SHADER_POSITION_LENGTHTEXTURECOLOR),this._ensureCapacity(64),this._trianglesWebBuffer=e._renderContext.createBuffer(),this._dirty=!0,!0;else return!1},drawRect:function(t,i,n,r,s){if(r=null==r?this._lineWidth:r,s=s||this.getDrawColor(),null==s.a)s.a=255;var o=[t,e.p(i.x,t.y),i,e.p(t.x,i.y)];if(null==n)this._drawSegments(o,r,s,!0);else this.drawPoly(o,n,r,s)},drawCircle:function(t,i,n,r,s,o,a){if(o=o||this._lineWidth,a=a||this.getDrawColor(),null==a.a)a.a=255;var c,l,h=2*Math.PI/r,u=[];for(c=0;r>=c;c++){var d=c*h,f=i*Math.cos(d+n)+t.x,_=i*Math.sin(d+n)+t.y;u.push(e.p(f,_))}if(s)u.push(e.p(t.x,t.y));for(o*=.5,c=0,l=u.length;l-1>c;c++)this.drawSegment(u[c],u[c+1],o,a)},drawQuadBezier:function(t,i,n,r,s,o){if(s=s||this._lineWidth,o=o||this.getDrawColor(),null==o.a)o.a=255;for(var a=[],c=0,l=0;r>l;l++){var h=Math.pow(1-c,2)*t.x+2*(1-c)*c*i.x+c*c*n.x,u=Math.pow(1-c,2)*t.y+2*(1-c)*c*i.y+c*c*n.y;a.push(e.p(h,u)),c+=1/r}a.push(e.p(n.x,n.y)),this._drawSegments(a,s,o,!1)},drawCubicBezier:function(t,i,n,r,s,o,a){if(o=o||this._lineWidth,a=a||this.getDrawColor(),null==a.a)a.a=255;for(var c=[],l=0,h=0;s>h;h++){var u=Math.pow(1-l,3)*t.x+3*Math.pow(1-l,2)*l*i.x+3*(1-l)*l*l*n.x+l*l*l*r.x,d=Math.pow(1-l,3)*t.y+3*Math.pow(1-l,2)*l*i.y+3*(1-l)*l*l*n.y+l*l*l*r.y;c.push(e.p(u,d)),l+=1/s}c.push(e.p(r.x,r.y)),this._drawSegments(c,o,a,!1)},drawCatmullRom:function(t,e,i,n){this.drawCardinalSpline(t,.5,e,i,n)},drawCardinalSpline:function(t,i,n,r,s){if(r=r||this._lineWidth,s=s||this.getDrawColor(),null==s.a)s.a=255;for(var o,a,c=[],l=1/t.length,h=0;n+1>h;h++){var u=h/n;if(1===u)o=t.length-1,a=1;else o=0|u/l,a=(u-l*o)/l;var d=e.cardinalSplineAt(e.getControlPointAt(t,o-1),e.getControlPointAt(t,o-0),e.getControlPointAt(t,o+1),e.getControlPointAt(t,o+2),i,a);c.push(d)}r*=.5;for(var f=0,_=c.length;_-1>f;f++)this.drawSegment(c[f],c[f+1],r,s)},_render:function(){var t=e._renderContext;if(e.gl.enableVertexAttribs(e.macro.VERTEX_ATTRIB_FLAG_POS_COLOR_TEX),t.bindBuffer(t.ARRAY_BUFFER,this._trianglesWebBuffer),this._dirty)t.bufferData(t.ARRAY_BUFFER,this._trianglesArrayBuffer,t.STREAM_DRAW),this._dirty=!1;var i=e.V2F_C4B_T2F.BYTES_PER_ELEMENT;t.vertexAttribPointer(e.macro.VERTEX_ATTRIB_POSITION,2,t.FLOAT,!1,i,0),t.vertexAttribPointer(e.macro.VERTEX_ATTRIB_COLOR,4,t.UNSIGNED_BYTE,!0,i,8),t.vertexAttribPointer(e.macro.VERTEX_ATTRIB_TEX_COORDS,2,t.FLOAT,!1,i,12),t.drawArrays(t.TRIANGLES,0,3*this._buffer.length),e.incrementGLDraws(1)},_ensureCapacity:function(t){var i=this,n=i._buffer;if(n.length+t>i._bufferCapacity){var r=e.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT;if(i._bufferCapacity+=Math.max(i._bufferCapacity,t),null==n||0===n.length)i._buffer=[],i._trianglesArrayBuffer=new ArrayBuffer(r*i._bufferCapacity),i._trianglesReader=new Uint8Array(i._trianglesArrayBuffer);else{for(var s=[],o=new ArrayBuffer(r*i._bufferCapacity),a=0;a<n.length;a++)s[a]=new e.V2F_C4B_T2F_Triangle(n[a].a,n[a].b,n[a].c,o,a*r);i._trianglesReader=new Uint8Array(o),i._trianglesArrayBuffer=o,i._buffer=s}}},drawDot:function(t,i,n){if(n=n||this.getDrawColor(),null==n.a)n.a=255;var r={r:0|n.r,g:0|n.g,b:0|n.b,a:0|n.a},s={vertices:{x:t.x-i,y:t.y-i},colors:r,texCoords:{u:-1,v:-1}},o={vertices:{x:t.x-i,y:t.y+i},colors:r,texCoords:{u:-1,v:1}},a={vertices:{x:t.x+i,y:t.y+i},colors:r,texCoords:{u:1,v:1}},c={vertices:{x:t.x+i,y:t.y-i},colors:r,texCoords:{u:1,v:-1}};this._ensureCapacity(6),this._buffer.push(new e.V2F_C4B_T2F_Triangle(s,o,a,this._trianglesArrayBuffer,this._buffer.length*e.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT)),this._buffer.push(new e.V2F_C4B_T2F_Triangle(s,a,c,this._trianglesArrayBuffer,this._buffer.length*e.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT)),this._dirty=!0},drawDots:function(t,e,i){if(t&&0!==t.length){if(i=i||this.getDrawColor(),null==i.a)i.a=255;for(var n=0,r=t.length;r>n;n++)this.drawDot(t[n],e,i)}},drawSegment:function(t,i,n,r){if(r=r||this.getDrawColor(),null==r.a)r.a=255;n=n||.5*this._lineWidth;var s=18;this._ensureCapacity(s);var o={r:0|r.r,g:0|r.g,b:0|r.b,a:0|r.a},a=e.v2(t),c=e.v2(i),l=e.pNormalize(e.pPerp(e.pSub(c,a))),h=e.pPerp(l),u=e.pMult(l,n),d=e.pMult(h,n),f=e.pSub(c,e.pAdd(u,d)),_=e.pAdd(c,e.pSub(u,d)),p=e.pSub(c,u),g=e.pAdd(c,u),m=e.pSub(a,u),v=e.pAdd(a,u),y=e.pSub(a,e.pSub(u,d)),T=e.pAdd(a,e.pAdd(u,d)),C=e.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT,x=this._trianglesArrayBuffer,S=this._buffer;S.push(new e.V2F_C4B_T2F_Triangle({vertices:f,colors:o,texCoords:O(e.pNeg(e.pAdd(l,h)))},{vertices:_,colors:o,texCoords:O(e.pSub(l,h))},{vertices:p,colors:o,texCoords:O(e.pNeg(l))},x,S.length*C)),S.push(new e.V2F_C4B_T2F_Triangle({vertices:g,colors:o,texCoords:O(l)},{vertices:_,colors:o,texCoords:O(e.pSub(l,h))},{vertices:p,colors:o,texCoords:O(e.pNeg(l))},x,S.length*C)),S.push(new e.V2F_C4B_T2F_Triangle({vertices:g,colors:o,texCoords:O(l)},{vertices:m,colors:o,texCoords:O(e.pNeg(l))},{vertices:p,colors:o,texCoords:O(e.pNeg(l))},x,S.length*C)),S.push(new e.V2F_C4B_T2F_Triangle({vertices:g,colors:o,texCoords:O(l)},{vertices:m,colors:o,texCoords:O(e.pNeg(l))},{vertices:v,colors:o,texCoords:O(l)},x,S.length*C)),S.push(new e.V2F_C4B_T2F_Triangle({vertices:y,colors:o,texCoords:O(e.pSub(h,l))},{vertices:m,colors:o,texCoords:O(e.pNeg(l))},{vertices:v,
colors:o,texCoords:O(l)},x,S.length*C)),S.push(new e.V2F_C4B_T2F_Triangle({vertices:y,colors:o,texCoords:O(e.pSub(h,l))},{vertices:T,colors:o,texCoords:O(e.pAdd(l,h))},{vertices:v,colors:o,texCoords:O(l)},x,S.length*C)),this._dirty=!0},drawPoly:function(t,i,n,r){if(null==i)return void this._drawSegments(t,n,r,!0);if(null==i.a)i.a=255;if(null==r.a)r.a=255;n=null==n?this._lineWidth:n,n*=.5;var s,o,a,c,l={r:0|i.r,g:0|i.g,b:0|i.b,a:0|i.a},h={r:0|r.r,g:0|r.g,b:0|r.b,a:0|r.a},u=[],d=t.length;for(s=0;d>s;s++){o=e.v2(t[(s-1+d)%d]),a=e.v2(t[s]),c=e.v2(t[(s+1)%d]);var f=e.pNormalize(e.pPerp(e.pSub(a,o))),_=e.pNormalize(e.pPerp(e.pSub(c,a))),p=e.pMult(e.pAdd(f,_),1/(e.pDot(f,_)+1));u[s]={offset:p,n:_}}var g=n>0,m=3*d-2,v=3*m;this._ensureCapacity(v);var y=e.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT,T=this._trianglesArrayBuffer,C=this._buffer,x=0==g?.5:0;for(s=0;d-2>s;s++)o=e.pSub(e.v2(t[0]),e.pMult(u[0].offset,x)),a=e.pSub(e.v2(t[s+1]),e.pMult(u[s+1].offset,x)),c=e.pSub(e.v2(t[s+2]),e.pMult(u[s+2].offset,x)),C.push(new e.V2F_C4B_T2F_Triangle({vertices:o,colors:l,texCoords:O(e.v2())},{vertices:a,colors:l,texCoords:O(e.v2())},{vertices:c,colors:l,texCoords:O(e.v2())},T,C.length*y));for(s=0;d>s;s++){var S=(s+1)%d;o=e.v2(t[s]),a=e.v2(t[S]);var b=u[s].n,E=u[s].offset,A=u[S].offset,w=g?e.pSub(o,e.pMult(E,n)):e.pSub(o,e.pMult(E,.5)),I=g?e.pSub(a,e.pMult(A,n)):e.pSub(a,e.pMult(A,.5)),R=g?e.pAdd(o,e.pMult(E,n)):e.pAdd(o,e.pMult(E,.5)),P=g?e.pAdd(a,e.pMult(A,n)):e.pAdd(a,e.pMult(A,.5));if(g)C.push(new e.V2F_C4B_T2F_Triangle({vertices:w,colors:h,texCoords:O(e.pNeg(b))},{vertices:I,colors:h,texCoords:O(e.pNeg(b))},{vertices:P,colors:h,texCoords:O(b)},T,C.length*y)),C.push(new e.V2F_C4B_T2F_Triangle({vertices:w,colors:h,texCoords:O(e.pNeg(b))},{vertices:R,colors:h,texCoords:O(b)},{vertices:P,colors:h,texCoords:O(b)},T,C.length*y));else C.push(new e.V2F_C4B_T2F_Triangle({vertices:w,colors:l,texCoords:O(e.v2())},{vertices:I,colors:l,texCoords:O(e.v2())},{vertices:P,colors:l,texCoords:O(b)},T,C.length*y)),C.push(new e.V2F_C4B_T2F_Triangle({vertices:w,colors:l,texCoords:O(e.v2())},{vertices:R,colors:l,texCoords:O(b)},{vertices:P,colors:l,texCoords:O(b)},T,C.length*y))}u=null,this._dirty=!0},_drawSegments:function(t,i,n,r){if(i=null==i?this._lineWidth:i,n=n||this._drawColor,null==n.a)n.a=255;if(i*=.5,!(0>=i)){var s,o,a,c,l={r:0|n.r,g:0|n.g,b:0|n.b,a:0|n.a},h=[],u=t.length;for(s=0;u>s;s++){o=e.v2(t[(s-1+u)%u]),a=e.v2(t[s]),c=e.v2(t[(s+1)%u]);var d=e.pNormalize(e.pPerp(e.pSub(a,o))),f=e.pNormalize(e.pPerp(e.pSub(c,a))),_=e.pMult(e.pAdd(d,f),1/(e.pDot(d,f)+1));h[s]={offset:_,n:f}}var p=3*u-2,g=3*p;this._ensureCapacity(g);var m=e.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT,v=this._trianglesArrayBuffer,y=this._buffer,T=r?u:u-1;for(s=0;T>s;s++){var C=(s+1)%u;o=e.v2(t[s]),a=e.v2(t[C]);var x=h[s].n,S=h[s].offset,b=h[C].offset,E=e.pSub(o,e.pMult(S,i)),A=e.pSub(a,e.pMult(b,i)),w=e.pAdd(o,e.pMult(S,i)),I=e.pAdd(a,e.pMult(b,i));y.push(new e.V2F_C4B_T2F_Triangle({vertices:E,colors:l,texCoords:O(e.pNeg(x))},{vertices:A,colors:l,texCoords:O(e.pNeg(x))},{vertices:I,colors:l,texCoords:O(x)},v,y.length*m)),y.push(new e.V2F_C4B_T2F_Triangle({vertices:E,colors:l,texCoords:O(e.pNeg(x))},{vertices:w,colors:l,texCoords:O(x)},{vertices:I,colors:l,texCoords:O(x)},v,y.length*m))}h=null,this._dirty=!0}},clear:function(){this._buffer.length=0,this._dirty=!0},_createRenderCmd:function(){return new e.DrawNode.WebGLRenderCmd(this)}})}),e.DrawNode.CanvasRenderCmd=function(t){_ccsg.Node.CanvasRenderCmd.call(this,t),this._needDraw=!0,this._buffer=null,this._drawColor=null,this._blendFunc=null},e.DrawNode.CanvasRenderCmd.prototype=Object.create(_ccsg.Node.CanvasRenderCmd.prototype),e.DrawNode.CanvasRenderCmd.prototype.constructor=e.DrawNode.CanvasRenderCmd,e.js.mixin(e.DrawNode.CanvasRenderCmd.prototype,{rendering:function(t,i,n){var r=t||e._renderContext,s=(r.getContext(),this._node),o=s._displayedOpacity/255;if(0!==o){if(r.setTransform(this._worldTransform,i,n),r.setGlobalAlpha(o),this._blendFunc&&this._blendFunc.src===e.macro.SRC_ALPHA&&this._blendFunc.dst===e.macro.ONE)r.setCompositeOperation("lighter");for(var a=this._buffer,c=0,l=a.length;l>c;c++){var h=a[c];switch(h.type){case e.DrawNode.TYPE_DOT:this._drawDot(r,h,i,n);break;case e.DrawNode.TYPE_SEGMENT:this._drawSegment(r,h,i,n);break;case e.DrawNode.TYPE_POLY:this._drawPoly(r,h,i,n)}}}},_drawDot:function(t,e,i,n){var r=e.fillColor,s=e.verts[0],o=e.lineWidth,a=t.getContext();t.setFillStyle("rgba("+(0|r.r)+","+(0|r.g)+","+(0|r.b)+","+r.a/255+")"),a.beginPath(),a.arc(s.x*i,-s.y*n,o*i,0,2*Math.PI,!1),a.closePath(),a.fill()},_drawSegment:function(t,e,i,n){var r=e.lineColor,s=e.verts[0],o=e.verts[1],a=e.lineWidth,c=e.lineCap,l=t.getContext();t.setStrokeStyle("rgba("+(0|r.r)+","+(0|r.g)+","+(0|r.b)+","+r.a/255+")"),l.lineWidth=a*i,l.beginPath(),l.lineCap=c,l.moveTo(s.x*i,-s.y*n),l.lineTo(o.x*i,-o.y*n),l.stroke()},_drawPoly:function(t,e,i,n){var r=e.verts,s=e.lineCap;if(null!=r){var o=e.fillColor,a=e.lineWidth,c=e.lineColor,l=e.isClosePolygon,h=e.isFill,u=e.isStroke,d=t.getContext(),f=r[0];if(d.lineCap=s,o)t.setFillStyle("rgba("+(0|o.r)+","+(0|o.g)+","+(0|o.b)+","+o.a/255+")");if(a)d.lineWidth=a*i;if(c)t.setStrokeStyle("rgba("+(0|c.r)+","+(0|c.g)+","+(0|c.b)+","+c.a/255+")");d.beginPath(),d.moveTo(f.x*i,-f.y*n);for(var _=1,p=r.length;p>_;_++)d.lineTo(r[_].x*i,-r[_].y*n);if(l)d.closePath();if(h)d.fill();if(u)d.stroke()}}}),e.DrawNode.WebGLRenderCmd=function(t){_ccsg.Node.WebGLRenderCmd.call(this,t),this._needDraw=!0},e.DrawNode.WebGLRenderCmd.prototype=Object.create(_ccsg.Node.WebGLRenderCmd.prototype),e.DrawNode.WebGLRenderCmd.prototype.constructor=e.DrawNode.WebGLRenderCmd,e.DrawNode.WebGLRenderCmd.prototype.rendering=function(t){var i=this._node;e.gl.blendFunc(i._blendFunc.src,i._blendFunc.dst),this._shaderProgram.use(),this._shaderProgram._setUniformForMVPMatrixWithMat4(this._stackMatrix),i._render()},e.ClippingNode=_ccsg.Node.extend({alphaThreshold:0,inverted:!1,_stencil:null,_className:"ClippingNode",ctor:function(t){t=t||null,_ccsg.Node.prototype.ctor.call(this),this._stencil=t,this.alphaThreshold=1,this.inverted=!1,this._renderCmd.initStencilBits()},init:function(t){return this._stencil=t,this.alphaThreshold=1,this.inverted=!1,this._renderCmd.initStencilBits(),!0},onEnter:function(){_ccsg.Node.prototype.onEnter.call(this),this._stencil.onEnter()},onEnterTransitionDidFinish:function(){_ccsg.Node.prototype.onEnterTransitionDidFinish.call(this),this._stencil.onEnterTransitionDidFinish()},onExitTransitionDidStart:function(){this._stencil.onExitTransitionDidStart(),_ccsg.Node.prototype.onExitTransitionDidStart.call(this)},onExit:function(){this._stencil.onExit(),_ccsg.Node.prototype.onExit.call(this)},getAlphaThreshold:function(){return this.alphaThreshold},setAlphaThreshold:function(t){this.alphaThreshold=t},isInverted:function(){return this.inverted},setInverted:function(t){this.inverted=t},getStencil:function(){return this._stencil},setStencil:function(t){if(this._stencil!==t)this._renderCmd.setStencil(t)},_createRenderCmd:function(){if(e._renderType===e.game.RENDER_TYPE_CANVAS)return new e.ClippingNode.CanvasRenderCmd(this);else return new e.ClippingNode.WebGLRenderCmd(this)}}),e.ClippingNode.stencilBits=-1;var _=e.ClippingNode.prototype;e.defineGetterSetter(_,"stencil",_.getStencil,_.setStencil),_.stencil,e.ClippingNode.CanvasRenderCmd=function(t){_ccsg.Node.CanvasRenderCmd.call(this,t),this._needDraw=!1,this._godhelpme=!1,this._clipElemType=!1,this._rendererSaveCmd=new e.CustomRenderCmd(this,this._saveCmdCallback),this._rendererClipCmd=new e.CustomRenderCmd(this,this._clipCmdCallback),this._rendererRestoreCmd=new e.CustomRenderCmd(this,this._restoreCmdCallback)};var l=e.ClippingNode.CanvasRenderCmd.prototype=Object.create(_ccsg.Node.CanvasRenderCmd.prototype);l.constructor=e.ClippingNode.CanvasRenderCmd,l.initStencilBits=function(){},l.setStencil=function(t){if(null!=t)if(this._node._stencil=t,t instanceof e.DrawNode){if(t._buffer)for(var i=0;i<t._buffer.length;i++)t._buffer[i].isFill=!1,t._buffer[i].isStroke=!1;t._renderCmd.rendering=function(i,n,r){n=n||e.view.getScaleX(),r=r||e.view.getScaleY();var s=i||e._renderContext,o=s.getContext(),a=this._transform;o.transform(a.a,a.b,a.c,a.d,a.tx*n,-a.ty*r);for(var c=0;c<t._buffer.length;c++){var l=t._buffer[c].verts,h=l[0];o.moveTo(h.x*n,-h.y*r);for(var u=l.length-1;u>0;u--)o.lineTo(l[u].x*n,-l[u].y*r)}}}else t._parent=this._node},l._saveCmdCallback=function(t,i,n){var r=t||e._renderContext,s=r.getContext();if(this._clipElemType){s.save(),s.globalAlpha=this._displayedOpacity/255;var o=e.ClippingNode.CanvasRenderCmd._getSharedCache(),a=s.canvas;if(o.width!==a.width)o.width=a.width;if(o.height!==a.height)o.height=a.height;var c=o.getContext("2d");c.drawImage(a,0,0)}else if(r.save(),s.beginPath(),r.setTransform(this._worldTransform,i,n),this._node.inverted)s.rect(0,0,s.canvas.width,-s.canvas.height),s.clip()},l._setStencilCompositionOperation=function(t){if(t){var e=this._node;if(t._renderCmd&&t._renderCmd._blendFuncStr)t._renderCmd._blendFuncStr=e.inverted?"destination-out":"destination-in";if(t._children)for(var i=t._children,n=0,r=i.length;r>n;n++)this._setStencilCompositionOperation(i[n])}},l._clipCmdCallback=function(t){var i=this._node,n=t||e._renderContext,r=n.getContext();if(this._clipElemType)this._setStencilCompositionOperation(i._stencil);else r.clip()},l._restoreCmdCallback=function(t){var i=e.ClippingNode.CanvasRenderCmd._getSharedCache(),n=t||e._renderContext,r=n.getContext();if(this._clipElemType)r.save(),r.setTransform(1,0,0,1,0,0),r.globalCompositeOperation="destination-over",r.drawImage(i,0,0),r.restore(),this._dirtyFlag=0,r.restore();else n.restore()},l.transform=function(t,e){_ccsg.Node.CanvasRenderCmd.prototype.transform.call(this,t,e);var i=this._node;if(i._stencil&&i._stencil._renderCmd)i._stencil._renderCmd.transform(this,e)},l._cangodhelpme=function(t){if(t===!0||t===!1)e.ClippingNode.CanvasRenderCmd.prototype._godhelpme=t;return e.ClippingNode.CanvasRenderCmd.prototype._godhelpme},l.visit=function(t){var i=this._node;if(i._visible){if(t=t||this.getParentRenderCmd())this._curLevel=t._curLevel+1;var n=this;if(this._clipElemType=!(!this._cangodhelpme()&&i._stencil instanceof e.DrawNode),i._stencil&&i._stencil.visible){if(this._syncStatus(t),e.renderer.pushRenderCommand(this._rendererSaveCmd),this._clipElemType)_ccsg.Node.CanvasRenderCmd.prototype.visit.call(this,t);else i._stencil.visit(this);if(e.renderer.pushRenderCommand(this._rendererClipCmd),this._clipElemType)i._stencil.visit(n);else{var r,s=i._children;this._cangodhelpme(!0);var o=s.length;if(o>0)for(i.sortAllChildren(),r=0;o>r;r++)s[r]._renderCmd.visit(this);this._cangodhelpme(!1)}e.renderer.pushRenderCommand(this._rendererRestoreCmd),this._dirtyFlag=0}else if(this.inverted)_ccsg.Node.CanvasRenderCmd.prototype.visit.call(this,t)}},e.ClippingNode.CanvasRenderCmd._sharedCache=null,e.ClippingNode.CanvasRenderCmd._getSharedCache=function(){return e.ClippingNode.CanvasRenderCmd._sharedCache||(e.ClippingNode.CanvasRenderCmd._sharedCache=document.createElement("canvas"))},e.ClippingNode.WebGLRenderCmd=function(t){_ccsg.Node.WebGLRenderCmd.call(this,t),this._needDraw=!1,this._beforeVisitCmd=new e.CustomRenderCmd(this,this._onBeforeVisit),this._afterDrawStencilCmd=new e.CustomRenderCmd(this,this._onAfterDrawStencil),this._afterVisitCmd=new e.CustomRenderCmd(this,this._onAfterVisit),this._currentStencilFunc=null,this._currentStencilRef=null,this._currentStencilValueMask=null,this._currentStencilFail=null,this._currentStencilPassDepthFail=null,this._currentStencilPassDepthPass=null,this._currentStencilWriteMask=null,this._currentStencilEnabled=null,this._currentDepthWriteMask=null,this._mask_layer_le=null};var l=e.ClippingNode.WebGLRenderCmd.prototype=Object.create(_ccsg.Node.WebGLRenderCmd.prototype);l.constructor=e.ClippingNode.WebGLRenderCmd,e.ClippingNode.WebGLRenderCmd._init_once=null,e.ClippingNode.WebGLRenderCmd._visit_once=null,e.ClippingNode.WebGLRenderCmd._layer=-1,l.initStencilBits=function(){if(e.ClippingNode.WebGLRenderCmd._init_once=!0,e.ClippingNode.WebGLRenderCmd._init_once){if(e.ClippingNode.stencilBits=e._renderContext.getParameter(e._renderContext.STENCIL_BITS),e.ClippingNode.stencilBits<=0)e.log("Stencil buffer is not enabled.");e.ClippingNode.WebGLRenderCmd._init_once=!1}},l.transform=function(t,e){var i=this._node;if(_ccsg.Node.WebGLRenderCmd.prototype.transform.call(this,t,e),i._stencil)i._stencil._renderCmd.transform(this,e)},l.visit=function(t){var i=this._node;if(i._visible){if(i._parent&&i._parent._renderCmd)this._curLevel=i._parent._renderCmd._curLevel+1;if(e.ClippingNode.stencilBits<1)return void _ccsg.Node.WebGLRenderCmd.prototype.visit.call(this,t);if(i._stencil&&i._stencil.visible){if(e.ClippingNode.WebGLRenderCmd._layer+1===e.ClippingNode.stencilBits){if(e.ClippingNode.WebGLRenderCmd._visit_once=!0,e.ClippingNode.WebGLRenderCmd._visit_once)e.log("Nesting more than "+e.ClippingNode.stencilBits+"stencils is not supported. Everything will be drawn without stencil for this node and its children."),e.ClippingNode.WebGLRenderCmd._visit_once=!1;return void _ccsg.Node.WebGLRenderCmd.prototype.visit.call(this,t)}e.renderer.pushRenderCommand(this._beforeVisitCmd);var n=e.current_stack;n.stack.push(n.top),this._syncStatus(t),n.top=this._stackMatrix,i._stencil._renderCmd.visit(this),e.renderer.pushRenderCommand(this._afterDrawStencilCmd);var r=i._children;if(r&&r.length>0){var s=r.length;i.sortAllChildren();for(var o=0;s>o;o++)r[o]._renderCmd.visit(this)}e.renderer.pushRenderCommand(this._afterVisitCmd),this._dirtyFlag=0,n.top=n.stack.pop()}else if(i.inverted)_ccsg.Node.WebGLRenderCmd.prototype.visit.call(this,t)}},l.setStencil=function(t){var e=this._node;if(e._stencil)e._stencil._parent=null;if(e._stencil=t,e._stencil)e._stencil._parent=e},l._drawFullScreenQuadClearStencil=function(){var t=e.math.projection_matrix_stack;t.push(),t.top.identity();var i=e.math.modelview_matrix_stack;i.push(),i.top.identity(),e._drawingUtil.drawSolidRect(e.p(-1,-1),e.p(1,1),e.color(255,255,255,255)),t.pop(),i.pop()},l._onBeforeVisit=function(t){var i=t||e._renderContext,n=this._node;e.ClippingNode.WebGLRenderCmd._layer++;var r=1<<e.ClippingNode.WebGLRenderCmd._layer,s=r-1;if(this._mask_layer_le=r|s,this._currentStencilEnabled=i.isEnabled(i.STENCIL_TEST),this._currentStencilWriteMask=i.getParameter(i.STENCIL_WRITEMASK),this._currentStencilFunc=i.getParameter(i.STENCIL_FUNC),this._currentStencilRef=i.getParameter(i.STENCIL_REF),this._currentStencilValueMask=i.getParameter(i.STENCIL_VALUE_MASK),this._currentStencilFail=i.getParameter(i.STENCIL_FAIL),this._currentStencilPassDepthFail=i.getParameter(i.STENCIL_PASS_DEPTH_FAIL),this._currentStencilPassDepthPass=i.getParameter(i.STENCIL_PASS_DEPTH_PASS),i.enable(i.STENCIL_TEST),i.stencilMask(r),this._currentDepthWriteMask=i.getParameter(i.DEPTH_WRITEMASK),i.depthMask(!1),i.stencilFunc(i.NEVER,r,r),i.stencilOp(!n.inverted?i.ZERO:i.REPLACE,i.KEEP,i.KEEP),this._drawFullScreenQuadClearStencil(),i.stencilFunc(i.NEVER,r,r),i.stencilOp(!n.inverted?i.REPLACE:i.ZERO,i.KEEP,i.KEEP),n.alphaThreshold<1){var o=e.shaderCache.programForKey(e.macro.SHADER_POSITION_TEXTURECOLORALPHATEST),c=i.getUniformLocation(o.getProgram(),e.macro.UNIFORM_ALPHA_TEST_VALUE_S);e.gl.useProgram(o.getProgram()),o.setUniformLocationWith1f(c,n.alphaThreshold),a(n._stencil,o)}},l._onAfterDrawStencil=function(t){var i=t||e._renderContext;i.depthMask(this._currentDepthWriteMask),i.stencilFunc(i.EQUAL,this._mask_layer_le,this._mask_layer_le),i.stencilOp(i.KEEP,i.KEEP,i.KEEP)},l._onAfterVisit=function(t){var i=t||e._renderContext;if(i.stencilFunc(this._currentStencilFunc,this._currentStencilRef,this._currentStencilValueMask),i.stencilOp(this._currentStencilFail,this._currentStencilPassDepthFail,this._currentStencilPassDepthPass),i.stencilMask(this._currentStencilWriteMask),!this._currentStencilEnabled)i.disable(i.STENCIL_TEST);e.ClippingNode.WebGLRenderCmd._layer--};var I=t("../cocos2d/particle/CCPNGReader"),R=t("../cocos2d/particle/CCTIFFReader");e.Particle=function(t,i,n,r,s,o,a,c,l,h,u,d){this.pos=t?t:e.p(0,0),this.startPos=i?i:e.p(0,0),this.color=n?n:{r:0,g:0,b:0,a:255},this.deltaColor=r?r:{r:0,g:0,b:0,a:255},this.size=s||0,this.deltaSize=o||0,this.rotation=a||0,this.deltaRotation=c||0,this.timeToLive=l||0,this.atlasIndex=h||0,this.modeA=u?u:new e.Particle.ModeA,this.modeB=d?d:new e.Particle.ModeB,this.isChangeColor=!1,this.drawPos=e.p(0,0)},e.Particle.ModeA=function(t,i,n){this.dir=t?t:e.p(0,0),this.radialAccel=i||0,this.tangentialAccel=n||0},e.Particle.ModeB=function(t,e,i,n){this.angle=t||0,this.degreesPerSecond=e||0,this.radius=i||0,this.deltaRadius=n||0},e.Particle.TemporaryPoints=[e.p(),e.p(),e.p(),e.p()],_ccsg.ParticleSystem=_ccsg.Node.extend({_className:"ParticleSystem",_plistFile:"",_elapsed:0,_dontTint:!1,modeA:null,modeB:null,_pointZeroForParticle:e.p(0,0),_particles:null,_emitCounter:0,_particleIdx:0,_batchNode:null,atlasIndex:0,_transformSystemDirty:!1,_allocatedParticles:0,_isActive:!1,particleCount:0,duration:0,_sourcePosition:null,_posVar:null,life:0,lifeVar:0,angle:0,angleVar:0,startSize:0,startSizeVar:0,endSize:0,endSizeVar:0,_startColor:null,_startColorVar:null,_endColor:null,_endColorVar:null,startSpin:0,startSpinVar:0,endSpin:0,endSpinVar:0,emissionRate:0,_totalParticles:0,_texture:null,_blendFunc:null,_opacityModifyRGB:!1,positionType:null,autoRemoveOnFinish:!1,emitterMode:0,_textureLoaded:null,ctor:function(t){if(_ccsg.Node.prototype.ctor.call(this),this.emitterMode=_ccsg.ParticleSystem.Mode.GRAVITY,this.modeA=new _ccsg.ParticleSystem.ModeA,this.modeB=new _ccsg.ParticleSystem.ModeB,this._blendFunc={src:e.macro.BLEND_SRC,dst:e.macro.BLEND_DST},this._particles=[],this._sourcePosition=e.p(0,0),this._posVar=e.p(0,0),this._startColor=e.color(255,255,255,255),this._startColorVar=e.color(255,255,255,255),this._endColor=e.color(255,255,255,255),this._endColorVar=e.color(255,255,255,255),this._plistFile="",this._elapsed=0,this._dontTint=!1,this._pointZeroForParticle=e.p(0,0),this._emitCounter=0,this._particleIdx=0,this._batchNode=null,this.atlasIndex=0,this._transformSystemDirty=!1,this._allocatedParticles=0,this._isActive=!1,this.particleCount=0,this.duration=0,this.life=0,this.lifeVar=0,this.angle=0,this.angleVar=0,this.startSize=0,this.startSizeVar=0,this.endSize=0,this.endSizeVar=0,this.startSpin=0,this.startSpinVar=0,this.endSpin=0,this.endSpinVar=0,this.emissionRate=0,this._totalParticles=0,this._texture=null,this._opacityModifyRGB=!1,this.positionType=_ccsg.ParticleSystem.Type.FREE,this.autoRemoveOnFinish=!1,this._textureLoaded=!0,!t||e.js.isNumber(t)){var i=t||100;this.setDrawMode(_ccsg.ParticleSystem.TEXTURE_MODE),this.initWithTotalParticles(i)}else if(e.js.isString(t))this.initWithFile(t);else if(e.js.isObject(t))this.initWithDictionary(t,"")},_createRenderCmd:function(){if(e._renderType===e.game.RENDER_TYPE_CANVAS)return new _ccsg.ParticleSystem.CanvasRenderCmd(this);else return new _ccsg.ParticleSystem.WebGLRenderCmd(this)},ignoreColor:function(t){this._dontTint=t},initTexCoordsWithRect:function(t){this._renderCmd.initTexCoordsWithRect(t)},getBatchNode:function(){return this._batchNode},setBatchNode:function(t){this._renderCmd.setBatchNode(t)},getAtlasIndex:function(){return this.atlasIndex},setAtlasIndex:function(t){this.atlasIndex=t},getDrawMode:function(){return this._renderCmd.getDrawMode()},setDrawMode:function(t){this._renderCmd.setDrawMode(t)},getShapeType:function(){return this._renderCmd.getShapeType()},setShapeType:function(t){this._renderCmd.setShapeType(t)},isActive:function(){return this._isActive},getParticleCount:function(){return this.particleCount},setParticleCount:function(t){this.particleCount=t},getDuration:function(){return this.duration},setDuration:function(t){this.duration=t},getSourcePosition:function(){return{x:this._sourcePosition.x,y:this._sourcePosition.y}},setSourcePosition:function(t){this._sourcePosition=t},getPosVar:function(){return{x:this._posVar.x,y:this._posVar.y}},setPosVar:function(t){this._posVar=t},getLife:function(){return this.life},setLife:function(t){this.life=t},getLifeVar:function(){return this.lifeVar},setLifeVar:function(t){this.lifeVar=t},getAngle:function(){return this.angle},setAngle:function(t){this.angle=t},getAngleVar:function(){return this.angleVar},setAngleVar:function(t){this.angleVar=t},getGravity:function(){var t=this.modeA.gravity;return e.p(t.x,t.y)},setGravity:function(t){this.modeA.gravity=t},getSpeed:function(){return this.modeA.speed},setSpeed:function(t){this.modeA.speed=t},getSpeedVar:function(){return this.modeA.speedVar},setSpeedVar:function(t){this.modeA.speedVar=t},getTangentialAccel:function(){return this.modeA.tangentialAccel},setTangentialAccel:function(t){this.modeA.tangentialAccel=t},getTangentialAccelVar:function(){return this.modeA.tangentialAccelVar},setTangentialAccelVar:function(t){this.modeA.tangentialAccelVar=t},getRadialAccel:function(){return this.modeA.radialAccel},setRadialAccel:function(t){this.modeA.radialAccel=t},getRadialAccelVar:function(){return this.modeA.radialAccelVar},setRadialAccelVar:function(t){this.modeA.radialAccelVar=t},getRotationIsDir:function(){return this.modeA.rotationIsDir},setRotationIsDir:function(t){this.modeA.rotationIsDir=t},getStartRadius:function(){return this.modeB.startRadius},setStartRadius:function(t){this.modeB.startRadius=t},getStartRadiusVar:function(){return this.modeB.startRadiusVar},setStartRadiusVar:function(t){this.modeB.startRadiusVar=t},getEndRadius:function(){return this.modeB.endRadius},setEndRadius:function(t){this.modeB.endRadius=t},getEndRadiusVar:function(){return this.modeB.endRadiusVar},setEndRadiusVar:function(t){this.modeB.endRadiusVar=t},getRotatePerSecond:function(){return this.modeB.rotatePerSecond},setRotatePerSecond:function(t){this.modeB.rotatePerSecond=t},getRotatePerSecondVar:function(){return this.modeB.rotatePerSecondVar},setRotatePerSecondVar:function(t){this.modeB.rotatePerSecondVar=t},setScale:function(t,e){this._transformSystemDirty=!0,_ccsg.Node.prototype.setScale.call(this,t,e)},setRotation:function(t){this._transformSystemDirty=!0,_ccsg.Node.prototype.setRotation.call(this,t)},setScaleX:function(t){this._transformSystemDirty=!0,_ccsg.Node.prototype.setScaleX.call(this,t)},setScaleY:function(t){this._transformSystemDirty=!0,_ccsg.Node.prototype.setScaleY.call(this,t)},getStartSize:function(){return this.startSize},setStartSize:function(t){this.startSize=t},getStartSizeVar:function(){return this.startSizeVar},setStartSizeVar:function(t){this.startSizeVar=t},getEndSize:function(){return this.endSize},setEndSize:function(t){this.endSize=t},getEndSizeVar:function(){return this.endSizeVar},setEndSizeVar:function(t){this.endSizeVar=t},getStartColor:function(){return e.color(this._startColor.r,this._startColor.g,this._startColor.b,this._startColor.a)},setStartColor:function(t){this._startColor=e.color(t)},getStartColorVar:function(){return e.color(this._startColorVar.r,this._startColorVar.g,this._startColorVar.b,this._startColorVar.a)},setStartColorVar:function(t){this._startColorVar=e.color(t)},getEndColor:function(){return e.color(this._endColor.r,this._endColor.g,this._endColor.b,this._endColor.a)},setEndColor:function(t){this._endColor=e.color(t)},getEndColorVar:function(){return e.color(this._endColorVar.r,this._endColorVar.g,this._endColorVar.b,this._endColorVar.a)},setEndColorVar:function(t){this._endColorVar=e.color(t)},getStartSpin:function(){return this.startSpin},setStartSpin:function(t){this.startSpin=t},getStartSpinVar:function(){return this.startSpinVar},setStartSpinVar:function(t){this.startSpinVar=t},getEndSpin:function(){return this.endSpin},setEndSpin:function(t){this.endSpin=t},getEndSpinVar:function(){return this.endSpinVar},setEndSpinVar:function(t){this.endSpinVar=t},getEmissionRate:function(){return this.emissionRate},setEmissionRate:function(t){this.emissionRate=t},getTotalParticles:function(){return this._totalParticles},setTotalParticles:function(t){this._renderCmd.setTotalParticles(t)},getTexture:function(){return this._texture},setTexture:function(t){if(t)if(t.isLoaded())this.setTextureWithRect(t,e.rect(0,0,t.width,t.height));else this._textureLoaded=!1,t.once("load",function(i){this._textureLoaded=!0,this.setTextureWithRect(t,e.rect(0,0,t.width,t.height))},this)},getBlendFunc:function(){return this._blendFunc},setBlendFunc:function(t,e){if(void 0===e){if(this._blendFunc!==t)this._blendFunc=t,this._updateBlendFunc()}else if(this._blendFunc.src!==t||this._blendFunc.dst!==e)this._blendFunc={src:t,dst:e},this._updateBlendFunc()},isOpacityModifyRGB:function(){return this._opacityModifyRGB},setOpacityModifyRGB:function(t){this._opacityModifyRGB=t},isBlendAdditive:function(){return this._blendFunc.src===e.macro.SRC_ALPHA&&this._blendFunc.dst===e.macro.ONE||this._blendFunc.src===e.macro.ONE&&this._blendFunc.dst===e.macro.ONE},setBlendAdditive:function(t){var i=this._blendFunc;if(t)i.src=e.macro.SRC_ALPHA,i.dst=e.macro.ONE;else this._renderCmd._setBlendAdditive()},getPositionType:function(){return this.positionType},setPositionType:function(t){this.positionType=t},isAutoRemoveOnFinish:function(){return this.autoRemoveOnFinish},setAutoRemoveOnFinish:function(t){this.autoRemoveOnFinish=t},getEmitterMode:function(){return this.emitterMode},setEmitterMode:function(t){this.emitterMode=t},init:function(){return this.initWithTotalParticles(150)},initWithFile:function(t){this._plistFile=t;var i=e.loader.getRes(t);if(!i)return e.log("_ccsg.ParticleSystem.initWithFile(): Particles: file not found"),!1;else return this.initWithDictionary(i,"")},getBoundingBoxToWorld:function(){return e.rect(0,0,e._canvas.width,e._canvas.height)},initWithDictionary:function(t,i){var n=!1,r=null,s=this._valueForKey,o=parseInt(s("maxParticles",t));if(this.initWithTotalParticles(o)){this.angle=parseFloat(s("angle",t)),this.angleVar=parseFloat(s("angleVariance",t)),this.duration=parseFloat(s("duration",t)),this._blendFunc.src=parseInt(s("blendFuncSource",t)),this._blendFunc.dst=parseInt(s("blendFuncDestination",t));var a=this._startColor;a.r=255*parseFloat(s("startColorRed",t)),a.g=255*parseFloat(s("startColorGreen",t)),a.b=255*parseFloat(s("startColorBlue",t)),a.a=255*parseFloat(s("startColorAlpha",t));var c=this._startColorVar;c.r=255*parseFloat(s("startColorVarianceRed",t)),c.g=255*parseFloat(s("startColorVarianceGreen",t)),c.b=255*parseFloat(s("startColorVarianceBlue",t)),c.a=255*parseFloat(s("startColorVarianceAlpha",t));var l=this._endColor;l.r=255*parseFloat(s("finishColorRed",t)),l.g=255*parseFloat(s("finishColorGreen",t)),l.b=255*parseFloat(s("finishColorBlue",t)),l.a=255*parseFloat(s("finishColorAlpha",t));var h=this._endColorVar;if(h.r=255*parseFloat(s("finishColorVarianceRed",t)),h.g=255*parseFloat(s("finishColorVarianceGreen",t)),h.b=255*parseFloat(s("finishColorVarianceBlue",t)),h.a=255*parseFloat(s("finishColorVarianceAlpha",t)),this.startSize=parseFloat(s("startParticleSize",t)),this.startSizeVar=parseFloat(s("startParticleSizeVariance",t)),this.endSize=parseFloat(s("finishParticleSize",t)),this.endSizeVar=parseFloat(s("finishParticleSizeVariance",t)),this.setPosition(parseFloat(s("sourcePositionx",t)),parseFloat(s("sourcePositiony",t))),this._posVar.x=parseFloat(s("sourcePositionVariancex",t)),this._posVar.y=parseFloat(s("sourcePositionVariancey",t)),this.startSpin=parseFloat(s("rotationStart",t)),this.startSpinVar=parseFloat(s("rotationStartVariance",t)),this.endSpin=parseFloat(s("rotationEnd",t)),this.endSpinVar=parseFloat(s("rotationEndVariance",t)),this.emitterMode=parseInt(s("emitterType",t)),this.emitterMode===_ccsg.ParticleSystem.Mode.GRAVITY){var u=this.modeA;u.gravity.x=parseFloat(s("gravityx",t)),u.gravity.y=parseFloat(s("gravityy",t)),u.speed=parseFloat(s("speed",t)),u.speedVar=parseFloat(s("speedVariance",t));var d=s("radialAcceleration",t);u.radialAccel=d?parseFloat(d):0,d=s("radialAccelVariance",t),u.radialAccelVar=d?parseFloat(d):0,d=s("tangentialAcceleration",t),u.tangentialAccel=d?parseFloat(d):0,d=s("tangentialAccelVariance",t),u.tangentialAccelVar=d?parseFloat(d):0;var f=s("rotationIsDir",t).toLowerCase();u.rotationIsDir=null!=f&&("true"===f||"1"===f)}else if(this.emitterMode===_ccsg.ParticleSystem.Mode.RADIUS){var _=this.modeB;_.startRadius=parseFloat(s("maxRadius",t)),_.startRadiusVar=parseFloat(s("maxRadiusVariance",t)),_.endRadius=parseFloat(s("minRadius",t)),_.endRadiusVar=0,_.rotatePerSecond=parseFloat(s("rotatePerSecond",t)),_.rotatePerSecondVar=parseFloat(s("rotatePerSecondVariance",t))}else return e.log("_ccsg.ParticleSystem.initWithDictionary(): Invalid emitterType in config file"),!1;if(this.life=parseFloat(s("particleLifespan",t)),this.lifeVar=parseFloat(s("particleLifespanVariance",t)),this.emissionRate=this._totalParticles/this.life,!this._batchNode){this._opacityModifyRGB=!1;var p=s("textureFileName",t),g=e.path.changeBasename(this._plistFile,p),m=e.textureCache.getTextureForKey(g);if(m)this.setTexture(m);else{var v=s("textureImageData",t);if(!v||0===v.length){if(m=e.textureCache.addImage(g),!m)return!1;this.setTexture(m)}else{if(r=e.Codec.unzipBase64AsArray(v,1),!r)return e.log("_ccsg.ParticleSystem: error decoding or ungzipping textureImageData"),!1;var y=e.getImageFormatByData(r);if(y!==e.ImageFormat.TIFF&&y!==e.ImageFormat.PNG)return e.log("_ccsg.ParticleSystem: unknown image format with Data"),!1;var T=document.createElement("canvas");if(y===e.ImageFormat.PNG){var C=new I(r);C.render(T)}else R.parseTIFF(r,T);e.textureCache.cacheImage(g,T);var x=e.textureCache.getTextureForKey(g);if(!x)e.log("_ccsg.ParticleSystem.initWithDictionary() : error loading the texture");this.setTexture(x)}}}n=!0}return n},initWithTotalParticles:function(t){this._totalParticles=t;var i,n=this._particles;for(n.length=0,i=0;t>i;i++)n[i]=new e.Particle;if(!n)return e.log("Particle system: not enough memory"),!1;if(this._allocatedParticles=t,this._batchNode)for(i=0;i<this._totalParticles;i++)n[i].atlasIndex=i;return this._isActive=!0,this._blendFunc.src=e.macro.BLEND_SRC,this._blendFunc.dst=e.macro.BLEND_DST,this.positionType=_ccsg.ParticleSystem.Type.FREE,this.emitterMode=_ccsg.ParticleSystem.Mode.GRAVITY,this.autoRemoveOnFinish=!1,this._transformSystemDirty=!1,this.scheduleUpdateWithPriority(1),this._renderCmd._initWithTotalParticles(t),!0},destroyParticleSystem:function(){this.unscheduleUpdate()},addParticle:function(){if(this.isFull())return!1;var t=this._renderCmd.addParticle();return this.initParticle(t),++this.particleCount,!0},initParticle:function(t){var i=e.randomMinus1To1;t.timeToLive=this.life+this.lifeVar*i(),t.timeToLive=Math.max(0,t.timeToLive),t.pos.x=this._sourcePosition.x+this._posVar.x*i(),t.pos.y=this._sourcePosition.y+this._posVar.y*i();var n,r,s=this._startColor,o=this._startColorVar,a=this._endColor,c=this._endColorVar;n={r:e.clampf(s.r+o.r*i(),0,255),g:e.clampf(s.g+o.g*i(),0,255),b:e.clampf(s.b+o.b*i(),0,255),a:e.clampf(s.a+o.a*i(),0,255)},r={r:e.clampf(a.r+c.r*i(),0,255),g:e.clampf(a.g+c.g*i(),0,255),b:e.clampf(a.b+c.b*i(),0,255),a:e.clampf(a.a+c.a*i(),0,255)},t.color=n;var l=t.deltaColor,h=t.timeToLive;l.r=(r.r-n.r)/h,l.g=(r.g-n.g)/h,l.b=(r.b-n.b)/h,l.a=(r.a-n.a)/h;var u=this.startSize+this.startSizeVar*i();if(u=Math.max(0,u),t.size=u,this.endSize===_ccsg.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE)t.deltaSize=0;else{var d=this.endSize+this.endSizeVar*i();d=Math.max(0,d),t.deltaSize=(d-u)/h}var f=this.startSpin+this.startSpinVar*i(),_=this.endSpin+this.endSpinVar*i();if(t.rotation=f,t.deltaRotation=(_-f)/h,this.positionType===_ccsg.ParticleSystem.Type.FREE)t.startPos=this.convertToWorldSpace(this._pointZeroForParticle);else if(this.positionType===_ccsg.ParticleSystem.Type.RELATIVE)t.startPos.x=this._position.x,t.startPos.y=this._position.y;var p=e.degreesToRadians(this.angle+this.angleVar*i());if(this.emitterMode===_ccsg.ParticleSystem.Mode.GRAVITY){var g=this.modeA,m=t.modeA,v=g.speed+g.speedVar*i();if(m.dir.x=Math.cos(p),m.dir.y=Math.sin(p),e.pMultIn(m.dir,v),m.radialAccel=g.radialAccel+g.radialAccelVar*i(),
m.tangentialAccel=g.tangentialAccel+g.tangentialAccelVar*i(),g.rotationIsDir)t.rotation=-e.radiansToDegrees(e.pToAngle(m.dir))}else{var y=this.modeB,T=t.modeB,C=y.startRadius+y.startRadiusVar*i(),x=y.endRadius+y.endRadiusVar*i();T.radius=C,T.deltaRadius=y.endRadius===_ccsg.ParticleSystem.START_RADIUS_EQUAL_TO_END_RADIUS?0:(x-C)/h,T.angle=p,T.degreesPerSecond=e.degreesToRadians(y.rotatePerSecond+y.rotatePerSecondVar*i())}},stopSystem:function(){this._isActive=!1,this._elapsed=this.duration,this._emitCounter=0},resetSystem:function(){this._isActive=!0,this._elapsed=0;var t=this._particles;for(this._particleIdx=0;this._particleIdx<this.particleCount;++this._particleIdx)t[this._particleIdx].timeToLive=0},isFull:function(){return this.particleCount>=this._totalParticles},updateQuadWithParticle:function(t,e){this._renderCmd.updateQuadWithParticle(t,e)},postStep:function(){this._renderCmd.postStep()},update:function(t){if(this._isActive&&this.emissionRate){var i=1/this.emissionRate;if(this.particleCount<this._totalParticles)this._emitCounter+=t;for(;this.particleCount<this._totalParticles&&this._emitCounter>i;)this.addParticle(),this._emitCounter-=i;if(this._elapsed+=t,-1!==this.duration&&this.duration<this._elapsed)this.stopSystem()}this._particleIdx=0;var n=e.Particle.TemporaryPoints[0];if(this.positionType===_ccsg.ParticleSystem.Type.FREE)e.pIn(n,this.convertToWorldSpace(this._pointZeroForParticle));else if(this.positionType===_ccsg.ParticleSystem.Type.RELATIVE)n.x=this._position.x,n.y=this._position.y;if(this._visible){for(var r=e.Particle.TemporaryPoints[1],s=e.Particle.TemporaryPoints[2],o=e.Particle.TemporaryPoints[3],a=this._particles;this._particleIdx<this.particleCount;){e.pZeroIn(r),e.pZeroIn(s),e.pZeroIn(o);var c=a[this._particleIdx];if(c.timeToLive-=t,c.timeToLive>0){if(this.emitterMode===_ccsg.ParticleSystem.Mode.GRAVITY){var l=o,h=r,u=s;if(c.pos.x||c.pos.y)e.pIn(h,c.pos),e.pNormalizeIn(h);else e.pZeroIn(h);e.pIn(u,h),e.pMultIn(h,c.modeA.radialAccel);var d=u.x;u.x=-u.y,u.y=d,e.pMultIn(u,c.modeA.tangentialAccel),e.pIn(l,h),e.pAddIn(l,u),e.pAddIn(l,this.modeA.gravity),e.pMultIn(l,t),e.pAddIn(c.modeA.dir,l),e.pIn(l,c.modeA.dir),e.pMultIn(l,t),e.pAddIn(c.pos,l)}else{var f=c.modeB;f.angle+=f.degreesPerSecond*t,f.radius+=f.deltaRadius*t,c.pos.x=-Math.cos(f.angle)*f.radius,c.pos.y=-Math.sin(f.angle)*f.radius}this._renderCmd._updateDeltaColor(c,t),c.size+=c.deltaSize*t,c.size=Math.max(0,c.size),c.rotation+=c.deltaRotation*t;var _=r;if(this.positionType===_ccsg.ParticleSystem.Type.FREE||this.positionType===_ccsg.ParticleSystem.Type.RELATIVE){var p=s;e.pIn(p,n),e.pSubIn(p,c.startPos),e.pIn(_,c.pos),e.pSubIn(_,p)}else e.pIn(_,c.pos);if(this._batchNode)_.x+=this._position.x,_.y+=this._position.y;this._renderCmd.updateParticlePosition(c,_),++this._particleIdx}else{var g=c.atlasIndex;if(this._particleIdx!==this.particleCount-1){var m=a[this._particleIdx];a[this._particleIdx]=a[this.particleCount-1],a[this.particleCount-1]=m}if(this._batchNode)this._batchNode.disableParticle(this.atlasIndex+g),a[this.particleCount-1].atlasIndex=g;if(--this.particleCount,0===this.particleCount&&this.autoRemoveOnFinish)return this.unscheduleUpdate(),void this._parent.removeChild(this,!0)}}this._transformSystemDirty=!1}if(!this._batchNode)this.postStep()},updateWithNoTime:function(){this.update(0)},_valueForKey:function(t,e){if(e){var i=e[t];return null!=i?i:""}return""},_updateBlendFunc:function(){if(this._batchNode)return void e.log("Can't change blending functions when the particle is being batched");var t=this._texture;if(t&&t instanceof e.Texture2D){this._opacityModifyRGB=!1;var i=this._blendFunc;if(i.src===e.macro.BLEND_SRC&&i.dst===e.macro.BLEND_DST)if(t.hasPremultipliedAlpha())this._opacityModifyRGB=!0;else i.src=e.macro.SRC_ALPHA,i.dst=e.macro.ONE_MINUS_SRC_ALPHA}},clone:function(){var t=new _ccsg.ParticleSystem;if(t.initWithTotalParticles(this.getTotalParticles())){t.setAngle(this.getAngle()),t.setAngleVar(this.getAngleVar()),t.setDuration(this.getDuration());var i=this.getBlendFunc();if(t.setBlendFunc(i.src,i.dst),t.setStartColor(this.getStartColor()),t.setStartColorVar(this.getStartColorVar()),t.setEndColor(this.getEndColor()),t.setEndColorVar(this.getEndColorVar()),t.setStartSize(this.getStartSize()),t.setStartSizeVar(this.getStartSizeVar()),t.setEndSize(this.getEndSize()),t.setEndSizeVar(this.getEndSizeVar()),t.setPosition(e.p(this.x,this.y)),t.setPosVar(e.p(this.getPosVar().x,this.getPosVar().y)),t.setPositionType(this.getPositionType()),t.setStartSpin(this.getStartSpin()||0),t.setStartSpinVar(this.getStartSpinVar()||0),t.setEndSpin(this.getEndSpin()||0),t.setEndSpinVar(this.getEndSpinVar()||0),t.setEmitterMode(this.getEmitterMode()),this.getEmitterMode()===_ccsg.ParticleSystem.Mode.GRAVITY){var n=this.getGravity();t.setGravity(e.p(n.x,n.y)),t.setSpeed(this.getSpeed()),t.setSpeedVar(this.getSpeedVar()),t.setRadialAccel(this.getRadialAccel()),t.setRadialAccelVar(this.getRadialAccelVar()),t.setTangentialAccel(this.getTangentialAccel()),t.setTangentialAccelVar(this.getTangentialAccelVar())}else if(this.getEmitterMode()===_ccsg.ParticleSystem.Mode.RADIUS)t.setStartRadius(this.getStartRadius()),t.setStartRadiusVar(this.getStartRadiusVar()),t.setEndRadius(this.getEndRadius()),t.setEndRadiusVar(this.getEndRadiusVar()),t.setRotatePerSecond(this.getRotatePerSecond()),t.setRotatePerSecondVar(this.getRotatePerSecondVar());if(t.setLife(this.getLife()),t.setLifeVar(this.getLifeVar()),t.setEmissionRate(this.getEmissionRate()),!this.getBatchNode()){t.setOpacityModifyRGB(this.isOpacityModifyRGB());var r=this.getTexture();if(r){var s=r.getContentSize();t.setTextureWithRect(r,e.rect(0,0,s.width,s.height))}}}return t},setDisplayFrame:function(t){if(t){var i=t.getOffset();if(0!==i.x||0!==i.y)e.log("_ccsg.ParticleSystem.setDisplayFrame(): QuadParticle only supports SpriteFrames with no offsets");var n=t.getTexture(),r=this._texture;if(r!==n)this.setTexture(n)}},setTextureWithRect:function(t,e){var i=this._texture;if(i!==t)this._texture=t,this._updateBlendFunc();this.initTexCoordsWithRect(e)},listenBackToForeground:function(t){}});var _=_ccsg.ParticleSystem.prototype;_.opacityModifyRGB,e.defineGetterSetter(_,"opacityModifyRGB",_.isOpacityModifyRGB,_.setOpacityModifyRGB),_.batchNode,e.defineGetterSetter(_,"batchNode",_.getBatchNode,_.setBatchNode),_.drawMode,e.defineGetterSetter(_,"drawMode",_.getDrawMode,_.setDrawMode),_.shapeType,e.defineGetterSetter(_,"shapeType",_.getShapeType,_.setShapeType),_.active,e.defineGetterSetter(_,"active",_.isActive),_.sourcePos,e.defineGetterSetter(_,"sourcePos",_.getSourcePosition,_.setSourcePosition),_.posVar,e.defineGetterSetter(_,"posVar",_.getPosVar,_.setPosVar),_.gravity,e.defineGetterSetter(_,"gravity",_.getGravity,_.setGravity),_.speed,e.defineGetterSetter(_,"speed",_.getSpeed,_.setSpeed),_.speedVar,e.defineGetterSetter(_,"speedVar",_.getSpeedVar,_.setSpeedVar),_.tangentialAccel,e.defineGetterSetter(_,"tangentialAccel",_.getTangentialAccel,_.setTangentialAccel),_.tangentialAccelVar,e.defineGetterSetter(_,"tangentialAccelVar",_.getTangentialAccelVar,_.setTangentialAccelVar),_.radialAccel,e.defineGetterSetter(_,"radialAccel",_.getRadialAccel,_.setRadialAccel),_.radialAccelVar,e.defineGetterSetter(_,"radialAccelVar",_.getRadialAccelVar,_.setRadialAccelVar),_.rotationIsDir,e.defineGetterSetter(_,"rotationIsDir",_.getRotationIsDir,_.setRotationIsDir),_.startRadius,e.defineGetterSetter(_,"startRadius",_.getStartRadius,_.setStartRadius),_.startRadiusVar,e.defineGetterSetter(_,"startRadiusVar",_.getStartRadiusVar,_.setStartRadiusVar),_.endRadius,e.defineGetterSetter(_,"endRadius",_.getEndRadius,_.setEndRadius),_.endRadiusVar,e.defineGetterSetter(_,"endRadiusVar",_.getEndRadiusVar,_.setEndRadiusVar),_.rotatePerS,e.defineGetterSetter(_,"rotatePerS",_.getRotatePerSecond,_.setRotatePerSecond),_.rotatePerSVar,e.defineGetterSetter(_,"rotatePerSVar",_.getRotatePerSecondVar,_.setRotatePerSecondVar),_.startColor,e.defineGetterSetter(_,"startColor",_.getStartColor,_.setStartColor),_.startColorVar,e.defineGetterSetter(_,"startColorVar",_.getStartColorVar,_.setStartColorVar),_.endColor,e.defineGetterSetter(_,"endColor",_.getEndColor,_.setEndColor),_.endColorVar,e.defineGetterSetter(_,"endColorVar",_.getEndColorVar,_.setEndColorVar),_.totalParticles,e.defineGetterSetter(_,"totalParticles",_.getTotalParticles,_.setTotalParticles),_.texture,e.defineGetterSetter(_,"texture",_.getTexture,_.setTexture),_ccsg.ParticleSystem.ModeA=function(t,i,n,r,s,o,a,c){this.gravity=t?t:e.p(0,0),this.speed=i||0,this.speedVar=n||0,this.tangentialAccel=r||0,this.tangentialAccelVar=s||0,this.radialAccel=o||0,this.radialAccelVar=a||0,this.rotationIsDir=c||!1},_ccsg.ParticleSystem.ModeB=function(t,e,i,n,r,s){this.startRadius=t||0,this.startRadiusVar=e||0,this.endRadius=i||0,this.endRadiusVar=n||0,this.rotatePerSecond=r||0,this.rotatePerSecondVar=s||0},_ccsg.ParticleSystem.SHAPE_MODE=0,_ccsg.ParticleSystem.TEXTURE_MODE=1,_ccsg.ParticleSystem.STAR_SHAPE=0,_ccsg.ParticleSystem.BALL_SHAPE=1,_ccsg.ParticleSystem.DURATION_INFINITY=-1,_ccsg.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE=-1,_ccsg.ParticleSystem.START_RADIUS_EQUAL_TO_END_RADIUS=-1,_ccsg.ParticleSystem.Mode=e.Enum({GRAVITY:0,RADIUS:1}),_ccsg.ParticleSystem.Type=e.Enum({FREE:0,RELATIVE:1,GROUPED:2}),_ccsg.ParticleSystem.CanvasRenderCmd=function(t){_ccsg.Node.CanvasRenderCmd.call(this,t),this._needDraw=!0,this._drawMode=_ccsg.ParticleSystem.TEXTURE_MODE,this._shapeType=_ccsg.ParticleSystem.BALL_SHAPE,this._pointRect=e.rect(0,0,0,0),this._tintCache=document.createElement("canvas")};var l=_ccsg.ParticleSystem.CanvasRenderCmd.prototype=Object.create(_ccsg.Node.CanvasRenderCmd.prototype);l.constructor=_ccsg.ParticleSystem.CanvasRenderCmd,l.getDrawMode=function(){return this._drawMode},l.setDrawMode=function(t){this._drawMode=t},l.getShapeType=function(){return this._shapeType},l.setShapeType=function(t){this._shapeType=t},l.setBatchNode=function(t){if(this._batchNode!==t)this._node._batchNode=t},l.updateQuadWithParticle=function(t,e){},l.updateParticlePosition=function(t,i){e.pIn(t.drawPos,i)},l.rendering=function(t,i,n){var r=t||e._renderContext,s=r.getContext(),o=this._node,a=this._pointRect;if(r.setTransform(this._worldTransform,i,n),r.save(),o.isBlendAdditive())s.globalCompositeOperation="lighter";else s.globalCompositeOperation="source-over";var c,l,h,u,d=this._node.particleCount,f=this._node._particles;if(o.drawMode!==_ccsg.ParticleSystem.SHAPE_MODE&&o._texture){if(!o._texture._textureLoaded)return void r.restore();var _=o._texture.getHtmlElementObj();if(!_.width||!_.height)return void r.restore();var p=_;for(c=0;d>c;c++)if(l=f[c],h=0|.5*l.size,u=l.color.a/255,0!==u){s.globalAlpha=u,s.save(),s.translate(0|l.drawPos.x,-(0|l.drawPos.y));var g=4*Math.floor(l.size/4),m=a.width,v=a.height;if(s.scale(Math.max(1/m*g,1e-6),Math.max(1/v*g,1e-6)),l.rotation)s.rotate(e.degreesToRadians(l.rotation));p=l.isChangeColor?this._changeTextureColor(o._texture,l.color,this._pointRect):_,s.drawImage(p,-(0|m/2),-(0|v/2)),s.restore()}else;}else{var y=e._drawingUtil;for(c=0;d>c;c++)if(l=f[c],h=0|.5*l.size,u=l.color.a/255,0!==u){if(s.globalAlpha=u,s.save(),s.translate(0|l.drawPos.x,-(0|l.drawPos.y)),o.shapeType===_ccsg.ParticleSystem.STAR_SHAPE){if(l.rotation)s.rotate(e.degreesToRadians(l.rotation));y.drawStar(r,h,l.color)}else y.drawColorBall(r,h,l.color);s.restore()}else;}r.restore(),e.g_NumberOfDraws++},l._changeTextureColor=function(t,e,i){var n=this._tintCache,r=t.getContentSize();return n.width=r.width,n.height=r.height,t._generateColorTexture(e.r,e.g,e.b,i,n)},l.initTexCoordsWithRect=function(t){this._pointRect=t},l.setTotalParticles=function(t){this._node._totalParticles=200>t?t:200},l.addParticle=function(){var t,i=this._node,n=i._particles;if(i.particleCount<n.length)t=n[i.particleCount];else t=new e.Particle,n.push(t);return t},l._setupVBO=function(){},l._allocMemory=function(){return!0},l.postStep=function(){},l._setBlendAdditive=function(){var t=this._node._blendFunc;t.src=e.macro.BLEND_SRC,t.dst=e.macro.BLEND_DST},l._initWithTotalParticles=function(t){},l._updateDeltaColor=function(t,e){if(!this._node._dontTint)t.color.r+=t.deltaColor.r*e,t.color.g+=t.deltaColor.g*e,t.color.b+=t.deltaColor.b*e,t.color.a+=t.deltaColor.a*e,t.isChangeColor=!0},_ccsg.ParticleSystem.WebGLRenderCmd=function(t){_ccsg.Node.WebGLRenderCmd.call(this,t),this._needDraw=!0,this._buffersVBO=[0,0],this._quads=[],this._indices=[],this._quadsArrayBuffer=null};var l=_ccsg.ParticleSystem.WebGLRenderCmd.prototype=Object.create(_ccsg.Node.WebGLRenderCmd.prototype);l.constructor=_ccsg.ParticleSystem.WebGLRenderCmd,l.getDrawMode=function(){},l.setDrawMode=function(t){},l.getShapeType=function(){},l.setShapeType=function(t){},l.setBatchNode=function(t){var i=this._node;if(i._batchNode!==t){var n=i._batchNode;if(i._batchNode=t,t)for(var r=i._particles,s=0;s<i._totalParticles;s++)r[s].atlasIndex=s;if(!t)this._allocMemory(),this.initIndices(i._totalParticles),i.setTexture(n.getTexture()),this._setupVBO();else if(!n)i._batchNode.textureAtlas._copyQuadsToTextureAtlas(this._quads,i.atlasIndex),e._renderContext.deleteBuffer(this._buffersVBO[1])}},l.initIndices=function(t){for(var e=this._indices,i=0,n=t;n>i;++i){var r=6*i,s=4*i;e[r+0]=s+0,e[r+1]=s+1,e[r+2]=s+2,e[r+5]=s+1,e[r+4]=s+2,e[r+3]=s+3}},l.isDifferentTexture=function(t,e){return t===e},l.updateParticlePosition=function(t,e){this.updateQuadWithParticle(t,e)},l.updateQuadWithParticle=function(t,i){var n=null,r=this._node;if(r._batchNode){var s=r._batchNode.textureAtlas.quads;n=s[r.atlasIndex+t.atlasIndex],r._batchNode.textureAtlas.dirty=!0}else n=this._quads[r._particleIdx];var o,a,c,l;if(r._opacityModifyRGB)o=0|t.color.r*t.color.a/255,a=0|t.color.g*t.color.a/255,c=0|t.color.b*t.color.a/255;else o=0|t.color.r,a=0|t.color.g,c=0|t.color.b;l=0|t.color.a;var h=n.bl.colors,u=n.br.colors,d=n.tl.colors,f=n.tr.colors;h.r=u.r=d.r=f.r=o,h.g=u.g=d.g=f.g=a,h.b=u.b=d.b=f.b=c,h.a=u.a=d.a=f.a=l;var _=t.size/2;if(t.rotation){var p=-_,g=-_,m=_,v=_,y=i.x,T=i.y,C=-e.degreesToRadians(t.rotation),x=Math.cos(C),S=Math.sin(C),b=p*x-g*S+y,E=p*S+g*x+T,A=m*x-g*S+y,w=m*S+g*x+T,O=m*x-v*S+y,I=m*S+v*x+T,R=p*x-v*S+y,P=p*S+v*x+T;n.bl.vertices.x=b,n.bl.vertices.y=E,n.br.vertices.x=A,n.br.vertices.y=w,n.tl.vertices.x=R,n.tl.vertices.y=P,n.tr.vertices.x=O,n.tr.vertices.y=I}else n.bl.vertices.x=i.x-_,n.bl.vertices.y=i.y-_,n.br.vertices.x=i.x+_,n.br.vertices.y=i.y-_,n.tl.vertices.x=i.x-_,n.tl.vertices.y=i.y+_,n.tr.vertices.x=i.x+_,n.tr.vertices.y=i.y+_},l.rendering=function(t){var i=this._node;if(i._texture){var n=t||e._renderContext;this._shaderProgram.use(),this._shaderProgram._setUniformForMVPMatrixWithMat4(this._stackMatrix),e.gl.bindTexture2D(i._texture),e.gl.blendFuncForParticle(i._blendFunc.src,i._blendFunc.dst),e.gl.enableVertexAttribs(e.macro.VERTEX_ATTRIB_FLAG_POS_COLOR_TEX),n.bindBuffer(n.ARRAY_BUFFER,this._buffersVBO[0]),n.vertexAttribPointer(e.macro.VERTEX_ATTRIB_POSITION,3,n.FLOAT,!1,24,0),n.vertexAttribPointer(e.macro.VERTEX_ATTRIB_COLOR,4,n.UNSIGNED_BYTE,!0,24,12),n.vertexAttribPointer(e.macro.VERTEX_ATTRIB_TEX_COORDS,2,n.FLOAT,!1,24,16),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this._buffersVBO[1]),n.drawElements(n.TRIANGLES,6*i._particleIdx,n.UNSIGNED_SHORT,0)}},l.initTexCoordsWithRect=function(t){var i=this._node,n=i.texture,r=t.width,s=t.height;if(n)r=n.getPixelWidth(),s=n.getPixelHeight();var o,a,c,l;if(e.macro.FIX_ARTIFACTS_BY_STRECHING_TEXEL)o=(2*t.x+1)/(2*r),a=(2*t.y+1)/(2*s),c=o+(2*t.width-2)/(2*r),l=a+(2*t.height-2)/(2*s);else o=t.x/r,a=t.y/s,c=o+t.width/r,l=a+t.height/s;var h=l;l=a,a=h;var u,d=0,f=0;if(i._batchNode)u=i._batchNode.textureAtlas.quads,d=i.atlasIndex,f=i.atlasIndex+i._totalParticles;else u=this._quads,d=0,f=i._totalParticles;for(var _=d;f>_;_++){if(!u[_])u[_]=e.V3F_C4B_T2F_QuadZero();var p=u[_];p.bl.texCoords.u=o,p.bl.texCoords.v=a,p.br.texCoords.u=c,p.br.texCoords.v=a,p.tl.texCoords.u=o,p.tl.texCoords.v=l,p.tr.texCoords.u=c,p.tr.texCoords.v=l}},l.setTotalParticles=function(t){var i=this._node;if(t>i._allocatedParticles){var n=e.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT;this._indices=new Uint16Array(6*t);var r=new ArrayBuffer(t*n),s=i._particles;s.length=0;var o=this._quads;o.length=0;for(var a=0;t>a;a++)s[a]=new e.Particle,o[a]=new e.V3F_C4B_T2F_Quad(null,null,null,null,r,a*n);if(i._allocatedParticles=t,i._totalParticles=t,i._batchNode)for(var c=0;t>c;c++)s[c].atlasIndex=c;if(this._quadsArrayBuffer=r,this.initIndices(t),this._setupVBO(),i._texture)this.initTexCoordsWithRect(e.rect(0,0,i._texture.width,i._texture.height))}else i._totalParticles=t;i.resetSystem()},l.addParticle=function(){var t=this._node,e=t._particles;return e[t.particleCount]},l._setupVBO=function(){var t=e._renderContext;this._buffersVBO[0]=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this._buffersVBO[0]),t.bufferData(t.ARRAY_BUFFER,this._quadsArrayBuffer,t.DYNAMIC_DRAW),this._buffersVBO[1]=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._buffersVBO[1]),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this._indices,t.STATIC_DRAW)},l._allocMemory=function(){var t=this._node;if(t._batchNode)return e.log("_ccsg.ParticleSystem._allocMemory(): Memory should not be allocated when not using batchNode"),!1;var i=e.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,n=t._totalParticles,r=this._quads;r.length=0,this._indices=new Uint16Array(6*n);for(var s=new ArrayBuffer(i*n),o=0;n>o;o++)r[o]=new e.V3F_C4B_T2F_Quad(null,null,null,null,s,o*i);if(!r||!this._indices)return e.log("cocos2d: Particle system: not enough memory"),!1;else return this._quadsArrayBuffer=s,!0},l.postStep=function(){var t=e._renderContext;t.bindBuffer(t.ARRAY_BUFFER,this._buffersVBO[0]),t.bufferData(t.ARRAY_BUFFER,this._quadsArrayBuffer,t.DYNAMIC_DRAW)},l._setBlendAdditive=function(){var t=this._node._blendFunc;if(this._texture&&!this._texture.hasPremultipliedAlpha())t.src=e.macro.SRC_ALPHA,t.dst=e.macro.ONE_MINUS_SRC_ALPHA;else t.src=e.macro.BLEND_SRC,t.dst=e.macro.BLEND_DST},l._initWithTotalParticles=function(t){if(!this._allocMemory())return!1;else return this.initIndices(t),this._setupVBO(),void(this._shaderProgram=e.shaderCache.programForKey(e.macro.SHADER_POSITION_TEXTURECOLOR))},l._updateDeltaColor=function(t,e){t.color.r+=t.deltaColor.r*e,t.color.g+=t.deltaColor.g*e,t.color.b+=t.deltaColor.b*e,t.color.a+=t.deltaColor.a*e,t.isChangeColor=!0},e.ParticleBatchNode=_ccsg.Node.extend({textureAtlas:null,_blendFunc:null,_className:"ParticleBatchNode",ctor:function(t,i){if(_ccsg.Node.prototype.ctor.call(this),this._blendFunc={src:e.macro.BLEND_SRC,dst:e.macro.BLEND_DST},e.js.isString(t))this.init(t,i);else if(t instanceof e.Texture2D)this.initWithTexture(t,i)},_createRenderCmd:function(){if(e._renderType===e.game.RENDER_TYPE_CANVAS)return new e.ParticleBatchNode.CanvasRenderCmd(this);else return new e.ParticleBatchNode.WebGLRenderCmd(this)},initWithTexture:function(t,i){return this.textureAtlas=new e.TextureAtlas,this.textureAtlas.initWithTexture(t,i),this._children.length=0,this._renderCmd._initWithTexture(),!0},initWithFile:function(t,i){var n=e.textureCache.addImage(t);return this.initWithTexture(n,i)},init:function(t,i){var n=e.textureCache.addImage(t);return this.initWithTexture(n,i)},addChild:function(t,i,n){if(!t)throw new Error("cc.ParticleBatchNode.addChild() : child should be non-null");if(!(t instanceof _ccsg.ParticleSystem))throw new Error("cc.ParticleBatchNode.addChild() : only supports _ccsg.ParticleSystem as children");if(i=null==i?t.zIndex:i,n=null==n?t.tag:n,t.getTexture()!==this.textureAtlas.texture)throw new Error("_ccsg.ParticleSystem.addChild() : the child is not using the same texture id");var r=t.getBlendFunc();if(0===this._children.length)this.setBlendFunc(r);else if(r.src!==this._blendFunc.src||r.dst!==this._blendFunc.dst)return void e.log("_ccsg.ParticleSystem.addChild() : Can't add a ParticleSystem that uses a different blending function");var s=this._addChildHelper(t,i,n),o=0;if(0!==s){var a=this._children[s-1];o=a.getAtlasIndex()+a.getTotalParticles()}else o=0;this.insertChild(t,o),t.setBatchNode(this)},insertChild:function(t,e){var i=t.getTotalParticles(),n=this.textureAtlas,r=n.totalQuads;if(t.setAtlasIndex(e),r+i>n.getCapacity())this._increaseAtlasCapacityTo(r+i),n.fillWithEmptyQuadsFromIndex(n.getCapacity()-i,i);if(t.getAtlasIndex()+i!==r)n.moveQuadsFromIndex(e,e+i);n.increaseTotalQuadsWith(i),this._updateAllAtlasIndexes()},removeChild:function(t,i){if(null!=t){if(!(t instanceof _ccsg.ParticleSystem))throw new Error("cc.ParticleBatchNode.removeChild(): only supports _ccsg.ParticleSystem as children");if(-1===this._children.indexOf(t))return void e.log("cc.ParticleBatchNode.removeChild(): doesn't contain the sprite. Can't remove it");_ccsg.Node.prototype.removeChild.call(this,t,i);var n=this.textureAtlas;n.removeQuadsAtIndex(t.getAtlasIndex(),t.getTotalParticles()),n.fillWithEmptyQuadsFromIndex(n.totalQuads,t.getTotalParticles()),t.setBatchNode(null),this._updateAllAtlasIndexes()}},reorderChild:function(t,i){if(!t)throw new Error("cc.ParticleBatchNode.reorderChild(): child should be non-null");if(!(t instanceof _ccsg.ParticleSystem))throw new Error("cc.ParticleBatchNode.reorderChild(): only supports cc.QuadParticleSystems as children");if(-1===this._children.indexOf(t))return void e.log("cc.ParticleBatchNode.reorderChild(): Child doesn't belong to batch");if(i!==t.zIndex){if(this._children.length>1){var n=this._getCurrentIndex(t,i);if(n.oldIndex!==n.newIndex){this._children.splice(n.oldIndex,1),this._children.splice(n.newIndex,0,t);var r=t.getAtlasIndex();this._updateAllAtlasIndexes();for(var s=0,o=this._children,a=0;a<o.length;a++){var c=o[a];if(c===t){s=t.getAtlasIndex();break}}this.textureAtlas.moveQuadsFromIndex(r,t.getTotalParticles(),s),t.updateWithNoTime()}}t._setLocalZOrder(i)}},removeChildAtIndex:function(t,e){this.removeChild(this._children[i],e)},removeAllChildren:function(t){for(var e=this._children,i=0;i<e.length;i++)e[i].setBatchNode(null);_ccsg.Node.prototype.removeAllChildren.call(this,t),this.textureAtlas.removeAllQuads()},disableParticle:function(t){var e=this.textureAtlas.quads[t];e.br.vertices.x=e.br.vertices.y=e.tr.vertices.x=e.tr.vertices.y=e.tl.vertices.x=e.tl.vertices.y=e.bl.vertices.x=e.bl.vertices.y=0,this.textureAtlas._setDirty(!0)},getTexture:function(){return this.textureAtlas.texture},setTexture:function(t){this.textureAtlas.texture=t;var i=this._blendFunc;if(t&&!t.hasPremultipliedAlpha()&&i.src===e.macro.BLEND_SRC&&i.dst===e.macro.BLEND_DST)i.src=e.macro.SRC_ALPHA,i.dst=e.macro.ONE_MINUS_SRC_ALPHA},setBlendFunc:function(t,e){if(void 0===e)this._blendFunc.src=t.src,this._blendFunc.dst=t.dst;else this._blendFunc.src=t,this._blendFunc.src=e},getBlendFunc:function(){return new e.BlendFunc(this._blendFunc.src,this._blendFunc.dst)},_updateAllAtlasIndexes:function(){for(var t=0,e=this._children,i=0;i<e.length;i++){var n=e[i];n.setAtlasIndex(t),t+=n.getTotalParticles()}},_increaseAtlasCapacityTo:function(t){if(e.log("cocos2d: cc.ParticleBatchNode: resizing TextureAtlas capacity from ["+this.textureAtlas.getCapacity()+"] to ["+t+"]."),!this.textureAtlas.resizeCapacity(t))e.log("cc.ParticleBatchNode._increaseAtlasCapacityTo() : WARNING: Not enough memory to resize the atlas")},_searchNewPositionInChildrenForZ:function(t){for(var e=this._children,i=e.length,n=0;i>n;n++)if(e[n].zIndex>t)return n;return i},_getCurrentIndex:function(t,e){for(var i=!1,n=!1,r=0,s=0,o=0,a=this._children,c=a.length,l=0;c>l;l++){var h=a[l];if(h.zIndex>e&&!n)if(r=l,n=!0,i&&n)break;if(t===h){if(s=l,i=!0,!n)o=-1;if(i&&n)break}}if(!n)r=c;return r+=o,{newIndex:r,oldIndex:s}},_addChildHelper:function(t,i,n){if(!t)throw new Error("cc.ParticleBatchNode._addChildHelper(): child should be non-null");if(t.parent)return e.log("cc.ParticleBatchNode._addChildHelper(): child already added. It can't be added again"),null;if(!this._children)this._children=[];var r=this._searchNewPositionInChildrenForZ(i);if(this._children.splice(r,0,t),t.tag=n,t._setLocalZOrder(i),t.parent=this,this._running)t.onEnter(),t.onEnterTransitionDidFinish();return r},_updateBlendFunc:function(){if(!this.textureAtlas.texture.hasPremultipliedAlpha())this._blendFunc.src=e.macro.SRC_ALPHA,this._blendFunc.dst=e.macro.ONE_MINUS_SRC_ALPHA},getTextureAtlas:function(){return this.textureAtlas},setTextureAtlas:function(t){this.textureAtlas=t}});var _=e.ParticleBatchNode.prototype;_.texture,e.defineGetterSetter(_,"texture",_.getTexture,_.setTexture),e.ParticleBatchNode.CanvasRenderCmd=function(t){_ccsg.Node.CanvasRenderCmd.call(this,t),this._needDraw=!1};var l=e.ParticleBatchNode.CanvasRenderCmd.prototype=Object.create(_ccsg.Node.CanvasRenderCmd.prototype);l.constructor=e.ParticleBatchNode.CanvasRenderCmd,l._initWithTexture=function(){},e.ParticleBatchNode.WebGLRenderCmd=function(t){_ccsg.Node.WebGLRenderCmd.call(this,t),this._needDraw=!0};var l=e.ParticleBatchNode.WebGLRenderCmd.prototype=Object.create(_ccsg.Node.WebGLRenderCmd.prototype);l.constructor=e.ParticleBatchNode.WebGLRenderCmd,l.rendering=function(t){var i=this._node;if(0!==i.textureAtlas.totalQuads)this._shaderProgram.use(),this._shaderProgram._setUniformForMVPMatrixWithMat4(this._stackMatrix),e.gl.blendFuncForParticle(i._blendFunc.src,i._blendFunc.dst),i.textureAtlas.drawQuads()},l._initWithTexture=function(){this._shaderProgram=e.shaderCache.programForKey(e.macro.SHADER_POSITION_TEXTURECOLOR)},l.visit=function(t){var i=this._node;if(i._visible){var n=e.current_stack;n.stack.push(n.top),this._syncStatus(t),n.top=this._stackMatrix,e.renderer.pushRenderCommand(this),this._dirtyFlag=0,e.math.glPopMatrix()}},_ccsg.TMXTiledMap=_ccsg.Node.extend({properties:null,mapOrientation:null,objectGroups:null,_mapSize:null,_tileSize:null,_tileProperties:null,_className:"TMXTiledMap",ctor:function(t,i){if(_ccsg.Node.prototype.ctor.call(this),this._mapSize=e.size(0,0),this._tileSize=e.size(0,0),void 0!==i)this.initWithXML(t,i);else if(void 0!==t)this.initWithTMXFile(t)},getMapSize:function(){return e.size(this._mapSize.width,this._mapSize.height)},setMapSize:function(t){this._mapSize.width=t.width,this._mapSize.height=t.height},_getMapWidth:function(){return this._mapSize.width},_setMapWidth:function(t){this._mapSize.width=t},_getMapHeight:function(){return this._mapSize.height},_setMapHeight:function(t){this._mapSize.height=t},getTileSize:function(){return e.size(this._tileSize.width,this._tileSize.height)},setTileSize:function(t){this._tileSize.width=t.width,this._tileSize.height=t.height},_getTileWidth:function(){return this._tileSize.width},_setTileWidth:function(t){this._tileSize.width=t},_getTileHeight:function(){return this._tileSize.height},_setTileHeight:function(t){this._tileSize.height=t},getMapOrientation:function(){return this.mapOrientation},setMapOrientation:function(t){this.mapOrientation=t},getObjectGroups:function(){return this.objectGroups},setObjectGroups:function(t){this.objectGroups=t},getProperties:function(){return this.properties},setProperties:function(t){this.properties=t},initWithTMXFile:function(t){if(!t||0===t.length)return!1;this.width=0,this.height=0;var i=new e.TMXMapInfo(t);if(!i)return!1;var n=i.getTilesets();if(!n||0===n.length)e.log("_ccsg.TMXTiledMap.initWithTMXFile(): Map not found. Please check the filename.");return this._buildWithMapInfo(i),!0},initWithXML:function(t,i){this.width=0,this.height=0;var n=new e.TMXMapInfo(t,i),r=n.getTilesets();if(!r||0===r.length)e.log("_ccsg.TMXTiledMap.initWithXML(): Map not found. Please check the filename.");return this._buildWithMapInfo(n),!0},_buildWithMapInfo:function(t){this._mapSize=t.getMapSize(),this._tileSize=t.getTileSize(),this.mapOrientation=t.orientation,this.objectGroups=t.getObjectGroups(),this.properties=t.properties,this._tileProperties=t.getTileProperties();for(var e=this.allLayers(),i=0,n=e.length;n>i;i++){var r=e[i];if(r)this.removeChild(r)}var s=0,o=t.getLayers();if(o)for(var a=null,c=0,l=o.length;l>c;c++)if(a=o[c],a&&a.visible){var h=this._parseLayer(a,t);this.addChild(h,s,s),this.width=Math.max(this.width,h.width),this.height=Math.max(this.height,h.height),s++}},allLayers:function(){for(var t=[],e=this._children,i=0,n=e.length;n>i;i++){var r=e[i];if(r&&r instanceof _ccsg.TMXLayer)t.push(r)}return t},getLayer:function(t){if(!t||0===t.length)throw new Error("_ccsg.TMXTiledMap.getLayer(): layerName should be non-null or non-empty string.");for(var e=this._children,i=0;i<e.length;i++){var n=e[i];if(n&&n.layerName===t)return n}return null},getObjectGroup:function(t){if(!t||0===t.length)throw new Error("_ccsg.TMXTiledMap.getObjectGroup(): groupName should be non-null or non-empty string.");if(this.objectGroups)for(var e=0;e<this.objectGroups.length;e++){var i=this.objectGroups[e];if(i&&i.groupName===t)return i}return null},getProperty:function(t){return this.properties[t.toString()]},propertiesForGID:function(t){return e.log("propertiesForGID is deprecated. Please use getPropertiesForGID instead."),this.getPropertiesForGID[t]},getPropertiesForGID:function(t){return this._tileProperties[t]},_parseLayer:function(t,e){var i=this._tilesetForLayer(t,e),n=new _ccsg.TMXLayer(i,t,e);return t.ownTiles=!1,n.setupTiles(),n},_tilesetForLayer:function(t,i){var n=t._layerSize,r=i.getTilesets();if(r)for(var s=r.length-1;s>=0;s--){var o=r[s];if(o)for(var a=0;a<n.height;a++)for(var c=0;c<n.width;c++){var l=c+n.width*a,h=t._tiles[l];if(0!==h)if((h&e.TiledMap.TileFlag.FLIPPED_MASK)>>>0>=o.firstGid)return o}}return e.log("cocos2d: Warning: TMX Layer "+t.name+" has no tiles"),null}});var _=_ccsg.TMXTiledMap.prototype;_.mapWidth,e.defineGetterSetter(_,"mapWidth",_._getMapWidth,_._setMapWidth),_.mapHeight,e.defineGetterSetter(_,"mapHeight",_._getMapHeight,_._setMapHeight),_.tileWidth,e.defineGetterSetter(_,"tileWidth",_._getTileWidth,_._setTileWidth),_.tileHeight,e.defineGetterSetter(_,"tileHeight",_._getTileHeight,_._setTileHeight),e.TMXLayerInfo=e._Class.extend({properties:null,name:"",_layerSize:null,_tiles:null,visible:null,_opacity:null,ownTiles:!0,_minGID:1e5,_maxGID:0,offset:null,ctor:function(){this.properties=[],this.name="",this._layerSize=null,this._tiles=[],this.visible=!0,this._opacity=0,this.ownTiles=!0,this._minGID=1e5,this._maxGID=0,this.offset=e.p(0,0)},getProperties:function(){return this.properties},setProperties:function(t){this.properties=t}}),e.TMXTilesetInfo=e._Class.extend({name:"",firstGid:0,_tileSize:null,spacing:0,margin:0,sourceImage:"",imageSize:null,ctor:function(){this._tileSize=e.size(0,0),this.imageSize=e.size(0,0)},rectForGID:function(t){var i=e.rect(0,0,0,0);i.width=this._tileSize.width,i.height=this._tileSize.height,t&=e.TiledMap.TileFlag.FLIPPED_MASK,t-=parseInt(this.firstGid,10);var n=parseInt((this.imageSize.width-2*this.margin+this.spacing)/(this._tileSize.width+this.spacing),10);return i.x=parseInt(t%n*(this._tileSize.width+this.spacing)+this.margin,10),i.y=parseInt(parseInt(t/n,10)*(this._tileSize.height+this.spacing)+this.margin,10),i}}),e.TMXMapInfo=e.SAXParser.extend({properties:null,orientation:null,parentElement:null,parentGID:null,layerAttrs:0,storingCharacters:!1,tmxFileName:null,currentString:null,_objectGroups:null,_mapSize:null,_tileSize:null,_layers:null,_tilesets:null,_tileProperties:null,_resources:"",_currentFirstGID:0,ctor:function(t,i){if(e.SAXParser.prototype.ctor.apply(this),this._mapSize=e.size(0,0),this._tileSize=e.size(0,0),this._layers=[],this._tilesets=[],this._objectGroups=[],this.properties=[],this._tileProperties={},this._currentFirstGID=0,void 0!==i)this.initWithXML(t,i);else if(void 0!==t)this.initWithTMXFile(t)},getOrientation:function(){return this.orientation},setOrientation:function(t){this.orientation=t},getMapSize:function(){return e.size(this._mapSize.width,this._mapSize.height)},setMapSize:function(t){this._mapSize.width=t.width,this._mapSize.height=t.height},_getMapWidth:function(){return this._mapSize.width},_setMapWidth:function(t){this._mapSize.width=t},_getMapHeight:function(){return this._mapSize.height},_setMapHeight:function(t){this._mapSize.height=t},getTileSize:function(){return e.size(this._tileSize.width,this._tileSize.height);
},setTileSize:function(t){this._tileSize.width=t.width,this._tileSize.height=t.height},_getTileWidth:function(){return this._tileSize.width},_setTileWidth:function(t){this._tileSize.width=t},_getTileHeight:function(){return this._tileSize.height},_setTileHeight:function(t){this._tileSize.height=t},getLayers:function(){return this._layers},setLayers:function(t){this._layers.push(t)},getTilesets:function(){return this._tilesets},setTilesets:function(t){this._tilesets.push(t)},getObjectGroups:function(){return this._objectGroups},setObjectGroups:function(t){this._objectGroups.push(t)},getParentElement:function(){return this.parentElement},setParentElement:function(t){this.parentElement=t},getParentGID:function(){return this.parentGID},setParentGID:function(t){this.parentGID=t},getLayerAttribs:function(){return this.layerAttrs},setLayerAttribs:function(t){this.layerAttrs=t},getStoringCharacters:function(){return this.storingCharacters},setStoringCharacters:function(t){this.storingCharacters=t},getProperties:function(){return this.properties},setProperties:function(t){this.properties=t},initWithTMXFile:function(t){return this._internalInit(t,null),this.parseXMLFile(t)},initWithXML:function(t,e){return this._internalInit(null,e),this.parseXMLString(t)},parseXMLFile:function(t,i){i=i||!1;var n=i?t:e.loader.getRes(t);if(!n)throw new Error("Please load the resource first : "+t);var r,s,o=this._parseXML(n),a=o.documentElement,l=a.getAttribute("version"),h=a.getAttribute("orientation");if("map"===a.nodeName){if("1.0"!==l&&null!==l)e.log("cocos2d: TMXFormat: Unsupported TMX version:"+l);if("orthogonal"===h)this.orientation=e.TiledMap.Orientation.ORTHO;else if("isometric"===h)this.orientation=e.TiledMap.Orientation.ISO;else if("hexagonal"===h)this.orientation=e.TiledMap.Orientation.HEX;else if(null!==h)e.log("cocos2d: TMXFomat: Unsupported orientation:"+h);var u=e.size(0,0);u.width=parseFloat(a.getAttribute("width")),u.height=parseFloat(a.getAttribute("height")),this.setMapSize(u),u=e.size(0,0),u.width=parseFloat(a.getAttribute("tilewidth")),u.height=parseFloat(a.getAttribute("tileheight")),this.setTileSize(u);var d=a.querySelectorAll("map > properties >  property");if(d){var f={};for(r=0;r<d.length;r++)f[d[r].getAttribute("name")]=d[r].getAttribute("value");this.properties=f}}var _=a.getElementsByTagName("tileset");if("map"!==a.nodeName)_=[],_.push(a);for(r=0;r<_.length;r++){var p=_[r],g=p.getAttribute("source");if(g){var m=i?e.path.join(this._resources,g):e.path.changeBasename(t,g);this.parseXMLFile(m)}else{var v=new e.TMXTilesetInfo;v.name=p.getAttribute("name")||"",v.firstGid=parseInt(p.getAttribute("firstgid"))||0,v.spacing=parseInt(p.getAttribute("spacing"))||0,v.margin=parseInt(p.getAttribute("margin"))||0;var y=e.size(0,0);y.width=parseFloat(p.getAttribute("tilewidth")),y.height=parseFloat(p.getAttribute("tileheight")),v._tileSize=y;var T=p.getElementsByTagName("image")[0],C=T.getAttribute("source"),x=-1;if(this.tmxFileName)x=this.tmxFileName.lastIndexOf("/");if(-1!==x){var S=this.tmxFileName.substr(0,x+1);v.sourceImage=S+C}else v.sourceImage=this._resources+(this._resources?"/":"")+C;this.setTilesets(v);var b=p.getElementsByTagName("tile");if(b)for(var E=0;E<b.length;E++){var A=b[E];this.parentGID=parseInt(v.firstGid)+parseInt(A.getAttribute("id")||0);var w=A.querySelectorAll("properties > property");if(w){var O={};for(s=0;s<w.length;s++){var I=w[s].getAttribute("name");O[I]=w[s].getAttribute("value")}this._tileProperties[this.parentGID]=O}}}}var R=a.getElementsByTagName("layer");if(R)for(r=0;r<R.length;r++){var P=R[r],N=P.getElementsByTagName("data")[0],L=new e.TMXLayerInfo;L.name=P.getAttribute("name");var F=e.size(0,0);F.width=parseFloat(P.getAttribute("width")),F.height=parseFloat(P.getAttribute("height")),L._layerSize=F;var D=P.getAttribute("visible");L.visible=!("0"==D);var M=P.getAttribute("opacity")||1;if(M)L._opacity=parseInt(255*parseFloat(M));else L._opacity=255;L.offset=e.p(parseFloat(P.getAttribute("x"))||0,parseFloat(P.getAttribute("y"))||0);var B="";for(s=0;s<N.childNodes.length;s++)B+=N.childNodes[s].nodeValue;B=B.trim();var z=N.getAttribute("compression"),k=N.getAttribute("encoding");if(z&&"gzip"!==z&&"zlib"!==z)return e.log("cc.TMXMapInfo.parseXMLFile(): unsupported compression method"),null;switch(z){case"gzip":L._tiles=e.Codec.unzipBase64AsArray(B,4);break;case"zlib":var V=new Zlib.Inflate(e.Codec.Base64.decodeAsArray(B,1));L._tiles=c(V.decompress());break;case null:case"":if("base64"===k)L._tiles=e.Codec.Base64.decodeAsArray(B,4);else if("csv"===k){L._tiles=[];for(var W=B.split(","),U=0;U<W.length;U++)L._tiles.push(parseInt(W[U]))}else{var G=N.getElementsByTagName("tile");L._tiles=[];for(var X=0;X<G.length;X++)L._tiles.push(parseInt(G[X].getAttribute("gid")))}break;default:if(this.layerAttrs===e.TMXLayerInfo.ATTRIB_NONE)e.log("cc.TMXMapInfo.parseXMLFile(): Only base64 and/or gzip/zlib maps are supported")}var j=P.querySelectorAll("properties > property");if(j){var Y={};for(s=0;s<j.length;s++)Y[j[s].getAttribute("name")]=j[s].getAttribute("value");L.properties=Y}this.setLayers(L)}var H=a.getElementsByTagName("objectgroup");if(H)for(r=0;r<H.length;r++){var q=H[r],Q=new e.TMXObjectGroup;Q.groupName=q.getAttribute("name"),Q.setPositionOffset(e.p(parseFloat(q.getAttribute("x"))*this.getTileSize().width||0,parseFloat(q.getAttribute("y"))*this.getTileSize().height||0));var Z=q.querySelectorAll("objectgroup > properties > property");if(Z)for(s=0;s<Z.length;s++){var K={};K[Z[s].getAttribute("name")]=Z[s].getAttribute("value"),Q.properties=K}var J=q.querySelectorAll("object"),$=e.director.getContentScaleFactor();if(J)for(s=0;s<J.length;s++){var tt=J[s],et={};et.name=tt.getAttribute("name")||"",et.type=tt.getAttribute("type")||"",et.width=parseInt(tt.getAttribute("width"))||0,et.height=parseInt(tt.getAttribute("height"))||0,et.x=((0|(tt.getAttribute("x")||0))+Q.getPositionOffset().x)/$;var it=(0|(tt.getAttribute("y")||0))+Q.getPositionOffset().y/$;et.y=(parseInt(this.getMapSize().height*this.getTileSize().height)-it-et.height)/e.director.getContentScaleFactor(),et.rotation=parseInt(tt.getAttribute("rotation"))||0;var nt=tt.querySelectorAll("properties > property");if(nt)for(var rt=0;rt<nt.length;rt++)et[nt[rt].getAttribute("name")]=nt[rt].getAttribute("value");var st=tt.querySelectorAll("polygon");if(st&&st.length>0){var ot=st[0].getAttribute("points");if(ot)et.points=this._parsePointsString(ot)}var at=tt.querySelectorAll("polyline");if(at&&at.length>0){var ct=at[0].getAttribute("points");if(ct)et.polylinePoints=this._parsePointsString(ct)}Q.setObjects(et)}this.setObjectGroups(Q)}return a},_parsePointsString:function(t){if(!t)return null;for(var e=[],i=t.split(" "),n=0;n<i.length;n++){var r=i[n].split(",");e.push({x:r[0],y:r[1]})}return e},parseXMLString:function(t){return this.parseXMLFile(t,!0)},getTileProperties:function(){return this._tileProperties},setTileProperties:function(t){this._tileProperties.push(t)},getCurrentString:function(){return this.currentString},setCurrentString:function(t){this.currentString=t},getTMXFileName:function(){return this.tmxFileName},setTMXFileName:function(t){this.tmxFileName=t},_internalInit:function(t,i){if(this._tilesets.length=0,this._layers.length=0,this.tmxFileName=t,i)this._resources=i;this._objectGroups.length=0,this.properties.length=0,this._tileProperties.length=0,this.currentString="",this.storingCharacters=!1,this.layerAttrs=e.TMXLayerInfo.ATTRIB_NONE,this.parentElement=e.TiledMap.NONE,this._currentFirstGID=0}});var _=e.TMXMapInfo.prototype;_.mapWidth,e.defineGetterSetter(_,"mapWidth",_._getMapWidth,_._setMapWidth),_.mapHeight,e.defineGetterSetter(_,"mapHeight",_._getMapHeight,_._setMapHeight),_.tileWidth,e.defineGetterSetter(_,"tileWidth",_._getTileWidth,_._setTileWidth),_.tileHeight,e.defineGetterSetter(_,"tileHeight",_._getTileHeight,_._setTileHeight),e.TMXMapInfo.create=function(t,i){return new e.TMXMapInfo(t,i)},e.TMXLayerInfo.ATTRIB_NONE=1,e.TMXLayerInfo.ATTRIB_BASE64=2,e.TMXLayerInfo.ATTRIB_GZIP=4,e.TMXLayerInfo.ATTRIB_ZLIB=8,e.TMXObjectGroup=e._Class.extend({properties:null,groupName:"",_positionOffset:null,_objects:null,ctor:function(){this.groupName="",this._positionOffset=e.p(0,0),this.properties=[],this._objects=[]},getPositionOffset:function(){return e.p(this._positionOffset)},setPositionOffset:function(t){this._positionOffset.x=t.x,this._positionOffset.y=t.y},getProperties:function(){return this.properties},setProperties:function(t){this.properties.push(t)},getGroupName:function(){return this.groupName.toString()},setGroupName:function(t){this.groupName=t},propertyNamed:function(t){return this.properties[t]},objectNamed:function(t){return this.getObject(t)},getObject:function(t){if(this._objects&&this._objects.length>0)for(var e=this._objects,i=0,n=e.length;n>i;i++){var r=e[i].name;if(r&&r===t)return e[i]}return null},getObjects:function(){return this._objects},setObjects:function(t){this._objects.push(t)}}),_ccsg.TMXLayer=e.SpriteBatchNode.extend({tiles:null,tileset:null,layerOrientation:null,properties:null,layerName:"",_layerSize:null,_mapTileSize:null,_opacity:255,_minGID:null,_maxGID:null,_vertexZvalue:null,_useAutomaticVertexZ:null,_reusedTile:null,_atlasIndexArray:null,_contentScaleFactor:null,_className:"TMXLayer",ctor:function(t,i,n){if(e.SpriteBatchNode.prototype.ctor.call(this),this._descendants=[],this._layerSize=e.size(0,0),this._mapTileSize=e.size(0,0),void 0!==n)this.initWithTilesetInfo(t,i,n)},_createRenderCmd:function(){if(e._renderType===e.game.RENDER_TYPE_CANVAS)return new _ccsg.TMXLayer.CanvasRenderCmd(this);else return new _ccsg.TMXLayer.WebGLRenderCmd(this)},setContentSize:function(t,e){_ccsg.Node.prototype.setContentSize.call(this,t,e),this._renderCmd._updateCacheContext(t,e)},getTexture:function(){return this._renderCmd.getTexture()},getLayerSize:function(){return e.size(this._layerSize.width,this._layerSize.height)},setLayerSize:function(t){this._layerSize.width=t.width,this._layerSize.height=t.height},_getLayerWidth:function(){return this._layerSize.width},_setLayerWidth:function(t){this._layerSize.width=t},_getLayerHeight:function(){return this._layerSize.height},_setLayerHeight:function(t){this._layerSize.height=t},getMapTileSize:function(){return e.size(this._mapTileSize.width,this._mapTileSize.height)},setMapTileSize:function(t){this._mapTileSize.width=t.width,this._mapTileSize.height=t.height},_getTileWidth:function(){return this._mapTileSize.width},_setTileWidth:function(t){this._mapTileSize.width=t},_getTileHeight:function(){return this._mapTileSize.height},_setTileHeight:function(t){this._mapTileSize.height=t},getTiles:function(){return this.tiles},setTiles:function(t){this.tiles=t},getTileset:function(){return this.tileset},setTileset:function(t){this.tileset=t},getLayerOrientation:function(){return this.layerOrientation},setLayerOrientation:function(t){this.layerOrientation=t},getProperties:function(){return this.properties},setProperties:function(t){this.properties=t},initWithTilesetInfo:function(t,i,n){var r,s=i._layerSize,o=parseInt(s.width*s.height),a=.35*o+1;if(t)r=e.textureCache.addImage(t.sourceImage);if(this.initWithTexture(r,a)){this.layerName=i.name,this._layerSize=s,this.tiles=i._tiles,this._minGID=i._minGID,this._maxGID=i._maxGID,this._opacity=i._opacity,this.properties=i.properties,this._contentScaleFactor=e.director.getContentScaleFactor(),this.tileset=t,this._mapTileSize=n.getTileSize(),this.layerOrientation=n.orientation;var c=this._calculateLayerOffset(i.offset);return this.setPosition(c),this._atlasIndexArray=[],this.setContentSize(e.size(this._layerSize.width*this._mapTileSize.width,this._layerSize.height*this._mapTileSize.height)),this._useAutomaticVertexZ=!1,this._vertexZvalue=0,!0}return!1},releaseMap:function(){if(this.tiles)this.tiles=null;if(this._atlasIndexArray)this._atlasIndexArray=null},getTileAt:function(t,i){if(!t)throw new Error("_ccsg.TMXLayer.getTileAt(): pos should be non-null");if(void 0!==i)t=e.p(t,i);if(t.x>=this._layerSize.width||t.y>=this._layerSize.height||t.x<0||t.y<0)throw new Error("_ccsg.TMXLayer.getTileAt(): invalid position");if(!this.tiles||!this._atlasIndexArray)return e.log("_ccsg.TMXLayer.getTileAt(): TMXLayer: the tiles map has been released"),null;var n=null,r=this.getTileGIDAt(t);if(0===r)return n;var s=0|t.x+t.y*this._layerSize.width;if(n=this.getChildByTag(s),!n){var o=this.tileset.rectForGID(r);n=new _ccsg.Sprite,n.initWithTexture(this.texture,o),n.batchNode=this,n.setPosition(this.getPositionAt(t)),n.vertexZ=this._vertexZForPos(t),n.anchorX=0,n.anchorY=0,n.opacity=this._opacity;var a=this._atlasIndexForExistantZ(s);this.addSpriteWithoutQuad(n,a,s)}return n},getTileGIDAt:function(t,i){if(null==t)throw new Error("_ccsg.TMXLayer.getTileGIDAt(): pos should be non-null");if(void 0!==i)t=e.p(t,i);if(t.x>=this._layerSize.width||t.y>=this._layerSize.height||t.x<0||t.y<0)throw new Error("_ccsg.TMXLayer.getTileGIDAt(): invalid position");if(!this.tiles||!this._atlasIndexArray)return e.log("_ccsg.TMXLayer.getTileGIDAt(): TMXLayer: the tiles map has been released"),null;var n=0|t.x+t.y*this._layerSize.width,r=this.tiles[n];return(r&e.TiledMap.TileFlag.FLIPPED_MASK)>>>0},getTileFlagsAt:function(t,i){if(!t)throw new Error("_ccsg.TMXLayer.getTileFlagsAt(): pos should be non-null");if(void 0!==i)t=e.p(t,i);if(t.x>=this._layerSize.width||t.y>=this._layerSize.height||t.x<0||t.y<0)throw new Error("_ccsg.TMXLayer.getTileFlagsAt(): invalid position");if(!this.tiles||!this._atlasIndexArray)return e.log("_ccsg.TMXLayer.getTileFlagsAt(): TMXLayer: the tiles map has been released"),null;var n=0|t.x+t.y*this._layerSize.width,r=this.tiles[n];return(r&e.TiledMap.TileFlag.FLIPPED_ALL)>>>0},setTileGID:function(t,i,n,r){if(!i)throw new Error("_ccsg.TMXLayer.setTileGID(): pos should be non-null");var s;if(void 0!==r)s=e.p(i,n);else s=i,r=n;if(s.x>=this._layerSize.width||s.y>=this._layerSize.height||s.x<0||s.y<0)throw new Error("_ccsg.TMXLayer.setTileGID(): invalid position");if(!this.tiles||!this._atlasIndexArray)return void e.log("_ccsg.TMXLayer.setTileGID(): TMXLayer: the tiles map has been released");if(0!==t&&t<this.tileset.firstGid)return void e.log("_ccsg.TMXLayer.setTileGID(): invalid gid:"+t);r=r||0,this._setNodeDirtyForCache();var o=this.getTileFlagsAt(s),a=this.getTileGIDAt(s);if(a!==t||o!==r){var c=(t|r)>>>0;if(0===t)this.removeTileAt(s);else if(0===a)this._insertTileForGID(c,s);else{var l=s.x+s.y*this._layerSize.width,h=this.getChildByTag(l);if(h){var u=this.tileset.rectForGID(t);if(h.setTextureRect(u,!1),null!=r)this._setupTileSprite(h,s,c);this.tiles[l]=c}else this._updateTileForGID(c,s)}}},removeTileAt:function(t,i){if(!t)throw new Error("_ccsg.TMXLayer.removeTileAt(): pos should be non-null");if(void 0!==i)t=e.p(t,i);if(t.x>=this._layerSize.width||t.y>=this._layerSize.height||t.x<0||t.y<0)throw new Error("_ccsg.TMXLayer.removeTileAt(): invalid position");if(!this.tiles||!this._atlasIndexArray)return void e.log("_ccsg.TMXLayer.removeTileAt(): TMXLayer: the tiles map has been released");var n=this.getTileGIDAt(t);if(0!==n){if(e._renderType===e.game.RENDER_TYPE_CANVAS)this._setNodeDirtyForCache();var r=0|t.x+t.y*this._layerSize.width,s=this._atlasIndexForExistantZ(r);this.tiles[r]=0,this._atlasIndexArray.splice(s,1);var o=this.getChildByTag(r);if(o)e.SpriteBatchNode.prototype.removeChild.call(this,o,!0);else{if(e._renderType===e.game.RENDER_TYPE_WEBGL)this.textureAtlas.removeQuadAtIndex(s);if(this._children)for(var a=this._children,c=0,l=a.length;l>c;c++){var h=a[c];if(h){var u=h.atlasIndex;if(u>=s)h.atlasIndex=u-1}}}}},getPositionAt:function(t,i){if(void 0!==i)t=e.p(t,i);var n=e.p(0,0);switch(this.layerOrientation){case e.TiledMap.Orientation.ORTHO:n=this._positionForOrthoAt(t);break;case e.TiledMap.Orientation.ISO:n=this._positionForIsoAt(t);break;case e.TiledMap.Orientation.HEX:n=this._positionForHexAt(t)}return n},getProperty:function(t){return this.properties[t]},setupTiles:function(){if(this._renderCmd.initImageSize(),this._parseInternalProperties(),e._renderType===e.game.RENDER_TYPE_CANVAS)this._setNodeDirtyForCache();for(var t=this._layerSize.height,i=this._layerSize.width,n=0;t>n;n++)for(var r=0;i>r;r++){var s=r+i*n,o=this.tiles[s];if(0!==o)this._appendTileForGID(o,e.p(r,n)),this._minGID=Math.min(o,this._minGID),this._maxGID=Math.max(o,this._maxGID)}if(!(this._maxGID>=this.tileset.firstGid&&this._minGID>=this.tileset.firstGid))e.log("cocos2d:TMX: Only 1 tileset per layer is supported")},addChild:function(t,i,n){e.log("addChild: is not supported on _ccsg.TMXLayer. Instead use setTileGID or tileAt.")},removeChild:function(t,i){if(t){if(-1===this._children.indexOf(t))return void e.log("_ccsg.TMXLayer.removeChild(): Tile does not belong to TMXLayer");if(e._renderType===e.game.RENDER_TYPE_CANVAS)this._setNodeDirtyForCache();var n=t.atlasIndex,r=this._atlasIndexArray[n];this.tiles[r]=0,this._atlasIndexArray.splice(n,1),e.SpriteBatchNode.prototype.removeChild.call(this,t,i),e.renderer.childrenOrderDirty=!0}},getLayerName:function(){return this.layerName},setLayerName:function(t){this.layerName=t},_positionForIsoAt:function(t){return e.p(this._mapTileSize.width/2*(this._layerSize.width+t.x-t.y-1),this._mapTileSize.height/2*(2*this._layerSize.height-t.x-t.y-2))},_positionForOrthoAt:function(t){return e.p(t.x*this._mapTileSize.width,(this._layerSize.height-t.y-1)*this._mapTileSize.height)},_positionForHexAt:function(t){var i=t.x%2===1?-this._mapTileSize.height/2:0;return e.p(t.x*this._mapTileSize.width*3/4,(this._layerSize.height-t.y-1)*this._mapTileSize.height+i)},_calculateLayerOffset:function(t){var i=e.p(0,0);switch(this.layerOrientation){case e.TiledMap.Orientation.ORTHO:i=e.p(t.x*this._mapTileSize.width,-t.y*this._mapTileSize.height);break;case e.TiledMap.Orientation.ISO:i=e.p(this._mapTileSize.width/2*(t.x-t.y),this._mapTileSize.height/2*(-t.x-t.y));break;case e.TiledMap.Orientation.HEX:if(0!==t.x||0!==t.y)e.log("offset for hexagonal map not implemented yet")}return i},_appendTileForGID:function(t,e){var i=this.tileset.rectForGID(t),n=0|e.x+e.y*this._layerSize.width,r=this._renderCmd._reusedTileWithRect(i);this._setupTileSprite(r,e,t);var s=this._atlasIndexArray.length;return this.insertQuadFromSprite(r,s),this._atlasIndexArray.splice(s,0,n),r},_insertTileForGID:function(t,e){var i=this.tileset.rectForGID(t),n=0|e.x+e.y*this._layerSize.width,r=this._renderCmd._reusedTileWithRect(i);this._setupTileSprite(r,e,t);var s=this._atlasIndexForNewZ(n);if(this.insertQuadFromSprite(r,s),this._atlasIndexArray.splice(s,0,n),this._children)for(var o=this._children,a=0,c=o.length;c>a;a++){var l=o[a];if(l){var h=l.atlasIndex;if(h>=s)l.atlasIndex=h+1}}return this.tiles[n]=t,r},_updateTileForGID:function(t,i){var n=this.tileset.rectForGID(t),r=this._contentScaleFactor;n=e.rect(n.x/r,n.y/r,n.width/r,n.height/r);var s=i.x+i.y*this._layerSize.width,o=this._renderCmd._reusedTileWithRect(n);return this._setupTileSprite(o,i,t),o.atlasIndex=this._atlasIndexForExistantZ(s),o.dirty=!0,o.updateTransform(),this.tiles[s]=t,o},_parseInternalProperties:function(){var t=this.getProperty("cc_vertexz");if(t)if("automatic"===t){this._useAutomaticVertexZ=!0;var i=this.getProperty("cc_alpha_func"),n=0;if(i)n=parseFloat(i);if(e._renderType===e.game.RENDER_TYPE_WEBGL){this.shaderProgram=e.shaderCache.programForKey(e.macro.SHADER_POSITION_TEXTURECOLORALPHATEST);var r=e._renderContext.getUniformLocation(this.shaderProgram.getProgram(),e.macro.UNIFORM_ALPHA_TEST_VALUE_S);this.shaderProgram.use(),this.shaderProgram.setUniformLocationWith1f(r,n)}}else this._vertexZvalue=parseInt(t,10)},_setupTileSprite:function(t,i,n){var r=i.x+i.y*this._layerSize.width;if(t.setPosition(this.getPositionAt(i)),e._renderType===e.game.RENDER_TYPE_WEBGL)t.vertexZ=this._vertexZForPos(i);else t.tag=r;if(t.anchorX=0,t.anchorY=0,t.opacity=this._opacity,e._renderType===e.game.RENDER_TYPE_WEBGL)t.rotation=0;if(t.setFlippedX(!1),t.setFlippedY(!1),(n&e.TiledMap.TileFlag.DIAGONAL_FLAG)>>>0){t.anchorX=.5,t.anchorY=.5,t.x=this.getPositionAt(i).x+t.width/2,t.y=this.getPositionAt(i).y+t.height/2;var s=(n&(e.TiledMap.TileFlag.HORIZONTAL|e.TiledMap.TileFlag.VERTICAL)>>>0)>>>0;if(s===e.TiledMap.TileFlag.HORIZONTAL)t.rotation=90;else if(s===e.TiledMap.TileFlag.VERTICAL)t.rotation=270;else if(s===(e.TiledMap.TileFlag.VERTICAL|e.TiledMap.TileFlag.HORIZONTAL)>>>0)t.rotation=90,t.setFlippedX(!0);else t.rotation=270,t.setFlippedX(!0)}else{if((n&e.TiledMap.TileFlag.HORIZONTAL)>>>0)t.setFlippedX(!0);if((n&e.TiledMap.TileFlag.VERTICAL)>>>0)t.setFlippedY(!0)}},_vertexZForPos:function(t){var i=0,n=0;if(this._useAutomaticVertexZ)switch(this.layerOrientation){case e.TiledMap.Orientation.ISO:n=this._layerSize.width+this._layerSize.height,i=-(n-(t.x+t.y));break;case e.TiledMap.Orientation.ORTHO:i=-(this._layerSize.height-t.y);break;case e.TiledMap.Orientation.HEX:e.log("TMX Hexa zOrder not supported");break;default:e.log("TMX invalid value")}else i=this._vertexZvalue;return i},_atlasIndexForExistantZ:function(t){var i;if(this._atlasIndexArray)for(var n=this._atlasIndexArray,r=0,s=n.length;s>r&&(i=n[r],i!==t);r++);if(!e.js.isNumber(i))e.log("_ccsg.TMXLayer._atlasIndexForExistantZ(): TMX atlas index not found. Shall not happen");return r},_atlasIndexForNewZ:function(t){for(var e=this._atlasIndexArray,i=0,n=e.length;n>i;i++){var r=e[i];if(r>t)break}return i}});var _=_ccsg.TMXLayer.prototype;e.defineGetterSetter(_,"texture",_.getTexture,_.setTexture),_.layerWidth,e.defineGetterSetter(_,"layerWidth",_._getLayerWidth,_._setLayerWidth),_.layerHeight,e.defineGetterSetter(_,"layerHeight",_._getLayerHeight,_._setLayerHeight),_.tileWidth,e.defineGetterSetter(_,"tileWidth",_._getTileWidth,_._setTileWidth),_.tileHeight,e.defineGetterSetter(_,"tileHeight",_._getTileHeight,_._setTileHeight),_ccsg.TMXLayer.create=function(t,e,i){return new _ccsg.TMXLayer(t,e,i)},_ccsg.TMXLayer.CanvasRenderCmd=function(t){e.SpriteBatchNode.CanvasRenderCmd.call(this,t),this._needDraw=!0,this._realWorldTransform={a:1,b:0,c:0,d:1,tx:0,ty:0};var i=e._canvas,n=document.createElement("canvas");n.width=i.width,n.height=i.height,this._cacheCanvas=n,this._cacheContext=new e.CanvasContextWrapper(this._cacheCanvas.getContext("2d"));var r=new e.Texture2D;r.initWithElement(n),r.handleLoadedTexture(),this._cacheTexture=r,this._cacheDirty=!1};var l=_ccsg.TMXLayer.CanvasRenderCmd.prototype=Object.create(e.SpriteBatchNode.CanvasRenderCmd.prototype);l.constructor=_ccsg.TMXLayer.CanvasRenderCmd,l._setNodeDirtyForCache=function(){this._cacheDirty=!0},l._renderingChildToCache=function(){if(this._cacheDirty){var t=this._cacheContext,e=t.getContext(),i=this._cacheCanvas;e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,i.width,i.height);for(var n=this._node._children,r=0,s=n.length;s>r;r++)if(n[r]){var o=n[r]._renderCmd;if(o)o.rendering(t,1,1),o._cacheDirty=!1}this._cacheDirty=!1}},l.rendering=function(t,i,n){var r=this._displayedOpacity/255;if(!(0>=r)){var s=this._node;this._renderingChildToCache();var o=t||e._renderContext,a=o.getContext();o.setGlobalAlpha(r);var c=this._cacheCanvas;if(c&&0!==c.width&&0!==c.height){o.setTransform(this._realWorldTransform,i,n);var l=c.height*n;if(s.layerOrientation===e.TiledMap.Orientation.HEX){var h=.5*s._mapTileSize.height*n;a.drawImage(c,0,0,c.width,c.height,0,-l+h,c.width*i,l)}else a.drawImage(c,0,0,c.width,c.height,0,-l,c.width*i,l)}e.g_NumberOfDraws++}},l._updateCacheContext=function(t,i){var n=this._node,r=n._contentSize,s=this._cacheCanvas;if(s.width=0|1.5*r.width,s.height=0|1.5*r.height,n.layerOrientation===e.TiledMap.Orientation.HEX)this._cacheContext.setOffset(0,.5*-n._mapTileSize.height);else this._cacheContext.setOffset(0,0);var o=this._cacheTexture._contentSize;o.width=s.width,o.height=s.height},l.getTexture=function(){return this._cacheTexture},l.visit=function(t){var i,n,r=this._node,s=r._children;if(r._visible&&s&&0!==s.length){if(t=t||this.getParentRenderCmd())this._curLevel=t._curLevel+1;if(this._syncStatus(t),this._cacheDirty){var o=this._cacheContext,a=this._cacheCanvas,c=o.getContext(),l=r.__instanceId,h=e.renderer;for(h._turnToCacheMode(l),r.sortAllChildren(),i=0,n=s.length;n>i;i++)if(s[i]){var u=s[i]._renderCmd;if(u)u.visit(this),u._cacheDirty=!1}c.setTransform(1,0,0,1,0,0),c.clearRect(0,0,a.width,a.height),h._renderingToCacheCanvas(o,l),this._cacheDirty=!1}e.renderer.pushRenderCommand(this),this._dirtyFlag=0}},l.transform=function(t,e){var i=this.getNodeToParentTransform(),n=this._realWorldTransform;if(t){var r=t._worldTransform;n.a=i.a*r.a+i.b*r.c,n.b=i.a*r.b+i.b*r.d,n.c=i.c*r.a+i.d*r.c,n.d=i.c*r.b+i.d*r.d,n.tx=r.a*i.tx+r.c*i.ty+r.tx,n.ty=r.d*i.ty+r.ty+r.b*i.tx}else n.a=i.a,n.b=i.b,n.c=i.c,n.d=i.d,n.tx=i.tx,n.ty=i.ty;if(e){var s=this._node._children;if(!s||0===s.length)return;var o,a;for(o=0,a=s.length;a>o;o++)s[o]._renderCmd.transform(this,e)}},l.initImageSize=function(){var t=this._node;t.tileset.imageSize=this._texture.getContentSizeInPixels()},l._reusedTileWithRect=function(t){var e=this._node;return e._reusedTile=new _ccsg.Sprite,e._reusedTile.initWithTexture(this._texture,t,!1),e._reusedTile.batchNode=e,e._reusedTile.parent=e,e._reusedTile._renderCmd._cachedParent=e._renderCmd,e._reusedTile},_ccsg.TMXLayer.WebGLRenderCmd=function(t){e.SpriteBatchNode.WebGLRenderCmd.call(this,t),this._needDraw=!0};var l=_ccsg.TMXLayer.WebGLRenderCmd.prototype=Object.create(e.SpriteBatchNode.WebGLRenderCmd.prototype);l.constructor=_ccsg.TMXLayer.WebGLRenderCmd,l._updateCacheContext=function(){},l.initImageSize=function(){var t=this._node;t.tileset.imageSize=this._textureAtlas.texture.getContentSizeInPixels(),this._textureAtlas.texture.setAliasTexParameters()},l._reusedTileWithRect=function(t){var e=this._node;if(!e._reusedTile)e._reusedTile=new _ccsg.Sprite,e._reusedTile.initWithTexture(e.texture,t,!1),e._reusedTile.batchNode=e;else e._reusedTile.batchNode=null,e._reusedTile.setTextureRect(t,!1),e._reusedTile.batchNode=e;return e._reusedTile};var P=e._Class.extend({_ratio:null,_offset:null,_child:null,ctor:function(t,e){this.initWithCCPoint(t,e)},getRatio:function(){return this._ratio},setRatio:function(t){this._ratio=t},getOffset:function(){return this._offset},setOffset:function(t){this._offset=t},getChild:function(){return this._child},setChild:function(t){this._child=t},initWithCCPoint:function(t,e){return this._ratio=t,this._offset=e,this._child=null,!0}});e.ParallaxNode=_ccsg.Node.extend({parallaxArray:null,_lastPosition:null,_className:"ParallaxNode",getParallaxArray:function(){return this.parallaxArray},setParallaxArray:function(t){this.parallaxArray=t},ctor:function(){_ccsg.Node.prototype.ctor.call(this),this.parallaxArray=[],this._lastPosition=e.p(-100,-100)},addChild:function(t,i,n,r){if(3===arguments.length)return void e.log("ParallaxNode: use addChild(child, z, ratio, offset) instead");if(!t)throw new Error("cc.ParallaxNode.addChild(): child should be non-null");var s=new P(n,r);s.setChild(t),this.parallaxArray.push(s),t.setPosition(this._position.x*n.x+r.x,this._position.y*n.y+r.y),_ccsg.Node.prototype.addChild.call(this,t,i,t.tag)},removeChild:function(t,e){for(var i=this.parallaxArray,n=0;n<i.length;n++){var r=i[n];if(r.getChild()===t){i.splice(n,1);break}}_ccsg.Node.prototype.removeChild.call(this,t,e)},removeAllChildren:function(t){this.parallaxArray.length=0,_ccsg.Node.prototype.removeAllChildren.call(this,t)},_updateParallaxPosition:function(){var t=this._absolutePosition();if(!e.pointEqualToPoint(t,this._lastPosition)){for(var i=this.parallaxArray,n=0,r=i.length;r>n;n++){var s=i[n],o=s.getChild();o.setPosition(-t.x+t.x*s.getRatio().x+s.getOffset().x,-t.y+t.y*s.getRatio().y+s.getOffset().y)}this._lastPosition=t}},_absolutePosition:function(){for(var t=this._position,i=this;null!==i.parent;)i=i.parent,t=e.pAdd(t,i.getPosition());return t},_createRenderCmd:function(){if(e._renderType===e.game.RENDER_TYPE_CANVAS)return new e.ParallaxNode.CanvasRenderCmd(this);else return new e.ParallaxNode.WebGLRenderCmd(this)}}),e.ParallaxNode.CanvasRenderCmd=function(t){_ccsg.Node.CanvasRenderCmd.call(this,t),this._needDraw=!1};var l=e.ParallaxNode.CanvasRenderCmd.prototype=Object.create(_ccsg.Node.CanvasRenderCmd.prototype);l.constructor=e.ParallaxNode.CanvasRenderCmd,l.updateStatus=function(){this._node._updateParallaxPosition(),_ccsg.Node.CanvasRenderCmd.prototype.updateStatus.call(this)},l._syncStatus=function(t){this._node._updateParallaxPosition(),_ccsg.Node.CanvasRenderCmd.prototype._syncStatus.call(this,t)},e.game.once(e.game.EVENT_RENDERER_INITED,function(){if(e._renderType===e.game.RENDER_TYPE_WEBGL){e.ParallaxNode.WebGLRenderCmd=function(t){_ccsg.Node.WebGLRenderCmd.call(this,t),this._needDraw=!1};var t=e.ParallaxNode.WebGLRenderCmd.prototype=Object.create(_ccsg.Node.WebGLRenderCmd.prototype);t.constructor=e.ParallaxNode.WebGLRenderCmd,t.updateStatus=function(){this._node._updateParallaxPosition(),_ccsg.Node.WebGLRenderCmd.prototype.updateStatus.call(this)},t._syncStatus=function(t){this._node._updateParallaxPosition(),_ccsg.Node.WebGLRenderCmd.prototype._syncStatus.call(this,t)}}}),e.__convertVerts=function(t){for(var e=[],i=0;i<t.length/2;i++)e[i]={x:t[2*i],y:t[2*i+1]};return e},e.ColorForBody=function(t){if(t.isRogue()||t.isSleeping())return e.color(128,128,128,128);else if(t.nodeIdleTime>t.space.sleepTimeThreshold)return e.color(84,84,84,128);else return e.color(255,0,0,128)},e.DrawShape=function(t,i){var n=t.body,r=e.ColorForBody(n);switch(t.collisionCode){case s.CircleShape.prototype.collisionCode:this.drawDot(t.tc,Math.max(t.r,1),r),this.drawSegment(t.tc,s.v.add(t.tc,s.v.mult(n.rot,t.r)),1,r);break;case s.SegmentShape.prototype.collisionCode:this.drawSegment(t.ta,t.tb,Math.max(t.r,2),r);break;case s.PolyShape.prototype.collisionCode:var o=e.color(r.r,r.g,r.b,e.lerp(r.a,255,.5));this.drawPoly(e.__convertVerts(t.tVerts),r,1,o);break;default:e.log("cc.DrawShape(): Bad assertion in DrawShape()")}},e.DrawConstraint=function(t,i){var n,r,o=t.a,a=t.b;if(t instanceof s.PinJoint)n=o.local2World(t.anchr1),r=a.local2World(t.anchr2),this.drawDot(n,3,e.CONSTRAINT_COLOR),this.drawDot(r,3,e.CONSTRAINT_COLOR),this.drawSegment(n,r,1,e.CONSTRAINT_COLOR);else if(t instanceof s.SlideJoint)n=o.local2World(t.anchr1),r=a.local2World(t.anchr2),this.drawDot(n,3,e.CONSTRAINT_COLOR),this.drawDot(r,3,e.CONSTRAINT_COLOR),this.drawSegment(n,r,1,e.CONSTRAINT_COLOR);else if(t instanceof s.PivotJoint)n=o.local2World(t.anchr1),r=a.local2World(t.anchr2),this.drawDot(n,3,e.CONSTRAINT_COLOR),this.drawDot(r,3,e.CONSTRAINT_COLOR);else if(t instanceof s.GrooveJoint){n=o.local2World(t.grv_a),r=o.local2World(t.grv_b);var c=a.local2World(t.anchr2);this.drawDot(c,3,e.CONSTRAINT_COLOR),this.drawSegment(n,r,1,e.CONSTRAINT_COLOR)}else if(t instanceof s.DampedSpring);else;},e.CONSTRAINT_COLOR=e.color(0,255,0,128),e.PhysicsDebugNode=e.DrawNode.extend({_space:null,_className:"PhysicsDebugNode",ctor:function(t){e.DrawNode.prototype.ctor.call(this),this._space=t},getSpace:function(){return this._space},setSpace:function(t){this._space=t},draw:function(t){if(this._space)this._space.eachShape(e.DrawShape.bind(this)),this._space.eachConstraint(e.DrawConstraint.bind(this)),e.DrawNode.prototype.draw.call(this),this.clear()},_createRenderCmd:function(){if(e._renderType===e.game.RENDER_TYPE_CANVAS)return new e.PhysicsDebugNode.CanvasRenderCmd(this);else return new e.PhysicsDebugNode.WebGLRenderCmd(this)}}),e.PhysicsDebugNode.create=function(t){return new e.PhysicsDebugNode(t)},function(){e.PhysicsDebugNode.CanvasRenderCmd=function(t){_ccsg.Node.CanvasRenderCmd.call(this,t),this._buffer=t._buffer,this._needDraw=!0};var t=e.PhysicsDebugNode.CanvasRenderCmd.prototype=Object.create(_ccsg.Node.CanvasRenderCmd.prototype);t.constructor=e.PhysicsDebugNode.CanvasRenderCmd,t.rendering=function(t,i,n){var r=this._node;if(r._space)r._space.eachShape(e.DrawShape.bind(r)),r._space.eachConstraint(e.DrawConstraint.bind(r)),e.DrawNode.CanvasRenderCmd.prototype.rendering.call(this,t,i,n),r.clear()},t._drawDot=e.DrawNode.CanvasRenderCmd.prototype._drawDot,t._drawSegment=e.DrawNode.CanvasRenderCmd.prototype._drawSegment,
t._drawPoly=e.DrawNode.CanvasRenderCmd.prototype._drawPoly}(),function(){e.PhysicsDebugNode.WebGLRenderCmd=function(t){_ccsg.Node.WebGLRenderCmd.call(this,t),this._needDraw=!0},e.PhysicsDebugNode.WebGLRenderCmd.prototype=Object.create(_ccsg.Node.WebGLRenderCmd.prototype),e.PhysicsDebugNode.WebGLRenderCmd.prototype.constructor=e.PhysicsDebugNode.WebGLRenderCmd,e.PhysicsDebugNode.WebGLRenderCmd.prototype.rendering=function(t){var i=this._node;if(i._space)i._space.eachShape(e.DrawShape.bind(i)),i._space.eachConstraint(e.DrawConstraint.bind(i)),e.gl.blendFunc(i._blendFunc.src,i._blendFunc.dst),this._shaderProgram.use(),this._shaderProgram._setUniformForMVPMatrixWithMat4(this._stackMatrix),i._render(),i.clear()}}()}).call(window,cc,ccui,ccs,cp)},{"../cocos2d/core/event/event-target":74,"../cocos2d/core/utils/misc":126,"../cocos2d/particle/CCPNGReader":153,"../cocos2d/particle/CCTIFFReader":156}],4:[function(t,e,i){cc.Action=cc._Class.extend({ctor:function(){this.originalTarget=null,this.target=null,this.tag=cc.Action.TAG_INVALID},clone:function(){var t=new cc.Action;return t.originalTarget=null,t.target=null,t.tag=this.tag,t},isDone:function(){return!0},startWithTarget:function(t){this.originalTarget=t,this.target=t},stop:function(){this.target=null},step:function(t){cc.log("[Action step]. override me")},update:function(t){cc.log("[Action update]. override me")},getTarget:function(){return this.target},setTarget:function(t){this.target=t},getOriginalTarget:function(){return this.originalTarget},setOriginalTarget:function(t){this.originalTarget=t},getTag:function(){return this.tag},setTag:function(t){this.tag=t},retain:function(){},release:function(){}}),cc.Action.TAG_INVALID=-1,cc.FiniteTimeAction=cc.Action.extend({_duration:0,ctor:function(){cc.Action.prototype.ctor.call(this),this._duration=0},getDuration:function(){return this._duration*(this._timesForRepeat||1)},setDuration:function(t){this._duration=t},reverse:function(){return cc.log("cocos2d: FiniteTimeAction#reverse: Implement me"),null},clone:function(){return new cc.FiniteTimeAction}}),cc.Speed=cc.Action.extend({_speed:0,_innerAction:null,ctor:function(t,e){cc.Action.prototype.ctor.call(this),this._speed=0,this._innerAction=null,t&&this.initWithAction(t,e)},getSpeed:function(){return this._speed},setSpeed:function(t){this._speed=t},initWithAction:function(t,e){if(!t)throw new Error("cc.Speed.initWithAction(): action must be non nil");return this._innerAction=t,this._speed=e,!0},clone:function(){var t=new cc.Speed;return t.initWithAction(this._innerAction.clone(),this._speed),t},startWithTarget:function(t){cc.Action.prototype.startWithTarget.call(this,t),this._innerAction.startWithTarget(t)},stop:function(){this._innerAction.stop(),cc.Action.prototype.stop.call(this)},step:function(t){this._innerAction.step(t*this._speed)},isDone:function(){return this._innerAction.isDone()},reverse:function(){return new cc.Speed(this._innerAction.reverse(),this._speed)},setInnerAction:function(t){if(this._innerAction!==t)this._innerAction=t},getInnerAction:function(){return this._innerAction}}),cc.speed=function(t,e){return new cc.Speed(t,e)},cc.Follow=cc.Action.extend({_followedNode:null,_boundarySet:!1,_boundaryFullyCovered:!1,_halfScreenSize:null,_fullScreenSize:null,_worldRect:null,leftBoundary:0,rightBoundary:0,topBoundary:0,bottomBoundary:0,ctor:function(t,e){if(cc.Action.prototype.ctor.call(this),this._followedNode=null,this._boundarySet=!1,this._boundaryFullyCovered=!1,this._halfScreenSize=null,this._fullScreenSize=null,this.leftBoundary=0,this.rightBoundary=0,this.topBoundary=0,this.bottomBoundary=0,this._worldRect=cc.rect(0,0,0,0),t)e?this.initWithTarget(t,e):this.initWithTarget(t)},clone:function(){var t=new cc.Follow,e=this._worldRect,i=new cc.Rect(e.x,e.y,e.width,e.height);return t.initWithTarget(this._followedNode,i),t},isBoundarySet:function(){return this._boundarySet},setBoudarySet:function(t){this._boundarySet=t},initWithTarget:function(t,e){if(!t)throw new Error("cc.Follow.initWithAction(): followedNode must be non nil");var i=this;e=e||cc.rect(0,0,0,0),i._followedNode=t,i._worldRect=e,i._boundarySet=!cc._rectEqualToZero(e),i._boundaryFullyCovered=!1;var n=cc.director.getWinSize();if(i._fullScreenSize=cc.p(n.width,n.height),i._halfScreenSize=cc.pMult(i._fullScreenSize,.5),i._boundarySet){if(i.leftBoundary=-(e.x+e.width-i._fullScreenSize.x),i.rightBoundary=-e.x,i.topBoundary=-e.y,i.bottomBoundary=-(e.y+e.height-i._fullScreenSize.y),i.rightBoundary<i.leftBoundary)i.rightBoundary=i.leftBoundary=(i.leftBoundary+i.rightBoundary)/2;if(i.topBoundary<i.bottomBoundary)i.topBoundary=i.bottomBoundary=(i.topBoundary+i.bottomBoundary)/2;if(i.topBoundary===i.bottomBoundary&&i.leftBoundary===i.rightBoundary)i._boundaryFullyCovered=!0}return!0},step:function(t){var e=this._followedNode.x,i=this._followedNode.y;if(e=this._halfScreenSize.x-e,i=this._halfScreenSize.y-i,this._boundarySet){if(this._boundaryFullyCovered)return;this.target.setPosition(cc.clampf(e,this.leftBoundary,this.rightBoundary),cc.clampf(i,this.bottomBoundary,this.topBoundary))}else this.target.setPosition(e,i)},isDone:function(){return!this._followedNode.isRunning()},stop:function(){this.target=null,cc.Action.prototype.stop.call(this)}}),cc.follow=function(t,e){return new cc.Follow(t,e)}},{}],5:[function(t,e,i){cc.ActionEase=cc.ActionInterval.extend({_inner:null,ctor:function(t){cc.ActionInterval.prototype.ctor.call(this),t&&this.initWithAction(t)},initWithAction:function(t){if(!t)throw new Error("cc.ActionEase.initWithAction(): action must be non nil");if(this.initWithDuration(t.getDuration()))return this._inner=t,!0;else return!1},clone:function(){var t=new cc.ActionEase;return t.initWithAction(this._inner.clone()),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._inner.startWithTarget(this.target)},stop:function(){this._inner.stop(),cc.ActionInterval.prototype.stop.call(this)},update:function(t){this._inner.update(t)},reverse:function(){return new cc.ActionEase(this._inner.reverse())},getInnerAction:function(){return this._inner}}),cc.actionEase=function(t){return new cc.ActionEase(t)},cc.EaseRateAction=cc.ActionEase.extend({_rate:0,ctor:function(t,e){cc.ActionEase.prototype.ctor.call(this),void 0!==e&&this.initWithAction(t,e)},setRate:function(t){this._rate=t},getRate:function(){return this._rate},initWithAction:function(t,e){if(cc.ActionEase.prototype.initWithAction.call(this,t))return this._rate=e,!0;else return!1},clone:function(){var t=new cc.EaseRateAction;return t.initWithAction(this._inner.clone(),this._rate),t},reverse:function(){return new cc.EaseRateAction(this._inner.reverse(),1/this._rate)}}),cc.easeRateAction=function(t,e){return new cc.EaseRateAction(t,e)},cc.EaseIn=cc.EaseRateAction.extend({update:function(t){this._inner.update(Math.pow(t,this._rate))},reverse:function(){return new cc.EaseIn(this._inner.reverse(),1/this._rate)},clone:function(){var t=new cc.EaseIn;return t.initWithAction(this._inner.clone(),this._rate),t}}),cc.easeIn=function(t){return{_rate:t,easing:function(t){return Math.pow(t,this._rate)},reverse:function(){return cc.easeIn(1/this._rate)}}},cc.EaseOut=cc.EaseRateAction.extend({update:function(t){this._inner.update(Math.pow(t,1/this._rate))},reverse:function(){return new cc.EaseOut(this._inner.reverse(),1/this._rate)},clone:function(){var t=new cc.EaseOut;return t.initWithAction(this._inner.clone(),this._rate),t}}),cc.easeOut=function(t){return{_rate:t,easing:function(t){return Math.pow(t,1/this._rate)},reverse:function(){return cc.easeOut(1/this._rate)}}},cc.EaseInOut=cc.EaseRateAction.extend({update:function(t){if(t*=2,1>t)this._inner.update(.5*Math.pow(t,this._rate));else this._inner.update(1-.5*Math.pow(2-t,this._rate))},clone:function(){var t=new cc.EaseInOut;return t.initWithAction(this._inner.clone(),this._rate),t},reverse:function(){return new cc.EaseInOut(this._inner.reverse(),this._rate)}}),cc.easeInOut=function(t){return{_rate:t,easing:function(t){if(t*=2,1>t)return.5*Math.pow(t,this._rate);else return 1-.5*Math.pow(2-t,this._rate)},reverse:function(){return cc.easeInOut(this._rate)}}},cc.EaseExponentialIn=cc.ActionEase.extend({update:function(t){this._inner.update(0===t?0:Math.pow(2,10*(t-1)))},reverse:function(){return new cc.EaseExponentialOut(this._inner.reverse())},clone:function(){var t=new cc.EaseExponentialIn;return t.initWithAction(this._inner.clone()),t}}),cc._easeExponentialInObj={easing:function(t){return 0===t?0:Math.pow(2,10*(t-1))},reverse:function(){return cc._easeExponentialOutObj}},cc.easeExponentialIn=function(){return cc._easeExponentialInObj},cc.EaseExponentialOut=cc.ActionEase.extend({update:function(t){this._inner.update(1===t?1:-Math.pow(2,-10*t)+1)},reverse:function(){return new cc.EaseExponentialIn(this._inner.reverse())},clone:function(){var t=new cc.EaseExponentialOut;return t.initWithAction(this._inner.clone()),t}}),cc._easeExponentialOutObj={easing:function(t){return 1===t?1:-Math.pow(2,-10*t)+1},reverse:function(){return cc._easeExponentialInObj}},cc.easeExponentialOut=function(){return cc._easeExponentialOutObj},cc.EaseExponentialInOut=cc.ActionEase.extend({update:function(t){if(1!==t&&0!==t)if(t*=2,1>t)t=.5*Math.pow(2,10*(t-1));else t=.5*(-Math.pow(2,-10*(t-1))+2);this._inner.update(t)},reverse:function(){return new cc.EaseExponentialInOut(this._inner.reverse())},clone:function(){var t=new cc.EaseExponentialInOut;return t.initWithAction(this._inner.clone()),t}}),cc._easeExponentialInOutObj={easing:function(t){if(1!==t&&0!==t)if(t*=2,1>t)return.5*Math.pow(2,10*(t-1));else return.5*(-Math.pow(2,-10*(t-1))+2);return t},reverse:function(){return cc._easeExponentialInOutObj}},cc.easeExponentialInOut=function(){return cc._easeExponentialInOutObj},cc.EaseSineIn=cc.ActionEase.extend({update:function(t){t=0===t||1===t?t:-1*Math.cos(t*Math.PI/2)+1,this._inner.update(t)},reverse:function(){return new cc.EaseSineOut(this._inner.reverse())},clone:function(){var t=new cc.EaseSineIn;return t.initWithAction(this._inner.clone()),t}}),cc._easeSineInObj={easing:function(t){return 0===t||1===t?t:-1*Math.cos(t*Math.PI/2)+1},reverse:function(){return cc._easeSineOutObj}},cc.easeSineIn=function(){return cc._easeSineInObj},cc.EaseSineOut=cc.ActionEase.extend({update:function(t){t=0===t||1===t?t:Math.sin(t*Math.PI/2),this._inner.update(t)},reverse:function(){return new cc.EaseSineIn(this._inner.reverse())},clone:function(){var t=new cc.EaseSineOut;return t.initWithAction(this._inner.clone()),t}}),cc._easeSineOutObj={easing:function(t){return 0===t||1===t?t:Math.sin(t*Math.PI/2)},reverse:function(){return cc._easeSineInObj}},cc.easeSineOut=function(){return cc._easeSineOutObj},cc.EaseSineInOut=cc.ActionEase.extend({update:function(t){t=0===t||1===t?t:-.5*(Math.cos(Math.PI*t)-1),this._inner.update(t)},clone:function(){var t=new cc.EaseSineInOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseSineInOut(this._inner.reverse())}}),cc._easeSineInOutObj={easing:function(t){return 0===t||1===t?t:-.5*(Math.cos(Math.PI*t)-1)},reverse:function(){return cc._easeSineInOutObj}},cc.easeSineInOut=function(){return cc._easeSineInOutObj},cc.EaseElastic=cc.ActionEase.extend({_period:.3,ctor:function(t,e){cc.ActionEase.prototype.ctor.call(this),t&&this.initWithAction(t,e)},getPeriod:function(){return this._period},setPeriod:function(t){this._period=t},initWithAction:function(t,e){return cc.ActionEase.prototype.initWithAction.call(this,t),this._period=null==e?.3:e,!0},reverse:function(){return cc.log("cc.EaseElastic.reverse(): it should be overridden in subclass."),null},clone:function(){var t=new cc.EaseElastic;return t.initWithAction(this._inner.clone(),this._period),t}}),cc.EaseElasticIn=cc.EaseElastic.extend({update:function(t){var e=0;if(0===t||1===t)e=t;else{var i=this._period/4;t-=1,e=-Math.pow(2,10*t)*Math.sin((t-i)*Math.PI*2/this._period)}this._inner.update(e)},reverse:function(){return new cc.EaseElasticOut(this._inner.reverse(),this._period)},clone:function(){var t=new cc.EaseElasticIn;return t.initWithAction(this._inner.clone(),this._period),t}}),cc._easeElasticInObj={easing:function(t){if(0===t||1===t)return t;else return t-=1,-Math.pow(2,10*t)*Math.sin((t-.075)*Math.PI*2/.3)},reverse:function(){return cc._easeElasticOutObj}},cc.easeElasticIn=function(t){if(t&&.3!==t)return{_period:t,easing:function(t){if(0===t||1===t)return t;else return t-=1,-Math.pow(2,10*t)*Math.sin((t-this._period/4)*Math.PI*2/this._period)},reverse:function(){return cc.easeElasticOut(this._period)}};else return cc._easeElasticInObj},cc.EaseElasticOut=cc.EaseElastic.extend({update:function(t){var e=0;if(0===t||1===t)e=t;else{var i=this._period/4;e=Math.pow(2,-10*t)*Math.sin((t-i)*Math.PI*2/this._period)+1}this._inner.update(e)},reverse:function(){return new cc.EaseElasticIn(this._inner.reverse(),this._period)},clone:function(){var t=new cc.EaseElasticOut;return t.initWithAction(this._inner.clone(),this._period),t}}),cc._easeElasticOutObj={easing:function(t){return 0===t||1===t?t:Math.pow(2,-10*t)*Math.sin((t-.075)*Math.PI*2/.3)+1},reverse:function(){return cc._easeElasticInObj}},cc.easeElasticOut=function(t){if(t&&.3!==t)return{_period:t,easing:function(t){return 0===t||1===t?t:Math.pow(2,-10*t)*Math.sin((t-this._period/4)*Math.PI*2/this._period)+1},reverse:function(){return cc.easeElasticIn(this._period)}};else return cc._easeElasticOutObj},cc.EaseElasticInOut=cc.EaseElastic.extend({update:function(t){var e=0,i=this._period;if(0===t||1===t)e=t;else{if(t=2*t,!i)i=this._period=.3*1.5;var n=i/4;if(t-=1,0>t)e=-.5*Math.pow(2,10*t)*Math.sin((t-n)*Math.PI*2/i);else e=Math.pow(2,-10*t)*Math.sin((t-n)*Math.PI*2/i)*.5+1}this._inner.update(e)},reverse:function(){return new cc.EaseElasticInOut(this._inner.reverse(),this._period)},clone:function(){var t=new cc.EaseElasticInOut;return t.initWithAction(this._inner.clone(),this._period),t}}),cc.easeElasticInOut=function(t){return t=t||.3,{_period:t,easing:function(t){var e=0,i=this._period;if(0===t||1===t)e=t;else{if(t=2*t,!i)i=this._period=.3*1.5;var n=i/4;if(t-=1,0>t)e=-.5*Math.pow(2,10*t)*Math.sin((t-n)*Math.PI*2/i);else e=Math.pow(2,-10*t)*Math.sin((t-n)*Math.PI*2/i)*.5+1}return e},reverse:function(){return cc.easeElasticInOut(this._period)}}},cc.EaseBounce=cc.ActionEase.extend({bounceTime:function(t){if(1/2.75>t)return 7.5625*t*t;else if(2/2.75>t)return t-=1.5/2.75,7.5625*t*t+.75;else if(2.5/2.75>t)return t-=2.25/2.75,7.5625*t*t+.9375;return t-=2.625/2.75,7.5625*t*t+.984375},clone:function(){var t=new cc.EaseBounce;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseBounce(this._inner.reverse())}}),cc.EaseBounceIn=cc.EaseBounce.extend({update:function(t){var e=1-this.bounceTime(1-t);this._inner.update(e)},reverse:function(){return new cc.EaseBounceOut(this._inner.reverse())},clone:function(){var t=new cc.EaseBounceIn;return t.initWithAction(this._inner.clone()),t}}),cc._bounceTime=function(t){if(1/2.75>t)return 7.5625*t*t;else if(2/2.75>t)return t-=1.5/2.75,7.5625*t*t+.75;else if(2.5/2.75>t)return t-=2.25/2.75,7.5625*t*t+.9375;return t-=2.625/2.75,7.5625*t*t+.984375},cc._easeBounceInObj={easing:function(t){return 1-cc._bounceTime(1-t)},reverse:function(){return cc._easeBounceOutObj}},cc.easeBounceIn=function(){return cc._easeBounceInObj},cc.EaseBounceOut=cc.EaseBounce.extend({update:function(t){var e=this.bounceTime(t);this._inner.update(e)},reverse:function(){return new cc.EaseBounceIn(this._inner.reverse())},clone:function(){var t=new cc.EaseBounceOut;return t.initWithAction(this._inner.clone()),t}}),cc._easeBounceOutObj={easing:function(t){return cc._bounceTime(t)},reverse:function(){return cc._easeBounceInObj}},cc.easeBounceOut=function(){return cc._easeBounceOutObj},cc.EaseBounceInOut=cc.EaseBounce.extend({update:function(t){var e=0;if(.5>t)t=2*t,e=.5*(1-this.bounceTime(1-t));else e=.5*this.bounceTime(2*t-1)+.5;this._inner.update(e)},clone:function(){var t=new cc.EaseBounceInOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseBounceInOut(this._inner.reverse())}}),cc._easeBounceInOutObj={easing:function(t){var e;if(.5>t)t=2*t,e=.5*(1-cc._bounceTime(1-t));else e=.5*cc._bounceTime(2*t-1)+.5;return e},reverse:function(){return cc._easeBounceInOutObj}},cc.easeBounceInOut=function(){return cc._easeBounceInOutObj},cc.EaseBackIn=cc.ActionEase.extend({update:function(t){var e=1.70158;t=0===t||1===t?t:t*t*((e+1)*t-e),this._inner.update(t)},reverse:function(){return new cc.EaseBackOut(this._inner.reverse())},clone:function(){var t=new cc.EaseBackIn;return t.initWithAction(this._inner.clone()),t}}),cc._easeBackInObj={easing:function(t){var e=1.70158;return 0===t||1===t?t:t*t*((e+1)*t-e)},reverse:function(){return cc._easeBackOutObj}},cc.easeBackIn=function(){return cc._easeBackInObj},cc.EaseBackOut=cc.ActionEase.extend({update:function(t){var e=1.70158;t-=1,this._inner.update(t*t*((e+1)*t+e)+1)},reverse:function(){return new cc.EaseBackIn(this._inner.reverse())},clone:function(){var t=new cc.EaseBackOut;return t.initWithAction(this._inner.clone()),t}}),cc._easeBackOutObj={easing:function(t){var e=1.70158;return t-=1,t*t*((e+1)*t+e)+1},reverse:function(){return cc._easeBackInObj}},cc.easeBackOut=function(){return cc._easeBackOutObj},cc.EaseBackInOut=cc.ActionEase.extend({update:function(t){var e=2.5949095;if(t=2*t,1>t)this._inner.update(t*t*((e+1)*t-e)/2);else t-=2,this._inner.update(t*t*((e+1)*t+e)/2+1)},clone:function(){var t=new cc.EaseBackInOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseBackInOut(this._inner.reverse())}}),cc._easeBackInOutObj={easing:function(t){var e=2.5949095;if(t=2*t,1>t)return t*t*((e+1)*t-e)/2;else return t-=2,t*t*((e+1)*t+e)/2+1},reverse:function(){return cc._easeBackInOutObj}},cc.easeBackInOut=function(){return cc._easeBackInOutObj},cc.EaseBezierAction=cc.ActionEase.extend({_p0:null,_p1:null,_p2:null,_p3:null,ctor:function(t){cc.ActionEase.prototype.ctor.call(this,t)},_updateTime:function(t,e,i,n,r){return Math.pow(1-r,3)*t+3*r*Math.pow(1-r,2)*e+3*Math.pow(r,2)*(1-r)*i+Math.pow(r,3)*n},update:function(t){var e=this._updateTime(this._p0,this._p1,this._p2,this._p3,t);this._inner.update(e)},clone:function(){var t=new cc.EaseBezierAction;return t.initWithAction(this._inner.clone()),t.setBezierParamer(this._p0,this._p1,this._p2,this._p3),t},reverse:function(){var t=new cc.EaseBezierAction(this._inner.reverse());return t.setBezierParamer(this._p3,this._p2,this._p1,this._p0),t},setBezierParamer:function(t,e,i,n){this._p0=t||0,this._p1=e||0,this._p2=i||0,this._p3=n||0}}),cc.easeBezierAction=function(t,e,i,n){return{easing:function(r){return cc.EaseBezierAction.prototype._updateTime(t,e,i,n,r)},reverse:function(){return cc.easeBezierAction(n,i,e,t)}}},cc.EaseQuadraticActionIn=cc.ActionEase.extend({_updateTime:function(t){return Math.pow(t,2)},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseQuadraticActionIn;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseQuadraticActionIn(this._inner.reverse())}}),cc._easeQuadraticActionIn={easing:cc.EaseQuadraticActionIn.prototype._updateTime,reverse:function(){return cc._easeQuadraticActionIn}},cc.easeQuadraticActionIn=function(){return cc._easeQuadraticActionIn},cc.EaseQuadraticActionOut=cc.ActionEase.extend({_updateTime:function(t){return-t*(t-2)},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseQuadraticActionOut;return t.initWithAction(),t},reverse:function(){return new cc.EaseQuadraticActionOut(this._inner.reverse())}}),cc._easeQuadraticActionOut={easing:cc.EaseQuadraticActionOut.prototype._updateTime,reverse:function(){return cc._easeQuadraticActionOut}},cc.easeQuadraticActionOut=function(){return cc._easeQuadraticActionOut},cc.EaseQuadraticActionInOut=cc.ActionEase.extend({_updateTime:function(t){var e=t;if(t*=2,1>t)e=t*t*.5;else--t,e=-.5*(t*(t-2)-1);return e},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseQuadraticActionInOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseQuadraticActionInOut(this._inner.reverse())}}),cc._easeQuadraticActionInOut={easing:cc.EaseQuadraticActionInOut.prototype._updateTime,reverse:function(){return cc._easeQuadraticActionInOut}},cc.easeQuadraticActionInOut=function(){return cc._easeQuadraticActionInOut},cc.EaseQuarticActionIn=cc.ActionEase.extend({_updateTime:function(t){return t*t*t*t},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseQuarticActionIn;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseQuarticActionIn(this._inner.reverse())}}),cc._easeQuarticActionIn={easing:cc.EaseQuarticActionIn.prototype._updateTime,reverse:function(){return cc._easeQuarticActionIn}},cc.easeQuarticActionIn=function(){return cc._easeQuarticActionIn},cc.EaseQuarticActionOut=cc.ActionEase.extend({_updateTime:function(t){return t-=1,-(t*t*t*t-1)},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseQuarticActionOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseQuarticActionOut(this._inner.reverse())}}),cc._easeQuarticActionOut={easing:cc.EaseQuarticActionOut.prototype._updateTime,reverse:function(){return cc._easeQuarticActionOut}},cc.easeQuarticActionOut=function(){return cc._easeQuarticActionOut},cc.EaseQuarticActionInOut=cc.ActionEase.extend({_updateTime:function(t){if(t=2*t,1>t)return.5*t*t*t*t;else return t-=2,-.5*(t*t*t*t-2)},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseQuarticActionInOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseQuarticActionInOut(this._inner.reverse())}}),cc._easeQuarticActionInOut={easing:cc.EaseQuarticActionInOut.prototype._updateTime,reverse:function(){return cc._easeQuarticActionInOut}},cc.easeQuarticActionInOut=function(){return cc._easeQuarticActionInOut},cc.EaseQuinticActionIn=cc.ActionEase.extend({_updateTime:function(t){return t*t*t*t*t},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseQuinticActionIn;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseQuinticActionIn(this._inner.reverse())}}),cc._easeQuinticActionIn={easing:cc.EaseQuinticActionIn.prototype._updateTime,reverse:function(){return cc._easeQuinticActionIn}},cc.easeQuinticActionIn=function(){return cc._easeQuinticActionIn},cc.EaseQuinticActionOut=cc.ActionEase.extend({_updateTime:function(t){return t-=1,t*t*t*t*t+1},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseQuinticActionOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseQuinticActionOut(this._inner.reverse())}}),cc._easeQuinticActionOut={easing:cc.EaseQuinticActionOut.prototype._updateTime,reverse:function(){return cc._easeQuinticActionOut}},cc.easeQuinticActionOut=function(){return cc._easeQuinticActionOut},cc.EaseQuinticActionInOut=cc.ActionEase.extend({_updateTime:function(t){if(t=2*t,1>t)return.5*t*t*t*t*t;else return t-=2,.5*(t*t*t*t*t+2)},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseQuinticActionInOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseQuinticActionInOut(this._inner.reverse())}}),cc._easeQuinticActionInOut={easing:cc.EaseQuinticActionInOut.prototype._updateTime,reverse:function(){return cc._easeQuinticActionInOut}},cc.easeQuinticActionInOut=function(){return cc._easeQuinticActionInOut},cc.EaseCircleActionIn=cc.ActionEase.extend({_updateTime:function(t){return-1*(Math.sqrt(1-t*t)-1)},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseCircleActionIn;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseCircleActionIn(this._inner.reverse())}}),cc._easeCircleActionIn={easing:cc.EaseCircleActionIn.prototype._updateTime,reverse:function(){return cc._easeCircleActionIn}},cc.easeCircleActionIn=function(){return cc._easeCircleActionIn},cc.EaseCircleActionOut=cc.ActionEase.extend({_updateTime:function(t){return t-=1,Math.sqrt(1-t*t)},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseCircleActionOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseCircleActionOut(this._inner.reverse())}}),cc._easeCircleActionOut={easing:cc.EaseCircleActionOut.prototype._updateTime,reverse:function(){return cc._easeCircleActionOut}},cc.easeCircleActionOut=function(){return cc._easeCircleActionOut},cc.EaseCircleActionInOut=cc.ActionEase.extend({_updateTime:function(t){if(t=2*t,1>t)return-.5*(Math.sqrt(1-t*t)-1);else return t-=2,.5*(Math.sqrt(1-t*t)+1)},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseCircleActionInOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseCircleActionInOut(this._inner.reverse())}}),cc._easeCircleActionInOut={easing:cc.EaseCircleActionInOut.prototype._updateTime,reverse:function(){return cc._easeCircleActionInOut}},cc.easeCircleActionInOut=function(){return cc._easeCircleActionInOut},cc.EaseCubicActionIn=cc.ActionEase.extend({_updateTime:function(t){return t*t*t},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseCubicActionIn;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseCubicActionIn(this._inner.reverse())}}),cc._easeCubicActionIn={easing:cc.EaseCubicActionIn.prototype._updateTime,reverse:function(){return cc._easeCubicActionIn}},cc.easeCubicActionIn=function(){return cc._easeCubicActionIn},cc.EaseCubicActionOut=cc.ActionEase.extend({_updateTime:function(t){return t-=1,t*t*t+1},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseCubicActionOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseCubicActionOut(this._inner.reverse())}}),cc._easeCubicActionOut={easing:cc.EaseCubicActionOut.prototype._updateTime,reverse:function(){return cc._easeCubicActionOut}},cc.easeCubicActionOut=function(){return cc._easeCubicActionOut},cc.EaseCubicActionInOut=cc.ActionEase.extend({_updateTime:function(t){if(t=2*t,1>t)return.5*t*t*t;else return t-=2,.5*(t*t*t+2)},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseCubicActionInOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseCubicActionInOut(this._inner.reverse())}}),cc._easeCubicActionInOut={easing:cc.EaseCubicActionInOut.prototype._updateTime,reverse:function(){return cc._easeCubicActionInOut}},cc.easeCubicActionInOut=function(){return cc._easeCubicActionInOut}},{}],6:[function(t,e,i){cc.ActionInstant=cc.FiniteTimeAction.extend({isDone:function(){return!0},step:function(t){this.update(1)},update:function(t){},reverse:function(){return this.clone()},clone:function(){return new cc.ActionInstant}}),cc.Show=cc.ActionInstant.extend({update:function(t){this.target.visible=!0},reverse:function(){return new cc.Hide},clone:function(){return new cc.Show}}),cc.show=function(){return new cc.Show},cc.Hide=cc.ActionInstant.extend({update:function(t){this.target.visible=!1},reverse:function(){return new cc.Show},clone:function(){return new cc.Hide}}),cc.hide=function(){return new cc.Hide},cc.ToggleVisibility=cc.ActionInstant.extend({update:function(t){this.target.visible=!this.target.visible},reverse:function(){return new cc.ToggleVisibility},clone:function(){return new cc.ToggleVisibility}}),cc.toggleVisibility=function(){return new cc.ToggleVisibility},cc.RemoveSelf=cc.ActionInstant.extend({_isNeedCleanUp:!0,ctor:function(t){cc.FiniteTimeAction.prototype.ctor.call(this),void 0!==t&&this.init(t)},update:function(t){this.target.removeFromParent(this._isNeedCleanUp)},init:function(t){return this._isNeedCleanUp=t,!0},reverse:function(){return new cc.RemoveSelf(this._isNeedCleanUp)},clone:function(){return new cc.RemoveSelf(this._isNeedCleanUp)}}),cc.removeSelf=function(t){return new cc.RemoveSelf(t)},cc.FlipX=cc.ActionInstant.extend({_flippedX:!1,ctor:function(t){cc.FiniteTimeAction.prototype.ctor.call(this),this._flippedX=!1,void 0!==t&&this.initWithFlipX(t)},initWithFlipX:function(t){return this._flippedX=t,!0},update:function(t){this.target.scaleX=Math.abs(this.target.scaleX)*(this._flippedX?1:-1)},reverse:function(){return new cc.FlipX(!this._flippedX)},clone:function(){var t=new cc.FlipX;return t.initWithFlipX(this._flippedX),t}}),cc.flipX=function(t){return new cc.FlipX(t)},cc.FlipY=cc.ActionInstant.extend({_flippedY:!1,ctor:function(t){cc.FiniteTimeAction.prototype.ctor.call(this),this._flippedY=!1,void 0!==t&&this.initWithFlipY(t)},initWithFlipY:function(t){return this._flippedY=t,!0},update:function(t){this.target.scaleY=Math.abs(this.target.scaleY)*(this._flippedX?1:-1)},reverse:function(){return new cc.FlipY(!this._flippedY)},clone:function(){var t=new cc.FlipY;return t.initWithFlipY(this._flippedY),t}}),cc.flipY=function(t){return new cc.FlipY(t)},cc.Place=cc.ActionInstant.extend({_x:0,_y:0,ctor:function(t,e){if(cc.FiniteTimeAction.prototype.ctor.call(this),this._x=0,this._y=0,void 0!==t){if(void 0!==t.x)e=t.y,t=t.x;this.initWithPosition(t,e)}},initWithPosition:function(t,e){return this._x=t,this._y=e,!0},update:function(t){this.target.setPosition(this._x,this._y)},clone:function(){var t=new cc.Place;return t.initWithPosition(this._x,this._y),t}}),cc.place=function(t,e){return new cc.Place(t,e)},cc.CallFunc=cc.ActionInstant.extend({_selectorTarget:null,_function:null,_data:null,ctor:function(t,e,i){cc.FiniteTimeAction.prototype.ctor.call(this),this.initWithFunction(t,e,i)},initWithFunction:function(t,e,i){if(t)this._function=t;if(e)this._selectorTarget=e;if(void 0!==i)this._data=i;return!0},execute:function(){if(this._function)this._function.call(this._selectorTarget,this.target,this._data)},update:function(t){this.execute()},getTargetCallback:function(){return this._selectorTarget},setTargetCallback:function(t){if(t!==this._selectorTarget){if(this._selectorTarget)this._selectorTarget=null;this._selectorTarget=t}},clone:function(){var t=new cc.CallFunc;return t.initWithFunction(this._function,this._selectorTarget,this._data),t}}),cc.callFunc=function(t,e,i){return new cc.CallFunc(t,e,i)}},{}],7:[function(t,e,i){cc.ActionInterval=cc.FiniteTimeAction.extend({_elapsed:0,_firstTick:!1,_easeList:null,_timesForRepeat:1,_repeatForever:!1,_repeatMethod:!1,_speed:1,_speedMethod:!1,ctor:function(t){this._speed=1,this._timesForRepeat=1,this._repeatForever=!1,this.MAX_VALUE=2,this._repeatMethod=!1,this._speedMethod=!1,cc.FiniteTimeAction.prototype.ctor.call(this),void 0!==t&&this.initWithDuration(t)},getElapsed:function(){return this._elapsed},initWithDuration:function(t){return this._duration=0===t?cc.macro.FLT_EPSILON:t,this._elapsed=0,this._firstTick=!0,!0},isDone:function(){return this._elapsed>=this._duration},_cloneDecoration:function(t){t._repeatForever=this._repeatForever,t._speed=this._speed,t._timesForRepeat=this._timesForRepeat,t._easeList=this._easeList,t._speedMethod=this._speedMethod,t._repeatMethod=this._repeatMethod},_reverseEaseList:function(t){if(this._easeList){t._easeList=[];for(var e=0;e<this._easeList.length;e++)t._easeList.push(this._easeList[e].reverse())}},clone:function(){var t=new cc.ActionInterval(this._duration);return this._cloneDecoration(t),t},easing:function(t){if(this._easeList)this._easeList.length=0;else this._easeList=[];for(var e=0;e<arguments.length;e++)this._easeList.push(arguments[e]);return this},_computeEaseTime:function(t){var e=this._easeList;if(!e||0===e.length)return t;for(var i=0,n=e.length;n>i;i++)t=e[i].easing(t);return t},step:function(t){if(this._firstTick)this._firstTick=!1,
this._elapsed=0;else this._elapsed+=t;var e=this._elapsed/(this._duration>1.192092896e-7?this._duration:1.192092896e-7);if(e=1>e?e:1,this.update(e>0?e:0),this._repeatMethod&&this._timesForRepeat>1&&this.isDone()){if(!this._repeatForever)this._timesForRepeat--;this.startWithTarget(this.target),this.step(this._elapsed-this._duration)}},startWithTarget:function(t){cc.Action.prototype.startWithTarget.call(this,t),this._elapsed=0,this._firstTick=!0},reverse:function(){return cc.log("cc.IntervalAction: reverse not implemented."),null},setAmplitudeRate:function(t){cc.log("cc.ActionInterval.setAmplitudeRate(): it should be overridden in subclass.")},getAmplitudeRate:function(){return cc.log("cc.ActionInterval.getAmplitudeRate(): it should be overridden in subclass."),0},speed:function(t){if(0>=t)return cc.log("The speed parameter error"),this;else return this._speedMethod=!0,this._speed*=t,this},getSpeed:function(){return this._speed},setSpeed:function(t){return this._speed=t,this},repeat:function(t){if(t=Math.round(t),isNaN(t)||1>t)return cc.log("The repeat parameter error"),this;else return this._repeatMethod=!0,this._timesForRepeat*=t,this},repeatForever:function(){return this._repeatMethod=!0,this._timesForRepeat=this.MAX_VALUE,this._repeatForever=!0,this}}),cc.actionInterval=function(t){return new cc.ActionInterval(t)},cc.Sequence=cc.ActionInterval.extend({_actions:null,_split:null,_last:0,ctor:function(t){cc.ActionInterval.prototype.ctor.call(this),this._actions=[];var e=t instanceof Array?t:arguments,i=e.length-1;if(i>=0&&null==e[i])cc.log("parameters should not be ending with null in Javascript");if(i>=0){for(var n,r=e[0],s=1;i>s;s++)if(e[s])n=r,r=cc.Sequence._actionOneTwo(n,e[s]);this.initWithTwoActions(r,e[i])}},initWithTwoActions:function(t,e){if(!t||!e)throw new Error("cc.Sequence.initWithTwoActions(): arguments must all be non nil");var i=t._duration+e._duration;return this.initWithDuration(i),this._actions[0]=t,this._actions[1]=e,!0},clone:function(){var t=new cc.Sequence;return this._cloneDecoration(t),t.initWithTwoActions(this._actions[0].clone(),this._actions[1].clone()),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._split=this._actions[0]._duration/this._duration,this._last=-1},stop:function(){if(-1!==this._last)this._actions[this._last].stop();cc.Action.prototype.stop.call(this)},update:function(t){var e,i,n=0,r=this._split,s=this._actions,o=this._last;if(t=this._computeEaseTime(t),r>t){if(e=0!==r?t/r:1,0===n&&1===o)s[1].update(0),s[1].stop()}else{if(n=1,e=1===r?1:(t-r)/(1-r),-1===o)s[0].startWithTarget(this.target),s[0].update(1),s[0].stop();if(!o)s[0].update(1),s[0].stop()}if(i=s[n],o!==n||!i.isDone()){if(o!==n)i.startWithTarget(this.target);e*=i._timesForRepeat,i.update(e>1?e%1:e),this._last=n}},reverse:function(){var t=cc.Sequence._actionOneTwo(this._actions[1].reverse(),this._actions[0].reverse());return this._cloneDecoration(t),this._reverseEaseList(t),t}}),cc.sequence=function(t){var e=t instanceof Array?t:arguments;if(e.length>0&&null==e[e.length-1])cc.log("parameters should not be ending with null in Javascript");for(var i,n,r,s;e&&e.length>0;){if(n=Array.prototype.shift.call(e),s=n._timesForRepeat||1,n._repeatMethod=!1,n._timesForRepeat=1,r=0,!i)i=n,r=1;for(r;s>r;r++)i=cc.Sequence._actionOneTwo(i,n)}return i},cc.Sequence._actionOneTwo=function(t,e){var i=new cc.Sequence;return i.initWithTwoActions(t,e),i},cc.Repeat=cc.ActionInterval.extend({_times:0,_total:0,_nextDt:0,_actionInstant:!1,_innerAction:null,ctor:function(t,e){cc.ActionInterval.prototype.ctor.call(this),void 0!==e&&this.initWithAction(t,e)},initWithAction:function(t,e){var i=t._duration*e;if(this.initWithDuration(i)){if(this._times=e,this._innerAction=t,t instanceof cc.ActionInstant)this._actionInstant=!0,this._times-=1;return this._total=0,!0}return!1},clone:function(){var t=new cc.Repeat;return this._cloneDecoration(t),t.initWithAction(this._innerAction.clone(),this._times),t},startWithTarget:function(t){this._total=0,this._nextDt=this._innerAction._duration/this._duration,cc.ActionInterval.prototype.startWithTarget.call(this,t),this._innerAction.startWithTarget(t)},stop:function(){this._innerAction.stop(),cc.Action.prototype.stop.call(this)},update:function(t){t=this._computeEaseTime(t);var e=this._innerAction,i=this._duration,n=this._times,r=this._nextDt;if(t>=r){for(;t>r&&this._total<n;)e.update(1),this._total++,e.stop(),e.startWithTarget(this.target),r+=e._duration/i,this._nextDt=r;if(t>=1&&this._total<n)this._total++;if(!this._actionInstant)if(this._total===n)e.update(1),e.stop();else e.update(t-(r-e._duration/i))}else e.update(t*n%1)},isDone:function(){return this._total===this._times},reverse:function(){var t=new cc.Repeat(this._innerAction.reverse(),this._times);return this._cloneDecoration(t),this._reverseEaseList(t),t},setInnerAction:function(t){if(this._innerAction!==t)this._innerAction=t},getInnerAction:function(){return this._innerAction}}),cc.repeat=function(t,e){return new cc.Repeat(t,e)},cc.RepeatForever=cc.ActionInterval.extend({_innerAction:null,ctor:function(t){cc.ActionInterval.prototype.ctor.call(this),this._innerAction=null,t&&this.initWithAction(t)},initWithAction:function(t){if(!t)throw new Error("cc.RepeatForever.initWithAction(): action must be non null");return this._innerAction=t,!0},clone:function(){var t=new cc.RepeatForever;return this._cloneDecoration(t),t.initWithAction(this._innerAction.clone()),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._innerAction.startWithTarget(t)},step:function(t){var e=this._innerAction;if(e.step(t),e.isDone())e.startWithTarget(this.target),e.step(e.getElapsed()-e._duration)},isDone:function(){return!1},reverse:function(){var t=new cc.RepeatForever(this._innerAction.reverse());return this._cloneDecoration(t),this._reverseEaseList(t),t},setInnerAction:function(t){if(this._innerAction!==t)this._innerAction=t},getInnerAction:function(){return this._innerAction}}),cc.repeatForever=function(t){return new cc.RepeatForever(t)},cc.Spawn=cc.ActionInterval.extend({_one:null,_two:null,ctor:function(t){cc.ActionInterval.prototype.ctor.call(this),this._one=null,this._two=null;var e=t instanceof Array?t:arguments,i=e.length-1;if(i>=0&&null==e[i])cc.log("parameters should not be ending with null in Javascript");if(i>=0){for(var n,r=e[0],s=1;i>s;s++)if(e[s])n=r,r=cc.Spawn._actionOneTwo(n,e[s]);this.initWithTwoActions(r,e[i])}},initWithTwoActions:function(t,e){if(!t||!e)throw new Error("cc.Spawn.initWithTwoActions(): arguments must all be non null");var i=!1,n=t._duration,r=e._duration;if(this.initWithDuration(Math.max(n,r))){if(this._one=t,this._two=e,n>r)this._two=cc.Sequence._actionOneTwo(e,cc.delayTime(n-r));else if(r>n)this._one=cc.Sequence._actionOneTwo(t,cc.delayTime(r-n));i=!0}return i},clone:function(){var t=new cc.Spawn;return this._cloneDecoration(t),t.initWithTwoActions(this._one.clone(),this._two.clone()),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._one.startWithTarget(t),this._two.startWithTarget(t)},stop:function(){this._one.stop(),this._two.stop(),cc.Action.prototype.stop.call(this)},update:function(t){if(t=this._computeEaseTime(t),this._one)this._one.update(t);if(this._two)this._two.update(t)},reverse:function(){var t=cc.Spawn._actionOneTwo(this._one.reverse(),this._two.reverse());return this._cloneDecoration(t),this._reverseEaseList(t),t}}),cc.spawn=function(t){var e=t instanceof Array?t:arguments;if(e.length>0&&null==e[e.length-1])cc.log("parameters should not be ending with null in Javascript");for(var i=e[0],n=1;n<e.length;n++)if(null!=e[n])i=cc.Spawn._actionOneTwo(i,e[n]);return i},cc.Spawn._actionOneTwo=function(t,e){var i=new cc.Spawn;return i.initWithTwoActions(t,e),i},cc.RotateTo=cc.ActionInterval.extend({_dstAngleX:0,_startAngleX:0,_diffAngleX:0,_dstAngleY:0,_startAngleY:0,_diffAngleY:0,ctor:function(t,e,i){cc.ActionInterval.prototype.ctor.call(this),void 0!==e&&this.initWithDuration(t,e,i)},initWithDuration:function(t,e,i){if(cc.ActionInterval.prototype.initWithDuration.call(this,t))return this._dstAngleX=e||0,this._dstAngleY=i||this._dstAngleX,!0;else return!1},clone:function(){var t=new cc.RotateTo;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._dstAngleX,this._dstAngleY),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t);var e=t.rotationX%360,i=this._dstAngleX-e;if(i>180)i-=360;if(-180>i)i+=360;this._startAngleX=e,this._diffAngleX=i,this._startAngleY=t.rotationY%360;var n=this._dstAngleY-this._startAngleY;if(n>180)n-=360;if(-180>n)n+=360;this._diffAngleY=n},reverse:function(){cc.log("cc.RotateTo.reverse(): it should be overridden in subclass.")},update:function(t){if(t=this._computeEaseTime(t),this.target)this.target.rotationX=this._startAngleX+this._diffAngleX*t,this.target.rotationY=this._startAngleY+this._diffAngleY*t}}),cc.rotateTo=function(t,e,i){return new cc.RotateTo(t,e,i)},cc.RotateBy=cc.ActionInterval.extend({_angleX:0,_startAngleX:0,_angleY:0,_startAngleY:0,ctor:function(t,e,i){cc.ActionInterval.prototype.ctor.call(this),void 0!==e&&this.initWithDuration(t,e,i)},initWithDuration:function(t,e,i){if(cc.ActionInterval.prototype.initWithDuration.call(this,t))return this._angleX=e||0,this._angleY=i||this._angleX,!0;else return!1},clone:function(){var t=new cc.RotateBy;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._angleX,this._angleY),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._startAngleX=t.rotationX,this._startAngleY=t.rotationY},update:function(t){if(t=this._computeEaseTime(t),this.target)this.target.rotationX=this._startAngleX+this._angleX*t,this.target.rotationY=this._startAngleY+this._angleY*t},reverse:function(){var t=new cc.RotateBy(this._duration,-this._angleX,-this._angleY);return this._cloneDecoration(t),this._reverseEaseList(t),t}}),cc.rotateBy=function(t,e,i){return new cc.RotateBy(t,e,i)},cc.MoveBy=cc.ActionInterval.extend({_positionDelta:null,_startPosition:null,_previousPosition:null,ctor:function(t,e,i){cc.ActionInterval.prototype.ctor.call(this),this._positionDelta=cc.p(0,0),this._startPosition=cc.p(0,0),this._previousPosition=cc.p(0,0),void 0!==e&&this.initWithDuration(t,e,i)},initWithDuration:function(t,e,i){if(cc.ActionInterval.prototype.initWithDuration.call(this,t)){if(void 0!==e.x)i=e.y,e=e.x;return this._positionDelta.x=e,this._positionDelta.y=i,!0}return!1},clone:function(){var t=new cc.MoveBy;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._positionDelta),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t);var e=t.getPositionX(),i=t.getPositionY();this._previousPosition.x=e,this._previousPosition.y=i,this._startPosition.x=e,this._startPosition.y=i},update:function(t){if(t=this._computeEaseTime(t),this.target){var e=this._positionDelta.x*t,i=this._positionDelta.y*t,n=this._startPosition;if(cc.macro.ENABLE_STACKABLE_ACTIONS){var r=this.target.getPositionX(),s=this.target.getPositionY(),o=this._previousPosition;n.x=n.x+r-o.x,n.y=n.y+s-o.y,e+=n.x,i+=n.y,o.x=e,o.y=i,this.target.setPosition(e,i)}else this.target.setPosition(n.x+e,n.y+i)}},reverse:function(){var t=new cc.MoveBy(this._duration,cc.p(-this._positionDelta.x,-this._positionDelta.y));return this._cloneDecoration(t),this._reverseEaseList(t),t}}),cc.moveBy=function(t,e,i){return new cc.MoveBy(t,e,i)},cc.MoveTo=cc.MoveBy.extend({_endPosition:null,ctor:function(t,e,i){cc.MoveBy.prototype.ctor.call(this),this._endPosition=cc.p(0,0),void 0!==e&&this.initWithDuration(t,e,i)},initWithDuration:function(t,e,i){if(cc.MoveBy.prototype.initWithDuration.call(this,t,e,i)){if(void 0!==e.x)i=e.y,e=e.x;return this._endPosition.x=e,this._endPosition.y=i,!0}return!1},clone:function(){var t=new cc.MoveTo;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._endPosition),t},startWithTarget:function(t){cc.MoveBy.prototype.startWithTarget.call(this,t),this._positionDelta.x=this._endPosition.x-t.getPositionX(),this._positionDelta.y=this._endPosition.y-t.getPositionY()}}),cc.moveTo=function(t,e,i){return new cc.MoveTo(t,e,i)},cc.SkewTo=cc.ActionInterval.extend({_skewX:0,_skewY:0,_startSkewX:0,_startSkewY:0,_endSkewX:0,_endSkewY:0,_deltaX:0,_deltaY:0,ctor:function(t,e,i){cc.ActionInterval.prototype.ctor.call(this),void 0!==i&&this.initWithDuration(t,e,i)},initWithDuration:function(t,e,i){var n=!1;if(cc.ActionInterval.prototype.initWithDuration.call(this,t))this._endSkewX=e,this._endSkewY=i,n=!0;return n},clone:function(){var t=new cc.SkewTo;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._endSkewX,this._endSkewY),t},startWithTarget:function(t){if(cc.ActionInterval.prototype.startWithTarget.call(this,t),this._startSkewX=t.skewX%180,this._deltaX=this._endSkewX-this._startSkewX,this._deltaX>180)this._deltaX-=360;if(this._deltaX<-180)this._deltaX+=360;if(this._startSkewY=t.skewY%360,this._deltaY=this._endSkewY-this._startSkewY,this._deltaY>180)this._deltaY-=360;if(this._deltaY<-180)this._deltaY+=360},update:function(t){t=this._computeEaseTime(t),this.target.skewX=this._startSkewX+this._deltaX*t,this.target.skewY=this._startSkewY+this._deltaY*t}}),cc.skewTo=function(t,e,i){return new cc.SkewTo(t,e,i)},cc.SkewBy=cc.SkewTo.extend({ctor:function(t,e,i){cc.SkewTo.prototype.ctor.call(this),void 0!==i&&this.initWithDuration(t,e,i)},initWithDuration:function(t,e,i){var n=!1;if(cc.SkewTo.prototype.initWithDuration.call(this,t,e,i))this._skewX=e,this._skewY=i,n=!0;return n},clone:function(){var t=new cc.SkewBy;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._skewX,this._skewY),t},startWithTarget:function(t){cc.SkewTo.prototype.startWithTarget.call(this,t),this._deltaX=this._skewX,this._deltaY=this._skewY,this._endSkewX=this._startSkewX+this._deltaX,this._endSkewY=this._startSkewY+this._deltaY},reverse:function(){var t=new cc.SkewBy(this._duration,-this._skewX,-this._skewY);return this._cloneDecoration(t),this._reverseEaseList(t),t}}),cc.skewBy=function(t,e,i){return new cc.SkewBy(t,e,i)},cc.JumpBy=cc.ActionInterval.extend({_startPosition:null,_delta:null,_height:0,_jumps:0,_previousPosition:null,ctor:function(t,e,i,n,r){cc.ActionInterval.prototype.ctor.call(this),this._startPosition=cc.p(0,0),this._previousPosition=cc.p(0,0),this._delta=cc.p(0,0),void 0!==n&&this.initWithDuration(t,e,i,n,r)},initWithDuration:function(t,e,i,n,r){if(cc.ActionInterval.prototype.initWithDuration.call(this,t)){if(void 0===r)r=n,n=i,i=e.y,e=e.x;return this._delta.x=e,this._delta.y=i,this._height=n,this._jumps=r,!0}return!1},clone:function(){var t=new cc.JumpBy;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._delta,this._height,this._jumps),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t);var e=t.getPositionX(),i=t.getPositionY();this._previousPosition.x=e,this._previousPosition.y=i,this._startPosition.x=e,this._startPosition.y=i},update:function(t){if(t=this._computeEaseTime(t),this.target){var e=t*this._jumps%1,i=4*this._height*e*(1-e);i+=this._delta.y*t;var n=this._delta.x*t,r=this._startPosition;if(cc.macro.ENABLE_STACKABLE_ACTIONS){var s=this.target.getPositionX(),o=this.target.getPositionY(),a=this._previousPosition;r.x=r.x+s-a.x,r.y=r.y+o-a.y,n+=r.x,i+=r.y,a.x=n,a.y=i,this.target.setPosition(n,i)}else this.target.setPosition(r.x+n,r.y+i)}},reverse:function(){var t=new cc.JumpBy(this._duration,cc.p(-this._delta.x,-this._delta.y),this._height,this._jumps);return this._cloneDecoration(t),this._reverseEaseList(t),t}}),cc.jumpBy=function(t,e,i,n,r){return new cc.JumpBy(t,e,i,n,r)},cc.JumpTo=cc.JumpBy.extend({_endPosition:null,ctor:function(t,e,i,n,r){cc.JumpBy.prototype.ctor.call(this),this._endPosition=cc.p(0,0),void 0!==n&&this.initWithDuration(t,e,i,n,r)},initWithDuration:function(t,e,i,n,r){if(cc.JumpBy.prototype.initWithDuration.call(this,t,e,i,n,r)){if(void 0===r)i=e.y,e=e.x;return this._endPosition.x=e,this._endPosition.y=i,!0}return!1},startWithTarget:function(t){cc.JumpBy.prototype.startWithTarget.call(this,t),this._delta.x=this._endPosition.x-this._startPosition.x,this._delta.y=this._endPosition.y-this._startPosition.y},clone:function(){var t=new cc.JumpTo;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._endPosition,this._height,this._jumps),t}}),cc.jumpTo=function(t,e,i,n,r){return new cc.JumpTo(t,e,i,n,r)},cc.bezierAt=function(t,e,i,n,r){return Math.pow(1-r,3)*t+3*r*Math.pow(1-r,2)*e+3*Math.pow(r,2)*(1-r)*i+Math.pow(r,3)*n},cc.BezierBy=cc.ActionInterval.extend({_config:null,_startPosition:null,_previousPosition:null,ctor:function(t,e){cc.ActionInterval.prototype.ctor.call(this),this._config=[],this._startPosition=cc.p(0,0),this._previousPosition=cc.p(0,0),e&&this.initWithDuration(t,e)},initWithDuration:function(t,e){if(cc.ActionInterval.prototype.initWithDuration.call(this,t))return this._config=e,!0;else return!1},clone:function(){var t=new cc.BezierBy;this._cloneDecoration(t);for(var e=[],i=0;i<this._config.length;i++){var n=this._config[i];e.push(cc.p(n.x,n.y))}return t.initWithDuration(this._duration,e),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t);var e=t.getPositionX(),i=t.getPositionY();this._previousPosition.x=e,this._previousPosition.y=i,this._startPosition.x=e,this._startPosition.y=i},update:function(t){if(t=this._computeEaseTime(t),this.target){var e=this._config,i=0,n=e[0].x,r=e[1].x,s=e[2].x,o=0,a=e[0].y,c=e[1].y,l=e[2].y,h=cc.bezierAt(i,n,r,s,t),u=cc.bezierAt(o,a,c,l,t),d=this._startPosition;if(cc.macro.ENABLE_STACKABLE_ACTIONS){var f=this.target.getPositionX(),_=this.target.getPositionY(),p=this._previousPosition;d.x=d.x+f-p.x,d.y=d.y+_-p.y,h+=d.x,u+=d.y,p.x=h,p.y=u,this.target.setPosition(h,u)}else this.target.setPosition(d.x+h,d.y+u)}},reverse:function(){var t=this._config,e=[cc.pAdd(t[1],cc.pNeg(t[2])),cc.pAdd(t[0],cc.pNeg(t[2])),cc.pNeg(t[2])],i=new cc.BezierBy(this._duration,e);return this._cloneDecoration(i),this._reverseEaseList(i),i}}),cc.bezierBy=function(t,e){return new cc.BezierBy(t,e)},cc.BezierTo=cc.BezierBy.extend({_toConfig:null,ctor:function(t,e){cc.BezierBy.prototype.ctor.call(this),this._toConfig=[],e&&this.initWithDuration(t,e)},initWithDuration:function(t,e){if(cc.ActionInterval.prototype.initWithDuration.call(this,t))return this._toConfig=e,!0;else return!1},clone:function(){var t=new cc.BezierTo;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._toConfig),t},startWithTarget:function(t){cc.BezierBy.prototype.startWithTarget.call(this,t);var e=this._startPosition,i=this._toConfig,n=this._config;n[0]=cc.pSub(i[0],e),n[1]=cc.pSub(i[1],e),n[2]=cc.pSub(i[2],e)}}),cc.bezierTo=function(t,e){return new cc.BezierTo(t,e)},cc.ScaleTo=cc.ActionInterval.extend({_scaleX:1,_scaleY:1,_startScaleX:1,_startScaleY:1,_endScaleX:0,_endScaleY:0,_deltaX:0,_deltaY:0,ctor:function(t,e,i){cc.ActionInterval.prototype.ctor.call(this),void 0!==e&&this.initWithDuration(t,e,i)},initWithDuration:function(t,e,i){if(cc.ActionInterval.prototype.initWithDuration.call(this,t))return this._endScaleX=e,this._endScaleY=null!=i?i:e,!0;else return!1},clone:function(){var t=new cc.ScaleTo;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._endScaleX,this._endScaleY),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._startScaleX=t.scaleX,this._startScaleY=t.scaleY,this._deltaX=this._endScaleX-this._startScaleX,this._deltaY=this._endScaleY-this._startScaleY},update:function(t){if(t=this._computeEaseTime(t),this.target)this.target.scaleX=this._startScaleX+this._deltaX*t,this.target.scaleY=this._startScaleY+this._deltaY*t}}),cc.scaleTo=function(t,e,i){return new cc.ScaleTo(t,e,i)},cc.ScaleBy=cc.ScaleTo.extend({startWithTarget:function(t){cc.ScaleTo.prototype.startWithTarget.call(this,t),this._deltaX=this._startScaleX*this._endScaleX-this._startScaleX,this._deltaY=this._startScaleY*this._endScaleY-this._startScaleY},reverse:function(){var t=new cc.ScaleBy(this._duration,1/this._endScaleX,1/this._endScaleY);return this._cloneDecoration(t),this._reverseEaseList(t),t},clone:function(){var t=new cc.ScaleBy;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._endScaleX,this._endScaleY),t}}),cc.scaleBy=function(t,e,i){return new cc.ScaleBy(t,e,i)},cc.Blink=cc.ActionInterval.extend({_times:0,_originalState:!1,ctor:function(t,e){cc.ActionInterval.prototype.ctor.call(this),void 0!==e&&this.initWithDuration(t,e)},initWithDuration:function(t,e){if(cc.ActionInterval.prototype.initWithDuration.call(this,t))return this._times=e,!0;else return!1},clone:function(){var t=new cc.Blink;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._times),t},update:function(t){if(t=this._computeEaseTime(t),this.target&&!this.isDone()){var e=1/this._times,i=t%e;this.target.opacity=i>e/2?255:0}},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._originalState=t.opacity},stop:function(){this.target.opacity=this._originalState,cc.ActionInterval.prototype.stop.call(this)},reverse:function(){var t=new cc.Blink(this._duration,this._times);return this._cloneDecoration(t),this._reverseEaseList(t),t}}),cc.blink=function(t,e){return new cc.Blink(t,e)},cc.FadeTo=cc.ActionInterval.extend({_toOpacity:0,_fromOpacity:0,ctor:function(t,e){cc.ActionInterval.prototype.ctor.call(this),void 0!==e&&this.initWithDuration(t,e)},initWithDuration:function(t,e){if(cc.ActionInterval.prototype.initWithDuration.call(this,t))return this._toOpacity=e,!0;else return!1},clone:function(){var t=new cc.FadeTo;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._toOpacity),t},update:function(t){t=this._computeEaseTime(t);var e=void 0!==this._fromOpacity?this._fromOpacity:255;this.target.opacity=e+(this._toOpacity-e)*t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._fromOpacity=t.opacity}}),cc.fadeTo=function(t,e){return new cc.FadeTo(t,e)},cc.FadeIn=cc.FadeTo.extend({_reverseAction:null,ctor:function(t){if(cc.FadeTo.prototype.ctor.call(this),null==t)t=0;this.initWithDuration(t,255)},reverse:function(){var t=new cc.FadeOut;return t.initWithDuration(this._duration,0),this._cloneDecoration(t),this._reverseEaseList(t),t},clone:function(){var t=new cc.FadeIn;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._toOpacity),t},startWithTarget:function(t){if(this._reverseAction)this._toOpacity=this._reverseAction._fromOpacity;cc.FadeTo.prototype.startWithTarget.call(this,t)}}),cc.fadeIn=function(t){return new cc.FadeIn(t)},cc.FadeOut=cc.FadeTo.extend({ctor:function(t){if(cc.FadeTo.prototype.ctor.call(this),null==t)t=0;this.initWithDuration(t,0)},reverse:function(){var t=new cc.FadeIn;return t._reverseAction=this,t.initWithDuration(this._duration,255),this._cloneDecoration(t),this._reverseEaseList(t),t},clone:function(){var t=new cc.FadeOut;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._toOpacity),t}}),cc.fadeOut=function(t){return new cc.FadeOut(t)},cc.TintTo=cc.ActionInterval.extend({_to:null,_from:null,ctor:function(t,e,i,n){cc.ActionInterval.prototype.ctor.call(this),this._to=cc.color(0,0,0),this._from=cc.color(0,0,0),void 0!==n&&this.initWithDuration(t,e,i,n)},initWithDuration:function(t,e,i,n){if(cc.ActionInterval.prototype.initWithDuration.call(this,t))return this._to=cc.color(e,i,n),!0;else return!1},clone:function(){var t=new cc.TintTo;this._cloneDecoration(t);var e=this._to;return t.initWithDuration(this._duration,e.r,e.g,e.b),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._from=this.target.color},update:function(t){t=this._computeEaseTime(t);var e=this._from,i=this._to;if(e)this.target.setColor(cc.color(e.r+(i.r-e.r)*t,e.g+(i.g-e.g)*t,e.b+(i.b-e.b)*t))}}),cc.tintTo=function(t,e,i,n){return new cc.TintTo(t,e,i,n)},cc.TintBy=cc.ActionInterval.extend({_deltaR:0,_deltaG:0,_deltaB:0,_fromR:0,_fromG:0,_fromB:0,ctor:function(t,e,i,n){cc.ActionInterval.prototype.ctor.call(this),void 0!==n&&this.initWithDuration(t,e,i,n)},initWithDuration:function(t,e,i,n){if(cc.ActionInterval.prototype.initWithDuration.call(this,t))return this._deltaR=e,this._deltaG=i,this._deltaB=n,!0;else return!1},clone:function(){var t=new cc.TintBy;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._deltaR,this._deltaG,this._deltaB),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t);var e=t.color;this._fromR=e.r,this._fromG=e.g,this._fromB=e.b},update:function(t){t=this._computeEaseTime(t),this.target.color=cc.color(this._fromR+this._deltaR*t,this._fromG+this._deltaG*t,this._fromB+this._deltaB*t)},reverse:function(){var t=new cc.TintBy(this._duration,-this._deltaR,-this._deltaG,-this._deltaB);return this._cloneDecoration(t),this._reverseEaseList(t),t}}),cc.tintBy=function(t,e,i,n){return new cc.TintBy(t,e,i,n)},cc.DelayTime=cc.ActionInterval.extend({update:function(t){},reverse:function(){var t=new cc.DelayTime(this._duration);return this._cloneDecoration(t),this._reverseEaseList(t),t},clone:function(){var t=new cc.DelayTime;return this._cloneDecoration(t),t.initWithDuration(this._duration),t}}),cc.delayTime=function(t){return new cc.DelayTime(t)},cc.ReverseTime=cc.ActionInterval.extend({_other:null,ctor:function(t){cc.ActionInterval.prototype.ctor.call(this),this._other=null,t&&this.initWithAction(t)},initWithAction:function(t){if(!t)throw new Error("cc.ReverseTime.initWithAction(): action must be non null");if(t===this._other)throw new Error("cc.ReverseTime.initWithAction(): the action was already passed in.");if(cc.ActionInterval.prototype.initWithDuration.call(this,t._duration))return this._other=t,!0;else return!1},clone:function(){var t=new cc.ReverseTime;return this._cloneDecoration(t),t.initWithAction(this._other.clone()),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._other.startWithTarget(t)},update:function(t){if(t=this._computeEaseTime(t),this._other)this._other.update(1-t)},reverse:function(){return this._other.clone()},stop:function(){this._other.stop(),cc.Action.prototype.stop.call(this)}}),cc.reverseTime=function(t){return new cc.ReverseTime(t)},cc.Animate=cc.ActionInterval.extend({_animation:null,_nextFrame:0,_origFrame:null,_executedLoops:0,_splitTimes:null,_currFrameIndex:0,ctor:function(t){cc.ActionInterval.prototype.ctor.call(this),this._splitTimes=[],t&&this.initWithAnimation(t)},getAnimation:function(){return this._animation},setAnimation:function(t){this._animation=t},getCurrentFrameIndex:function(){return this._currFrameIndex},initWithAnimation:function(t){if(!t)throw new Error("cc.Animate.initWithAnimation(): animation must be non-NULL");var e=t.getDuration();if(this.initWithDuration(e*t.getLoops())){this._nextFrame=0,this.setAnimation(t),this._origFrame=null,this._executedLoops=0;var i=this._splitTimes;i.length=0;var n=0,r=e/t.getTotalDelayUnits(),s=t.getFrames();cc.js.array.verifyType(s,cc.AnimationFrame);for(var o=0;o<s.length;o++){var a=s[o],c=n*r/e;n+=a.getDelayUnits(),i.push(c)}return!0}return!1},clone:function(){var t=new cc.Animate;return this._cloneDecoration(t),t.initWithAnimation(this._animation.clone()),t},startWithTarget:function(t){if(cc.ActionInterval.prototype.startWithTarget.call(this,t),this._animation.getRestoreOriginalFrame())this._origFrame=t.displayFrame();this._nextFrame=0,this._executedLoops=0},update:function(t){if(t=this._computeEaseTime(t),1>t){t*=this._animation.getLoops();var e=0|t;if(e>this._executedLoops)this._nextFrame=0,this._executedLoops++;t%=1}for(var i=this._animation.getFrames(),n=i.length,r=this._splitTimes,s=this._nextFrame;n>s&&r[s]<=t;s++)_currFrameIndex=s,this.target.setSpriteFrame(i[_currFrameIndex].getSpriteFrame()),this._nextFrame=s+1},reverse:function(){var t=this._animation,e=t.getFrames(),i=[];if(cc.js.array.verifyType(e,cc.AnimationFrame),e.length>0)for(var n=e.length-1;n>=0;n--){var r=e[n];if(!r)break;i.push(r.clone())}var s=new cc.SpriteFrameAnimation(i,t.getDelayPerUnit(),t.getLoops());s.setRestoreOriginalFrame(t.getRestoreOriginalFrame());var o=new cc.Animate(s);return this._cloneDecoration(o),this._reverseEaseList(o),o},stop:function(){if(this._animation.getRestoreOriginalFrame()&&this.target)this.target.setSpriteFrame(this._origFrame);cc.Action.prototype.stop.call(this)}}),cc.animate=function(t){return new cc.Animate(t)},cc.TargetedAction=cc.ActionInterval.extend({_action:null,_forcedTarget:null,ctor:function(t,e){cc.ActionInterval.prototype.ctor.call(this),e&&this.initWithTarget(t,e)},initWithTarget:function(t,e){if(this.initWithDuration(e._duration))return this._forcedTarget=t,this._action=e,!0;else return!1},clone:function(){var t=new cc.TargetedAction;return this._cloneDecoration(t),t.initWithTarget(this._forcedTarget,this._action.clone()),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._action.startWithTarget(this._forcedTarget)},stop:function(){this._action.stop()},update:function(t){t=this._computeEaseTime(t),this._action.update(t)},getForcedTarget:function(){return this._forcedTarget},setForcedTarget:function(t){if(this._forcedTarget!==t)this._forcedTarget=t}}),cc.targetedAction=function(t,e){return new cc.TargetedAction(t,e)}},{}],8:[function(t,e,i){t("./CCAction.js"),t("./CCActionInterval.js"),t("./CCActionInstant.js"),t("./CCActionEase.js")},{"./CCAction.js":4,"./CCActionEase.js":5,"./CCActionInstant.js":6,"./CCActionInterval.js":7}],9:[function(t,e,i){function n(t,e){c.call(this,t),this.animation=e}function r(t,e,i,n){i=i.clone();for(var r=i,s=e+1,o=t.indexOf(".",s);-1!==o;){var a=t.slice(s,o);r=r[a],s=o+1,o=t.indexOf(".",s)}var c=t.slice(s);return r[c]=n,i}function s(t){var e=t.split(".");return e.shift(),e.length>0?e:null}function o(t,e){function i(t){if(!Array.isArray(t))return!1;for(var e=0,i=t.length;i>e;e++){var n=t[e];if(!Array.isArray(n)||6!==n.length)return!1}return!0}function n(t,n,r){var a,a,c=t instanceof cc.Node&&"position"===n,d=[];if(c)a=new h;else a=new l;a.target=t;var f,_,p=n.indexOf("."),g=-1!==p;if(g)f=n.slice(0,p),_=t[f];else f=n;a.prop=f,a.subProps=s(n);for(var m=0,v=r.length;v>m;m++){var y=r[m],T=y.frame/e.duration;if(a.ratios.push(T),c){var C=y.motionPath;if(C&&!i(C))cc.error("motion path of target ["+t.name+"] in prop ["+n+"] frame ["+m+"] is not valid"),C=null;d.push(C)}var x=y.value;a.values.push(x);var S=y.curve;if(S)if("string"==typeof S){a.types.push(S);continue}else if(Array.isArray(S)){if(S[0]===S[1]&&S[2]===S[3])a.types.push(l.Linear);else a.types.push(l.Bezier(S));continue}a.types.push(l.Linear)}if(c)u(d,a,o.duration,o.sample);return a}function r(t,e){var i=e.props,r=e.comps;if(i)for(var s in i){var o=i[s],c=n(t,s,o);a.push(c)}if(r)for(var l in r){var h=t.getComponent(l);if(h){var u=r[l];for(var s in u){var o=u[s],c=n(h,s,o);a.push(c)}}else;}}var o=e.clip,a=e.curves;if(a.length=0,e.duration=o.duration,e.speed=o.speed,e.wrapMode=o.wrapMode,e.frameRate=o.sample,(e.wrapMode&_.Loop)===_.Loop)e.repeatCount=1/0;else e.repeatCount=1;var c=o.events;if(c)for(var g,m=0,v=c.length;v>m;m++){if(!g)g=new d,g.target=t,a.push(g);var y,T=c[m],C=T.frame/e.duration,x=p(g.ratios,C);if(x>=0)y=g.events[x];else y=new f,g.ratios.push(C),g.events.push(y);y.add(T.func,T.params)}var S=o.curveData,b=S.paths;r(t,S);for(var E in b){var A=cc.find(E,t);if(A){var w=b[E];r(A,w)}else;}}var a=cc.js,c=t("./animators").Animator,l=t("./animation-curves").DynamicAnimCurve,h=t("./animation-curves").SampledAnimCurve,u=t("./motion-path-helper").sampleMotionPaths,d=t("./animation-curves").EventAnimCurve,f=t("./animation-curves").EventInfo,_=t("./types").WrapModeMask,p=t("./binary-search");a.extend(n,c);var g=n.prototype;if(g.playState=function(t,e){if(t.clip){if(!t.curveLoaded)o(this.target,t);if(this.addAnimation(t),t.animator=this,t.play(),"number"==typeof e)t.time=e;
this.play()}},g.removeAnimation=function(t){c.prototype.removeAnimation.call(this,t),t.animator=null},g.sample=function(){for(var t=this.playingAnims,e=0;e<t.length;e++){var i=t[e];i.sample()}},g.stopState=function(t){if(t)t.stop()},g.pauseState=function(t){if(t)t.pause()},g.resumeState=function(t){if(t)t.resume();if(this.isPaused)this.resume()},g.setStateTime=function(t,e){if(t)t.setTime(e)},g.onStop=function(){for(var t=this.playingAnims,e=t.length-1;e>=0;e--)t[e].stop();c.prototype.onStop.call(this)},g.onPause=function(){for(var t=this.playingAnims,e=0,i=t.length;i>e;e++)t[e].pause()},g.onResume=function(){for(var t=this.playingAnims,e=0,i=t.length;i>e;e++)t[e].resume()},g._reloadClip=function(t){o(this.target,t)},!1)cc._Test.createBatchedProperty=r;if(!1)cc._Test.initClipData=o;e.exports=n},{"./animation-curves":11,"./animators":14,"./binary-search":16,"./motion-path-helper":19,"./types":21}],10:[function(t,e,i){var n=cc.Class({name:"cc.AnimationClip","extends":cc.Asset,properties:{_duration:{"default":0,type:"Float"},duration:{get:function(){return this._duration}},sample:{"default":60},speed:{"default":1},wrapMode:{"default":cc.WrapMode.Normal},curveData:{"default":{},visible:!1},events:{"default":[],visible:!1}}});cc.AnimationClip=e.exports=n},{}],11:[function(t,e,i){function n(t,e){if("string"==typeof e){var i=cc.Easing[e];if(i)t=i(t);else cc.error("Can't find easing type ["+e+"]")}else if(Array.isArray(e))t=r(e,t);return t}var r=t("./bezier").bezierByTime,s=t("./binary-search"),o=t("./types").WrapModeMask,a=cc.Class({name:"cc.AnimCurve",sample:function(t,e,i){},onTimeChangedManually:function(){}}),c=cc.Class({name:"cc.DynamicAnimCurve","extends":a,properties:{target:null,prop:"",values:[],ratios:[],types:[],subProps:null},_calcValue:function(t,e){var i,n=this.values,r=n[t-1],s=n[t];if("number"==typeof r)i=r+(s-r)*e;else{var o=r.lerp;if(o)i=r.lerp(s,e);else i=r}return i},_applyValue:function(t,e,i){t[e]=i},_findFrameIndex:s,sample:function(t,e,i){var r=this.values,s=this.ratios,o=s.length;if(0!==o){var a,c=this._findFrameIndex(s,e);if(0>c)if(c=~c,0>=c)a=r[0];else if(c>=o)a=r[o-1];else{var l=s[c-1],h=s[c],u=this.types[c-1],d=(e-l)/(h-l);d=n(d,u),a=this._calcValue(c,d)}else a=r[c];var f=this.subProps;if(f){for(var _=this.target[this.prop],p=_,g=0;g<f.length-1;g++){var m=f[g];if(p)p=p[m];else return}var v=f[f.length-1];if(p)this._applyValue(p,v,a);else return;a=_}this._applyValue(this.target,this.prop,a)}}});c.Linear=null,c.Bezier=function(t){return t};var l=cc.Class({name:"cc.SampledAnimCurve","extends":c,_findFrameIndex:function(t,e){var i=t.length-1;if(0===i)return 0;var n=t[0];if(n>e)return 0;var r=t[i];if(e>r)return i;e=(e-n)/(r-n);var s=1/i,o=e/s,a=0|o,c=1e-6;if(c>o-a)return a;else return~(a+1)}}),h=function(){this.events=[]};h.prototype.add=function(t,e){this.events.push({func:t||"",params:e||[]})};var u=cc.Class({name:"cc.EventAnimCurve","extends":a,properties:{target:null,ratios:[],events:[],_lastWrappedInfo:null},_wrapIterations:function(t){if(t-(0|t)===0)t-=1;return 0|t},sample:function(t,e,i){var n=this.ratios.length,r=i.getWrappedInfo(i.time),a=r.direction,c=s(this.ratios,r.ratio);if(0>c)if(c=~c-1,0>a)c+=1;var l=this._lastWrappedInfo;if(r.frameIndex=c,this._lastWrappedInfo=r,!l)return void this._fireEvent(c);var h=l.frameIndex,u=i.wrapMode,d=this._wrapIterations(r.iterations),f=this._wrapIterations(l.iterations),_=-1!==f&&d!==f;if(h===c&&_&&1===n)this._fireEvent(0);else if(h!==c||_){a=l.direction;do{if(h!==c){if(-1===a&&0===h&&c>0){if((u&o.PingPong)===o.PingPong)a*=-1;else h=n;f++}else if(1===a&&h===n-1&&n-1>c){if((u&o.PingPong)===o.PingPong)a*=-1;else h=-1;f++}if(h===c)break;if(f>d)break}h+=a,this._fireEvent(h)}while(h!==c&&h>-1&&n>h)}},_fireEvent:function(t){if(!(0>t||t>=this.events.length))for(var e=this.events[t],i=e.events,n=this.target._components,r=0;r<i.length;r++)for(var s=i[r],o=s.func,a=0;a<n.length;a++){var c=n[a],l=c[o];if(l)l.apply(c,s.params)}},onTimeChangedManually:function(){this._lastWrappedInfo=null}});if(!1)cc._Test.DynamicAnimCurve=c,cc._Test.SampledAnimCurve=l,cc._Test.EventAnimCurve=u;e.exports={AnimCurve:a,DynamicAnimCurve:c,SampledAnimCurve:l,EventAnimCurve:u,EventInfo:h,computeRatioByType:n}},{"./bezier":15,"./binary-search":16,"./types":21}],12:[function(t,e,i){var n=(cc.js,cc.Class({ctor:function(){this.animators=[],this.__instanceId=cc.ClassManager.getNewInstanceId(),this._updating=!1,this._removeList=[]},update:function(t){this._updating=!0;var e,i,n=this.animators;for(e=0,i=n.length;i>e;e++){var r=n[e];if(r._isPlaying&&!r._isPaused)r.update(t)}this._updating=!1;var s=this._removeList;for(e=0,i=s.length;i>e;e++)this.removeAnimator(s[e]);s.length=0},destruct:function(){},addAnimator:function(t){var e=this.animators.indexOf(t);if(-1===e)this.animators.push(t);if(e=this._removeList.indexOf(t),-1!==e)this._removeList.splice(e,1)},removeAnimator:function(t){var e=this.animators.indexOf(t);if(e>=0)if(this._updating){var i=this._removeList;if(-1===i.indexOf(t))i.push(t)}else this.animators.splice(e,1);else cc.error("animator not added or already removed")}}));cc.AnimationManager=e.exports=n},{}],13:[function(t,e,i){function n(t,e){s.call(this,null,null,{duration:t.length}),this._clip=t,this._name=e||t.name}var r=cc.js,s=t("./types").AnimationNode;r.extend(n,s);var o=n.prototype;r.get(o,"clip",function(){return this._clip}),r.get(o,"name",function(){return this._name}),r.obsolete(o,"AnimationState.length","duration"),r.getset(o,"curveLoaded",function(){return this.curves.length>0},function(){this.curves.length=0}),o.onPlay=function(){this.setTime(0)},o.onStop=function(){if(this.animator)this.animator.removeAnimation(this)},o.setTime=function(t){this.time=t||0,this.curves.forEach(function(t){t.onTimeChangedManually()})},cc.AnimationState=e.exports=n},{"./types":21}],14:[function(t,e,i){function n(t){this.target=t,this.playingAnims=[],this._updating=!1,this._removeList=[]}function r(t){n.call(this,t)}function s(t){for(var e=0,i=0,n=t.length,r=0;n>r;r++){var s=t[r],o=s.ratio;if(0===r&&"number"!=typeof o)s.computedRatio=o=0;else if(r===n-1&&"number"!=typeof o)s.computedRatio=o=1;if("number"==typeof o){if(r>e+1)for(var a=r-e,c=(o-i)/a,l=e+1;r>l;l++)i+=c,t[l].computedRatio=i;e=r,i=o}}}function o(t,e,i){for(var n,r=0;r<t.length;r++)if(n=t[r],n.target===e&&n.prop===i)return n;return null}function a(t,e,i,n,r){var s=o(t,e,i);if(!s)s=new u,t.push(s),s.target=e,s.prop=i;s.values.push(n),s.ratios.push(r)}var c=cc.js,l=t("./playable"),h=t("./types").AnimationNode,u=t("./animation-curves").DynamicAnimCurve;c.extend(n,l);var d=n.prototype;d.update=function(t){this._updating=!0;var e,i,n=this.playingAnims,r=0;for(e=0,i=n.length;i>e;e++){var s=n[e];if(s._isPlaying&&!s._isPaused)if(s.update(t),!s._isPlaying)r++}if(this._updating=!1,0===n.length||r>=n.length)this.stop();var o=this._removeList;for(e=0,i=o.length;i>e;e++)this.removeAnimation(o[e]);o.length=0},d.onPlay=function(){cc.director.getAnimationManager().addAnimator(this)},d.onStop=function(){cc.director.getAnimationManager().removeAnimator(this)},d.addAnimation=function(t){var e=this.playingAnims.indexOf(t);if(-1===e)this.playingAnims.push(t);if(e=this._removeList.indexOf(t),-1!==e)this._removeList.splice(e,1)},d.removeAnimation=function(t){var e=this.playingAnims.indexOf(t);if(e>=0)if(this._updating){var i=this._removeList;if(-1===i.indexOf(t))i.push(t)}else this.playingAnims.splice(e,1);else cc.error("animation not added or already removed")},c.extend(r,n);var f=r.prototype;if(!1)cc._Test.computeNullRatios=s;if(f.animate=function(t,e){if(!t)return cc.error("[animate] keyFrames must be non-nil"),null;s(t);var i=this._doAnimate(t,e);return this.play(),i},f._doAnimate=function(t,e){var i=new h(this,null,e);i.play();for(var n=i.curves,r=-1,s=0;s<t.length;s++){var o=t[s],c=o.ratio;if("number"!=typeof c)c=o.computedRatio;if(!(0>c))if(!(r>c)){r=c;for(var l in o){var u=o[l];if("props"===l)for(var d in u)a(n,this.target,d,u[d],c);else if("comps"===l)for(var f in u){var _=this.target.getComponent(f),p=u[f];for(var d in p)a(n,_,d,p[d],c)}}}else cc.error("[animate] ratio should in the order of smallest to largest!");else cc.error("[animate] ratio should >= 0!")}return this.playingAnims.push(i),i},!1)cc._Test.EntityAnimator=r;e.exports={Animator:n,EntityAnimator:r}},{"./animation-curves":11,"./playable":20,"./types":21}],15:[function(t,e,i){function n(t,e,i,n,r){var s=1-r;return t*s*s*s+3*e*s*s*r+3*i*s*r*r+n*r*r*r}function r(t){if(0>t)return-Math.pow(-t,1/3);else return Math.pow(t,1/3)}function s(t,e){var i,n,s,o,h,f=e-0,_=e-t[0],p=e-t[2],g=e-1,m=3*f,v=3*_,y=3*p,T=-f+v-y+g,C=1/T,x=1/3,S=(m-6*_+y)*C,b=S*x,E=(-m+v)*C,A=f*C,w=(3*E-S*S)*x,O=w*x,I=(2*S*S*S-9*S*E+27*A)/27,R=I/2,P=R*R+O*O*O;if(0>P){var N=-w*x,L=N*N*N,F=d(L),D=-I/(2*F),M=-1>D?-1:D>1?1:D,B=c(M),z=r(F),k=2*z;if(s=k*a(B*x)-b,o=k*a((B+u)*x)-b,h=k*a((B+2*u)*x)-b,s>=0&&1>=s)if(o>=0&&1>=o)if(h>=0&&1>=h)return l(s,o,h);else return l(s,o);else if(h>=0&&1>=h)return l(s,h);else return s;else if(o>=0&&1>=o)if(h>=0&&1>=h)return l(o,h);else return o;else return h}else if(0===P)if(i=0>R?r(-R):-r(R),s=2*i-b,o=-i-b,s>=0&&1>=s)if(o>=0&&1>=o)return l(s,o);else return s;else return o;else{var V=d(P);return i=r(-R+V),n=r(R+V),s=i-n-b}}function o(t,e){var i=s(t,e),n=0,r=t[1],o=t[3],a=1,c=1-i;return n*c*c*c+3*r*i*c*c+3*o*i*i*c+a*i*i*i}var a=Math.cos,c=Math.acos,l=Math.max,h=Math.PI,u=2*h,d=Math.sqrt;if(!1)cc._Test.bezier=n,cc._Test.bezierByTime=o;e.exports={bezier:n,bezierByTime:o}},{}],16:[function(t,e,i){function n(t,e){for(var i=0,n=t.length-1;n>=i;){var s=i+n>>1;if(Math.abs(t[s]-e)<r)return s;if(t[s]>e)n=s-1;else i=s+1}return~i}var r=1e-6;e.exports=n},{}],17:[function(t,e,i){function n(t,e){return function(i){if(.5>i)return e(2*i)/2;else return t(2*i-1)/2+.5}}var r={linear:function(t){return t},quadIn:function(t){return t*t},quadOut:function(t){return t*(2-t)},quadInOut:function(t){if((t*=2)<1)return.5*t*t;else return-.5*(--t*(t-2)-1)},cubicIn:function(t){return t*t*t},cubicOut:function(t){return--t*t*t+1},cubicInOut:function(t){if((t*=2)<1)return.5*t*t*t;else return.5*((t-=2)*t*t+2)},quartIn:function(t){return t*t*t*t},quartOut:function(t){return 1- --t*t*t*t},quartInOut:function(t){if((t*=2)<1)return.5*t*t*t*t;else return-.5*((t-=2)*t*t*t-2)},quintIn:function(t){return t*t*t*t*t},quintOut:function(t){return--t*t*t*t*t+1},quintInOut:function(t){if((t*=2)<1)return.5*t*t*t*t*t;else return.5*((t-=2)*t*t*t*t+2)},sineIn:function(t){return 1-Math.cos(t*Math.PI/2)},sineOut:function(t){return Math.sin(t*Math.PI/2)},sineInOut:function(t){return.5*(1-Math.cos(Math.PI*t))},expoIn:function(t){return 0===t?0:Math.pow(1024,t-1)},expoOut:function(t){return 1===t?1:1-Math.pow(2,-10*t)},expoInOut:function(t){if(0===t)return 0;if(1===t)return 1;if((t*=2)<1)return.5*Math.pow(1024,t-1);else return.5*(-Math.pow(2,-10*(t-1))+2)},circIn:function(t){return 1-Math.sqrt(1-t*t)},circOut:function(t){return Math.sqrt(1- --t*t)},circInOut:function(t){if((t*=2)<1)return-.5*(Math.sqrt(1-t*t)-1);else return.5*(Math.sqrt(1-(t-=2)*t)+1)},elasticIn:function(t){var e,i=.1,n=.4;if(0===t)return 0;if(1===t)return 1;if(!i||1>i)i=1,e=n/4;else e=n*Math.asin(1/i)/(2*Math.PI);return-(i*Math.pow(2,10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/n))},elasticOut:function(t){var e,i=.1,n=.4;if(0===t)return 0;if(1===t)return 1;if(!i||1>i)i=1,e=n/4;else e=n*Math.asin(1/i)/(2*Math.PI);return i*Math.pow(2,-10*t)*Math.sin((t-e)*(2*Math.PI)/n)+1},elasticInOut:function(t){var e,i=.1,n=.4;if(0===t)return 0;if(1===t)return 1;if(!i||1>i)i=1,e=n/4;else e=n*Math.asin(1/i)/(2*Math.PI);if((t*=2)<1)return-.5*(i*Math.pow(2,10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/n));else return i*Math.pow(2,-10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/n)*.5+1},backIn:function(t){var e=1.70158;return t*t*((e+1)*t-e)},backOut:function(t){var e=1.70158;return--t*t*((e+1)*t+e)+1},backInOut:function(t){var e=2.5949095;if((t*=2)<1)return.5*(t*t*((e+1)*t-e));else return.5*((t-=2)*t*((e+1)*t+e)+2)},bounceOut:function(t){if(1/2.75>t)return 7.5625*t*t;else if(2/2.75>t)return 7.5625*(t-=1.5/2.75)*t+.75;else if(2.5/2.75>t)return 7.5625*(t-=2.25/2.75)*t+.9375;else return 7.5625*(t-=2.625/2.75)*t+.984375},smooth:function(t){if(0>=t)return 0;if(t>=1)return 1;else return t*t*(3-2*t)},fade:function(t){if(0>=t)return 0;if(t>=1)return 1;else return t*t*t*(t*(6*t-15)+10)}};r.quadOutIn=n(r.quadIn,r.quadOut),r.cubicOutIn=n(r.cubicIn,r.cubicOut),r.quartOutIn=n(r.quartIn,r.quartOut),r.quintOutIn=n(r.quintIn,r.quintOut),r.sineOutIn=n(r.sineIn,r.sineOut),r.expoOutIn=n(r.expoIn,r.expoOut),r.circOutIn=n(r.circIn,r.circOut),r.backOutIn=n(r.backIn,r.backOut),r.backOutIn=n(r.backIn,r.backOut),r.bounceIn=function(t){return 1-r.bounceOut(1-t)},r.bounceInOut=function(t){if(.5>t)return.5*r.bounceIn(2*t);else return.5*r.bounceOut(2*t-1)+.5},r.bounceOutIn=n(r.bounceIn,r.bounceOut),cc.Easing=e.exports=r},{}],18:[function(t,e,i){t("./bezier"),t("./easing"),t("./types"),t("./motion-path-helper"),t("./animation-curves"),t("./animation-clip"),t("./animators"),t("./animation-manager"),t("./animation-state"),t("./animation-animator")},{"./animation-animator":9,"./animation-clip":10,"./animation-curves":11,"./animation-manager":12,"./animation-state":13,"./animators":14,"./bezier":15,"./easing":17,"./motion-path-helper":19,"./types":21}],19:[function(t,e,i){function n(t){this.points=t||[],this.beziers=[],this.ratios=[],this.progresses=[],this.length=0,this.computeBeziers()}function r(){this.start=h(),this.end=h(),this.startCtrlPoint=h(),this.endCtrlPoint=h()}function s(t,e,i,r){function s(t){if(t instanceof cc.Vec2)return{"in":t,pos:t,out:t};else if(Array.isArray(t)&&6===t.length)return{"in":h(t[2],t[3]),pos:h(t[0],t[1]),out:h(t[4],t[5])};return{"in":cc.Vec2.ZERO,pos:cc.Vec2.ZERO,out:cc.Vec2.ZERO}}function c(t,e,i){_.push(t),p.push(e),g.push(i)}var u=e.values;if(0!==t.length&&0!==u.length){if(u=u.map(function(t){return h(t[0],t[1])}),1===u.length)return void(e.values=u);for(var d=e.types,f=e.ratios,_=e.values=[],p=e.types=[],g=e.ratios=[],m=0,v=1e-6,y=0,T=t.length;T-1>y;y++){var C,x=t[y],S=f[y],b=f[y+1],E=b-S,A=u[y],w=u[y+1],O=d[y],I=[],R=m/E,P=1/(E*i*r);if(x&&x.length>0){var N=[];N.push(s(A));for(var L=0,F=x.length;F>L;L++){var D=s(x[L]);N.push(D)}N.push(s(w));var M=new n(N);M.computeBeziers();for(var B=M.progresses;1-R>v;){C=R,C=a(C,O);var z,k,V,W;if(0>C)k=M.beziers[0],W=(0-C)*k.getLength(),V=k.start.sub(k.endCtrlPoint).normalize(),z=k.start.add(V.mul(W));else if(C>1)k=M.beziers[M.beziers.length-1],W=(C-1)*k.getLength(),V=k.end.sub(k.startCtrlPoint).normalize(),z=k.end.add(V.mul(W));else{var U=l(B,C);if(0>U)U=~U;C-=U>0?B[U-1]:0,C/=M.ratios[U],z=M.beziers[U].getPointAt(C)}I.push(z),R+=P}}else for(;1-R>v;)C=R,C=a(C,O),I.push(A.lerp(w,C)),R+=P;for(var L=0,F=I.length;F>L;L++){var G=S+m+P*L*E;c(I[L],o.Linear,G)}if(Math.abs(R-1)>v)m=(R-1)*E;else m=0}if(f[f.length-1]!==g[g.length-1])c(u[u.length-1],o.Linear,f[f.length-1])}}var o=t("./animation-curves").DynamicAnimCurve,a=t("./animation-curves").computeRatioByType,c=t("./bezier").bezier,l=t("./binary-search"),h=cc.v2;if(n.prototype.computeBeziers=function(){this.beziers.length=0,this.ratios.length=0,this.progresses.length=0,this.length=0;for(var t,e=1;e<this.points.length;e++){var i=this.points[e-1],n=this.points[e];t=new r,t.start=i.pos,t.startCtrlPoint=i.out,t.end=n.pos,t.endCtrlPoint=n["in"],this.beziers.push(t),this.length+=t.getLength()}for(var s=0,e=0;e<this.beziers.length;e++)t=this.beziers[e],this.ratios[e]=t.getLength()/this.length,this.progresses[e]=s+=this.ratios[e];return this.beziers},r.prototype.getPointAt=function(t){var e=this.getUtoTmapping(t);return this.getPoint(e)},r.prototype.getPoint=function(t){var e=c(this.start.x,this.startCtrlPoint.x,this.endCtrlPoint.x,this.end.x,t),i=c(this.start.y,this.startCtrlPoint.y,this.endCtrlPoint.y,this.end.y,t);return new h(e,i)},r.prototype.getLength=function(){var t=this.getLengths();return t[t.length-1]},r.prototype.getLengths=function(t){if(!t)t=this.__arcLengthDivisions?this.__arcLengthDivisions:200;if(this.cacheArcLengths&&this.cacheArcLengths.length===t+1)return this.cacheArcLengths;var e,i,n=[],r=this.getPoint(0),s=0;for(n.push(0),i=1;t>=i;i++)e=this.getPoint(i/t),s+=cc.pDistance(e,r),n.push(s),r=e;return this.cacheArcLengths=n,n},r.prototype.getUtoTmapping=function(t,e){var i,n=this.getLengths(),r=0,s=n.length;if(e)i=e;else i=t*n[s-1];for(var o,a=0,c=s-1;c>=a;)if(r=Math.floor(a+(c-a)/2),o=n[r]-i,!(0>o))if(o>0){c=r-1;continue}else{c=r;break}else a=r+1;if(r=c,n[r]===i){var l=r/(s-1);return l}var h=n[r],u=n[r+1],d=u-h,f=(i-h)/d,l=(r+f)/(s-1);return l},!1)cc._Test.sampleMotionPaths=s;e.exports={sampleMotionPaths:s,Curve:n,Bezier:r}},{"./animation-curves":11,"./bezier":15,"./binary-search":16}],20:[function(t,e,i){function n(){this._isPlaying=!1,this._isPaused=!1,this._stepOnce=!1}var r=cc.js,s=n.prototype;r.get(s,"isPlaying",function(){return this._isPlaying},!0),r.get(s,"isPaused",function(){return this._isPaused},!0);var o=function(){};s.onPlay=o,s.onPause=o,s.onResume=o,s.onStop=o,s.onError=o,s.play=function(){if(this._isPlaying)if(this._isPaused)this._isPaused=!1,this.onResume();else this.onError("already-playing");else this._isPlaying=!0,this.onPlay()},s.stop=function(){if(this._isPlaying)this._isPlaying=!1,this._isPaused=!1,this.onStop()},s.pause=function(){this._isPaused=!0,this.onPause()},s.resume=function(){this._isPaused=!1,this.onResume()},s.step=function(){if(this.pause(),this._stepOnce=!0,!this._isPlaying)this.play()},e.exports=n},{}],21:[function(t,e,i){function n(t,e,i){if(c.call(this),this.animator=t,this.curves=e||[],this.delay=0,this.repeatCount=1,this.duration=1,this.speed=1,this.wrapMode=a.Normal,i){this.delay=i.delay||this.delay;var n=i.duration;if("undefined"!=typeof n)this.duration=n;var r=i.speed;if("undefined"!=typeof r)this.speed=r;var s=i.wrapMode;if("undefined"!=typeof s){var l="number"==typeof s;if(l)this.wrapMode=s;else this.wrapMode=a[s]}var h=i.repeatCount;if("undefined"!=typeof h)this.repeatCount=h;else if(this.wrapMode&o.Loop)this.repeatCount=1/0}if(this.time=0,this._timeNoScale=0,this._firstFramePlayed=!1,this._duringDelay=!1,this.delay>0)this._duringDelay=!0}var r=cc.js,s=t("./playable"),o={Loop:2,ShouldWrap:4,PingPong:22,Reverse:36},a=cc.Enum({Default:0,Normal:1,Reverse:o.Reverse,Loop:o.Loop,LoopReverse:o.Loop|o.Reverse,PingPong:o.PingPong,PingPongReverse:o.PingPong|o.Reverse});cc.WrapMode=a;var c=function(){s.call(this)};r.extend(c,s),c.prototype.update=function(t){},r.extend(n,c),r.mixin(n.prototype,{update:function(t){if(this._duringDelay)if(this._timeNoScale+=t,this._timeNoScale<this.delay)return;else this._duringDelay=!1;if(this._firstFramePlayed)this.time+=t*this.speed;else this._firstFramePlayed=!0;if(this.sample())this.stop()},_needRevers:function(t){var e=this.wrapMode,i=!1;if((e&o.PingPong)===o.PingPong){var n=t-(0|t)===0;if(n&&t>0)t-=1;var r=1&t;if(r)i=!i}if((e&o.Reverse)===o.Reverse)i=!i;return i},getWrappedInfo:function(t){var e=!1,i=this.duration,n=0,r=this.wrapMode,s=Math.abs(t/i);if(s>this.repeatCount)s=this.repeatCount;var a=!1;if(r&o.ShouldWrap)a=this._needRevers(s);var c=a?-1:1;if(this.speed<0)c*=-1;if(s>=this.repeatCount){e=!0;var l=this.repeatCount-(0|this.repeatCount);if(0===l)l=1;t=l*i*(t>0?1:-1)}if(t>i){var h=t%i;t=0===h?i:h}else if(0>t)if(t%=i,0!==t)t+=i;if(r&o.ShouldWrap)if(a)t=i-t;return n=t/i,{ratio:n,time:t,direction:c,stopped:e,iterations:s}},sample:function(){for(var t=this.getWrappedInfo(this.time),e=this.curves,i=0,n=e.length;n>i;i++){var r=e[i];r.sample(t.time,t.ratio,this)}return t.stopped}}),cc.AnimationNode=n,e.exports={WrapModeMask:o,WrapMode:a,AnimationNode:n}},{"./playable":20}],22:[function(t,e,i){var n=t("../core/platform/js");cc.Audio=function(t,e,i){if(this.volume=1,this.loop=!1,this._touch=!1,this._playing=!1,this._AUDIO_TYPE="AUDIO",this._pause=!1,this._buffer=null,this._currentSource=null,this._startTime=null,this._currentTime=null,this._context=null,this._volume=null,this._ignoreEnded=!1,this._manualLoop=!1,this._element=null,t&&(this._context=t),e&&(this._volume=e),t&&e)this._AUDIO_TYPE="WEBAUDIO";this.src=i},n.mixin(cc.Audio.prototype,{_setBufferCallback:null,setBuffer:function(t){if(t){var e=this._playing;if(this._AUDIO_TYPE="WEBAUDIO",this._buffer&&this._buffer!==t&&this.getPlaying())this.stop();if(this._buffer=t,e)this.play();this._volume.gain.value=this.volume,this._setBufferCallback&&this._setBufferCallback(t)}},_setElementCallback:null,setElement:function(t){if(t){var e=this._playing;if(this._AUDIO_TYPE="AUDIO",this._element&&this._element!==t&&this.getPlaying())this.stop();if(this._element=t,e)this.play();t.volume=this.volume,t.loop=this.loop,this._setElementCallback&&this._setElementCallback(t)}},play:function(t,e){if(this._playing=!0,this.loop=void 0===e?this.loop:e,"AUDIO"===this._AUDIO_TYPE)this._playOfAudio(t);else this._playOfWebAudio(t)},getPlaying:function(){if("AUDIO"===this._AUDIO_TYPE){var t=this._element;if(!t||this._pause||t.ended)return this._playing=!1;else return!0}var e=this._currentSource;if(!e||!e.playbackState)return!0;else return this._currentTime+this._context.currentTime-this._startTime<e.buffer.duration},_playOfWebAudio:function(t){var e=this._currentSource;if(this._buffer){if(!this._pause&&e)if(0===this._context.currentTime||this._currentTime+this._context.currentTime-this._startTime>e.buffer.duration)this._stopOfWebAudio();else return;var i=this._context.createBufferSource();if(i.buffer=this._buffer,i.connect(this._volume),this._manualLoop)i.loop=!1;else i.loop=this.loop;if(this._startTime=this._context.currentTime,this._currentTime=t||0,this._ignoreEnded=!1,i.start)i.start(0,t||0);else if(i.noteGrainOn){var n=i.buffer.duration;if(this.loop)i.noteGrainOn(0,t,n);else i.noteGrainOn(0,t,n-t)}else i.noteOn(0);this._currentSource=i;var r=this;i.onended=function(){if(r._manualLoop&&r._playing&&r.loop)return r.stop(),void r.play();if(r._ignoreEnded)r._ignoreEnded=!1;else if(!r._pause)r.stop();else r._playing=!1}}},_playOfAudio:function(){var t=this._element;if(t)t.loop=this.loop,t.play()},stop:function(){if(this._playing=!1,"AUDIO"===this._AUDIO_TYPE)this._stopOfAudio();else this._stopOfWebAudio()},_stopOfWebAudio:function(){var t=this._currentSource;if(this._ignoreEnded=!0,t)t.stop(0),this._currentSource=null},_stopOfAudio:function(){var t=this._element;if(t)if(t.pause(),t.duration&&t.duration!==1/0)t.currentTime=0},pause:function(){if(this.getPlaying()!==!1)if(this._playing=!1,this._pause=!0,"AUDIO"===this._AUDIO_TYPE)this._pauseOfAudio();else this._pauseOfWebAudio()},_pauseOfWebAudio:function(){this._currentTime+=this._context.currentTime-this._startTime;var t=this._currentSource;if(t)t.stop(0)},_pauseOfAudio:function(){var t=this._element;if(t)t.pause()},resume:function(){if(this._pause){if("AUDIO"===this._AUDIO_TYPE)this._resumeOfAudio();else this._resumeOfWebAudio();this._pause=!1,this._playing=!0}},_resumeOfWebAudio:function(){var t=this._currentSource;if(t){this._startTime=this._context.currentTime;var e=this._currentTime%t.buffer.duration;this._playOfWebAudio(e)}},_resumeOfAudio:function(){var t=this._element;if(t)t.play()},setVolume:function(t){if(t>1)t=1;if(0>t)t=0;if(this.volume=t,"AUDIO"===this._AUDIO_TYPE){if(this._element)this._element.volume=t}else if(this._volume)this._volume.gain.value=t},getVolume:function(){return this.volume},cloneNode:function(){var t,e;if("AUDIO"===this._AUDIO_TYPE){t=new cc.Audio;var i=document.createElement("audio");i.src=this.src,t.setElement(i)}else{var n=this._context.createGain();if(n.gain.value=1,n.connect(this._context.destination),t=new cc.Audio(this._context,n,this.src),this._buffer)t.setBuffer(this._buffer);else e=this,this._setBufferCallback=function(i){t.setBuffer(i),e._setBufferCallback=null};t._manualLoop=this._manualLoop}return t._AUDIO_TYPE=this._AUDIO_TYPE,t}}),function(t){var e=t.WEB_AUDIO,i=t.AUTOPLAY;if(cc.audioEngine={_currMusic:null,_musicVolume:1,features:t,playMusic:function(t,e){var i=this._currMusic;if(i&&i.src!==t&&i.getPlaying())i.stop();var n=cc.loader.getItem(t),r=n&&n.audio?n.audio:null;if(!r){var s=this;return void cc.loader.load(t,function(i){if(!i){var n=cc.loader.getItem(t),r=n&&n.audio?n.audio:null;r.play(0,e),r.setVolume(s._musicVolume),s._currMusic=r}})}r.play(0,e),r.setVolume(this._musicVolume),this._currMusic=r},stopMusic:function(t){var e=this._currMusic;if(e)if(e.stop(),t)cc.loader.release(e.src)},pauseMusic:function(){var t=this._currMusic;if(t)t.pause()},resumeMusic:function(){var t=this._currMusic;if(t)t.resume()},rewindMusic:function(){var t=this._currMusic;if(t)t.stop(),t.play()},getMusicVolume:function(){return this._musicVolume},setMusicVolume:function(t){if(t-=0,isNaN(t))t=1;if(t>1)t=1;if(0>t)t=0;this._musicVolume=t;var e=this._currMusic;if(e)e.setVolume(t)},isMusicPlaying:function(){var t=this._currMusic;if(t)return t.getPlaying();else return!1},_audioPool:{},_maxAudioInstance:5,_effectVolume:1,playEffect:function(i,n){if(!t.MULTI_CHANNEL)return null;var r=this._audioPool[i];if(!r)r=this._audioPool[i]=[];for(var s=0;s<r.length&&r[s].getPlaying();s++);var o;if(r[s])o=r[s],o.setVolume(this._effectVolume),o.play(0,n);else if(!e&&s>this._maxAudioInstance)cc.log("Error: %s greater than %d",i,this._maxAudioInstance);else{var a=cc.loader.getItem(i);if(o=a&&a.audio?a.audio:null,!o)if(cc.loader.load(i),a=cc.loader.getItem(i),o=a&&a.audio?a.audio:null,!o)return;o=o.cloneNode(),o.setVolume(this._effectVolume),o.loop=n||!1,o.play(),r.push(o)}return o},setEffectsVolume:function(t){if(t-=0,isNaN(t))t=1;if(t>1)t=1;if(0>t)t=0;this._effectVolume=t;var e=this._audioPool;for(var i in e){var n=e[i];if(Array.isArray(n))for(var r=0;r<n.length;r++)n[r].setVolume(t)}},getEffectsVolume:function(){return this._effectVolume},pauseEffect:function(t){if(t)t.pause()},pauseAllEffects:function(){var t=this._audioPool;for(var e in t)for(var i=t[e],n=0;n<t[e].length;n++)if(i[n].getPlaying())i[n].pause()},resumeEffect:function(t){if(t)t.resume()},resumeAllEffects:function(){var t=this._audioPool;for(var e in t)for(var i=t[e],n=0;n<t[e].length;n++)i[n].resume()},stopEffect:function(t){if(t)t.stop()},stopAllEffects:function(){var t=this._audioPool;for(var e in t)for(var i=t[e],n=0;n<t[e].length;n++)i[n].stop()},unloadEffect:function(t){if(t){cc.loader.release(t);var e=this._audioPool[t];if(e)e.length=0;delete this._audioPool[t]}},end:function(){this.stopMusic(),this.stopAllEffects()},_pauseCache:[],_pausePlaying:function(){var t=this._currMusic;if(t&&t.getPlaying())t.pause(),this._pauseCache.push(t);var e=this._audioPool;for(var i in e)for(var n=e[i],r=0;r<e[i].length;r++)if(n[r].getPlaying())n[r].pause(),this._pauseCache.push(n[r])},_resumePlaying:function(){for(var t=this._pauseCache,e=0;e<t.length;e++)t[e].resume();t.length=0}},!i){var n=function(){var e=cc.audioEngine._currMusic;if(e&&e._touch===!1&&e._playing&&e.getPlaying())e._touch=!0,e.play(0,e.loop),!t.REPLAY_AFTER_TOUCH&&cc._canvas.removeEventListener("touchstart",n)};setTimeout(function(){if(cc._canvas)cc._canvas.addEventListener("touchstart",n,!1)},150)}}(cc.sys.__audioSupport)},{"../core/platform/js":105}],23:[function(t,e,i){cc.Codec={name:"Jacob__Codec"},cc.Codec.unzip=function(){return cc.Codec.GZip.gunzip.apply(cc.Codec.GZip,arguments)},cc.Codec.unzipBase64=function(){var t=cc.Codec.Base64.decode.apply(cc.Codec.Base64,arguments);return cc.Codec.GZip.gunzip.apply(cc.Codec.GZip,[t])},cc.Codec.unzipBase64AsArray=function(t,e){e=e||1;var i,n,r,s=this.unzipBase64(t),o=[];for(i=0,r=s.length/e;r>i;i++)for(o[i]=0,n=e-1;n>=0;--n)o[i]+=s.charCodeAt(i*e+n)<<8*n;return o},cc.Codec.unzipAsArray=function(t,e){e=e||1;var i,n,r,s=this.unzip(t),o=[];for(i=0,r=s.length/e;r>i;i++)for(o[i]=0,n=e-1;n>=0;--n)o[i]+=s.charCodeAt(i*e+n)<<8*n;return o}},{}],24:[function(t,e,i){cc.Codec.Base64={name:"Jacob__Codec__Base64"},cc.Codec.Base64._keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",cc.Codec.Base64.decode=function(t){var e,i,n,r,s,o,a,c=[],l=0;for(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");l<t.length;){if(r=this._keyStr.indexOf(t.charAt(l++)),s=this._keyStr.indexOf(t.charAt(l++)),o=this._keyStr.indexOf(t.charAt(l++)),a=this._keyStr.indexOf(t.charAt(l++)),e=r<<2|s>>4,i=(15&s)<<4|o>>2,n=(3&o)<<6|a,c.push(String.fromCharCode(e)),64!==o)c.push(String.fromCharCode(i));if(64!==a)c.push(String.fromCharCode(n))}return c=c.join("")},cc.Codec.Base64.decodeAsArray=function(t,e){var i,n,r,s=this.decode(t),o=[];for(i=0,r=s.length/e;r>i;i++)for(o[i]=0,n=e-1;n>=0;--n)o[i]+=s.charCodeAt(i*e+n)<<8*n;return o}},{}],25:[function(t,e,i){cc.Codec.GZip=function(t){this.data=t,this.debug=!1,this.gpflags=void 0,this.files=0,this.unzipped=[],this.buf32k=new Array(32768),this.bIdx=0,this.modeZIP=!1,this.bytepos=0,this.bb=1,this.bits=0,this.nameBuf=[],this.fileout=void 0,this.literalTree=new Array(cc.Codec.GZip.LITERALS),this.distanceTree=new Array(32),this.treepos=0,this.Places=null,this.len=0,this.fpos=new Array(17),this.fpos[0]=0,this.flens=void 0,this.fmax=void 0},cc.Codec.GZip.gunzip=function(t){if(t.constructor===Array);else if(t.constructor===String);var e=new cc.Codec.GZip(t);return e.gunzip()[0][0]},cc.Codec.GZip.HufNode=function(){this.b0=0,this.b1=0,this.jump=null,this.jumppos=-1},cc.Codec.GZip.LITERALS=288,cc.Codec.GZip.NAMEMAX=256,cc.Codec.GZip.bitReverse=[0,128,64,192,32,160,96,224,16,144,80,208,48,176,112,240,8,136,72,200,40,168,104,232,24,152,88,216,56,184,120,248,4,132,68,196,36,164,100,228,20,148,84,212,52,180,116,244,12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254,1,129,65,193,33,161,97,225,17,145,81,209,49,177,113,241,9,137,73,201,41,169,105,233,25,153,89,217,57,185,121,249,5,133,69,197,37,165,101,229,21,149,85,213,53,181,117,245,13,141,77,205,45,173,109,237,29,157,93,221,61,189,125,253,3,131,67,195,35,163,99,227,19,147,83,211,51,179,115,243,11,139,75,203,43,171,107,235,27,155,91,219,59,187,123,251,7,135,71,199,39,167,103,231,23,151,87,215,55,183,119,247,15,143,79,207,47,175,111,239,31,159,95,223,63,191,127,255],cc.Codec.GZip.cplens=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],cc.Codec.GZip.cplext=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,99,99],cc.Codec.GZip.cpdist=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],cc.Codec.GZip.cpdext=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],cc.Codec.GZip.border=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],cc.Codec.GZip.prototype.gunzip=function(){return this.outputArr=[],this.nextFile(),this.unzipped},cc.Codec.GZip.prototype.readByte=function(){if(this.bits+=8,this.bytepos<this.data.length)return this.data.charCodeAt(this.bytepos++);else return-1},cc.Codec.GZip.prototype.byteAlign=function(){this.bb=1},cc.Codec.GZip.prototype.readBit=function(){var t;if(this.bits++,t=1&this.bb,this.bb>>=1,0===this.bb)this.bb=this.readByte(),t=1&this.bb,this.bb=this.bb>>1|128;return t},cc.Codec.GZip.prototype.readBits=function(t){for(var e=0,i=t;i--;)e=e<<1|this.readBit();if(t)e=cc.Codec.GZip.bitReverse[e]>>8-t;return e},cc.Codec.GZip.prototype.flushBuffer=function(){this.bIdx=0},cc.Codec.GZip.prototype.addBuffer=function(t){if(this.buf32k[this.bIdx++]=t,this.outputArr.push(String.fromCharCode(t)),32768===this.bIdx)this.bIdx=0},cc.Codec.GZip.prototype.IsPat=function(){for(;;){if(this.fpos[this.len]>=this.fmax)return-1;if(this.flens[this.fpos[this.len]]===this.len)return this.fpos[this.len]++;this.fpos[this.len]++}},cc.Codec.GZip.prototype.Rec=function(){var t,e=this.Places[this.treepos];if(17===this.len)return-1;if(this.treepos++,this.len++,t=this.IsPat(),t>=0)e.b0=t;else if(e.b0=32768,this.Rec())return-1;if(t=this.IsPat(),t>=0)e.b1=t,e.jump=null;else if(e.b1=32768,e.jump=this.Places[this.treepos],e.jumppos=this.treepos,this.Rec())return-1;return this.len--,0},cc.Codec.GZip.prototype.CreateTree=function(t,e,i,n){
var r;for(this.Places=t,this.treepos=0,this.flens=i,this.fmax=e,r=0;17>r;r++)this.fpos[r]=0;if(this.len=0,this.Rec())return-1;else return 0},cc.Codec.GZip.prototype.DecodeValue=function(t){for(var e,i,n,r=0,s=t[r];;)if(n=this.readBit()){if(!(32768&s.b1))return s.b1;for(s=s.jump,e=t.length,i=0;e>i;i++)if(t[i]===s){r=i;break}}else{if(!(32768&s.b0))return s.b0;r++,s=t[r]}return-1},cc.Codec.GZip.prototype.DeflateLoop=function(){var t,e,i,n,r;do if(t=this.readBit(),i=this.readBits(2),0===i){var s,o;if(this.byteAlign(),s=this.readByte(),s|=this.readByte()<<8,o=this.readByte(),o|=this.readByte()<<8,65535&(s^~o))document.write("BlockLen checksum mismatch\n");for(;s--;)e=this.readByte(),this.addBuffer(e)}else if(1===i)for(var a;;){if(a=cc.Codec.GZip.bitReverse[this.readBits(7)]>>1,a>23){if(a=a<<1|this.readBit(),a>199)a-=128,a=a<<1|this.readBit();else if(a-=48,a>143)a+=136}else a+=256;if(256>a)this.addBuffer(a);else if(256===a)break;else{var r,c;if(a-=257,r=this.readBits(cc.Codec.GZip.cplext[a])+cc.Codec.GZip.cplens[a],a=cc.Codec.GZip.bitReverse[this.readBits(5)]>>3,cc.Codec.GZip.cpdext[a]>8)c=this.readBits(8),c|=this.readBits(cc.Codec.GZip.cpdext[a]-8)<<8;else c=this.readBits(cc.Codec.GZip.cpdext[a]);for(c+=cc.Codec.GZip.cpdist[a],a=0;r>a;a++){var e=this.buf32k[this.bIdx-c&32767];this.addBuffer(e)}}}else if(2===i){var a,l,h,u,d,f=new Array(320);for(h=257+this.readBits(5),u=1+this.readBits(5),d=4+this.readBits(4),a=0;19>a;a++)f[a]=0;for(a=0;d>a;a++)f[cc.Codec.GZip.border[a]]=this.readBits(3);for(r=this.distanceTree.length,n=0;r>n;n++)this.distanceTree[n]=new cc.Codec.GZip.HufNode;if(this.CreateTree(this.distanceTree,19,f,0))return this.flushBuffer(),1;l=h+u,n=0;for(var _=-1;l>n;)if(_++,a=this.DecodeValue(this.distanceTree),16>a)f[n++]=a;else if(16===a){var p;if(a=3+this.readBits(2),n+a>l)return this.flushBuffer(),1;for(p=n?f[n-1]:0;a--;)f[n++]=p}else{if(17===a)a=3+this.readBits(3);else a=11+this.readBits(7);if(n+a>l)return this.flushBuffer(),1;for(;a--;)f[n++]=0}for(r=this.literalTree.length,n=0;r>n;n++)this.literalTree[n]=new cc.Codec.GZip.HufNode;if(this.CreateTree(this.literalTree,h,f,0))return this.flushBuffer(),1;for(r=this.literalTree.length,n=0;r>n;n++)this.distanceTree[n]=new cc.Codec.GZip.HufNode;var g=new Array;for(n=h;n<f.length;n++)g[n-h]=f[n];if(this.CreateTree(this.distanceTree,u,g,0))return this.flushBuffer(),1;for(;;)if(a=this.DecodeValue(this.literalTree),a>=256){var r,c;if(a-=256,0===a)break;if(a--,r=this.readBits(cc.Codec.GZip.cplext[a])+cc.Codec.GZip.cplens[a],a=this.DecodeValue(this.distanceTree),cc.Codec.GZip.cpdext[a]>8)c=this.readBits(8),c|=this.readBits(cc.Codec.GZip.cpdext[a]-8)<<8;else c=this.readBits(cc.Codec.GZip.cpdext[a]);for(c+=cc.Codec.GZip.cpdist[a];r--;){var e=this.buf32k[this.bIdx-c&32767];this.addBuffer(e)}}else this.addBuffer(a)}while(!t);return this.flushBuffer(),this.byteAlign(),0},cc.Codec.GZip.prototype.unzipFile=function(t){var e;for(this.gunzip(),e=0;e<this.unzipped.length;e++)if(this.unzipped[e][1]===t)return this.unzipped[e][0]},cc.Codec.GZip.prototype.nextFile=function(){this.outputArr=[],this.modeZIP=!1;var t=[];if(t[0]=this.readByte(),t[1]=this.readByte(),120===t[0]&&218===t[1])this.DeflateLoop(),this.unzipped[this.files]=[this.outputArr.join(""),"geonext.gxt"],this.files++;if(31===t[0]&&139===t[1])this.skipdir(),this.unzipped[this.files]=[this.outputArr.join(""),"file"],this.files++;if(80===t[0]&&75===t[1])if(this.modeZIP=!0,t[2]=this.readByte(),t[3]=this.readByte(),3===t[2]&&4===t[3]){t[0]=this.readByte(),t[1]=this.readByte(),this.gpflags=this.readByte(),this.gpflags|=this.readByte()<<8;var e=this.readByte();e|=this.readByte()<<8,this.readByte(),this.readByte(),this.readByte(),this.readByte();var i=this.readByte();i|=this.readByte()<<8,i|=this.readByte()<<16,i|=this.readByte()<<24;var n=this.readByte();n|=this.readByte()<<8,n|=this.readByte()<<16,n|=this.readByte()<<24;var r=this.readByte();r|=this.readByte()<<8;var s=this.readByte();for(s|=this.readByte()<<8,a=0,this.nameBuf=[];r--;){var o=this.readByte();if("/"===o|":"===o)a=0;else if(a<cc.Codec.GZip.NAMEMAX-1)this.nameBuf[a++]=String.fromCharCode(o)}if(!this.fileout)this.fileout=this.nameBuf;for(var a=0;s>a;)o=this.readByte(),a++;if(8===e)this.DeflateLoop(),this.unzipped[this.files]=[this.outputArr.join(""),this.nameBuf.join("")],this.files++;this.skipdir()}},cc.Codec.GZip.prototype.skipdir=function(){var t,e,i,n,r,s=[];if(8&this.gpflags)s[0]=this.readByte(),s[1]=this.readByte(),s[2]=this.readByte(),s[3]=this.readByte(),t=this.readByte(),t|=this.readByte()<<8,t|=this.readByte()<<16,t|=this.readByte()<<24,e=this.readByte(),e|=this.readByte()<<8,e|=this.readByte()<<16,e|=this.readByte()<<24;if(this.modeZIP)this.nextFile();if(s[0]=this.readByte(),8!==s[0])return 0;if(this.gpflags=this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),i=this.readByte(),4&this.gpflags)for(s[0]=this.readByte(),s[2]=this.readByte(),this.len=s[0]+256*s[1],n=0;n<this.len;n++)this.readByte();if(8&this.gpflags)for(n=0,this.nameBuf=[];r=this.readByte();){if("7"===r||":"===r)n=0;if(n<cc.Codec.GZip.NAMEMAX-1)this.nameBuf[n++]=r}if(16&this.gpflags)for(;r=this.readByte(););if(2&this.gpflags)this.readByte(),this.readByte();if(this.DeflateLoop(),e=this.readByte(),e|=this.readByte()<<8,e|=this.readByte()<<16,e|=this.readByte()<<24,this.modeZIP)this.nextFile()}},{}],26:[function(t,e,i){t("./ZipUtils"),t("./base64"),t("./gzip"),t("./zlib.min")},{"./ZipUtils":23,"./base64":24,"./gzip":25,"./zlib.min":27}],27:[function(t,e,i){(function(){"use strict";function t(t){throw t}function e(t,e){var i=t.split("."),n=T;!(i[0]in n)&&n.execScript&&n.execScript("var "+i[0]);for(var r;i.length&&(r=i.shift());)!i.length&&e!==v?n[r]=e:n=n[r]?n[r]:n[r]={}}function i(t){if("string"==typeof t){var e,i,n=t.split("");for(e=0,i=n.length;i>e;e++)n[e]=(255&n[e].charCodeAt(0))>>>0;t=n}for(var r,s=1,o=0,a=t.length,c=0;a>0;){r=a>1024?1024:a,a-=r;do s+=t[c++],o+=s;while(--r);s%=65521,o%=65521}return(o<<16|s)>>>0}function n(e,i){this.index="number"==typeof i?i:0,this.i=0,this.buffer=e instanceof(C?Uint8Array:Array)?e:new(C?Uint8Array:Array)(32768),2*this.buffer.length<=this.index&&t(Error("invalid index")),this.buffer.length<=this.index&&this.f()}function r(t){this.buffer=new(C?Uint16Array:Array)(2*t),this.length=0}function s(t){var e,i,n,r,s,o,a,c,l,h=t.length,u=0,d=Number.POSITIVE_INFINITY;for(c=0;h>c;++c)t[c]>u&&(u=t[c]),t[c]<d&&(d=t[c]);for(e=1<<u,i=new(C?Uint32Array:Array)(e),n=1,r=0,s=2;u>=n;){for(c=0;h>c;++c)if(t[c]===n){for(o=0,a=r,l=0;n>l;++l)o=o<<1|1&a,a>>=1;for(l=o;e>l;l+=s)i[l]=n<<16|c;++r}++n,r<<=1,s<<=1}return[i,u,d]}function o(t,e){this.h=R,this.w=0,this.input=t,this.b=0,e&&(e.lazy&&(this.w=e.lazy),"number"==typeof e.compressionType&&(this.h=e.compressionType),e.outputBuffer&&(this.a=C&&e.outputBuffer instanceof Array?new Uint8Array(e.outputBuffer):e.outputBuffer),"number"==typeof e.outputIndex&&(this.b=e.outputIndex)),this.a||(this.a=new(C?Uint8Array:Array)(32768))}function a(t,e){this.length=t,this.G=e}function c(){var e=L;switch(y){case 3===e:return[257,e-3,0];case 4===e:return[258,e-4,0];case 5===e:return[259,e-5,0];case 6===e:return[260,e-6,0];case 7===e:return[261,e-7,0];case 8===e:return[262,e-8,0];case 9===e:return[263,e-9,0];case 10===e:return[264,e-10,0];case 12>=e:return[265,e-11,1];case 14>=e:return[266,e-13,1];case 16>=e:return[267,e-15,1];case 18>=e:return[268,e-17,1];case 22>=e:return[269,e-19,2];case 26>=e:return[270,e-23,2];case 30>=e:return[271,e-27,2];case 34>=e:return[272,e-31,2];case 42>=e:return[273,e-35,3];case 50>=e:return[274,e-43,3];case 58>=e:return[275,e-51,3];case 66>=e:return[276,e-59,3];case 82>=e:return[277,e-67,4];case 98>=e:return[278,e-83,4];case 114>=e:return[279,e-99,4];case 130>=e:return[280,e-115,4];case 162>=e:return[281,e-131,5];case 194>=e:return[282,e-163,5];case 226>=e:return[283,e-195,5];case 257>=e:return[284,e-227,5];case 258===e:return[285,e-258,0];default:t("invalid length: "+e)}}function l(e,i){function n(e,i){var n,r=e.G,s=[],o=0;n=M[e.length],s[o++]=65535&n,s[o++]=n>>16&255,s[o++]=n>>24;var a;switch(y){case 1===r:a=[0,r-1,0];break;case 2===r:a=[1,r-2,0];break;case 3===r:a=[2,r-3,0];break;case 4===r:a=[3,r-4,0];break;case 6>=r:a=[4,r-5,1];break;case 8>=r:a=[5,r-7,1];break;case 12>=r:a=[6,r-9,2];break;case 16>=r:a=[7,r-13,2];break;case 24>=r:a=[8,r-17,3];break;case 32>=r:a=[9,r-25,3];break;case 48>=r:a=[10,r-33,4];break;case 64>=r:a=[11,r-49,4];break;case 96>=r:a=[12,r-65,5];break;case 128>=r:a=[13,r-97,5];break;case 192>=r:a=[14,r-129,6];break;case 256>=r:a=[15,r-193,6];break;case 384>=r:a=[16,r-257,7];break;case 512>=r:a=[17,r-385,7];break;case 768>=r:a=[18,r-513,8];break;case 1024>=r:a=[19,r-769,8];break;case 1536>=r:a=[20,r-1025,9];break;case 2048>=r:a=[21,r-1537,9];break;case 3072>=r:a=[22,r-2049,10];break;case 4096>=r:a=[23,r-3073,10];break;case 6144>=r:a=[24,r-4097,11];break;case 8192>=r:a=[25,r-6145,11];break;case 12288>=r:a=[26,r-8193,12];break;case 16384>=r:a=[27,r-12289,12];break;case 24576>=r:a=[28,r-16385,13];break;case 32768>=r:a=[29,r-24577,13];break;default:t("invalid distance")}n=a,s[o++]=n[0],s[o++]=n[1],s[o++]=n[2];var c,l;for(c=0,l=s.length;l>c;++c)p[g++]=s[c];T[s[0]]++,x[s[3]]++,m=e.length+i-1,d=null}var r,s,o,c,l,h,u,d,f,_={},p=C?new Uint16Array(2*i.length):[],g=0,m=0,T=new(C?Uint32Array:Array)(286),x=new(C?Uint32Array:Array)(30),S=e.w;if(!C){for(o=0;285>=o;)T[o++]=0;for(o=0;29>=o;)x[o++]=0}for(T[256]=1,r=0,s=i.length;s>r;++r){for(o=l=0,c=3;c>o&&r+o!==s;++o)l=l<<8|i[r+o];if(_[l]===v&&(_[l]=[]),h=_[l],!(0<m--)){for(;0<h.length&&32768<r-h[0];)h.shift();if(r+3>=s){for(d&&n(d,-1),o=0,c=s-r;c>o;++o)f=i[r+o],p[g++]=f,++T[f];break}if(0<h.length){var b=v,E=v,A=0,w=v,O=v,I=v,R=v,P=i.length,O=0,R=h.length;t:for(;R>O;O++){if(b=h[R-O-1],w=3,A>3){for(I=A;I>3;I--)if(i[b+I-1]!==i[r+I-1])continue t;w=A}for(;258>w&&P>r+w&&i[b+w]===i[r+w];)++w;if(w>A&&(E=b,A=w),258===w)break}u=new a(A,r-E),d?d.length<u.length?(f=i[r-1],p[g++]=f,++T[f],n(u,0)):n(d,-1):u.length<S?d=u:n(u,0)}else d?n(d,-1):(f=i[r],p[g++]=f,++T[f])}h.push(r)}return p[g++]=256,T[256]++,e.L=T,e.K=x,C?p.subarray(0,g):p}function h(t,e){function i(t){var e=S[t][b[t]];e===m?(i(t+1),i(t+1)):--T[e],++b[t]}var n,s,o,a,c,l=t.length,h=new r(572),u=new(C?Uint8Array:Array)(l);if(!C)for(a=0;l>a;a++)u[a]=0;for(a=0;l>a;++a)0<t[a]&&h.push(a,t[a]);if(n=Array(h.length/2),s=new(C?Uint32Array:Array)(h.length/2),1===n.length)return u[h.pop().index]=1,u;for(a=0,c=h.length/2;c>a;++a)n[a]=h.pop(),s[a]=n[a].value;var d,f,_,p,g,m=s.length,v=new(C?Uint16Array:Array)(e),y=new(C?Uint8Array:Array)(e),T=new(C?Uint8Array:Array)(m),x=Array(e),S=Array(e),b=Array(e),E=(1<<e)-m,A=1<<e-1;for(v[e-1]=m,f=0;e>f;++f)A>E?y[f]=0:(y[f]=1,E-=A),E<<=1,v[e-2-f]=(v[e-1-f]/2|0)+m;for(v[0]=y[0],x[0]=Array(v[0]),S[0]=Array(v[0]),f=1;e>f;++f)v[f]>2*v[f-1]+y[f]&&(v[f]=2*v[f-1]+y[f]),x[f]=Array(v[f]),S[f]=Array(v[f]);for(d=0;m>d;++d)T[d]=e;for(_=0;_<v[e-1];++_)x[e-1][_]=s[_],S[e-1][_]=_;for(d=0;e>d;++d)b[d]=0;for(1===y[e-1]&&(--T[0],++b[e-1]),f=e-2;f>=0;--f){for(p=d=0,g=b[f+1],_=0;_<v[f];_++)p=x[f+1][g]+x[f+1][g+1],p>s[d]?(x[f][_]=p,S[f][_]=m,g+=2):(x[f][_]=s[d],S[f][_]=d,++d);b[f]=0,1===y[f]&&i(f)}for(o=T,a=0,c=n.length;c>a;++a)u[n[a].index]=o[a];return u}function u(e){var i,n,r,s,o=new(C?Uint16Array:Array)(e.length),a=[],c=[],l=0;for(i=0,n=e.length;n>i;i++)a[e[i]]=(0|a[e[i]])+1;for(i=1,n=16;n>=i;i++)c[i]=l,l+=0|a[i],l>1<<i&&t("overcommitted"),l<<=1;for(65536>l&&t("undercommitted"),i=0,n=e.length;n>i;i++)for(l=c[e[i]],c[e[i]]+=1,r=o[i]=0,s=e[i];s>r;r++)o[i]=o[i]<<1|1&l,l>>>=1;return o}function d(t,e){this.input=t,this.a=new(C?Uint8Array:Array)(32768),this.h=B.j;var i,n={};if((e||!(e={}))&&"number"==typeof e.compressionType)this.h=e.compressionType;for(i in e)n[i]=e[i];n.outputBuffer=this.a,this.z=new o(this.input,n)}function f(e,i){if(this.k=[],this.l=32768,this.e=this.g=this.c=this.q=0,this.input=C?new Uint8Array(e):e,this.s=!1,this.m=k,this.B=!1,i||!(i={}))i.index&&(this.c=i.index),i.bufferSize&&(this.l=i.bufferSize),i.bufferType&&(this.m=i.bufferType),i.resize&&(this.B=i.resize);switch(this.m){case z:this.b=32768,this.a=new(C?Uint8Array:Array)(32768+this.l+258);break;case k:this.b=0,this.a=new(C?Uint8Array:Array)(this.l),this.f=this.J,this.t=this.H,this.o=this.I;break;default:t(Error("invalid inflate mode"))}}function _(e,i){for(var n,r=e.g,s=e.e,o=e.input,a=e.c;i>s;)n=o[a++],n===v&&t(Error("input buffer is broken")),r|=n<<s,s+=8;return n=r&(1<<i)-1,e.g=r>>>i,e.e=s-i,e.c=a,n}function p(e,i){for(var n,r,s,o=e.g,a=e.e,c=e.input,l=e.c,h=i[0],u=i[1];u>a;)n=c[l++],n===v&&t(Error("input buffer is broken")),o|=n<<a,a+=8;return r=h[o&(1<<u)-1],s=r>>>16,e.g=o>>s,e.e=a-s,e.c=l,65535&r}function g(t){function e(t,e,i){var n,r,s,o;for(o=0;t>o;)switch(n=p(this,e)){case 16:for(s=3+_(this,2);s--;)i[o++]=r;break;case 17:for(s=3+_(this,3);s--;)i[o++]=0;r=0;break;case 18:for(s=11+_(this,7);s--;)i[o++]=0;r=0;break;default:r=i[o++]=n}return i}var i,n,r,o,a=_(t,5)+257,c=_(t,5)+1,l=_(t,4)+4,h=new(C?Uint8Array:Array)(X.length);for(o=0;l>o;++o)h[X[o]]=_(t,3);i=s(h),n=new(C?Uint8Array:Array)(a),r=new(C?Uint8Array:Array)(c),t.o(s(e.call(t,a,i,n)),s(e.call(t,c,i,r)))}function m(e,i){var n,r;if(this.input=e,this.c=0,i||!(i={}))i.index&&(this.c=i.index),i.verify&&(this.M=i.verify);switch(n=e[this.c++],r=e[this.c++],15&n){case gt:this.method=gt;break;default:t(Error("unsupported compression method"))}0!==((n<<8)+r)%31&&t(Error("invalid fcheck flag:"+((n<<8)+r)%31)),32&r&&t(Error("fdict flag is not supported")),this.A=new f(e,{index:this.c,bufferSize:i.bufferSize,bufferType:i.bufferType,resize:i.resize})}var v=void 0,y=!0,T=this,C="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array;n.prototype.f=function(){var t,e=this.buffer,i=e.length,n=new(C?Uint8Array:Array)(i<<1);if(C)n.set(e);else for(t=0;i>t;++t)n[t]=e[t];return this.buffer=n},n.prototype.d=function(t,e,i){var n,r=this.buffer,s=this.index,o=this.i,a=r[s];if(i&&e>1&&(t=e>8?(w[255&t]<<24|w[t>>>8&255]<<16|w[t>>>16&255]<<8|w[t>>>24&255])>>32-e:w[t]>>8-e),8>e+o)a=a<<e|t,o+=e;else for(n=0;e>n;++n)a=a<<1|t>>e-n-1&1,8===++o&&(o=0,r[s++]=w[a],a=0,s===r.length&&(r=this.f()));r[s]=a,this.buffer=r,this.i=o,this.index=s},n.prototype.finish=function(){var t,e=this.buffer,i=this.index;return 0<this.i&&(e[i]<<=8-this.i,e[i]=w[e[i]],i++),C?t=e.subarray(0,i):(e.length=i,t=e),t};var x,S=new(C?Uint8Array:Array)(256);for(x=0;256>x;++x){for(var b=x,E=b,A=7,b=b>>>1;b;b>>>=1)E<<=1,E|=1&b,--A;S[x]=(E<<A&255)>>>0}var w=S,O=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];C&&new Uint32Array(O),r.prototype.getParent=function(t){return 2*((t-2)/4|0)},r.prototype.push=function(t,e){var i,n,r,s=this.buffer;for(i=this.length,s[this.length++]=e,s[this.length++]=t;i>0&&(n=this.getParent(i),s[i]>s[n]);)r=s[i],s[i]=s[n],s[n]=r,r=s[i+1],s[i+1]=s[n+1],s[n+1]=r,i=n;return this.length},r.prototype.pop=function(){var t,e,i,n,r,s=this.buffer;for(e=s[0],t=s[1],this.length-=2,s[0]=s[this.length],s[1]=s[this.length+1],r=0;(n=2*r+2,!(n>=this.length))&&(n+2<this.length&&s[n+2]>s[n]&&(n+=2),s[n]>s[r]);)i=s[r],s[r]=s[n],s[n]=i,i=s[r+1],s[r+1]=s[n+1],s[n+1]=i,r=n;return{index:t,value:e,length:this.length}};var I,R=2,P={NONE:0,r:1,j:R,N:3},N=[];for(I=0;288>I;I++)switch(y){case 143>=I:N.push([I+48,8]);break;case 255>=I:N.push([I-144+400,9]);break;case 279>=I:N.push([I-256+0,7]);break;case 287>=I:N.push([I-280+192,8]);break;default:t("invalid literal: "+I)}o.prototype.n=function(){var e,i,r,s,o=this.input;switch(this.h){case 0:for(r=0,s=o.length;s>r;){i=C?o.subarray(r,r+65535):o.slice(r,r+65535),r+=i.length;var a=i,c=r===s,d=v,f=v,_=v,p=v,g=v,m=this.a,T=this.b;if(C){for(m=new Uint8Array(this.a.buffer);m.length<=T+a.length+5;)m=new Uint8Array(m.length<<1);m.set(this.a)}if(d=c?1:0,m[T++]=0|d,f=a.length,_=~f+65536&65535,m[T++]=255&f,m[T++]=f>>>8&255,m[T++]=255&_,m[T++]=_>>>8&255,C)m.set(a,T),T+=a.length,m=m.subarray(0,T);else{for(p=0,g=a.length;g>p;++p)m[T++]=a[p];m.length=T}this.b=T,this.a=m}break;case 1:var x=new n(new Uint8Array(this.a.buffer),this.b);x.d(1,1,y),x.d(1,2,y);var S,b,E,A=l(this,o);for(S=0,b=A.length;b>S;S++)if(E=A[S],n.prototype.d.apply(x,N[E]),E>256)x.d(A[++S],A[++S],y),x.d(A[++S],5),x.d(A[++S],A[++S],y);else if(256===E)break;this.a=x.finish(),this.b=this.a.length;break;case R:var w,O,I,P,L,F,D,M,B,z,k,V,W,U,G,X=new n(new Uint8Array(this.a),this.b),j=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Y=Array(19);for(w=R,X.d(1,1,y),X.d(w,2,y),O=l(this,o),F=h(this.L,15),D=u(F),M=h(this.K,7),B=u(M),I=286;I>257&&0===F[I-1];I--);for(P=30;P>1&&0===M[P-1];P--);var H,q,Q,Z,K,J,$=I,tt=P,et=new(C?Uint32Array:Array)($+tt),it=new(C?Uint32Array:Array)(316),nt=new(C?Uint8Array:Array)(19);for(H=q=0;$>H;H++)et[q++]=F[H];for(H=0;tt>H;H++)et[q++]=M[H];if(!C)for(H=0,Z=nt.length;Z>H;++H)nt[H]=0;for(H=K=0,Z=et.length;Z>H;H+=q){for(q=1;Z>H+q&&et[H+q]===et[H];++q);if(Q=q,0===et[H])if(3>Q)for(;0<Q--;)it[K++]=0,nt[0]++;else for(;Q>0;)J=138>Q?Q:138,J>Q-3&&Q>J&&(J=Q-3),10>=J?(it[K++]=17,it[K++]=J-3,nt[17]++):(it[K++]=18,it[K++]=J-11,nt[18]++),Q-=J;else if(it[K++]=et[H],nt[et[H]]++,Q--,3>Q)for(;0<Q--;)it[K++]=et[H],nt[et[H]]++;else for(;Q>0;)J=6>Q?Q:6,J>Q-3&&Q>J&&(J=Q-3),it[K++]=16,it[K++]=J-3,nt[16]++,Q-=J}for(e=C?it.subarray(0,K):it.slice(0,K),z=h(nt,7),U=0;19>U;U++)Y[U]=z[j[U]];for(L=19;L>4&&0===Y[L-1];L--);for(k=u(z),X.d(I-257,5,y),X.d(P-1,5,y),X.d(L-4,4,y),U=0;L>U;U++)X.d(Y[U],3,y);for(U=0,G=e.length;G>U;U++)if(V=e[U],X.d(k[V],z[V],y),V>=16){switch(U++,V){case 16:W=2;break;case 17:W=3;break;case 18:W=7;break;default:t("invalid code: "+V)}X.d(e[U],W,y)}var rt,st,ot,at,ct,lt,ht,ut,dt=[D,F],ft=[B,M];for(ct=dt[0],lt=dt[1],ht=ft[0],ut=ft[1],rt=0,st=O.length;st>rt;++rt)if(ot=O[rt],X.d(ct[ot],lt[ot],y),ot>256)X.d(O[++rt],O[++rt],y),at=O[++rt],X.d(ht[at],ut[at],y),X.d(O[++rt],O[++rt],y);else if(256===ot)break;this.a=X.finish(),this.b=this.a.length;break;default:t("invalid compression type")}return this.a};var L,F,D=[];for(L=3;258>=L;L++)F=c(),D[L]=F[2]<<24|F[1]<<16|F[0];var M=C?new Uint32Array(D):D,B=P;d.prototype.n=function(){var e,n,r,s,o,a,c,l=0;switch(c=this.a,e=gt){case gt:n=Math.LOG2E*Math.log(32768)-8;break;default:t(Error("invalid compression method"))}switch(r=n<<4|e,c[l++]=r,e){case gt:switch(this.h){case B.NONE:o=0;break;case B.r:o=1;break;case B.j:o=2;break;default:t(Error("unsupported compression type"))}break;default:t(Error("invalid compression method"))}return s=o<<6|0,c[l++]=s|31-(256*r+s)%31,a=i(this.input),this.z.b=l,c=this.z.n(),l=c.length,C&&(c=new Uint8Array(c.buffer),c.length<=l+4&&(this.a=new Uint8Array(c.length+4),this.a.set(c),c=this.a),c=c.subarray(0,l+4)),c[l++]=a>>24&255,c[l++]=a>>16&255,c[l++]=a>>8&255,c[l++]=255&a,c},e("Zlib.Deflate",d),e("Zlib.Deflate.compress",function(t,e){return new d(t,e).n()}),e("Zlib.Deflate.CompressionType",B),e("Zlib.Deflate.CompressionType.NONE",B.NONE),e("Zlib.Deflate.CompressionType.FIXED",B.r),e("Zlib.Deflate.CompressionType.DYNAMIC",B.j);var z=0,k=1,V={D:z,C:k};f.prototype.p=function(){for(;!this.s;){var e=_(this,3);switch(1&e&&(this.s=y),e>>>=1){case 0:var i=this.input,n=this.c,r=this.a,s=this.b,o=v,a=v,c=v,l=r.length,h=v;switch(this.e=this.g=0,o=i[n++],o===v&&t(Error("invalid uncompressed block header: LEN (first byte)")),a=o,o=i[n++],o===v&&t(Error("invalid uncompressed block header: LEN (second byte)")),a|=o<<8,o=i[n++],o===v&&t(Error("invalid uncompressed block header: NLEN (first byte)")),c=o,o=i[n++],o===v&&t(Error("invalid uncompressed block header: NLEN (second byte)")),c|=o<<8,a===~c&&t(Error("invalid uncompressed block header: length verify")),n+a>i.length&&t(Error("input buffer is broken")),this.m){case z:for(;s+a>r.length;){if(h=l-s,a-=h,C)r.set(i.subarray(n,n+h),s),s+=h,n+=h;else for(;h--;)r[s++]=i[n++];this.b=s,r=this.f(),s=this.b}break;case k:for(;s+a>r.length;)r=this.f({v:2});break;default:t(Error("invalid inflate mode"))}if(C)r.set(i.subarray(n,n+a),s),s+=a,n+=a;else for(;a--;)r[s++]=i[n++];this.c=n,this.b=s,this.a=r;break;case 1:this.o(it,rt);break;case 2:g(this);break;default:t(Error("unknown BTYPE: "+e))}}return this.t()};var W,U,G=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],X=C?new Uint16Array(G):G,j=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],Y=C?new Uint16Array(j):j,H=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],q=C?new Uint8Array(H):H,Q=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],Z=C?new Uint16Array(Q):Q,K=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],J=C?new Uint8Array(K):K,$=new(C?Uint8Array:Array)(288);for(W=0,U=$.length;U>W;++W)$[W]=143>=W?8:255>=W?9:279>=W?7:8;var tt,et,it=s($),nt=new(C?Uint8Array:Array)(30);for(tt=0,et=nt.length;et>tt;++tt)nt[tt]=5;var rt=s(nt);f.prototype.o=function(t,e){var i=this.a,n=this.b;this.u=t;for(var r,s,o,a,c=i.length-258;256!==(r=p(this,t));)if(256>r)n>=c&&(this.b=n,i=this.f(),n=this.b),i[n++]=r;else for(s=r-257,a=Y[s],0<q[s]&&(a+=_(this,q[s])),r=p(this,e),o=Z[r],0<J[r]&&(o+=_(this,J[r])),n>=c&&(this.b=n,i=this.f(),n=this.b);a--;)i[n]=i[n++-o];for(;8<=this.e;)this.e-=8,this.c--;this.b=n},f.prototype.I=function(t,e){var i=this.a,n=this.b;this.u=t;for(var r,s,o,a,c=i.length;256!==(r=p(this,t));)if(256>r)n>=c&&(i=this.f(),c=i.length),i[n++]=r;else for(s=r-257,a=Y[s],0<q[s]&&(a+=_(this,q[s])),r=p(this,e),o=Z[r],0<J[r]&&(o+=_(this,J[r])),n+a>c&&(i=this.f(),c=i.length);a--;)i[n]=i[n++-o];for(;8<=this.e;)this.e-=8,this.c--;this.b=n},f.prototype.f=function(){var t,e,i=new(C?Uint8Array:Array)(this.b-32768),n=this.b-32768,r=this.a;if(C)i.set(r.subarray(32768,i.length));else for(t=0,e=i.length;e>t;++t)i[t]=r[t+32768];if(this.k.push(i),this.q+=i.length,C)r.set(r.subarray(n,n+32768));else for(t=0;32768>t;++t)r[t]=r[n+t];return this.b=32768,r},f.prototype.J=function(t){var e,i,n,r,s=this.input.length/this.c+1|0,o=this.input,a=this.a;return t&&("number"==typeof t.v&&(s=t.v),"number"==typeof t.F&&(s+=t.F)),2>s?(i=(o.length-this.c)/this.u[2],r=258*(i/2)|0,n=r<a.length?a.length+r:a.length<<1):n=a.length*s,C?(e=new Uint8Array(n),e.set(a)):e=a,this.a=e},f.prototype.t=function(){var t,e,i,n,r,s=0,o=this.a,a=this.k,c=new(C?Uint8Array:Array)(this.q+(this.b-32768));if(0===a.length)return C?this.a.subarray(32768,this.b):this.a.slice(32768,this.b);for(e=0,i=a.length;i>e;++e)for(t=a[e],n=0,r=t.length;r>n;++n)c[s++]=t[n];for(e=32768,i=this.b;i>e;++e)c[s++]=o[e];return this.k=[],this.buffer=c},f.prototype.H=function(){var t,e=this.b;return C?this.B?(t=new Uint8Array(e),t.set(this.a.subarray(0,e))):t=this.a.subarray(0,e):(this.a.length>e&&(this.a.length=e),t=this.a),this.buffer=t},m.prototype.p=function(){var e,n,r=this.input;return e=this.A.p(),this.c=this.A.c,this.M&&(n=(r[this.c++]<<24|r[this.c++]<<16|r[this.c++]<<8|r[this.c++])>>>0,n!==i(e)&&t(Error("invalid adler-32 checksum"))),e},e("Zlib.Inflate",m),e("Zlib.Inflate.BufferType",V),V.ADAPTIVE=V.C,V.BLOCK=V.D,e("Zlib.Inflate.prototype.decompress",m.prototype.p);var st=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];C&&new Uint16Array(st);var ot=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258];C&&new Uint16Array(ot);var at=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0];C&&new Uint8Array(at);var ct=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577];C&&new Uint16Array(ct);var lt=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];C&&new Uint8Array(lt);var ht,ut,dt=new(C?Uint8Array:Array)(288);for(ht=0,ut=dt.length;ut>ht;++ht)dt[ht]=143>=ht?8:255>=ht?9:279>=ht?7:8;s(dt);var ft,_t,pt=new(C?Uint8Array:Array)(30);for(ft=0,_t=pt.length;_t>ft;++ft)pt[ft]=5;s(pt);var gt=8}).call(window);var n=window;n=window.Zlib=n.Zlib,n.Deflate=n.Deflate,n.Deflate.compress=n.Deflate.compress,n.Inflate=n.Inflate,n.Inflate.BufferType=n.Inflate.BufferType,n.Inflate.prototype.decompress=n.Inflate.prototype.decompress},{}],28:[function(t,e,i){var n=cc._Class.extend({actions:null,target:null,actionIndex:0,currentAction:null,currentActionSalvaged:!1,paused:!1,hh:null,ctor:function(){this.actions=[],this.target=null,this.actionIndex=0,this.currentAction=null,this.currentActionSalvaged=!1,this.paused=!1,this.hh=null}});cc.ActionManager=cc._Class.extend({_hashTargets:null,_arrayTargets:null,_currentTarget:null,_currentTargetSalvaged:!1,_searchElementByTarget:function(t,e){for(var i=0;i<t.length;i++)if(e===t[i].target)return t[i];return null},ctor:function(){this._hashTargets={},this._arrayTargets=[],this._currentTarget=null,this._currentTargetSalvaged=!1},addAction:function(t,e,i){if(!t)throw new Error("cc.ActionManager.addAction(): action must be non-null");if(!e)throw new Error("cc.ActionManager.addAction(): action must be non-null");var r=this._hashTargets[e.__instanceId];if(!r)r=new n,r.paused=i,r.target=e,this._hashTargets[e.__instanceId]=r,this._arrayTargets.push(r);this._actionAllocWithHashElement(r),r.actions.push(t),t.startWithTarget(e)},removeAllActions:function(){for(var t=this._arrayTargets,e=0;e<t.length;e++){var i=t[e];if(i)this.removeAllActionsFromTarget(i.target,!0)}},removeAllActionsFromTarget:function(t,e){if(null!=t){var i=this._hashTargets[t.__instanceId];if(i){if(-1!==i.actions.indexOf(i.currentAction)&&!i.currentActionSalvaged)i.currentActionSalvaged=!0;if(i.actions.length=0,this._currentTarget===i&&!e)this._currentTargetSalvaged=!0;else this._deleteHashElement(i)}}},removeAction:function(t){if(null!=t){var e=t.getOriginalTarget(),i=this._hashTargets[e.__instanceId];if(i){for(var n=0;n<i.actions.length;n++)if(i.actions[n]===t){i.actions.splice(n,1);break}}else cc.log(cc._LogInfos.ActionManager.removeAction)}},removeActionByTag:function(t,e){if(t===cc.Action.TAG_INVALID)cc.log(cc._LogInfos.ActionManager.addAction);cc.assert(e,cc._LogInfos.ActionManager.addAction);var i=this._hashTargets[e.__instanceId];if(i)for(var n=i.actions.length,r=0;n>r;++r){var s=i.actions[r];if(s&&s.getTag()===t&&s.getOriginalTarget()===e){this._removeActionAtIndex(r,i);break}}},getActionByTag:function(t,e){if(t===cc.Action.TAG_INVALID)cc.log(cc._LogInfos.ActionManager.getActionByTag);var i=this._hashTargets[e.__instanceId];if(i){if(null!=i.actions)for(var n=0;n<i.actions.length;++n){var r=i.actions[n];if(r&&r.getTag()===t)return r}cc.log(cc._LogInfos.ActionManager.getActionByTag_2,t)}return null},numberOfRunningActionsInTarget:function(t){var e=this._hashTargets[t.__instanceId];if(e)return e.actions?e.actions.length:0;else return 0},pauseTarget:function(t){var e=this._hashTargets[t.__instanceId];if(e)e.paused=!0},resumeTarget:function(t){var e=this._hashTargets[t.__instanceId];if(e)e.paused=!1},pauseAllRunningActions:function(){for(var t=[],e=this._arrayTargets,i=0;i<e.length;i++){var n=e[i];if(n&&!n.paused)n.paused=!0,t.push(n.target)}return t},resumeTargets:function(t){if(t)for(var e=0;e<t.length;e++)if(t[e])this.resumeTarget(t[e])},pauseTargets:function(t){if(t)for(var e=0;e<t.length;e++)if(t[e])this.pauseTarget(t[e])},purgeSharedManager:function(){cc.director.getScheduler().unscheduleUpdate(this)},_removeActionAtIndex:function(t,e){var i=e.actions[t];if(i===e.currentAction&&!e.currentActionSalvaged)e.currentActionSalvaged=!0;if(e.actions.splice(t,1),e.actionIndex>=t)e.actionIndex--;if(0===e.actions.length)if(this._currentTarget===e)this._currentTargetSalvaged=!0;else this._deleteHashElement(e)},_deleteHashElement:function(t){var e=!1;if(t){if(this._hashTargets[t.target.__instanceId])delete this._hashTargets[t.target.__instanceId],cc.js.array.remove(this._arrayTargets,t),e=!0;t.actions=null,t.target=null}return e},_actionAllocWithHashElement:function(t){if(null==t.actions)t.actions=[]},update:function(t){for(var e,i=this._arrayTargets,n=0;n<i.length;n++){if(this._currentTarget=i[n],e=this._currentTarget,!e.paused)for(e.actionIndex=0;e.actionIndex<(e.actions?e.actions.length:0);e.actionIndex++)if(e.currentAction=e.actions[e.actionIndex],e.currentAction){if(e.currentActionSalvaged=!1,e.currentAction.step(t*(e.currentAction._speedMethod?e.currentAction._speed:1)),e.currentActionSalvaged)e.currentAction=null;else if(e.currentAction.isDone()){e.currentAction.stop();var r=e.currentAction;e.currentAction=null,this.removeAction(r)}e.currentAction=null}else;if(this._currentTargetSalvaged&&0===e.actions.length)this._deleteHashElement(e)&&n--}}})},{}],29:[function(t,e,i){function n(t){for(var e=t._children,i=0,r=e.length;r>i;i++){var s=e[i];s._dirtyFlags=0,n(s)}}var r=t("./event/event-target"),s=t("./platform/_CCClass");cc.g_NumberOfDraws=0,cc.Director=s.extend({_landscape:!1,_nextDeltaTimeZero:!1,_paused:!1,_purgeDirectorInNextLoop:!1,_sendCleanupToScene:!1,_animationInterval:0,_oldAnimationInterval:0,_projection:0,_contentScaleFactor:1,_deltaTime:0,_winSizeInPoints:null,_lastUpdate:null,_nextScene:null,_notificationNode:null,_openGLView:null,_scenesStack:null,_projectionDelegate:null,_loadingScene:"",_runningScene:null,_scene:null,_totalFrames:0,_secondsPerFrame:0,_dirtyRegion:null,_scheduler:null,_actionManager:null,ctor:function(){var t=this;r.call(t),t._lastUpdate=Date.now(),cc.eventManager.addCustomListener(cc.game.EVENT_SHOW,function(){t._lastUpdate=Date.now()})},init:function(){if(this._oldAnimationInterval=this._animationInterval=1/cc.defaultFPS,this._scenesStack=[],this._projection=cc.Director.PROJECTION_DEFAULT,
this._projectionDelegate=null,this._totalFrames=0,this._lastUpdate=Date.now(),this._paused=!1,this._purgeDirectorInNextLoop=!1,this._winSizeInPoints=cc.size(0,0),this._openGLView=null,this._contentScaleFactor=1,this._scheduler=new cc.Scheduler,cc.ActionManager)this._actionManager=new cc.ActionManager,this._scheduler.scheduleUpdate(this._actionManager,cc.Scheduler.PRIORITY_SYSTEM,!1);else this._actionManager=null;return this.sharedInit(),!0},sharedInit:function(){if(cc.AnimationManager)this._animationManager=new cc.AnimationManager,this._scheduler.scheduleUpdate(this._animationManager,cc.Scheduler.PRIORITY_SYSTEM,!1);else this._animationManager=null;cc._widgetManager.init(this)},calculateDeltaTime:function(){var t=Date.now();if(this._nextDeltaTimeZero)this._deltaTime=0,this._nextDeltaTimeZero=!1;else this._deltaTime=(t-this._lastUpdate)/1e3;if(cc.game.config[cc.game.CONFIG_KEY.debugMode]>0&&this._deltaTime>.2)this._deltaTime=1/60;this._lastUpdate=t},convertToGL:null,convertToUI:null,engineUpdate:function(t){this._scheduler.update(t)},visit:function(t){if(this.emit(cc.Director.EVENT_BEFORE_VISIT,this),this._beforeVisitScene)this._beforeVisitScene();if(this._scene)n(this._scene);if(this._runningScene){var e=cc.renderer;if(e.childrenOrderDirty===!0)e.clearRenderCommands(),this._runningScene._renderCmd._curLevel=0,this._runningScene.visit(),e.resetFlag();else if(e.transformDirty()===!0)e.transform()}if(this._notificationNode)this._notificationNode.visit();if(this.emit(cc.Director.EVENT_AFTER_VISIT,this),this._afterVisitScene)this._afterVisitScene()},render:function(t){cc.g_NumberOfDraws=0,cc.renderer.clear(),cc.renderer.rendering(cc._renderContext),this._totalFrames++,this.emit(cc.Director.EVENT_AFTER_DRAW)},_beforeVisitScene:null,_afterVisitScene:null,end:function(){this._purgeDirectorInNextLoop=!0},getContentScaleFactor:function(){return this._contentScaleFactor},getNotificationNode:function(){return this._notificationNode},getWinSize:function(){return cc.size(this._winSizeInPoints)},getWinSizeInPixels:function(){return cc.size(this._winSizeInPoints.width*this._contentScaleFactor,this._winSizeInPoints.height*this._contentScaleFactor)},getVisibleSize:null,getVisibleOrigin:null,getZEye:null,pause:function(){if(!this._paused)this._oldAnimationInterval=this._animationInterval,this.setAnimationInterval(.25),this._paused=!0},popScene:function(){cc.assert(this._runningScene,cc._LogInfos.Director.popScene),this._scenesStack.pop();var t=this._scenesStack.length;if(0===t)this.end();else this._sendCleanupToScene=!0,this._nextScene=this._scenesStack[t-1]},purgeCachedData:function(){cc.spriteFrameCache._clear(),cc.textureCache._clear()},purgeDirector:function(){if(this.getScheduler().unscheduleAll(),cc.eventManager)cc.eventManager.setEnabled(!1);if(this._runningScene)this._runningScene.onExitTransitionDidStart(),this._runningScene.onExit(),this._runningScene.cleanup(),cc.renderer.clearRenderCommands();this._runningScene=null,this._nextScene=null,this._scenesStack.length=0,this.stopAnimation(),this.purgeCachedData(),cc.checkGLErrorDebug()},reset:function(){if(this.purgeDirector(),cc.eventManager)cc.eventManager.setEnabled(!0);if(this._actionManager)this._scheduler.scheduleUpdate(this._actionManager,cc.Scheduler.PRIORITY_SYSTEM,!1);if(this._animationManager)this._scheduler.scheduleUpdate(this._animationManager,cc.Scheduler.PRIORITY_SYSTEM,!1);this.startAnimation()},pushScene:function(t){cc.assert(t,cc._LogInfos.Director.pushScene),this._sendCleanupToScene=!1,this._scenesStack.push(t),this._nextScene=t},runSceneImmediate:function(t,e,i){var n,r,s=cc.game,o=s._persistRootNodes;if(t instanceof cc.Scene)t._load();for(n in o)r=o[n],s._ignoreRemovePersistNode=r,r.parent=null,s._ignoreRemovePersistNode=null;var a=this._scene;if(cc.isValid(a))a.destroy();if(this._scene=null,cc.Object._deferredDestroy(),e)e();this.emit(cc.Director.EVENT_BEFORE_SCENE_LAUNCH,t);var c=t;if(t instanceof cc.Scene){this._scene=t,c=t._sgNode;for(n in o){r=o[n];var l=t.getChildByUuid(n);if(l)o[n]=l,l._persistNode=!0;else r.parent=t}t._activate()}if(!this._runningScene)this.pushScene(c),this.startAnimation();else{var h=this._scenesStack.length;this._scenesStack[Math.max(h-1,0)]=c,this._sendCleanupToScene=!0,this._nextScene=c}if(this._nextScene)this.setNextScene();if(i)i(null,t);cc.renderer.clear(),this.emit(cc.Director.EVENT_AFTER_SCENE_LAUNCH,t)},runScene:function(t,e,i){if(cc.assert(t,cc._LogInfos.Director.pushScene),t instanceof cc.Scene)t._load();this.once(cc.Director.EVENT_AFTER_DRAW,function(){this.runSceneImmediate(t,e,i)})},loadScene:function(t,e,i){var n,r;if(this._loadingScene)return cc.error('[loadScene] Failed to load scene "%s" because "%s" is already loading',t,this._loadingScene),!1;if("string"==typeof t){if(!t.endsWith(".fire"))t+=".fire";if("/"!==t[0]&&!t.startsWith("db://assets/"))t="/"+t;for(var s=0;s<cc.game._sceneInfos.length;s++){r=cc.game._sceneInfos[s];var o=r.url;if(o.endsWith(t)){n=r.uuid;break}}}else if(r=cc.game._sceneInfos[t],"object"==typeof r)n=r.uuid;else return cc.error("[loadScene] The scene index to load (%s) is out of range.",t),!1;if(n)return this.emit(cc.Director.EVENT_BEFORE_SCENE_LOADING,t),this._loadingScene=t,this._loadSceneByUuid(n,e,i),!0;else return cc.error('[loadScene] Can not load the scene "%s" because it has not been added to the build settings before play.',t),!1},_loadSceneByUuid:function(t,e,i){cc.AssetLibrary.loadAsset(t,function(n,r){var s,o=cc.director;if(n){if(n="Failed to load scene: "+n,cc.error(n),!1)console.assert(!1,n)}else{if(r instanceof cc.SceneAsset)s=r.scene,s._id=r._uuid;else s=r;if(s instanceof cc.Scene)o.runSceneImmediate(s,i,e);else n="The asset "+t+" is not a scene",cc.error(n),s=null}if(o._loadingScene="",n&&e)e(n)})},resume:function(){if(this._paused){if(this.setAnimationInterval(this._oldAnimationInterval),this._lastUpdate=Date.now(),!this._lastUpdate)cc.log(cc._LogInfos.Director.resume);this._paused=!1,this._deltaTime=0}},setContentScaleFactor:function(t){if(t!==this._contentScaleFactor)this._contentScaleFactor=t},setDepthTest:null,setClearColor:null,setDefaultValues:function(){},setNextDeltaTimeZero:function(t){this._nextDeltaTimeZero=t},setNextScene:function(){var t=!1,e=!1;if(cc.TransitionScene)t=this._runningScene?this._runningScene instanceof cc.TransitionScene:!1,e=this._nextScene?this._nextScene instanceof cc.TransitionScene:!1;if(!e){var i=this._runningScene;if(i)i.onExitTransitionDidStart(),i.onExit();if(this._sendCleanupToScene&&i)i.cleanup()}if(this._runningScene=this._nextScene,cc.renderer.childrenOrderDirty=!0,this._nextScene=null,!t&&null!==this._runningScene)this._runningScene.onEnter(),this._runningScene.onEnterTransitionDidFinish()},setNotificationNode:function(t){if(cc.renderer.childrenOrderDirty=!0,this._notificationNode)this._notificationNode.onExitTransitionDidStart(),this._notificationNode.onExit(),this._notificationNode.cleanup();if(this._notificationNode=t,t)this._notificationNode.onEnter(),this._notificationNode.onEnterTransitionDidFinish()},getDelegate:function(){return this._projectionDelegate},setDelegate:function(t){this._projectionDelegate=t},setOpenGLView:null,setProjection:null,setViewport:null,getOpenGLView:null,getProjection:null,setAlphaBlending:null,isSendCleanupToScene:function(){return this._sendCleanupToScene},getRunningScene:function(){return this._runningScene},getScene:function(){return this._scene},getAnimationInterval:function(){return this._animationInterval},isDisplayStats:function(){return cc.profiler?cc.profiler.isShowingStats():!1},setDisplayStats:function(t){if(cc.profiler)t?cc.profiler.showStats():cc.profiler.hideStats()},getSecondsPerFrame:function(){return this._secondsPerFrame},isNextDeltaTimeZero:function(){return this._nextDeltaTimeZero},isPaused:function(){return this._paused},getTotalFrames:function(){return this._totalFrames},popToRootScene:function(){this.popToSceneStackLevel(1)},popToSceneStackLevel:function(t){cc.assert(this._runningScene,cc._LogInfos.Director.popToSceneStackLevel_2);var e=this._scenesStack,i=e.length;if(0===i)return void this.end();if(!(t>i)){for(;i>t;){var n=e.pop();if(n.running)n.onExitTransitionDidStart(),n.onExit();n.cleanup(),i--}this._nextScene=e[e.length-1],this._sendCleanupToScene=!1}},getScheduler:function(){return this._scheduler},setScheduler:function(t){if(this._scheduler!==t)this._scheduler=t},getActionManager:function(){return this._actionManager},setActionManager:function(t){if(this._actionManager!==t)this._actionManager=t},getAnimationManager:function(){return this._animationManager},getDeltaTime:function(){return this._deltaTime},_calculateMPF:function(){var t=Date.now();this._secondsPerFrame=(t-this._lastUpdate)/1e3}}),cc.js.addon(cc.Director.prototype,r.prototype),cc.Director.EVENT_PROJECTION_CHANGED="director_projection_changed",cc.Director.EVENT_BEFORE_SCENE_LOADING="director_before_scene_loading",cc.Director.EVENT_BEFORE_SCENE_LAUNCH="director_before_scene_launch",cc.Director.EVENT_AFTER_SCENE_LAUNCH="director_after_scene_launch",cc.Director.EVENT_BEFORE_UPDATE="director_before_update",cc.Director.EVENT_COMPONENT_UPDATE="director_component_update",cc.Director.EVENT_COMPONENT_LATE_UPDATE="director_component_late_update",cc.Director.EVENT_AFTER_UPDATE="director_after_update",cc.Director.EVENT_BEFORE_VISIT="director_before_visit",cc.Director.EVENT_AFTER_VISIT="director_after_visit",cc.Director.EVENT_AFTER_DRAW="director_after_draw",cc.DisplayLinkDirector=cc.Director.extend({invalid:!1,startAnimation:function(){this._nextDeltaTimeZero=!0,this.invalid=!1},mainLoop:!1?function(t,e){if(!this._paused){if(this.emit(cc.Director.EVENT_BEFORE_UPDATE),this.emit(cc.Director.EVENT_COMPONENT_UPDATE,t),e)cc.director.engineUpdate(t);this.emit(cc.Director.EVENT_COMPONENT_LATE_UPDATE,t),this.emit(cc.Director.EVENT_AFTER_UPDATE)}this.visit(),this.render()}:function(){if(this._purgeDirectorInNextLoop)this._purgeDirectorInNextLoop=!1,this.purgeDirector();else if(!this.invalid){if(this.calculateDeltaTime(),!this._paused)this.emit(cc.Director.EVENT_BEFORE_UPDATE),this.emit(cc.Director.EVENT_COMPONENT_UPDATE,this._deltaTime),this.engineUpdate(this._deltaTime),this.emit(cc.Director.EVENT_COMPONENT_LATE_UPDATE,this._deltaTime),this.emit(cc.Director.EVENT_AFTER_UPDATE),cc.Object._deferredDestroy();if(this._nextScene)this.setNextScene();this.visit(this._deltaTime),this.render(this._deltaTime),this._calculateMPF()}},stopAnimation:function(){this.invalid=!0},setAnimationInterval:function(t){if(this._animationInterval=t,!this.invalid)this.stopAnimation(),this.startAnimation()}}),cc.Director.sharedDirector=null,cc.Director.firstUseDirector=!0,cc.Director._getInstance=function(){if(cc.Director.firstUseDirector)cc.Director.firstUseDirector=!1,cc.Director.sharedDirector=new cc.DisplayLinkDirector,cc.Director.sharedDirector.init();return cc.Director.sharedDirector},cc.defaultFPS=60,cc.Director.PROJECTION_2D=0,cc.Director.PROJECTION_3D=1,cc.Director.PROJECTION_CUSTOM=3,cc.Director.PROJECTION_DEFAULT=cc.Director.PROJECTION_3D},{"./event/event-target":74,"./platform/_CCClass":98}],30:[function(t,e,i){t("./CCDirector"),t("./CCGame"),cc.game.once(cc.game.EVENT_RENDERER_INITED,function(){if(cc._renderType===cc.game.RENDER_TYPE_CANVAS){var t=cc.Director.prototype;t.getProjection=function(t){return this._projection},t.setProjection=function(t){this._projection=t,this.emit(cc.Director.EVENT_PROJECTION_CHANGED,this)},t.setDepthTest=function(){},t.setClearColor=function(t){cc.renderer._clearColor=t,cc.renderer._clearFillStyle="rgb("+t.r+","+t.g+","+t.b+")"},t.setOpenGLView=function(t){if(this._winSizeInPoints.width=cc._canvas.width,this._winSizeInPoints.height=cc._canvas.height,this._openGLView=t||cc.view,cc.eventManager)cc.eventManager.setEnabled(!0)},t.getVisibleSize=function(){return this.getWinSize()},t.getVisibleOrigin=function(){return cc.p(0,0)}}})},{"./CCDirector":29,"./CCGame":32}],31:[function(t,e,i){t("./CCDirector"),t("./CCGame"),t("../kazmath");var n=cc.math,r=function(t){n.glGetMatrix(n.KM_GL_PROJECTION,t);var e=new n.Matrix4;n.glGetMatrix(n.KM_GL_MODELVIEW,e),t.multiply(e)};cc.game.once(cc.game.EVENT_RENDERER_INITED,function(){if(cc._renderType===cc.game.RENDER_TYPE_WEBGL){cc.DirectorDelegate=cc._Class.extend({updateProjection:function(){}});var t=cc.Director.prototype,e=function(t){if(t&&t._renderCmd){t._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty);var i,n=t._children;for(i=0;i<n.length;i++)e(n[i])}};cc.Director._getInstance().on(cc.Director.EVENT_PROJECTION_CHANGED,function(){for(var t=(cc.director,cc.director._scenesStack),i=0;i<t.length;i++)e(t[i])}),t.setProjection=function(t){var e=this,i=e._winSizeInPoints;e.setViewport();var r=e._openGLView,s=r._viewPortRect.x/r._scaleX,o=r._viewPortRect.y/r._scaleY;switch(t){case cc.Director.PROJECTION_2D:n.glMatrixMode(n.KM_GL_PROJECTION),n.glLoadIdentity();var a=n.Matrix4.createOrthographicProjection(-s,i.width-s,-o,i.height-o,-1024,1024);n.glMultMatrix(a),n.glMatrixMode(n.KM_GL_MODELVIEW),n.glLoadIdentity();break;case cc.Director.PROJECTION_3D:var c=e.getZEye(),l=new n.Matrix4,h=new n.Matrix4;n.glMatrixMode(n.KM_GL_PROJECTION),n.glLoadIdentity(),l=n.Matrix4.createPerspectiveProjection(60,i.width/i.height,.1,2*c),n.glMultMatrix(l),n.glMatrixMode(n.KM_GL_MODELVIEW),n.glLoadIdentity();var u=new n.Vec3(-s+i.width/2,-o+i.height/2,c),d=new n.Vec3(-s+i.width/2,-o+i.height/2,0),f=new n.Vec3(0,1,0);h.lookAt(u,d,f),n.glMultMatrix(h);break;case cc.Director.PROJECTION_CUSTOM:if(e._projectionDelegate)e._projectionDelegate.updateProjection();break;default:cc.log(cc._LogInfos.Director.setProjection)}e._projection=t,e.emit(cc.Director.EVENT_PROJECTION_CHANGED,e),cc.gl.setProjectionMatrixDirty(),cc.renderer.childrenOrderDirty=!0},t.setDepthTest=function(t){cc.renderer.setDepthTest(t)},t.setClearColor=function(t){cc.renderer._clearColor=t},t.setOpenGLView=function(t){var e=this;e._winSizeInPoints.width=cc._canvas.width,e._winSizeInPoints.height=cc._canvas.height,e._openGLView=t||cc.view;var i=cc.configuration;if(i.gatherGPUInfo(),i.dumpInfo(),e.setGLDefaultValues(),cc.eventManager)cc.eventManager.setEnabled(!0)},t._clear=function(){var t=cc._renderContext;t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)},t._beforeVisitScene=function(){n.glPushMatrix()},t._afterVisitScene=function(){n.glPopMatrix()},t.convertToGL=function(t){var e=new n.Matrix4;r(e);var i=e.inverse(),s=e.mat[14]/e.mat[15],o=this._openGLView.getDesignResolutionSize(),a=new n.Vec3(2*t.x/o.width-1,1-2*t.y/o.height,s);return a.transformCoord(i),cc.p(a.x,a.y)},t.convertToUI=function(t){var e=new n.Matrix4;r(e);var i=new n.Vec3(t.x,t.y,0);i.transformCoord(e);var s=this._openGLView.getDesignResolutionSize();return cc.p(s.width*(.5*i.x+.5),s.height*(.5*-i.y+.5))},t.getVisibleSize=function(){return this._openGLView.getVisibleSize()},t.getVisibleOrigin=function(){return this._openGLView.getVisibleOrigin()},t.getZEye=function(){return this._winSizeInPoints.height/1.1566},t.setViewport=function(){var t=this._openGLView;if(t){var e=this._winSizeInPoints;t.setViewPortInPoints(-t._viewPortRect.x/t._scaleX,-t._viewPortRect.y/t._scaleY,e.width,e.height)}},t.getOpenGLView=function(){return this._openGLView},t.getProjection=function(){return this._projection},t.setAlphaBlending=function(t){if(t)cc.gl.blendFunc(cc.macro.BLEND_SRC,cc.macro.BLEND_DST);else cc.gl.blendFunc(cc.macro.ONE,cc.macro.ZERO)},t.setGLDefaultValues=function(){var t=this;t.setAlphaBlending(!0),t.setDepthTest(!1),t.setProjection(t._projection),cc._renderContext.clearColor(0,0,0,0)}}})},{"../kazmath":143,"./CCDirector":29,"./CCGame":32}],32:[function(t,e,i){var n,r=t("./event/event-target");if(!0)n=t("./platform/CCView");var s={EVENT_HIDE:"game_on_hide",EVENT_SHOW:"game_on_show",EVENT_RESIZE:"game_on_resize",EVENT_RENDERER_INITED:"renderer_inited",RENDER_TYPE_CANVAS:0,RENDER_TYPE_WEBGL:1,RENDER_TYPE_OPENGL:2,_eventHide:null,_eventShow:null,_persistRootNodes:{},_ignoreRemovePersistNode:null,CONFIG_KEY:{width:"width",height:"height",engineDir:"engineDir",modules:"modules",debugMode:"debugMode",showFPS:"showFPS",frameRate:"frameRate",id:"id",renderMode:"renderMode",registerSystemEvent:"registerSystemEvent",jsList:"jsList",scenes:"scenes"},_paused:!0,_isCloning:!1,_prepareCalled:!1,_prepared:!1,_rendererInitialized:!1,_renderContext:null,_intervalId:null,_lastTime:null,_frameTime:null,_sceneInfos:[],frame:null,container:null,canvas:null,config:null,onStart:null,onStop:null,setFrameRate:function(t){var e=this,i=e.config,n=e.CONFIG_KEY;if(i[n.frameRate]=t,e._intervalId)window.cancelAnimationFrame(e._intervalId);e._paused=!0,e._setAnimFrame(),e._runMainLoop()},step:function(){cc.director.mainLoop()},pause:function(){if(!this._paused){if(this._paused=!0,cc.audioEngine&&cc.audioEngine._pausePlaying(),this._intervalId)window.cancelAnimationFrame(this._intervalId);this._intervalId=0}},resume:function(){if(this._paused)this._paused=!1,cc.audioEngine&&cc.audioEngine._resumePlaying(),this._runMainLoop()},isPaused:function(){return this._paused},restart:function(){cc.director.popToSceneStackLevel(0),cc.audioEngine&&cc.audioEngine.end(),s.onStart()},prepare:function(t){var e=this,i=e.config,r=e.CONFIG_KEY;if(this._loadConfig(),!this._prepared){if(!this._prepareCalled)if(!cc._engineLoaded)cc.initEngine(this.config,function(){e.prepare(t)});else{if(this._prepareCalled=!0,this._initRenderer(i[r.width],i[r.height]),cc.view=n?n._getInstance():null,cc.director=cc.Director._getInstance(),cc.director.setOpenGLView)cc.director.setOpenGLView(cc.view);if(cc.winSize=cc.director.getWinSize(),1)this._initEvents();this._setAnimFrame(),this._runMainLoop();var s=i[r.jsList];if(s&&s.length>0)cc.loader.load(s,function(i){if(i)throw new Error(JSON.stringify(i));if(e._prepared=!0,t)t()});else if(t)t()}}else if(t)t()},run:function(t,e){if("function"==typeof t)s.onStart=t;else{if(t)s.config=t;if("function"==typeof e)s.onStart=e}this.prepare(s.onStart&&s.onStart.bind(s))},addPersistRootNode:function(t){if(!(t instanceof cc.Node&&t.uuid))return void cc.warn("The target can not be made persist because it's not a cc.Node or it doesn't have _id property.");var e=t.uuid;if(!this._persistRootNodes[e]){var i=cc.director._scene;if(cc.isValid(i)){if(!t.parent)t.parent=i;else if(!(t.parent instanceof cc.Scene))return void cc.warn("The node can not be made persist because it's not under root node.");else if(t.parent!==i)return void cc.warn("The node can not be made persist because it's not in current scene.");this._persistRootNodes[e]=t,t._persistNode=!0}}},removePersistRootNode:function(t){if(t!==this._ignoreRemovePersistNode){var e=t.uuid||"";if(t===this._persistRootNodes[e])delete this._persistRootNodes[e],t._persistNode=!1}},isPersistRootNode:function(t){return t._persistNode},_setAnimFrame:function(){if(this._lastTime=new Date,this._frameTime=1e3/s.config[s.CONFIG_KEY.frameRate],cc.sys.os===cc.sys.OS_IOS&&cc.sys.browserType===cc.sys.BROWSER_TYPE_WECHAT||60!==s.config[s.CONFIG_KEY.frameRate])window.requestAnimFrame=this._stTime,window.cancelAnimationFrame=this._ctTime;else window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||this._stTime,window.cancelAnimationFrame=window.cancelAnimationFrame||window.cancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.webkitCancelRequestAnimationFrame||window.msCancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.oCancelAnimationFrame||this._ctTime},_stTime:function(t){var e=(new Date).getTime(),i=Math.max(0,s._frameTime-(e-s._lastTime)),n=window.setTimeout(function(){t()},i);return s._lastTime=e+i,n},_ctTime:function(t){window.clearTimeout(t)},_runMainLoop:function(){var t,e=this,i=e.config,n=e.CONFIG_KEY,r=cc.director;r.setDisplayStats(i[n.showFPS]),t=function(){if(!e._paused){if(r.mainLoop(),e._intervalId)window.cancelAnimationFrame(e._intervalId);e._intervalId=window.requestAnimFrame(t)}},window.requestAnimFrame(t),e._paused=!1},_loadConfig:function(){if(this.config)return void this._initConfig(this.config);if(document.ccConfig)this._initConfig(document.ccConfig);else try{for(var t=document.getElementsByTagName("script"),e=0;e<t.length;e++){var i=t[e].getAttribute("cocos");if(""===i||i)break}var n,r,s;if(e<t.length){if(n=t[e].src)s=/(.*)\//.exec(n)[0],cc.loader.resPath=s,n=cc.path.join(s,"project.json");r=cc.loader._loadTxtSync(n)}if(!r)r=cc.loader._loadTxtSync("project.json");var o=JSON.parse(r);this._initConfig(o||{})}catch(a){cc.log("Failed to read or parse project.json"),this._initConfig({})}},_initConfig:function(t){var e=this.CONFIG_KEY,i=t[e.modules];if("number"!=typeof t[e.debugMode])t[e.debugMode]=0;if("number"!=typeof t[e.frameRate])t[e.frameRate]=60;if("number"!=typeof t[e.renderMode])t[e.renderMode]=0;if("boolean"!=typeof t[e.registerSystemEvent])t[e.registerSystemEvent]=!0;if(t[e.showFPS]=e.showFPS in t?!!t[e.showFPS]:!0,t[e.engineDir]=t[e.engineDir]||"frameworks/cocos2d-html5",i&&i.indexOf("core")<0)i.splice(0,0,"core");i&&(t[e.modules]=i),this._sceneInfos=this._sceneInfos.concat(t[e.scenes]),this.config=t},_initRenderer:function(t,e){if(!this._rendererInitialized){if(!cc._supportRender)throw new Error("The renderer doesn't support the renderMode "+this.config[this.CONFIG_KEY.renderMode]);var i,n,r,o=this.config[s.CONFIG_KEY.id],a=window,c=cc.$(o)||cc.$("#"+o);if("CANVAS"===c.tagName){if(t=t||c.width,e=e||c.height,this.canvas=cc._canvas=i=c,this.container=cc.container=n=document.createElement("DIV"),i.parentNode)i.parentNode.insertBefore(n,i)}else{if("DIV"!==c.tagName)cc.log("Warning: target element is not a DIV or CANVAS");t=t||c.clientWidth,e=e||c.clientHeight,this.canvas=cc._canvas=i=document.createElement("CANVAS"),this.container=cc.container=n=document.createElement("DIV"),c.appendChild(n)}if(n.setAttribute("id","Cocos2dGameContainer"),n.appendChild(i),this.frame=n.parentNode===document.body?document.documentElement:n.parentNode,i.addClass("gameCanvas"),i.setAttribute("width",t||480),i.setAttribute("height",e||320),i.setAttribute("tabindex",99),i.style.outline="none",r=n.style,r.width=(t||480)+"px",r.height=(e||320)+"px",r.margin="0 auto",r.position="relative",r.overflow="hidden",n.top="100%",cc._renderType===s.RENDER_TYPE_WEBGL)this._renderContext=cc._renderContext=cc.webglContext=cc.create3DContext(i,{stencil:!0,preserveDrawingBuffer:!0,antialias:!cc.sys.isMobile,alpha:!0});if(this._renderContext)cc.renderer=cc.rendererWebGL,a.gl=this._renderContext,cc.shaderCache._init(),cc._drawingUtil=new cc.DrawingPrimitiveWebGL(this._renderContext),cc.textureCache._initializingRenderer();else cc.renderer=cc.rendererCanvas,this._renderContext=cc._renderContext=new cc.CanvasContextWrapper(i.getContext("2d")),cc._drawingUtil=cc.DrawingPrimitiveCanvas?new cc.DrawingPrimitiveCanvas(this._renderContext):null;cc._gameDiv=n,s.canvas.oncontextmenu=function(){if(!cc._isContextMenuEnable)return!1;else;},this.emit(this.EVENT_RENDERER_INITED,!0),this._rendererInitialized=!0}},_initEvents:function(){var t,e,i=window;if(this._eventHide=this._eventHide||new cc.Event.EventCustom(this.EVENT_HIDE),this._eventHide.setUserData(this),this._eventShow=this._eventShow||new cc.Event.EventCustom(this.EVENT_SHOW),this._eventShow.setUserData(this),this.config[this.CONFIG_KEY.registerSystemEvent])cc.inputManager.registerSystemEvent(this.canvas);if(!cc.js.isUndefined(document.hidden))t="hidden",e="visibilitychange";else if(!cc.js.isUndefined(document.mozHidden))t="mozHidden",e="mozvisibilitychange";else if(!cc.js.isUndefined(document.msHidden))t="msHidden",e="msvisibilitychange";else if(!cc.js.isUndefined(document.webkitHidden))t="webkitHidden",e="webkitvisibilitychange";var n=function(){if(cc.eventManager&&s._eventHide)cc.eventManager.dispatchEvent(s._eventHide)},r=function(){if(cc.eventManager&&s._eventShow)cc.eventManager.dispatchEvent(s._eventShow)};if(t)document.addEventListener(e,function(){if(document[t])n();else r()},!1);else i.addEventListener("blur",n,!1),i.addEventListener("focus",r,!1);if(navigator.userAgent.indexOf("MicroMessenger")>-1)i.onfocus=function(){r()};if("onpageshow"in window&&"onpagehide"in window)i.addEventListener("pagehide",n,!1),i.addEventListener("pageshow",r,!1);cc.eventManager.addCustomListener(s.EVENT_HIDE,function(){s.pause()}),cc.eventManager.addCustomListener(s.EVENT_SHOW,function(){s.resume()})}};r.call(s),cc.js.addon(s,r.prototype),cc.game=e.exports=s},{"./event/event-target":74,"./platform/CCView":96}],33:[function(t,e,i){"use strict";function n(t){if(!t)return cc.error("getComponent: Type must be non-nil"),null;if("string"==typeof t)return l.getClassByName(t);else return t}function r(t,e){for(var i=0;i<t._components.length;++i){var n=t._components[i];if(n instanceof e)return n}return null}function s(t,e,i){for(var n=0;n<t._components.length;++n){var r=t._components[n];if(r instanceof e)i.push(r)}}function o(t,e){for(var i=0;i<t.length;++i){var n=t[i],s=r(n,e);if(s)return s;else if(n.children.length>0)if(s=o(n.children,e))return s}return null}function a(t,e,i){for(var n=0;n<t.length;++n){var r=t[n];if(s(r,e,i),r._children.length>0)a(r._children,e,i)}}var c=t("./event/event-target"),l=cc.js,h=cc.Object.Flags,u=h.Destroying,d=h.DontDestroy,f=cc.Enum({TOUCH_START:"touchstart",TOUCH_MOVE:"touchmove",TOUCH_END:"touchend",TOUCH_CANCEL:"touchcancel",MOUSE_DOWN:"mousedown",MOUSE_MOVE:"mousemove",MOUSE_ENTER:"mouseenter",MOUSE_LEAVE:"mouseleave",MOUSE_UP:"mouseup",MOUSE_WHEEL:"mousewheel"}),_=[f.TOUCH_START,f.TOUCH_MOVE,f.TOUCH_END,f.TOUCH_CANCEL],p=[f.MOUSE_DOWN,f.MOUSE_ENTER,f.MOUSE_MOVE,f.MOUSE_LEAVE,f.MOUSE_UP,f.MOUSE_WHEEL],g=null,m=function(t,e){var i=t.getLocation(),n=this.owner;if(n._hitTest(i,this))return e.type=f.TOUCH_START,e.touch=t,e.bubbles=!0,n.dispatchEvent(e),!0;else return!1},v=function(t,e){var i=this.owner;e.type=f.TOUCH_MOVE,e.touch=t,e.bubbles=!0,i.dispatchEvent(e)},y=function(t,e){var i=t.getLocation(),n=this.owner;if(n._hitTest(i,this))e.type=f.TOUCH_END;else e.type=f.TOUCH_CANCEL;e.touch=t,e.bubbles=!0,n.dispatchEvent(e)},T=function(t){var e=t.getLocation(),i=this.owner;if(i._hitTest(e,this))t.type=f.MOUSE_DOWN,i.dispatchEvent(t),t.stopPropagation()},C=function(t){var e=t.getLocation(),i=this.owner;if(i._hitTest(e,this)){if(t.stopPropagation(),!this._previousIn){if(g)t.type=f.MOUSE_LEAVE,g.owner.dispatchEvent(t),g._previousIn=!1;g=this,t.type=f.MOUSE_ENTER,i.dispatchEvent(t),this._previousIn=!0}t.type=f.MOUSE_MOVE,i.dispatchEvent(t)}else if(this._previousIn)t.type=f.MOUSE_LEAVE,i.dispatchEvent(t),this._previousIn=!1,g=null},x=function(t){var e=t.getLocation(),i=this.owner;if(i._hitTest(e,this))t.type=f.MOUSE_UP,i.dispatchEvent(t),t.stopPropagation()},S=function(t){var e=t.getLocation(),i=this.owner;if(i._hitTest(e,this))t.type=f.MOUSE_WHEEL,i.dispatchEvent(t)},b=function(t){if(cc.Mask)for(var e=0,i=null,n=t;n&&n instanceof cc.Node;n=n.parent,++e)if(i=n.getComponent(cc.Mask))return{index:e,node:n};return null},E=cc.Class({name:"cc.Node","extends":t("./utils/base-node"),mixins:[c],properties:{active:{get:function(){return this._active},set:function(t){if(t=!!t,this._active!==t){this._active=t;var e=this._parent&&this._parent._activeInHierarchy;if(e)this._onActivatedInHierarchy(t),this.emit("active-in-hierarchy-changed",this)}}},activeInHierarchy:{get:function(){return this._activeInHierarchy}},_active:!0,_components:[],_prefab:{"default":null,editorOnly:!0},_persistNode:{get:function(){return(this._objFlags&d)>0},set:function(t){if(t)this._objFlags|=d;else this._objFlags&=~d}}},ctor:function(){var t=arguments[0];if(this._name="undefined"!=typeof t?t:"New Node",this._activeInHierarchy=!1,this.__instanceId=this._id||cc.ClassManager.getNewInstanceId(),this._widget=null,this._touchListener=null,this._mouseListener=null,this.__eventTargets=[],cc.sys.isNative)this._retainedActions=[]},statics:{_DirtyFlags:t("./utils/misc").DirtyFlags},destroy:function(){if(cc.Object.prototype.destroy.call(this))if(this._activeInHierarchy)this._deactivateChildComponents()},_onPreDestroy:function(){var t,e;this._objFlags|=u;var i=this._parent,n=i&&i._objFlags&u;if(!n)if(!1)this._registerIfAttached(!1);var r=this._children;for(t=0,e=r.length;e>t;++t)r[t]._destroyImmediate();for(t=0,e=this._components.length;e>t;++t){var s=this._components[t];s._destroyImmediate()}for(this.stopAllActions(),this._releaseAllActions(),cc.eventManager.removeListeners(this),t=0,e=this.__eventTargets.length;e>t;++t){var o=this.__eventTargets[t];o&&o.targetOff(this)}if(this.__eventTargets.length=0,this._persistNode)cc.game.removePersistRootNode(this);if(!n){if(i){var a=i._children.indexOf(this);i._children.splice(a,1),i.emit("child-removed",this)}if(this._removeSgNode(),!1)this._parent=null}else this._sgNode.release()},getComponent:function(t){var e=n(t);if(e)return r(this,e);else return null},getComponents:function(t){var e=n(t),i=[];if(e)s(this,e,i);return i},getComponentInChildren:function(t){var e=n(t);if(e)return o(this._children,e);else return null},getComponentsInChildren:function(t){var e=n(t),i=[];if(e)a(this._children,e,i);return i},_checkMultipleComp:!1,addComponent:function(t){if(this._objFlags&u,!1)return cc.error("isDestroying"),null;var e;if("string"==typeof t){if(e=l.getClassByName(t),!e){if(cc.error('addComponent: Failed to get class "%s"',t),cc._RFpeek())cc.error('addComponent: Should not add component ("%s") when the scripts are still loading.',t);return null}}else{if(!t)return cc.error("addComponent: Type must be non-nil"),null;e=t}if("function"!=typeof e)return cc.error("addComponent: The component to add must be a constructor"),null;if(!cc.isChildClassOf(e,cc.Component))return cc.error("addComponent: The component to add must be child class of cc.Component"),null;if(e._disallowMultiple,!1)if(!this._checkMultipleComp(e))return null;var i=e._requireComponent;if(i&&!this.getComponent(i)){var n=this.addComponent(i);if(!n)return null}var r=new e;if(r.node=this,this._components.push(r),this._activeInHierarchy)r.__onNodeActivated(!0);return r},_addComponentAt:!1,removeComponent:function(t){if(!t)return void cc.error("removeComponent: Component must be non-nil");if("object"!=typeof t)t=this.getComponent(t);if(t)t.destroy()},_getDependComponent:!1,_removeComponent:function(t){if(!t)return void cc.error("Argument must be non-nil");if(!(this._objFlags&u)){var e=this._components.indexOf(t);if(-1!==e)this._components.splice(e,1);else if(t.node!==this)cc.error("Component not owned by this entity")}},_registerIfAttached:!1,_onActivatedInHierarchy:function(t){this._activeInHierarchy=t;for(var e=this._components.length,i=0;e>i;++i){var n=this._components[i];if(!(n instanceof cc.Component)){if(!1)cc.error('Sorry, the component of "%s" which with an index of %s is corrupted! It has been removed.',this.name,i),console.log("Corrupted component value:",n);if(n)this._removeComponent(n);else this._components.splice(i,1);--i,--e}else n.__onNodeActivated(t)}for(var r=0,s=this.childrenCount;s>r;++r){var o=this._children[r];if(o._active)o._onActivatedInHierarchy(t)}if(t)cc.director.getActionManager().resumeTarget(this),cc.eventManager.resumeTarget(this);else cc.director.getActionManager().pauseTarget(this),cc.eventManager.pauseTarget(this)},_onHierarchyChanged:function(t){var e=this._parent;if(this._persistNode&&!(e instanceof cc.Scene))if(cc.game.removePersistRootNode(this),!1)cc.warn('Set "%s" to normal node (not persist root node).');var i=this._active&&!(!t||!t._activeInHierarchy),n=this._active&&!(!e||!e._activeInHierarchy);if(i!==n)this._onActivatedInHierarchy(n);if(!1){var r=cc.director.getScene(),s=t&&t.isChildOf(r),o=e&&e.isChildOf(r);if(!s&&o)this._registerIfAttached(!0);else if(s&&!o)this._registerIfAttached(!1);var a=e&&e._prefab&&e._prefab.root,c=this._prefab;if(c){if(a)_Scene.PrefabUtils.linkPrefab(a._prefab.asset,a,this);else if(c.root!==this)_Scene.PrefabUtils.unlinkPrefab(this)}else if(a)_Scene.PrefabUtils.linkPrefab(a._prefab.asset,a,this);
_Scene.DetectConflict.afterAddChild(this)}},_deactivateChildComponents:function(){for(var t=this._components.length,e=0;t>e;++e){var i=this._components[e];i.__onNodeActivated(!1)}for(var n=0,r=this.childrenCount;r>n;++n){var s=this._children[n];if(s._active)s._deactivateChildComponents()}},_instantiate:function(){var t=cc.instantiate._clone(this,this);if(t._parent=null,false)this._name+=" (Clone)";return t._onBatchCreated(),t},_onColorChanged:function(){for(var t=0;t<this._components.length;++t){var e=this._components[t];if(e instanceof cc._SGComponent&&e.isValid&&e._sgNode)if(e._sgNode.setColor(this._color),!this._cascadeOpacityEnabled)e._sgNode.setOpacity(this._opacity)}},_onCascadeChanged:function(){for(var t=this._cascadeOpacityEnabled?255:this._opacity,e=0;e<this._components.length;++e){var i=this._components[e];if(i instanceof cc._SGComponent&&i.isValid&&i._sgNode)i._sgNode.setOpacity(t)}},_onAnchorChanged:function(){for(var t=0;t<this._components.length;++t){var e=this._components[t];if(e instanceof cc._SGComponent&&e.isValid&&e._sgNode)e._sgNode.setAnchorPoint(this._anchorPoint),e._sgNode.ignoreAnchorPointForPosition(this.__ignoreAnchor)}},_onOpacityModifyRGBChanged:function(){for(var t=0;t<this._components.length;++t){var e=this._components[t];if(e instanceof cc._SGComponent&&e.isValid&&e._sgNode)e._sgNode.setOpacityModifyRGB(this._opacityModifyRGB)}},on:function(t,e,i){if(-1!==_.indexOf(t)){if(!this._touchListener)this._touchListener=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,owner:this,mask:b(this),onTouchBegan:m,onTouchMoved:v,onTouchEnded:y}),this._touchListener.retain(),cc.eventManager.addListener(this._touchListener,this)}else if(-1!==p.indexOf(t))if(!this._mouseListener)this._mouseListener=cc.EventListener.create({event:cc.EventListener.MOUSE,_previousIn:!1,owner:this,mask:b(this),onMouseDown:T,onMouseMove:C,onMouseUp:x,onMouseScroll:S}),this._mouseListener.retain(),cc.eventManager.addListener(this._mouseListener,this);c.prototype.on.call(this,t,e,i)},off:function(t,e,i){if(c.prototype.off.call(this,t,e,i),-1!==_.indexOf(t))this._checkTouchListeners();else if(-1!==p.indexOf(t))this._checkMouseListeners()},targetOff:function(t){c.prototype.targetOff.call(this,t),this._checkTouchListeners(),this._checkMouseListeners()},_checkTouchListeners:function(){if(!(this._objFlags&u)&&this._bubblingListeners&&this._touchListener){for(var t=0;t<_.length;++t)if(this._bubblingListeners.has(_[t]))return;cc.eventManager.removeListener(this._touchListener),this._touchListener=null}},_checkMouseListeners:function(){if(!(this._objFlags&u)&&this._bubblingListeners&&this._mouseListener){for(var t=0;t<p.length;++t)if(this._bubblingListeners.has(p[t]))return;cc.eventManager.removeListener(this._mouseListener),this._mouseListener=null}},_hitTest:function(t,e){var i=this.width,n=this.height,r=cc.rect(0,0,i,n),s=this.getNodeToWorldTransform();cc._rectApplyAffineTransformIn(r,s);var o=t.x-r.x,a=r.x+r.width-t.x,c=t.y-r.y,l=r.y+r.height-t.y;if(o>=0&&a>=0&&l>=0&&c>=0)if(e&&e.mask){for(var h=e.mask,u=this,d=0;u&&d<h.index;++d,u=u.parent);if(u===h.node)return u._hitTest(t);else return e.mask=null,!0}else return!0;else return!1},_getBubblingTargets:function(t,e){for(var i=this.parent;i;){if(i.hasEventListener(t))e.push(i);i=i.parent}},isRunning:function(){return this._activeInHierarchy},runAction:function(t){if(this.active){if(cc.assert(t,cc._LogInfos.Node.runAction),cc.sys.isNative)this._retainAction(t),this._sgNode._owner=this;return cc.director.getActionManager().addAction(t,this,!1),t}},stopAllActions:function(){cc.director.getActionManager().removeAllActionsFromTarget(this)},stopAction:function(t){cc.director.getActionManager().removeAction(t)},stopActionByTag:function(t){if(t===cc.Action.TAG_INVALID)return void cc.log(cc._LogInfos.Node.stopActionByTag);else return void cc.director.getActionManager().removeActionByTag(t,this)},getActionByTag:function(t){if(t===cc.Action.TAG_INVALID)return cc.log(cc._LogInfos.Node.getActionByTag),null;else return void cc.director.getActionManager().getActionByTag(t,this)},getNumberOfRunningActions:function(){cc.director.getActionManager().numberOfRunningActionsInTarget(this)},_retainAction:function(t){if(cc.sys.isNative&&t instanceof cc.Action&&-1===this._retainedActions.indexOf(t))this._retainedActions.push(t),t.retain()},_releaseAllActions:function(){if(cc.sys.isNative){for(var t=0;t<this._retainedActions.length;++t)this._retainedActions[t].release();this._retainedActions.length=0}}});if(cc.sys.isNative)cc.js.getset(E.prototype,"_sgNode",function(){return this.__sgNode},function(t){if(this.__sgNode=t,this._touchListener)this._touchListener.retain(),cc.eventManager.removeListener(this._touchListener),cc.eventManager.addListener(this._touchListener,this),this._touchListener.release();if(this._mouseListener)this._mouseListener.retain(),cc.eventManager.removeListener(this._mouseListener),cc.eventManager.addListener(this._mouseListener,this),this._mouseListener.release()},!0);E.EventType=f,cc.Node=e.exports=E},{"./event/event-target":74,"./utils/base-node":123,"./utils/misc":126}],34:[function(t,e,i){var n=function(){};if(cc.Scene=cc.Class({name:"cc.Scene","extends":t("./utils/base-node"),ctor:function(){var t=this._sgNode=new _ccsg.Scene;t.retain(),t.setAnchorPoint(0,0),this._anchorPoint.x=0,this._anchorPoint.y=0,this._activeInHierarchy=!1,this._inited=!cc.game._isCloning},destroy:function(){for(var t=this._children,e=cc.Object.Flags.DontDestroy,i=0,n=t.length;n>i;++i){var r=t[i];if(r.isValid)if(!(r._objFlags&e))r.destroy()}this._super(),this._activeInHierarchy=!1},_onHierarchyChanged:n,_onColorChanged:n,_onAnchorChanged:n,_onOpacityModifyRGBChanged:n,_onCascadeChanged:n,_load:function(){if(!this._inited)this._onBatchCreated(),this._inited=!0},_activate:function(t){t=t!==!1;var e,i,n=this._children,r=n.length;if(!1)for(e=0;r>e;++e)i=n[e],i._registerIfAttached(t);for(this._activeInHierarchy=t,e=0;r>e;++e)if(i=n[e],i._active)i._onActivatedInHierarchy(t)}}),e.exports=cc.Scene,!1){var r='"%s" is not defined in the Scene, it is only defined in child nodes.';Object.defineProperties(cc.Scene.prototype,{active:{get:function(){return cc.error(r,"active"),!0},set:function(){cc.error(r,"active")}},activeInHierarchy:{get:function(){return cc.error(r,"activeInHierarchy"),!0}},getComponent:{get:function(){return cc.error(r,"getComponent"),function(){return null}}},addComponent:{get:function(){return cc.error(r,"addComponent"),function(){return null}}}})}},{"./utils/base-node":123}],35:[function(t,e,i){var n=function(t,e,i,n,r,s,o){this.prev=t,this.next=e,this.callback=i,this.target=n,this.priority=r,this.paused=s,this.markedForDeletion=o};n.prototype.trigger=function(t){this.callback.call(this.target,t)};var r=function(t,e,i,n,r){this.list=t,this.entry=e,this.target=i,this.callback=n,this.hh=r},s=function(t,e,i,n,r,s,o){var a=this;a.timers=t,a.target=e,a.timerIndex=i,a.currentTimer=n,a.currentTimerSalvaged=r,a.paused=s,a.hh=o},o=cc._Class.extend({getInterval:function(){return this._interval},setInterval:function(t){this._interval=t},setupTimerWithInterval:function(t,e,i){this._elapsed=-1,this._interval=t,this._delay=i,this._useDelay=this._delay>0,this._repeat=e,this._runForever=this._repeat===cc.macro.REPEAT_FOREVER},trigger:function(){return 0},cancel:function(){return 0},ctor:function(){this._scheduler=null,this._elapsed=-1,this._runForever=!1,this._useDelay=!1,this._timesExecuted=0,this._repeat=0,this._delay=0,this._interval=0},update:function(t){if(-1===this._elapsed)this._elapsed=0,this._timesExecuted=0;else if(this._elapsed+=t,this._runForever&&!this._useDelay){if(this._elapsed>=this._interval)this.trigger(),this._elapsed=0}else{if(this._useDelay){if(this._elapsed>=this._delay)this.trigger(),this._elapsed-=this._delay,this._timesExecuted+=1,this._useDelay=!1}else if(this._elapsed>=this._interval)this.trigger(),this._elapsed=0,this._timesExecuted+=1;if(!this._runForever&&this._timesExecuted>this._repeat)this.cancel()}}}),a=o.extend({ctor:function(){this._target=null,this._selector=null},initWithSelector:function(t,e,i,n,r,s){return this._scheduler=t,this._target=e,this._selector=i,this.setupTimerWithInterval(n,r,s),!0},getSelector:function(){return this._selector},trigger:function(){if(this._selector&&this._target)this._selector.call(this._target,this._elapsed)},cancel:function(){this._scheduler.unschedule(this._selector,this._target)}}),c=function(t){return t.__instanceId||t.uuid};cc.Scheduler=cc._Class.extend({_timeScale:1,_updatesNegList:null,_updates0List:null,_updatesPosList:null,_hashForTimers:null,_arrayForTimers:null,_hashForUpdates:null,_currentTarget:null,_currentTargetSalvaged:!1,_updateHashLocked:!1,ctor:function(){this._timeScale=1,this._updatesNegList=[],this._updates0List=[],this._updatesPosList=[],this._hashForUpdates={},this._hashForTimers={},this._currentTarget=null,this._currentTargetSalvaged=!1,this._updateHashLocked=!1,this._arrayForTimers=[]},_schedulePerFrame:function(t,e,i,n){var r=this._hashForUpdates[c(e)];if(r&&r.entry)if(r.entry.priority!==i)if(this._updateHashLocked)return cc.log("warning: you CANNOT change update priority in scheduled function"),r.entry.markedForDeletion=!1,void(r.entry.paused=n);else this.unscheduleUpdate(e);else return r.entry.markedForDeletion=!1,void(r.entry.paused=n);if(0===i)this._appendIn(this._updates0List,t,e,n);else if(0>i)this._priorityIn(this._updatesNegList,t,e,i,n);else this._priorityIn(this._updatesPosList,t,e,i,n)},_removeHashElement:function(t){delete this._hashForTimers[c(t.target)],cc.js.array.remove(this._arrayForTimers,t),t.Timer=null,t.target=null,t=null},_removeUpdateFromHash:function(t){var e=this,i=e._hashForUpdates[c(t.target)];if(i)cc.js.array.remove(i.list,i.entry),delete e._hashForUpdates[c(i.target)],i.entry=null,i.target=null},_priorityIn:function(t,e,i,s,o){var a=this,l=new n(null,null,e,i,s,o,!1);if(!t)t=[],t.push(l);else{for(var h=t.length-1,u=0;h>=u;u++)if(s<t[u].priority){h=u;break}t.splice(u,0,l)}return a._hashForUpdates[c(i)]=new r(t,l,i,null),t},_appendIn:function(t,e,i,s){var o=this,a=new n(null,null,e,i,0,s,!1);t.push(a),o._hashForUpdates[c(i)]=new r(t,a,i,null,null)},setTimeScale:function(t){this._timeScale=t},getTimeScale:function(){return this._timeScale},update:function(t){if(this._updateHashLocked=!0,1!==this._timeScale)t*=this._timeScale;var e,i,n,r;for(e=0,i=this._updatesNegList,n=i.length;n>e;e++)if(r=i[e],!r.paused&&!r.markedForDeletion)r.trigger(t);for(e=0,i=this._updates0List,n=i.length;n>e;e++)if(r=i[e],!r.paused&&!r.markedForDeletion)r.trigger(t);for(e=0,i=this._updatesPosList,n=i.length;n>e;e++)if(r=i[e],!r.paused&&!r.markedForDeletion)r.trigger(t);var s,o=this._arrayForTimers;for(e=0;e<o.length;e++){if(s=o[e],this._currentTarget=s,this._currentTargetSalvaged=!1,!s.paused)for(s.timerIndex=0;s.timerIndex<s.timers.length;++s.timerIndex)s.currentTimer=s.timers[s.timerIndex],s.currentTimerSalvaged=!1,s.currentTimer.update(t),s.currentTimer=null;if(this._currentTargetSalvaged&&0===this._currentTarget.timers.length)this._removeHashElement(this._currentTarget)}for(e=0,i=this._updatesNegList;e<i.length;)if(r=i[e],r.markedForDeletion)this._removeUpdateFromHash(r);else e++;for(e=0,i=this._updates0List;e<i.length;)if(r=i[e],r.markedForDeletion)this._removeUpdateFromHash(r);else e++;for(e=0,i=this._updatesPosList;e<i.length;)if(r=i[e],r.markedForDeletion)this._removeUpdateFromHash(r);else e++;this._updateHashLocked=!1,this._currentTarget=null},scheduleCallbackForTarget:function(t,e,i,n,r,s){this.schedule(e,t,i,n,r,s)},schedule:function(t,e,i,n,r,o){"use strict";if("function"!=typeof t){var l=t;t=e,e=l}if(4===arguments.length||5===arguments.length)o=n,n=cc.macro.REPEAT_FOREVER,r=0;cc.assert(e,cc._LogInfos.Scheduler_scheduleCallbackForTarget_3);var h=c(e),u=this._hashForTimers[h];if(!u)u=new s(null,e,0,null,null,o,null),this._arrayForTimers.push(u),this._hashForTimers[h]=u;else cc.assert(u.paused===o,"");var d,f;if(null==u.timers)u.timers=[];else for(f=0;f<u.timers.length;++f)if(d=u.timers[f],d&&t===d.getSelector())return cc.log("CCScheduler#scheduleSelector. Selector already scheduled. Updating interval from: %.4f to %.4f",d.getInterval(),i),void d.setInterval(i);d=new a,d.initWithSelector(this,e,t,i,n,r),u.timers.push(d)},scheduleUpdate:function(t,e,i,n){n=n||t.update,this._schedulePerFrame(n,t,e,i)},_getUnscheduleMark:function(t,e){switch(typeof t){case"number":case"string":return t===e.getKey();case"function":return t===e._callback||e.getSelector()}},unschedule:function(t,e){if(e&&t){var i=this,n=i._hashForTimers[c(e)];if(n)for(var r=n.timers,s=0,o=r.length;o>s;s++){var a=r[s];if(this._getUnscheduleMark(t,a)){if(a===n.currentTimer&&!n.currentTimerSalvaged)n.currentTimerSalvaged=!0;if(r.splice(s,1),n.timerIndex>=s)n.timerIndex--;if(0===r.length)if(i._currentTarget===n)i._currentTargetSalvaged=!0;else i._removeHashElement(n);return}}}},unscheduleUpdate:function(t){if(null!=t){var e=this._hashForUpdates[c(t)];if(e)if(this._updateHashLocked)e.entry.markedForDeletion=!0;else this._removeUpdateFromHash(e.entry)}},unscheduleAllForTarget:function(t){if(null!=t){var e=this._hashForTimers[c(t)];if(e){if(e.timers.indexOf(e.currentTimer)>-1&&!e.currentTimerSalvaged)e.currentTimerSalvaged=!0;if(e.timers.length=0,this._currentTarget===e)this._currentTargetSalvaged=!0;else this._removeHashElement(e)}this.unscheduleUpdate(t)}},unscheduleAll:function(){this.unscheduleAllWithMinPriority(cc.Scheduler.PRIORITY_SYSTEM)},unscheduleAllWithMinPriority:function(t){var e,i,n=this._arrayForTimers;for(e=n.length-1;e>=0;e--)i=n[e],this.unscheduleAllForTarget(i.target);var r,s=0;if(0>t)for(e=0;e<this._updatesNegList.length;){if(s=this._updatesNegList.length,r=this._updatesNegList[e],r&&r.priority>=t)this.unscheduleUpdate(r.target);if(s==this._updatesNegList.length)e++}if(0>=t)for(e=0;e<this._updates0List.length;){if(s=this._updates0List.length,r=this._updates0List[e])this.unscheduleUpdate(r.target);if(s==this._updates0List.length)e++}for(e=0;e<this._updatesPosList.length;){if(s=this._updatesPosList.length,r=this._updatesPosList[e],r&&r.priority>=t)this.unscheduleUpdate(r.target);if(s==this._updatesPosList.length)e++}},isScheduled:function(t,e){cc.assert(t,"Argument key must not be empty"),cc.assert(e,"Argument target must be non-nullptr");var i=this._hashForUpdates[c(e)];if(!i)return!1;if(null==i.timers)return!1;else{for(var n=i.timers,r=0;r<n.length;++r){var s=n[r];if(t===s.getKey())return!0}return!1}},pauseAllTargets:function(){return this.pauseAllTargetsWithMinPriority(cc.Scheduler.PRIORITY_SYSTEM)},pauseAllTargetsWithMinPriority:function(t){var e,i,n,r=[],s=this,o=s._arrayForTimers;for(i=0,n=o.length;n>i;i++)if(e=o[i])e.paused=!0,r.push(e.target);var a;if(0>t)for(i=0;i<this._updatesNegList.length;i++)if(a=this._updatesNegList[i])if(a.priority>=t)a.paused=!0,r.push(a.target);if(0>=t)for(i=0;i<this._updates0List.length;i++)if(a=this._updates0List[i])a.paused=!0,r.push(a.target);for(i=0;i<this._updatesPosList.length;i++)if(a=this._updatesPosList[i])if(a.priority>=t)a.paused=!0,r.push(a.target);return r},resumeTargets:function(t){if(t)for(var e=0;e<t.length;e++)this.resumeTarget(t[e])},pauseTarget:function(t){cc.assert(t,cc._LogInfos.Scheduler.pauseTarget);var e=this,i=c(t),n=e._hashForTimers[i];if(n)n.paused=!0;var r=e._hashForUpdates[i];if(r)r.entry.paused=!0},resumeTarget:function(t){cc.assert(t,cc._LogInfos.Scheduler.resumeTarget);var e=this,i=c(t),n=e._hashForTimers[i];if(n)n.paused=!1;var r=e._hashForUpdates[i];if(r)r.entry.paused=!1},isTargetPaused:function(t){cc.assert(t,cc._LogInfos.Scheduler.isTargetPaused);var e=c(t),i=this._hashForTimers[e];if(i)return i.paused;var n=this._hashForUpdates[e];if(n)return n.entry.paused;else return!1},scheduleUpdateForTarget:function(t,e,i){this.scheduleUpdate(t,e,i)},unscheduleCallbackForTarget:function(t,e){this.unschedule(e,t)},unscheduleUpdateForTarget:function(t){this.unscheduleUpdate(t)},unscheduleAllCallbacksForTarget:function(t){this.unscheduleAllForTarget(t)},unscheduleAllCallbacks:function(){this.unscheduleAllWithMinPriority(cc.Scheduler.PRIORITY_SYSTEM)},unscheduleAllCallbacksWithMinPriority:function(t){this.unscheduleAllWithMinPriority(t)}}),cc.Scheduler.PRIORITY_SYSTEM=-2147483648,cc.Scheduler.PRIORITY_NON_SYSTEM=cc.Scheduler.PRIORITY_SYSTEM+1},{}],36:[function(t,e,i){var n=t("./CCRawAsset");cc.Asset=cc.Class({name:"cc.Asset","extends":n,properties:{rawUrl:{get:function(){if(this._rawFiles)if(cc.AssetLibrary)return cc.AssetLibrary.getImportedDir(this._uuid)+"/"+this._uuid+"/"+this._rawFiles[0];else cc.error("asset.url is not usable in core process");return""},visible:!1},rawUrls:{get:function(){if(this._rawFiles)if(cc.AssetLibrary){var t=cc.AssetLibrary.getImportedDir(this._uuid)+"/"+this._uuid+"/";return this._rawFiles.map(function(e){return t+e})}else cc.error("asset.urls is not usable in core process");return[]},visible:!1},_rawFiles:void 0},statics:{deserialize:function(t){return cc.deserialize(t)}},serialize:function(){return Editor.serialize(this)},createNode:null,_setRawFiles:function(t){this._rawFiles=t.length>0?t:void 0}}),e.exports=cc.Asset},{"./CCRawAsset":41}],37:[function(t,e,i){var n=cc.Class({name:"cc.AudioClip","extends":cc.RawAsset});cc.AudioClip=n,e.exports=n},{}],38:[function(t,e,i){var n=cc.Class({name:"cc.BitmapFont","extends":cc.Font});cc.BitmapFont=n,e.exports=n},{}],39:[function(t,e,i){var n=cc.Class({name:"cc.Font","extends":cc.RawAsset});cc.Font=n,e.exports=n},{}],40:[function(t,e,i){var n=cc.Class({name:"cc.Prefab","extends":cc.Asset,properties:{data:null},createNode:function(t){if(!1){var e=cc.instantiate(this);t(null,e)}},_instantiate:function(){var t=cc.instantiate(this.data);if(!1)_Scene.PrefabUtils.linkPrefab(this,t);return t}});cc.Prefab=e.exports=n,cc.js.obsolete(cc,"cc._Prefab","Prefab")},{}],41:[function(t,e,i){var n=t("../platform/CCObject");cc.RawAsset=cc.Class({name:"cc.RawAsset","extends":n,ctor:function(){Object.defineProperty(this,"_uuid",{value:"",writable:!0,enumerable:!1})},statics:{createNodeByInfo:null,isRawAssetType:function(t){return cc.isChildClassOf(t,cc.RawAsset)&&!cc.isChildClassOf(t,cc.Asset)}}}),e.exports=cc.RawAsset},{"../platform/CCObject":92}],42:[function(t,e,i){var n=cc.Class({name:"cc.SceneAsset","extends":cc.Asset,properties:{scene:null}});cc.SceneAsset=n,e.exports=n},{}],43:[function(t,e,i){var n=cc.Class({name:"cc.Script","extends":cc.Asset});cc._Script=n;var r=cc.Class({name:"cc.JavaScript","extends":n});cc._JavaScript=r;var s=cc.Class({name:"cc.CoffeeScript","extends":n});cc._CoffeeScript=s},{}],44:[function(t,e,i){var n=cc.Class({name:"cc.SpriteAtlas","extends":cc.Asset,properties:{_spriteFrames:{"default":{}}},getTexture:function(){var t=Object.keys(this._spriteFrames);if(t.length>0){var e=this._spriteFrames[t[0]];return e?e.getTexture():null}else return null},getSpriteFrame:function(t){return this._spriteFrames[t]}});cc.SpriteAtlas=n,e.exports=n},{}],45:[function(t,e,i){var n=cc.Class({name:"cc.TTFFont","extends":cc.Font});cc.TTFFont=n,e.exports=n},{}],46:[function(t,e,i){t("./CCRawAsset"),t("./CCAsset"),t("./CCFont"),t("./CCPrefab"),t("./CCAudioClip"),t("./CCBitmapFont"),t("./CCScripts"),t("./CCSceneAsset"),t("../sprites/CCSpriteFrame"),t("../textures/CCTexture2D"),t("./CCTTFFont"),t("./CCSpriteAtlas")},{"../sprites/CCSpriteFrame":115,"../textures/CCTexture2D":117,"./CCAsset":36,"./CCAudioClip":37,"./CCBitmapFont":38,"./CCFont":39,"./CCPrefab":40,"./CCRawAsset":41,"./CCSceneAsset":42,"./CCScripts":43,"./CCSpriteAtlas":44,"./CCTTFFont":45}],47:[function(t,e,i){function n(t){if(t instanceof cc.Scene)return!1?cc.engine.getDesignResolutionSize():cc.visibleRect;else if(!t._sizeProvider||t._sizeProvider instanceof _ccsg.Node)return t._contentSize;else return t.getContentSize()}function r(t,e){var i,r,s,o,a=t._parent,c=n(a),l=c.width,h=c.height,u=a._anchorPoint;if(a instanceof cc.Scene){var d=cc.visibleRect;i=d.left.x,r=d.right.x,o=d.bottom.y,s=d.top.y}else i=-u.x*l,r=i+l,o=-u.y*h,s=o+h;i+=e._isAbsLeft?e._left:e._left*l,r-=e._isAbsRight?e._right:e._right*l,o+=e._isAbsBottom?e._bottom:e._bottom*h,s-=e._isAbsTop?e._top:e._top*h;var f,_=t.getAnchorPoint(),p=t._position.x,g=_.x;if(e.isStretchWidth)f=r-i,t.width=f,p=i+g*f;else if(f=t.width,e.isAlignHorizontalCenter){var m=(.5-u.x)*l;p=m+(g-.5)*f}else if(e.isAlignLeft)p=i+g*f;else if(e.isAlignRight)p=r+g*f-f;var v,y=t._position.y,T=_.y;if(e.isStretchHeight)v=s-o,t.height=v,y=o+T*v;else if(v=t.height,e.isAlignVerticalCenter){var C=(.5-u.y)*h;y=C+(T-.5)*v}else if(e.isAlignBottom)y=o+T*v;else if(e.isAlignTop)y=s+T*v-v;t.setPosition(p,y)}function s(t){var e=t._widget;if(e)if(r(t,e),e.isAlignOnce)e.enabled=!1;for(var i=t._children,n=0;n<i.length;n++){var o=i[n];if(o._active)s(o)}}function o(){var t=cc.director.getScene();if(t)l.isAligning=!0,s(t),l.isAligning=!1}var a=!1,c=!1,l=cc._widgetManager={isAligning:!1,init:function(t){t.on(cc.Director.EVENT_BEFORE_VISIT,o)},add:function(t){if(t.node._widget=t,false)t.node.on("position-changed",a,t),t.node.on("size-changed",c,t)},remove:function(t){if(t.node._widget=null,false)t.node.off("position-changed",a,t),t.node.off("size-changed",c,t)},_getParentSize:n}},{}],48:[function(t,e,i){function n(t,e){if(t===e)return!0;else return t&&e&&(t.name===e.name||t._uuid===e._uuid)}var r=t("../../animation/animation-animator"),s=t("../../animation/animation-clip"),o=cc.Class({name:"cc.Animation","extends":t("./CCComponent"),editor:!1,ctor:function(){this._animator=null,this._nameToState={},this._didInit=!1,this._currentClip=null},properties:{_defaultClip:{"default":null,type:s},defaultClip:{type:s,get:function(){return this._defaultClip},set:function(t){cc.engine;if(!1)if(this._defaultClip=t,t){for(var e=this._clips,i=0,r=e.length;r>i;i++)if(n(t,e[i]))return;this.addClip(t)}},tooltip:"i18n:COMPONENT.animation.default_clip"},currentClip:{get:function(){return this._currentClip},set:function(t,e){if(this._currentClip=t,false)this._updateClip(t)},type:s,visible:!1},_clips:{"default":[],type:[s],tooltip:"i18n:COMPONENT.animation.clips",visible:!0},playOnLoad:{"default":!1,tooltip:"i18n:COMPONENT.animation.play_on_load"}},onLoad:function(){if(1)if(this._init(),this.playOnLoad&&this._defaultClip){var t=this.getAnimationState(this._defaultClip.name);this._animator.playState(t)}},onEnable:function(){this.resume()},onDisable:function(){this.pause()},getClips:function(){return this._clips},play:function(t,e){for(var i=this.playAdditive(t,e),n=this._animator.playingAnims,r=n.length;r>=0;r--)if(n[r]!==i)this._animator.stopState(n[r]);else;return i},playAdditive:function(t,e){this._init();var i=this.getAnimationState(t||this._defaultClip.name);if(i){var n=this._animator;if(n.isPlaying&&i.isPlaying)if(i.isPaused)n.resumeState(i);else n.stopState(i),n.playState(i,e);else n.playState(i,e);this.currentClip=i.clip}return i},stop:function(t){if(this._didInit)if(t){var e=this._nameToState[t];if(e)this._animator.stopState(e)}else this._animator.stop()},pause:function(t){if(this._didInit)if(t){var e=this._nameToState[t];if(e)this._animator.pauseState(e)}else this._animator.pause()},resume:function(t){if(this._didInit)if(t){var e=this._nameToState[t];if(e)this._animator.resumeState(e)}else this._animator.resume()},setCurrentTime:function(t,e){if(this._init(),e){var i=this._nameToState[e];if(i)this._animator.setStateTime(i,t)}else for(var e in this._nameToState)i=this._nameToState[e],this._animator.setStateTime(i,t)},getAnimationState:function(t){this._init();var e=this._nameToState[t];if(false){if(this._didInit=!1,this.animator)this.animator.stop();this._init(),e=this._nameToState[t]}if(e&&!e.curveLoaded)this._animator._reloadClip(e);return e||null},addClip:function(t,e){if(!t)return void cc.warn("Invalid clip to add");if(this._init(),!cc.js.array.contains(this._clips,t))this._clips.push(t);e=e||t.name;var i=this._nameToState[e];if(i)if(i.clip===t)return i;else{var n=this._clips.indexOf(i.clip);if(-1!==n)this._clips.splice(n,1)}var r=new cc.AnimationState(t,e);return this._nameToState[e]=r,r},_removeStateIfNotUsed:function(t,e){var i=t.clip!==this._defaultClip&&!cc.js.array.contains(this._clips,t.clip);if(e||i){if(t.isPlaying)this.stop(t.name);delete this._nameToState[t.name]}},removeClip:function(t,e){if(!t)return void cc.warn("Invalid clip to remove");this._init(),this._clips=this._clips.filter(function(e){return e!==t});var i;for(var n in this._nameToState){i=this._nameToState[n];var r=i.clip;if(r===t)this._removeStateIfNotUsed(i,e)}},sample:function(){this._init(),this._animator.sample()},_init:function(){if(!this._didInit)this._didInit=!0,this._animator=new r(this.node,this),this._createStates()},_createStates:function(){for(var t=null,e=!1,i=0;i<this._clips.length;++i){var r=this._clips[i];if(r){if(t=new cc.AnimationState(r),!1)this._animator._reloadClip(t);if(this._nameToState[t.name]=t,n(this._defaultClip,r))e=t}}if(this._defaultClip&&!e){if(t=new cc.AnimationState(this._defaultClip),!1)this._animator._reloadClip(t);this._nameToState[t.name]=t}},_updateClip:!1});cc.Animation=e.exports=o},{"../../animation/animation-animator":9,"../../animation/animation-clip":10,"./CCComponent":52}],49:[function(t,e,i){var n=cc.audioEngine,r=cc.Class({name:"cc.AudioSource","extends":t("./CCComponent"),editor:!1,ctor:function(){this.audio=null},properties:{_clip:{"default":"",url:cc.AudioClip},_volume:1,_mute:!1,_loop:!1,isPlaying:{get:function(){return!cc.sys.isNative&&this.audio&&this.audio.getPlaying()},visible:!1},clip:{get:function(){return this._clip},set:function(t){this._clip=t},url:cc.AudioClip,tooltip:"i18n:COMPONENT.audio.clip",animatable:!1},volume:{get:function(){return this._volume},set:function(t){if(this._volume=t,this.audio)if(cc.sys.isNative)cc.audioEngine.setEffectsVolume(t);else this.audio.setVolume(t)},tooltip:"i18n:COMPONENT.audio.volume"},mute:{get:function(){return this._mute},set:function(t){if(this._mute=t,this.audio)if(this._mute)if(cc.sys.isNative)cc.audioEngine.setEffectsVolume(0);else this.audio.setVolume(0);else if(cc.sys.isNative)cc.audioEngine.setEffectsVolume(this._volume);else this.audio.setVolume(this._volume)},animatable:!1,tooltip:"i18n:COMPONENT.audio.mute"},loop:{get:function(){return this._loop},set:function(t){if(this._loop=t,this.audio)this.audio.loop=this._loop},animatable:!1,tooltip:"i18n:COMPONENT.audio.loop"},playOnLoad:{"default":!1,tooltip:"i18n:COMPONENT.audio.play_on_load",animatable:!1}},onEnable:function(){if(this.playOnLoad)this.play()},onDisable:function(){this.stop()},onDestroy:function(){this.stop()},play:function(){if(this._clip)this.audio=n.playEffect(this._clip,this._loop)},stop:function(){if(this.audio)cc.audioEngine.stopEffect(this.audio)},pause:function(){if(this.audio)cc.audioEngine.pauseEffect(this.audio)},resume:function(){if(this.audio)cc.audioEngine.resumeEffect(this.audio)},rewind:function(){if(this.audio)cc.audioEngine.stopEffect(this.audio),cc.audioEngine.playEffect(this.audio)}});cc.AudioSource=e.exports=r},{"./CCComponent":52}],50:[function(t,e,i){var n=cc.Enum({NONE:0,COLOR:1,SPRITE:2}),r=cc.Class({name:"cc.Button","extends":t("./CCComponent"),ctor:function(){this._pressed=!1,this._hovered=!1,this._sprite=null,this._fromColor=null,this._toColor=null,this._time=0,this._transitionFinished=!0},editor:!1,properties:{interactable:{"default":!0,tooltip:"i18n:COMPONENT.button.interactable",notify:function(){this._updateState()},animatable:!1},transition:{"default":n.NONE,tooltip:"i18n:COMPONENT.button.transition",type:n,animatable:!1},normalColor:{"default":cc.color(214,214,214),displayName:"Normal",tooltip:"i18n:COMPONENT.button.normal_color",notify:function(){this._updateState()}},pressedColor:{"default":cc.color(211,211,211),displayName:"Pressed",tooltip:"i18n:COMPONENT.button.pressed_color"},hoverColor:{"default":cc.Color.WHITE,displayName:"Hover",tooltip:"i18n:COMPONENT.button.hover_color"},disabledColor:{"default":cc.color(124,124,124),displayName:"Disabled",tooltip:"i18n:COMPONENT.button.diabled_color",notify:function(){this._updateState()}},duration:{"default":.1,range:[0,10],tooltip:"i18n:COMPONENT.button.duration"},normalSprite:{"default":null,type:cc.SpriteFrame,displayName:"Normal",tooltip:"i18n:COMPONENT.button.normal_sprite",notify:function(){this._updateState()}},pressedSprite:{"default":null,type:cc.SpriteFrame,displayName:"Pressed",tooltip:"i18n:COMPONENT.button.pressed_sprite"},hoverSprite:{"default":null,type:cc.SpriteFrame,displayName:"Hover",tooltip:"i18n:COMPONENT.button.hover_sprite"},disabledSprite:{"default":null,type:cc.SpriteFrame,displayName:"Disabled",tooltip:"i18n:COMPONENT.button.disabled_sprite",notify:function(){this._updateState()}},target:{"default":null,type:cc.Node,tooltip:"i18n:COMPONENT.button.target",notify:function(){this._applyTarget()}},clickEvents:{"default":[],type:cc.Component.EventHandler,tooltip:"i18n:COMPONENT.button.click_events"}},statics:{Transition:n},onLoad:function(){if(!this.target)this.target=this.node;if(1)this._registerEvent()},start:function(){this._applyTarget(),this._updateState()},update:function(t){var e=this.target;if(!this.transition!==n.COLOR&&e&&!this._transitionFinished){this.time+=t;var i=this.time/this.duration;if(i>1)i=1,this._transitionFinished=!0;e.color=this._fromColor.lerp(this._toColor,i)}},_registerEvent:function(){this.node.on(cc.Node.EventType.TOUCH_START,this._onTouchBegan,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this._onTouchMove,this),this.node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this._onTouchCancel,this),this.node.on(cc.Node.EventType.MOUSE_ENTER,this._onMouseMoveIn,this),this.node.on(cc.Node.EventType.MOUSE_LEAVE,this._onMouseMoveOut,this)},_cancelButtonClick:function(){this._pressed=!1},_applyTarget:function(){var t=this.target;if(t)this._sprite=t.getComponent(cc.Sprite);else this._sprite=null},_onTouchBegan:function(t){if(this.interactable&&this.enabledInHierarchy)this._pressed=!0,this._updateState()},_onTouchMove:function(t){if(this.interactable&&this.enabledInHierarchy){var e,i=t.touch,n=this.node._hitTest(i.getLocation());if(n)e="pressed";else e="normal";var r=this[e+"Color"],s=this[e+"Sprite"];this._applyTransition(r,s)}},_onTouchEnded:function(){if(this.interactable&&this.enabledInHierarchy){if(this._pressed)cc.Component.EventHandler.emitEvents(this.clickEvents);this._pressed=!1,this._updateState()}},_onTouchCancel:function(){if(this.interactable&&this.enabledInHierarchy)this._pressed=!1,this._updateState()},_onMouseMoveIn:function(t){if(!this._pressed&&this.interactable&&this.enabledInHierarchy)if(!this._hovered)this._hovered=!0,this._updateState()},_onMouseMoveOut:function(){if(this._hovered)this._hovered=!1,this._updateState()},_updateState:function(){var t;if(!this.interactable)t="disabled";else if(this._pressed)t="pressed";else if(this._hovered)t="hover";else t="normal";var e=this[t+"Color"],i=this[t+"Sprite"];this._applyTransition(e,i)},onDisable:function(){this._hovered=!1,this._pressed=!1},_applyTransition:function(t,e){var i=this.transition;if(i===n.COLOR){var r=this.target;if(!1)r.color=t;else this._fromColor=r.color.clone(),this._toColor=t,this.time=0,this._transitionFinished=!1}else if(i===n.SPRITE&&this._sprite&&e)this._sprite.spriteFrame=e}});cc.Button=e.exports=r},{"./CCComponent":52}],51:[function(t,e,i){var n={getContentSize:function(){return!1?cc.engine.getDesignResolutionSize():cc.visibleRect},setContentSize:function(t){},_getWidth:function(){return this.getContentSize().width},_getHeight:function(){return this.getContentSize().height}},r=cc.Class({name:"cc.Canvas","extends":t("./CCComponent"),editor:!1,statics:{instance:null},properties:{_designResolution:cc.size(960,640),designResolution:{get:function(){return cc.size(this._designResolution)},set:function(t){this._designResolution.width=t.width,this._designResolution.height=t.height,this.applySettings()},tooltip:"i18n:COMPONENT.canvas.design_resolution"},_fitWidth:!1,_fitHeight:!0,fitHeight:{get:function(){return this._fitHeight;
},set:function(t){if(this._fitHeight!==t)this._fitHeight=t,this.applySettings()},tooltip:"i18n:COMPONENT.canvas.fit_height"},fitWidth:{get:function(){return this._fitWidth},set:function(t){if(this._fitWidth!==t)this._fitWidth=t,this.applySettings()},tooltip:"i18n:COMPONENT.canvas.fit_width"}},ctor:function(){this._thisOnResized=this.onResized.bind(this)},onLoad:function(){var t=cc.Object.Flags;if(this._objFlags|=t.IsPositionLocked|t.IsAnchorLocked|t.IsSizeLocked,r.instance)return cc.error("Can't init canvas '%s' because it conflicts with the existing '%s', the scene should only have one active canvas at the same time",this.node.name,r.instance.node.name);if(r.instance=this,!this.node._sizeProvider)this.node._sizeProvider=n;else cc.error("CCCanvas: Node can only have one size.");if(cc.director.on(cc.Director.EVENT_BEFORE_VISIT,this.alignWithScreen,this),!1)cc.engine.on("design-resolution-changed",this._thisOnResized);else if(!cc.sys.isNative)if(cc.sys.isMobile)window.addEventListener("resize",this._thisOnResized);else cc.eventManager.addCustomListener("canvas-resize",this._thisOnResized);this.applySettings(),this.onResized()},onDestroy:function(){if(this.node._sizeProvider===n)this.node._sizeProvider=null;if(cc.director.off(cc.Director.EVENT_BEFORE_VISIT,this.alignWithScreen,this),!1)cc.engine.off("design-resolution-changed",this._thisOnResized);else if(!cc.sys.isNative)if(cc.sys.isMobile)window.removeEventListener("resize",this._thisOnResized);else cc.eventManager.removeCustomListeners("canvas-resize",this._thisOnResized);if(r.instance===this)r.instance=null},alignWithScreen:function(){var t;if(!1)t=cc.engine.getDesignResolutionSize(),this.node.setPosition(.5*t.width,.5*t.height);else{var e=cc.visibleRect,i=!this.fitHeight&&!this.fitWidth,n=0,r=0;if(i)t=cc.view.getDesignResolutionSize(),n=.5*(t.width-e.width),r=.5*(t.height-e.height);this.node.setPosition(.5*e.width+n,.5*e.height+r)}},onResized:function(){this.alignWithScreen()},applySettings:function(){var t,e=cc.ResolutionPolicy;if(this.fitHeight&&this.fitWidth)t=e.SHOW_ALL;else if(!this.fitHeight&&!this.fitWidth)t=e.NO_BORDER;else if(this.fitWidth)t=e.FIXED_WIDTH;else t=e.FIXED_HEIGHT;var i=this._designResolution;if(!1)cc.engine.setDesignResolutionSize(i.width,i.height);else cc.view.setDesignResolutionSize(i.width,i.height,t)}});cc.Canvas=e.exports=r},{"./CCComponent":52}],52:[function(t,e,i){function n(t,e){if(!1)if(!cc.engine.isPlaying&&!t.constructor._executeInEditMode)return;var i=t._objFlags&a;if(e){if(!i){if(t.onEnable)if(!1)d(t);else t.onEnable();cc.director.getScheduler().resumeTarget(t),r(t,!0),t._objFlags|=a}}else if(i){if(t.onDisable)if(!1)f(t);else t.onDisable();cc.director.getScheduler().pauseTarget(t),r(t,!1),t._objFlags&=~a}}function r(t,e){if(!0){if(e&&t.start&&!(t._objFlags&h))cc.director.once(cc.Director.EVENT_BEFORE_UPDATE,y,t);if(t.update)if(e)cc.director.on(cc.Director.EVENT_COMPONENT_UPDATE,T,t);else cc.director.off(cc.Director.EVENT_COMPONENT_UPDATE,T,t);if(t.lateUpdate)if(e)cc.director.on(cc.Director.EVENT_COMPONENT_LATE_UPDATE,C,t);else cc.director.off(cc.Director.EVENT_COMPONENT_LATE_UPDATE,C,t)}}t("../platform/CCObject"),t("../CCNode");var s=t("../platform/id-generater"),o=cc.Object.Flags,a=o.IsOnEnableCalled,c=o.IsOnLoadStarted,l=o.IsOnLoadCalled,h=o.IsOnStartCalled,u=!1;if(!1)u="(function call_FUNC_InTryCatch (c) { c._FUNC_() })";var d=!1,f=!1,_=!1,p=!1,g=!1,m=!1,v=!1,y=!1?function(){p(this),this._objFlags|=h}:function(){this.start(),this._objFlags|=h},T=!1?function(t){try{this.update(t.detail)}catch(e){cc._throw(e)}}:function(t){this.update(t.detail)},C=!1?function(t){try{this.lateUpdate(t.detail)}catch(e){cc._throw(e)}}:function(t){this.lateUpdate(t.detail)},x=new s("Comp"),S=cc.Class({name:"cc.Component","extends":cc.Object,ctor:function(){if(false)_Scene.AssetsWatcher.initComponent(this);Object.defineProperty(this,"_id",{value:"",enumerable:!1}),this.__instanceId=cc.ClassManager.getNewInstanceId()},properties:{node:{"default":null,visible:!1},name:{get:function(){return this._name||this.node.name},set:function(t){this._name=t},visible:!1},_id:{"default":"",serializable:!1},uuid:{get:function(){var t=this._id;if(!t)if(t=this._id=x.getNewId(),!1)cc.engine.attachedObjsForEditor[t]=this;return t},visible:!1},__scriptAsset:!1,_enabled:!0,enabled:{get:function(){return this._enabled},set:function(t){if(this._enabled!==t)if(this._enabled=t,this.node._activeInHierarchy)n(this,t)},visible:!1},enabledInHierarchy:{get:function(){return this._enabled&&this.node._activeInHierarchy},visible:!1},_isOnLoadCalled:{get:function(){return this._objFlags&l}},__eventTargets:{"default":[],serializable:!1}},update:null,lateUpdate:null,onLoad:null,start:null,onEnable:null,onDisable:null,onDestroy:null,onFocusInEditor:null,onLostFocusInEditor:null,addComponent:function(t){return this.node.addComponent(t)},getComponent:function(t){return this.node.getComponent(t)},getComponents:function(t){return this.node.getComponents(t)},getComponentInChildren:function(t){return this.node.getComponentInChildren(t)},getComponentsInChildren:function(t){return this.node.getComponentsInChildren(t)},_getLocalBounds:null,onRestore:null,destroy:function(){if(!1){var t=this.node._getDependComponent(this);if(t)return cc.error("Can't remove '%s' because '%s' depends on it.",cc.js.getClassName(this),cc.js.getClassName(t))}if(this._super())if(this._enabled&&this.node._activeInHierarchy)n(this,!1)},__onNodeActivated:!1?function(t){if(!(this._objFlags&c)&&(cc.engine._isPlaying||this.constructor._executeInEditMode)){if(this._objFlags|=c,this.onLoad)_(this);if(this._objFlags|=l,this.onLoad&&!cc.engine._isPlaying){var e=Editor.Selection.curActivate("node")===this.node.uuid;if(e&&this.onFocusInEditor)m(this);else if(this.onLostFocusInEditor)v(this)}if(1)_Scene.AssetsWatcher.start(this)}if(this._enabled)n(this,t)}:function(t){if(!(this._objFlags&c)){if(this._objFlags|=c,this.onLoad)this.onLoad();this._objFlags|=l}if(this._enabled)n(this,t)},_onPreDestroy:function(){var t,e,i;for(n(this,!1),this.unscheduleAllCallbacks(),t=0,e=this.__eventTargets.length;e>t;++t)i=this.__eventTargets[t],i&&i.targetOff(this);if(this.__eventTargets.length=0,cc.eventManager.removeListeners(this),!1){if(1)_Scene.AssetsWatcher.stop(this);if(cc.engine._isPlaying||this.constructor._executeInEditMode)if(this.onDestroy)g(this)}else if(this.onDestroy)this.onDestroy();if(this.node._removeComponent(this),!1)delete cc.engine.attachedObjsForEditor[this._id]},_instantiate:function(){var t=cc.instantiate._clone(this,this);return t.node=null,t},isRunning:function(){return this.enabledInHierarchy},schedule:function(t,e,i,n){cc.assert(t,cc._LogInfos.Node.schedule),cc.assert(e>=0,cc._LogInfos.Node.schedule_2),e=e||0,i=isNaN(i)?cc.macro.REPEAT_FOREVER:i,n=n||0,cc.director.getScheduler().schedule(t,this,e,i,n,!this.enabledInHierarchy)},scheduleOnce:function(t,e){this.schedule(t,0,0,e)},unschedule:function(t){if(t)cc.director.getScheduler().unschedule(t,this)},unscheduleAllCallbacks:function(){cc.director.getScheduler().unscheduleAllForTarget(this)}});if(S._requireComponent=null,!1)S._executeInEditMode=!1,S._playOnFocus=!1,S._disallowMultiple=null,S._help="",Object.defineProperty(S,"_inspector",{value:"",enumerable:!1}),Object.defineProperty(S,"_icon",{value:"",enumerable:!1}),cc._componentMenuItems=[],S._addMenuItem=function(t,e,i){cc._componentMenuItems.push({component:t,menuPath:e,priority:i})};Object.defineProperty(S,"_registerEditorProps",{value:function(t,e){var i=e.requireComponent;if(i)t._requireComponent=i;if(!1){var n=cc.js.getClassName(t);for(var r in e){var s=e[r];switch(r){case"executeInEditMode":t._executeInEditMode=!!s;break;case"playOnFocus":if(s){var o="executeInEditMode"in e?e.executeInEditMode:t._executeInEditMode;if(o)t._playOnFocus=!0;else cc.warn('The editor property "playOnFocus" should be used with "executeInEditMode" in class "%s".',n)}break;case"inspector":Object.defineProperty(t,"_inspector",{value:s});break;case"icon":Object.defineProperty(t,"_icon",{value:s});break;case"menu":S._addMenuItem(t,s,e.menuPriority);break;case"disallowMultiple":t._disallowMultiple=t;break;case"requireComponent":break;case"help":t._help=s;break;default:cc.warn('Unknown editor property "%s" in class "%s".',r,n)}}}}}),S.prototype.__scriptUuid="",cc.Component=e.exports=S},{"../CCNode":33,"../platform/CCObject":92,"../platform/id-generater":102}],53:[function(t,e,i){cc.Component.EventHandler=cc.Class({name:"cc.ClickEvent",properties:{target:{"default":null,type:cc.Node},component:{"default":""},handler:{"default":""}},statics:{emitEvents:function(t,e){for(var i=0,n=t.length;n>i;i++){var r=t[i];if(!(!r instanceof cc.Component.EventHandler))r.emit(e);else;}}},emit:function(t){var e=this.target;if(cc.isValid(e)){var i=e.getComponent(this.component);if(cc.isValid(i)){var n=i[this.handler];if("function"==typeof n)n.call(i,t)}}}})},{}],54:[function(t,e,i){var n=_ccsg.EditBox.KeyboardReturnType,r=_ccsg.EditBox.InputMode,s=_ccsg.EditBox.InputFlag,o=cc.Class({name:"cc.EditBox","extends":cc._RendererUnderSG,editor:!1,properties:{_useOriginalSize:!0,_string:"",string:{tooltip:"i18n:COMPONENT.editbox.string",get:function(){return this._sgNode.string},set:function(t){this._sgNode.string=this._string=t}},backgroundImage:{tooltip:"i18n:COMPONENT.editbox.backgroundImage","default":null,type:cc.SpriteFrame,notify:function(){var t=this._sgNode,e=t.getBackgroundSprite();if(this.backgroundImage){var i=this._createBackgroundSprite();i.setContentSize(t.getContentSize())}else e.removeFromParent()}},returnType:{"default":n.DEFAULT,tooltip:"i18n:COMPONENT.editbox.returnType",displayName:"KeyboardReturnType",type:n,notify:function(){this._sgNode.returnType=this.returnType}},inputFlag:{tooltip:"i18n:COMPONENT.editbox.input_flag","default":s.INITIAL_CAPS_ALL_CHARACTERS,type:s,notify:function(){this._sgNode.inputFlag=this.inputFlag}},inputMode:{tooltip:"i18n:COMPONENT.editbox.input_mode","default":r.ANY,type:r,notify:function(){this._sgNode.inputMode=this.inputMode}},fontSize:{tooltip:"i18n:COMPONENT.editbox.font_size","default":20,notify:function(){this._sgNode.fontSize=this.fontSize}},lineHeight:{tooltip:"i18n:COMPONENT.editbox.line_height","default":40,notify:function(){this._sgNode.setLineHeight(this.lineHeight)}},fontColor:{tooltip:"i18n:COMPONENT.editbox.font_color","default":cc.Color.WHITE,notify:function(){this._sgNode.fontColor=this.fontColor}},placeholder:{tooltip:"i18n:COMPONENT.editbox.placeholder","default":"Enter text here...",notify:function(){this._sgNode.placeholder=this.placeholder}},placeholderFontSize:{tooltip:"i18n:COMPONENT.editbox.placeholder_font_size","default":20,notify:function(){this._sgNode.placeholderFontSize=this.placeholderFontSize}},placeholderFontColor:{tooltip:"i18n:COMPONENT.editbox.placeholder_font_color","default":cc.Color.GRAY,notify:function(){this._sgNode.placeholderFontColor=this.placeholderFontColor}},maxLength:{tooltip:"i18n:COMPONENT.editbox.max_length","default":20,notify:function(){this._sgNode.maxLength=this.maxLength}},editingDidBegan:{"default":[],type:cc.Component.EventHandler},textChanged:{"default":[],type:cc.Component.EventHandler},editingDidEnded:{"default":[],type:cc.Component.EventHandler}},statics:{KeyboardReturnType:n,InputFlag:s,InputMode:r},_applyCapInset:function(t){var e=this.backgroundImage;t.setInsetTop(e.insetTop),t.setInsetBottom(e.insetBottom),t.setInsetRight(e.insetRight),t.setInsetLeft(e.insetLeft)},_createSgNode:function(){return new _ccsg.EditBox(cc.size(160,40))},_createBackgroundSprite:function(){var t=this._sgNode,e=new cc.Scale9Sprite;if(e.setRenderingType(cc.Scale9Sprite.RenderingType.SLICED),this.backgroundImage)e.setSpriteFrame(this.backgroundImage),this._applyCapInset(e);return t.initWithSizeAndBackgroundSprite(cc.size(160,40),e),e},_initSgNode:function(){var t=this._sgNode;if(this._createBackgroundSprite(),this._useOriginalSize,!1)this.node.setContentSize(t.getContentSize()),this._useOriginalSize=!1;else t.setContentSize(this.node.getContentSize());t.inputMode=this.inputMode,t.maxLength=this.maxLength,t.string=this._string,t.fontSize=this.fontSize,t.fontColor=this.fontColor,t.placeholder=this.placeholder,t.placeholderFontSize=this.placeholderFontSize,t.placeholderFontColor=this.placeholderFontColor,t.inputFlag=this.inputFlag,t.returnType=this.returnType,t.setLineHeight(this.lineHeight),t.setDelegate(this)},editBoxEditingDidBegan:function(){cc.Component.EventHandler.emitEvents(this.editingDidBegan)},editBoxEditingDidEnded:function(){cc.Component.EventHandler.emitEvents(this.editingDidEnded)},editBoxTextChanged:function(t,e){cc.Component.EventHandler.emitEvents(this.textChanged,e)},onLoad:function(){if(this._super(),1)this._registerEvent()},_registerEvent:function(){this.node.on(cc.Node.EventType.TOUCH_START,this._onTouchBegan,this),this.node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this)},_onTouchBegan:function(t){if(this._sgNode)this._sgNode._onTouchBegan(t.touch);t.stopPropagation()},_onTouchEnded:function(t){if(this._sgNode)this._sgNode._onTouchEnded();t.stopPropagation()}});cc.EditBox=e.exports=o},{}],55:[function(t,e,i){var n=cc.TextAlignment,r=cc.VerticalTextAlignment,s=_ccsg.Label.Overflow,o=(_ccsg.Label.Type,cc.Class({name:"cc.Label","extends":cc._RendererUnderSG,editor:!1,properties:{_useOriginalSize:!0,string:{"default":"Label",multiline:!0,tooltip:"i18n:COMPONENT.label.string",notify:function(){if(this._sgNode)this._sgNode.setString(this.string),this._updateNodeSize()}},horizontalAlign:{"default":n.LEFT,type:n,tooltip:"i18n:COMPONENT.label.horizontal_align",notify:function(){if(this._sgNode)this._sgNode.setHorizontalAlign(this.horizontalAlign)},animatable:!1},verticalAlign:{"default":r.TOP,type:r,tooltip:"i18n:COMPONENT.label.vertical_align",notify:function(){if(this._sgNode)this._sgNode.setVerticalAlign(this.verticalAlign)},animatable:!1},_fontSize:40,fontSize:{get:function(){if(this._sgNode)this._fontSize=this._sgNode.getFontSize();return this._fontSize},set:function(t){if(this._fontSize=t,this._sgNode)this._sgNode.setFontSize(t),this._updateNodeSize()},tooltip:"i18n:COMPONENT.label.font_size"},_lineHeight:40,lineHeight:{get:function(){if(this._sgNode)this._lineHeight=this._sgNode.getLineHeight();return this._lineHeight},set:function(t){if(this._lineHeight=t,this._sgNode)this._sgNode.setLineHeight(t),this._updateNodeSize()},tooltip:"i18n:COMPONENT.label.line_height"},overflow:{"default":s.NONE,type:s,tooltip:"i18n:COMPONENT.label.overflow",notify:function(){if(this._sgNode)this._sgNode.setOverflow(this.overflow),this._updateNodeSize()},animatable:!1},_enableWrapText:!0,enableWrapText:{get:function(){if(this._sgNode)this._enableWrapText=this._sgNode.isWrapTextEnabled();return this._enableWrapText},set:function(t){if(this._enableWrapText=t,this._sgNode)this._sgNode.enableWrapText(t)},animatable:!1,tooltip:"i18n:COMPONENT.label.wrap"},file:{"default":"Arial",url:cc.Font,tooltip:"i18n:COMPONENT.label.file",notify:function(){if(this._sgNode)this._sgNode.setFontFileOrFamily(this.file)},animatable:!1},_isSystemFontUsed:!0,useSystemFont:{get:function(){if(this._sgNode)this._isSystemFontUsed=this._sgNode.isSystemFontUsed();return this._isSystemFontUsed},set:function(t){if(this._isSystemFontUsed=t,t)if(this.file="",this._sgNode)this._sgNode.setSystemFontUsed(t)},animatable:!1,tooltip:"i18n:COMPONENT.label.system_font"}},statics:{HorizontalAlign:n,VerticalAlign:r,Overflow:s},onLoad:function(){this._super();var t=this._sgNode._isUseSystemFont;if(t)this._updateNodeSize();else if(this.node._sizeProvider===this._sgNode)this.node._sizeProvider=null;if(!cc.sys.isNative)this._sgNode.on("load",this._updateNodeSize,this)},_createSgNode:function(){return null},_initSgNode:function(){this._sgNode=new _ccsg.Label(this.string,this.file),this._sgNode.retain();var t=this._sgNode;if(t.setHorizontalAlign(this.horizontalAlign),t.setVerticalAlign(this.verticalAlign),t.setFontSize(this._fontSize),t.setOverflow(this.overflow),t.enableWrapText(this._enableWrapText),t.setLineHeight(this._lineHeight),t.setString(this.string),t.setFontFileOrFamily(this.file),this._useOriginalSize,!1)this.node.setContentSize(t.getContentSize()),this._useOriginalSize=!1;else t.setContentSize(this.node.getContentSize());t.setColor(this.node.color)},_updateNodeSize:function(){var t=this._sgNode&&this._sgNode.parent;if(t){if(this.overflow===s.NONE)this.node.setContentSize(this._sgNode.getContentSize());if(!this.node._sizeProvider)this.node._sizeProvider=this._sgNode}}}));cc.Label=e.exports=o},{}],56:[function(t,e,i){var n=cc.Enum({NONE:0,HORIZONTAL:1,VERTICAL:2,GRID:3}),r=cc.Enum({NONE:0,CONTAINER:1,CHILDREN:2}),s=cc.Enum({HORIZONTAL:0,VERTICAL:1}),o=cc.Enum({BOTTOM_TO_TOP:0,TOP_TO_BOTTOM:1}),a=cc.Enum({LEFT_TO_RIGHT:0,RIGHT_TO_LEFT:1}),c=cc.Class({name:"cc.Layout","extends":t("./CCComponent"),editor:!1,properties:{_layoutSize:cc.size(300,200),_layoutDirty:{"default":!0,serializable:!1},_resize:r.NONE,_N$layoutType:n.NONE,type:{type:n,get:function(){return this._N$layoutType},set:function(t){if(this._N$layoutType=t,this.type!==n.NONE&&this._resize===r.CONTAINER,!1){var e=_Scene.DetectConflict.checkConflict_Layout(this);if(e)return}this._doLayoutDirty()},animatable:!1,tooltip:"i18n:COMPONENT.layout.layout_type"},resizeMode:{type:r,tooltip:"i18n:COMPONENT.layout.auto_resize",get:function(){return this._resize},set:function(t){if(this.type!==n.NONE||t!==r.CHILDREN){if(this._resize=t,this.type!==n.NONE&&t===r.CONTAINER,!1){var e=_Scene.DetectConflict.checkConflict_Layout(this);if(e)return}this._doLayoutDirty()}},animatable:!1},cellSize:{"default":cc.size(40,40),type:cc.Size,notify:function(){this._doLayoutDirty()},animatable:!1},startAxis:{"default":s.HORIZONTAL,type:s,notify:function(){if(this._resize===r.CONTAINER,!1){var t=_Scene.DetectConflict.checkConflict_Layout(this);if(t)return}this._doLayoutDirty()},animatable:!1},padding:{"default":0,notify:function(){this._doLayoutDirty()},animatable:!1},spacingX:{"default":0,notify:function(){this._doLayoutDirty()},animatable:!1,tooltip:"i18n:COMPONENT.layout.space_x"},spacingY:{"default":0,notify:function(){this._doLayoutDirty()},animatable:!1,tooltip:"i18n:COMPONENT.layout.space_y"},verticalDirection:{"default":o.TOP_TO_BOTTOM,type:o,notify:function(){this._doLayoutDirty()},animatable:!1,tooltip:"i18n:COMPONENT.layout.vertical_direction"},horizontalDirection:{"default":a.LEFT_TO_RIGHT,type:a,notify:function(){this._doLayoutDirty()},animatable:!1,tooltip:"i18n:COMPONENT.layout.horizontal_direction"}},statics:{Type:n,VerticalDirection:o,HorizontalDirection:a,ResizeMode:r,AxisDirection:s},onLoad:function(){this.node.setContentSize(this._layoutSize),this.node.on("size-changed",this._resized,this),this.node.on("anchor-changed",this._doLayoutDirty,this),this.node.on("child-added",this._childrenAddOrDeleted,this),this.node.on("child-removed",this._childrenAddOrDeleted,this),this.node.on("child-reorder",this._doLayoutDirty,this),this._updateChildrenEventListener()},_doLayoutDirty:function(){this._layoutDirty=!0},_updateChildrenEventListener:function(){var t=this.node.children;t.forEach(function(t){t.on("size-changed",this._doLayoutDirty,this),t.on("position-changed",this._doLayoutDirty,this),t.on("anchor-changed",this._doLayoutDirty,this),t.on("active-in-hierarchy-changed",this._doLayoutDirty,this)}.bind(this))},_childrenAddOrDeleted:function(){this._updateChildrenEventListener(),this._doLayoutDirty()},_resized:function(){this._layoutSize=this.node.getContentSize(),this._doLayoutDirty()},_doLayoutHorizontally:function(t,e,i,s){var c=this.node.getAnchorPoint(),l=this.node.children,h=1,u=-c.x*t;if(this.horizontalDirection===a.RIGHT_TO_LEFT)h=-1,u=(1-c.x)*t;var d,f,_=u+h*this.padding-h*this.spacingX,p=0,g=0,m=0,v=0,y=this.cellSize.width;if(this.type!==n.GRID&&this.resizeMode===r.CHILDREN)y=(t-2*this.padding-(l.length-1)*this.spacingX)/l.length;return l.forEach(function(l){if(l.activeInHierarchy){if(this._resize===r.CHILDREN)if(l.width=y,this.type===n.GRID)l.height=this.cellSize.height;var T=l.anchorX;if(m>g)g=m;if(l.height>=g)m=g,g=l.height,f=l.getAnchorPoint();if(this.horizontalDirection===a.RIGHT_TO_LEFT)T=1-l.anchorX;_=_+h*T*l.width+h*this.spacingX;var C=h*(1-T)*l.width;if(e){var x=_+C+h*this.padding,S=this.horizontalDirection===a.LEFT_TO_RIGHT&&x>(1-c.x)*t,b=this.horizontalDirection===a.RIGHT_TO_LEFT&&x<-c.x*t;if(S||b){if(l.height>=g){if(0===m)m=g;p+=m,m=g}else p+=g,m=l.height,g=0;_=u+h*(this.padding+T*l.width),v++}}var E=i(l,p,v);if(t>=l.width+2*this.padding)if(s)l.setPosition(cc.p(_,E));var A,w=1,O=0===g?l.height:g;if(this.verticalDirection===o.TOP_TO_BOTTOM){if(d=d||this.node._contentSize.height,w=-1,A=E+w*(O*f.y+this.padding),d>A)d=A}else if(d=d||-this.node._contentSize.height,A=E+w*(O*f.y+this.padding),A>d)d=A;_+=C}}.bind(this)),d},_getVerticalBaseHeight:function(t){var e=0;if(this.resizeMode===r.CONTAINER)t.forEach(function(t){e+=t.height}),e+=(t.length-1)*this.spacingY+2*this.padding;else e=this.node.getContentSize().height;return e},_doLayoutVertically:function(t,e,i,s){var c=this.node.getAnchorPoint(),l=this.node.children,h=1,u=-c.y*t;if(this.verticalDirection===o.TOP_TO_BOTTOM)h=-1,u=(1-c.y)*t;var d,f,_=u+h*this.padding-h*this.spacingY,p=0,g=0,m=0,v=0,y=this.cellSize.height;if(this.type!==n.GRID&&this.resizeMode===r.CHILDREN)y=(t-2*this.padding-(l.length-1)*this.spacingY)/l.length;return l.forEach(function(l){if(l.activeInHierarchy){if(this.resizeMode===r.CHILDREN)if(l.height=y,this.type===n.GRID)l.width=this.cellSize.width;var T=l.anchorY;if(m>g)g=m;if(l.width>=g)m=g,g=l.width,f=l.getAnchorPoint();if(this.verticalDirection===o.TOP_TO_BOTTOM)T=1-l.anchorY;_=_+h*T*l.height+h*this.spacingY;var C=h*(1-T)*l.height;if(e){var x=_+C+h*this.padding,S=this.verticalDirection===o.BOTTOM_TO_TOP&&x>(1-c.y)*t,b=this.verticalDirection===o.TOP_TO_BOTTOM&&x<-c.y*t;if(S||b){if(l.width>=g){if(0===m)m=g;p+=m,m=g}else p+=g,m=l.width,g=0;_=u+h*(this.padding+T*l.height),v++}}var E=i(l,p,v);if(t>=l.height+2*this.padding)if(s)l.setPosition(cc.p(E,_));var A,w=1,O=0===g?l.width:g;if(this.horizontalDirection===a.RIGHT_TO_LEFT){if(w=-1,d=d||this.node._contentSize.width,A=E+w*(O*f.x+this.padding),d>A)d=A}else if(d=d||-this.node._contentSize.width,A=E+w*(O*f.x+this.padding),A>d)d=A;_+=C}}.bind(this)),d},_doLayoutBasic:function(){var t=this.node.children,e=null;if(t.forEach(function(t){if(!e)e=t.getBoundingBoxToWorld();else e=cc.rectUnion(e,t.getBoundingBoxToWorld())}),e){var i=this.node.parent.convertToNodeSpaceAR(cc.p(e.x,e.y)),n=this.node.parent.convertToNodeSpaceAR(cc.p(e.x+e.width,e.y+e.height)),r=cc.size(n.x-i.x,n.y-i.y),s=this.node.getPosition(),o=cc.p((s.x-i.x)/r.width,(s.y-i.y)/r.height);this.node.setAnchorPoint(o),this.node.setContentSize(r)}},_doLayoutGridAxisHorizontal:function(t,e){var i=e.width,n=1,s=-t.y*e.height;if(this.verticalDirection===o.TOP_TO_BOTTOM)n=-1,s=(1-t.y)*e.height;var a=function(t,e,i){return s+n*(e+t.anchorY*t.height+this.padding+i*this.spacingY)}.bind(this),c=0;if(this.resizeMode===r.CONTAINER){var l=this._doLayoutHorizontally(i,!0,a,!1);if(c=s-l,0>c)c*=-1;if(s=-t.y*c,this.verticalDirection===o.TOP_TO_BOTTOM)n=-1,s=(1-t.y)*c}if(this._doLayoutHorizontally(i,!0,a,!0),this.resizeMode===r.CONTAINER)this.node.setContentSize(i,c)},_doLayoutGridAxisVertical:function(t,e){var i=e.height,n=1,s=-t.x*e.width;if(this.horizontalDirection===a.RIGHT_TO_LEFT)n=-1,s=(1-t.x)*e.width;var o=function(t,e,i){return s+n*(e+t.anchorX*t.width+this.padding+i*this.spacingX)}.bind(this),c=0;if(this.resizeMode===r.CONTAINER){var l=this._doLayoutVertically(i,!0,o,!1);if(c=s-l,0>c)c*=-1;if(s=-t.x*c,this.horizontalDirection===a.RIGHT_TO_LEFT)n=-1,s=(1-t.x)*c}if(this._doLayoutVertically(i,!0,o,!0),this.resizeMode===r.CONTAINER)this.node.setContentSize(c,i)},_doLayoutGrid:function(){var t=this.node.getAnchorPoint(),e=this.node.getContentSize();if(this.startAxis===s.HORIZONTAL)this._doLayoutGridAxisHorizontal(t,e);else if(this.startAxis===s.VERTICAL)this._doLayoutGridAxisVertical(t,e)},_getHorizontalBaseWidth:function(t){var e=0;if(this.resizeMode===r.CONTAINER)t.forEach(function(t){e+=t.width}),e+=(t.length-1)*this.spacingX+2*this.padding;else e=this.node.getContentSize().width;return e},_doLayout:function(){if(this.type===n.HORIZONTAL){var t=this._getHorizontalBaseWidth(this.node.children),e=function(t){return t.y};this._doLayoutHorizontally(t,!1,e,!0),this.node.width=t}else if(this.type===n.VERTICAL){var i=this._getVerticalBaseHeight(this.node.children),s=function(t){return t.x};this._doLayoutVertically(i,!1,s,!0),this.node.height=i}else if(this.type===n.NONE){if(this.resizeMode===r.CONTAINER)this._doLayoutBasic()}else if(this.type===n.GRID)this._doLayoutGrid()},lateUpdate:function(){if(this._layoutDirty&&this.node.children.length>0)this._doLayout(),this._layoutDirty=!1}});cc.Layout=e.exports=c},{"./CCComponent":52}],57:[function(t,e,i){var n=cc.Class({name:"cc.Mask","extends":cc._RendererInSG,editor:!1,properties:{_clippingStencil:{"default":null,serializable:!1}},_createSgNode:function(){return this._clippingStencil=new cc.DrawNode,this._clippingStencil.retain(),new cc.ClippingNode(this._clippingStencil)},_initSgNode:function(){var t=this._sgNode;t.setContentSize(this.node.getContentSize(!0))},onEnable:function(){this._refreshStencil(),this._super(),this.node.on("size-changed",this._refreshStencil,this),this.node.on("anchor-changed",this._refreshStencil,this)},onDisable:function(){this._super(),this.node.off("size-changed",this._refreshStencil,this),this.node.off("anchor-changed",this._refreshStencil,this)},onDestroy:function(){this._super(),this._clippingStencil.release()},_refreshStencil:function(){var t=this.node.getContentSize(),e=this.node.getAnchorPoint(),i=t.width,n=t.height,r=-i*e.x,s=-n*e.y,o=[cc.v2(r,s),cc.v2(r+i,s),cc.v2(r+i,s+n),cc.v2(r,s+n)],a=cc.color(255,255,255,0);this._clippingStencil.clear(),this._clippingStencil.drawPoly(o,a,0,a)}});cc.Mask=e.exports=n},{}],58:[function(t,e,i){var n=cc.Enum({HORIZONTAL:0,VERTICAL:1,FILLED:2}),r=cc.Class({name:"cc.ProgressBar","extends":t("./CCComponent"),editor:!1,_initBarSprite:function(){if(this.barSprite){var t=this.barSprite.node;if(!t)return;var e=this.node.getContentSize(),i=this.node.getAnchorPoint(),r=t.getContentSize();if(t.parent===this.node)this.node.setContentSize(r);if(this.barSprite.fillType===cc.Sprite.FillType.RADIAL)this.mode=n.FILLED;var s=t.getContentSize();if(this.mode===n.HORIZONTAL)this.totalLength=s.width;else if(this.mode===n.VERTICAL)this.totalLength=s.height;else this.totalLength=this.barSprite.fillRange;if(t.parent===this.node){var o=-e.width*i.x,a=0;t.setPosition(cc.p(o,a))}}},_updateBarStatus:function(){if(this.barSprite){var t=this.barSprite.node;if(!t)return;var e,i,r,s=t.getAnchorPoint(),o=t.getContentSize(),a=t.getPosition(),c=cc.p(0,.5),l=cc.clamp01(this.progress),h=this.totalLength*l;switch(this.mode){case n.HORIZONTAL:if(this.reverse)c=cc.p(1,.5);e=cc.size(h,o.height),i=this.totalLength,r=o.height;break;case n.VERTICAL:if(this.reverse)c=cc.p(.5,1);else c=cc.p(.5,0);e=cc.size(o.width,h),i=o.width,r=this.totalLength;break;case n.FILLED:if(this.reverse)h=-1*h;this.barSprite.fillRange=h}if(this.barSprite.type!==cc.Sprite.Type.FILLED){var u=c.x-s.x,d=c.y-s.y,f=cc.p(i*u,r*d);t.setPosition(cc.pAdd(a,f)),t.setAnchorPoint(c),t.setContentSize(e)}}},properties:{barSprite:{"default":null,type:cc.Sprite,tooltip:"i18n:COMPONENT.progress.bar_sprite",notify:function(){this._initBarSprite()},animatable:!1},mode:{"default":n.HORIZONTAL,type:n,tooltip:"i18n:COMPONENT.progress.mode",notify:function(){if(this.barSprite){var t=this.barSprite.node;if(!t)return;var e=t.getContentSize();if(this.mode===n.HORIZONTAL)this.totalLength=e.width;else if(this.mode===n.VERTICAL)this.totalLength=e.height;else if(this.mode===n.FILLED)this.totalLength=this.barSprite.fillRange}},animatable:!1},totalLength:{"default":1,range:[0,Number.MAX_VALUE],tooltip:"i18n:COMPONENT.progress.total_length",notify:function(t){this._updateBarStatus()}},progress:{"default":1,type:"Float",range:[0,1,.1],tooltip:"i18n:COMPONENT.progress.progress",notify:function(){this._updateBarStatus()}},reverse:{"default":!1,tooltip:"i18n:COMPONENT.progress.reverse",notify:function(){if(this.barSprite)this.barSprite.fillStart=1-this.barSprite.fillStart;this._updateBarStatus()},animatable:!1}},statics:{Mode:n}});cc.ProgressBar=e.exports=r},{"./CCComponent":52}],59:[function(t,e,i){var n=cc.Class({"extends":t("./CCSGComponent"),ctor:function(){if(this._sgNode=this._createSgNode(),this._sgNode)this._sgNode.retain();else cc.error("Not support for asynchronous creating node in SG");this._plainNode=new _ccsg.Node,this._plainNode.retain()},onEnable:function(){this._replaceSgNode(this._sgNode),this.node._ignoreAnchor=!0},onDisable:function(){this._replaceSgNode(this._plainNode),this.node._ignoreAnchor=!1},onDestroy:function(){this._super();var t=this.node._sgNode;if(this._plainNode!==t)this._plainNode.release()},_replaceSgNode:function(t){if(!(t instanceof _ccsg.Node),!1)throw new Error("Invalid sgNode. It must be an instance of _ccsg.Node");var e=this.node,i=e._sgNode;if(false)return void cc.warn("The same sgNode");var n=i.getChildren().slice();if(i.removeAllChildren(),t.getChildrenCount()>0){if(!1)cc.warn("The replacement sgNode should not contain any child.");t.removeAllChildren()}for(var r=0,s=n.length;s>r;++r)t.addChild(n[r]);var o=i.getParent();if(o.removeChild(i),o.addChild(t),t.arrivalOrder=i.arrivalOrder,1)cc.renderer.childrenOrderDirty=o._reorderChildDirty=!0;e._sgNode=t,e._updateSgNode()}});cc._RendererInSG=e.exports=n},{"./CCSGComponent":61}],60:[function(t,e,i){var n=cc.Class({"extends":t("./CCSGComponent"),ctor:function(){if(this._sgNode=this._createSgNode(),this._sgNode)this._sgNode.retain()},onLoad:function(){this._super(),this._appendSgNode(this._sgNode)},onEnable:function(){if(this._sgNode)this._sgNode.setVisible(!0)},onDisable:function(){if(this._sgNode)this._sgNode.setVisible(!1)},_appendSgNode:function(t){if(t){if(!this.enabled)t.setVisible(!1);var e=this.node;if(t.setColor(e._color),!e._cascadeOpacityEnabled)t.setOpacity(e._opacity);t.setAnchorPoint(e._anchorPoint),t.ignoreAnchorPointForPosition(e.__ignoreAnchor),t.setOpacityModifyRGB(e._opacityModifyRGB),t.setLocalZOrder(-1);var i=e._sgNode;i.addChild(t)}}});cc._RendererUnderSG=e.exports=n},{"./CCSGComponent":61}],61:[function(t,e,i){var n=t("../utils/scene-graph-helper"),r=cc.Class({"extends":t("./CCComponent"),editor:!1,properties:{_sgNode:{"default":null,serializable:!1}},onLoad:function(){this._initSgNode();var t=this._sgNode;if(!this.node._sizeProvider)this.node._sizeProvider=t},onDestroy:function(){if(this.node._sizeProvider===this._sgNode)this.node._sizeProvider=null;this._removeSgNode()},_createSgNode:null,_initSgNode:null,_removeSgNode:n.removeSgNode});cc._SGComponent=e.exports=r},{"../utils/scene-graph-helper":127,"./CCComponent":52}],62:[function(t,e,i){var n=20,r=cc.Enum({HORIZONTAL:0,VERTICAL:1}),s=cc.Class({name:"cc.Scrollbar","extends":t("./CCComponent"),editor:!1,properties:{_scrollView:null,_touching:!1,_autoHideRemainingTime:{"default":0,serializable:!1},_opacity:255,handle:{"default":null,type:cc.Sprite,tooltip:"i18n:COMPONENT.scrollbar.handle",notify:function(){this._onScroll(cc.p(0,0))},animatable:!1},direction:{"default":r.HORIZONTAL,type:r,tooltip:"i18n:COMPONENT.scrollbar.direction",notify:function(){this._onScroll(cc.p(0,0))},animatable:!1},enableAutoHide:{"default":!0,animatable:!1,tooltip:"i18n:COMPONENT.scrollbar.auto_hide"},autoHideTime:{"default":1,animatable:!1,tooltip:"i18n:COMPONENT.scrollbar.auto_hide_time"}},statics:{Direction:r},setTargetScrollView:function(t){this._scrollView=t},_convertToScrollViewSpace:function(t){var e=t.convertToWorldSpace(cc.p(0,0)),i=this._scrollView.node.convertToNodeSpace(e);return i},_setOpacity:function(t){if(this.handle)this.node.setOpacity(t)},_onScroll:function(t){if(this._scrollView){var e=this._scrollView.content;if(e){var i=e.getContentSize(),n=this._scrollView.node.getContentSize();if(this._conditionalDisableScrollBar(i,n))return;
if(this.enableAutoHide)this._autoHideRemainingTime=this.autoHideTime,this._setOpacity(this._opacity);var s=0,o=0,a=0,c=0;if(this.direction===r.HORIZONTAL)s=i.width,o=n.width,a=t.x,c=-this._convertToScrollViewSpace(e).x;else if(this.direction===r.VERTICAL)s=i.height,o=n.height,a=t.y,c=-this._convertToScrollViewSpace(e).y;var l=this._calculateLength(s,o,a),h=this._calculatePosition(s,o,c,a,l);this._updateLength(l),this._updateHanlderPosition(h)}}},_updateHanlderPosition:function(t){if(this.handle){var e=this._fixupHandlerPosition();this.handle.node.setPosition(cc.pAdd(t,e))}},_fixupHandlerPosition:function(){var t,e=this.node.getContentSize(),i=this.node.getAnchorPoint(),n=(this.node.getPosition(),this.handle.node.parent);if(this.direction===r.HORIZONTAL){var s=this.node.convertToWorldSpaceAR(cc.p(-e.width*i.x,-e.height*i.y));t=n.convertToNodeSpaceAR(s)}else if(this.direction===r.VERTICAL){var o=this.node.convertToWorldSpaceAR(cc.p(-e.width*i.x,-e.height*i.y));t=n.convertToNodeSpaceAR(o)}return this.handle.node.setPosition(t),t},_onTouchBegan:function(){if(this.enableAutoHide)this._touching=!0},_conditionalDisableScrollBar:function(t,e){if(t.width<=e.width&&this.direction===r.HORIZONTAL)return!0;if(t.height<=e.height&&this.direction===r.VERTICAL)return!0;else return!1},_onTouchEnded:function(){if(this.enableAutoHide)if(this._touching=!1,!(this.autoHideTime<=0)){if(this._scrollView){var t=this._scrollView.content;if(t){var e=t.getContentSize(),i=this._scrollView.node.getContentSize();if(this._conditionalDisableScrollBar(e,i))return}}this._autoHideRemainingTime=this.autoHideTime}},_calculateLength:function(t,e,i){var r=t;if(i)r+=(i>0?i:-i)*n;var s=e/r;return e*s},_calculatePosition:function(t,e,i,n,s){var o=t-e;if(n)o+=Math.abs(n);var a=0;if(o)a=i/o,a=cc.clamp01(a);var c=(e-s)*a;if(this.direction===r.VERTICAL)return cc.p(0,c);else return cc.p(c,0)},_updateLength:function(t){if(this.handle){var e=this.handle.node,i=this.node.getContentSize();if(e.setAnchorPoint(cc.p(0,0)),this.direction===r.HORIZONTAL)e.setContentSize(t,i.height);else e.setContentSize(i.width,t)}},_processAutoHide:function(t){if(this.enableAutoHide&&!(this._autoHideRemainingTime<=0)){if(this._touching)return;if(this._autoHideRemainingTime-=t,this._autoHideRemainingTime<=this.autoHideTime){this._autoHideRemainingTime=Math.max(0,this._autoHideRemainingTime);var e=this._opacity*(this._autoHideRemainingTime/this.autoHideTime);this._setOpacity(e)}}},start:function(){if(this.enableAutoHide)this._setOpacity(0)},update:function(t){this._processAutoHide(t)}});cc.Scrollbar=e.exports=s},{"./CCComponent":52}],63:[function(t,e,i){var n=5,r=.05,s=1e-7,o=.7,a=function(t){return t-=1,t*t*t*t*t+1},c=function(){var t=new Date;return t.getMilliseconds()},l=cc.Class({name:"cc.ScrollView","extends":t("./CCComponent"),editor:!1,ctor:function(){this._topBoundary=0,this._bottomBoundary=0,this._leftBoundary=0,this._rightBoundary=0,this._touchMoveDisplacements=[],this._touchMoveTimeDeltas=[],this._touchMovePreviousTimestamp=0,this._autoScrolling=!1,this._autoScrollAttenuate=!1,this._autoScrollStartPosition=cc.p(0,0),this._autoScrollTargetDelta=cc.p(0,0),this._autoScrollTotalTime=0,this._autoScrollAccumulatedTime=0,this._autoScrollCurrentlyOutOfBoundary=!1,this._autoScrollBraking=!1,this._autoScrollBrakingStartPosition=cc.p(0,0),this._outOfBoundaryAmount=cc.p(0,0),this._outOfBoundaryAmountDirty=!0,this._stopMouseWheel=!1,this._mouseWheelEventElapsedTime=0},properties:{content:{"default":null,type:cc.Node,tooltip:"i18n:COMPONENT.scrollview.content"},horizontal:{"default":!0,animatable:!1,tooltip:"i18n:COMPONENT.scrollview.horizontal"},vertical:{"default":!0,animatable:!1,tooltip:"i18n:COMPONENT.scrollview.vertical"},inertia:{"default":!0,animatable:!1,tooltip:"i18n:COMPONENT.scrollview.inertia"},brake:{"default":.5,type:"Float",range:[0,1,.1],animatable:!1},elastic:{"default":!0,animatable:!1},bounceDuration:{"default":1,range:[0,10],animatable:!1},horizontalScrollBar:{"default":null,type:cc.Scrollbar,tooltip:"i18n:COMPONENT.scrollview.horizontal_bar",notify:function(){if(this.horizontalScrollBar)this.horizontalScrollBar.setTargetScrollView(this),this._updateScrollBar(0)},animatable:!1},verticalScrollBar:{"default":null,type:cc.Scrollbar,tooltip:"i18n:COMPONENT.scrollview.vertical_bar",notify:function(){if(this.verticalScrollBar)this.verticalScrollBar.setTargetScrollView(this),this._updateScrollBar(0)},animatable:!1}},scrollToBottom:function(t,e){var i=this._calculateMovePercentDelta({anchor:cc.p(0,0),applyToHorizontal:!1,applyToVertical:!0});if(t)this._startAutoScroll(i,t,e!==!1);else this._moveContent(i,!0)},scrollToTop:function(t,e){var i=this._calculateMovePercentDelta({anchor:cc.p(0,1),applyToHorizontal:!1,applyToVertical:!0});if(t)this._startAutoScroll(i,t,e!==!1);else this._moveContent(i)},scrollToLeft:function(t,e){var i=this._calculateMovePercentDelta({anchor:cc.p(0,0),applyToHorizontal:!0,applyToVertical:!1});if(t)this._startAutoScroll(i,t,e!==!1);else this._moveContent(i)},scrollToRight:function(t,e){var i=this._calculateMovePercentDelta({anchor:cc.p(1,0),applyToHorizontal:!0,applyToVertical:!1});if(t)this._startAutoScroll(i,t,e!==!1);else this._moveContent(i)},scrollToTopLeft:function(t,e){var i=this._calculateMovePercentDelta({anchor:cc.p(0,1),applyToHorizontal:!0,applyToVertical:!0});if(t)this._startAutoScroll(i,t,e!==!1);else this._moveContent(i)},scrollToTopRight:function(t,e){var i=this._calculateMovePercentDelta({anchor:cc.p(1,1),applyToHorizontal:!0,applyToVertical:!0});if(t)this._startAutoScroll(i,t,e!==!1);else this._moveContent(i)},scrollToBottomLeft:function(t,e){var i=this._calculateMovePercentDelta({anchor:cc.p(0,0),applyToHorizontal:!0,applyToVertical:!0});if(t)this._startAutoScroll(i,t,e!==!1);else this._moveContent(i)},scrollToBottomRight:function(t,e){var i=this._calculateMovePercentDelta({anchor:cc.p(1,0),applyToHorizontal:!0,applyToVertical:!0});if(t)this._startAutoScroll(i,t,e!==!1);else this._moveContent(i)},scrollToPercentHorizontal:function(t,e,i){var n=this._calculateMovePercentDelta({anchor:cc.p(t,0),applyToHorizontal:!0,applyToVertical:!1});if(e)this._startAutoScroll(n,e,i!==!1);else this._moveContent(n)},scrollTo:function(t,e,i){var n=this._calculateMovePercentDelta({anchor:t,applyToHorizontal:!0,applyToVertical:!0});if(e)this._startAutoScroll(n,e,i!==!1);else this._moveContent(n)},scrollToPercentVertical:function(t,e,i){var n=this._calculateMovePercentDelta({anchor:cc.p(0,t),applyToHorizontal:!1,applyToVertical:!0});if(e)this._startAutoScroll(n,e,i!==!1);else this._moveContent(n)},setContentPosition:function(t){if(!cc.pFuzzyEqual(t,this.getContentPosition(),s))this.content.setPosition(t),this._outOfBoundaryAmountDirty=!0},getContentPosition:function(){return this.content.getPosition()},_registerEvent:function(){this.node.on(cc.Node.EventType.TOUCH_START,this._onTouchBegan,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this._onTouchMoved,this),this.node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this._onTouchCancelled,this),this.node.on(cc.Node.EventType.MOUSE_WHEEL,this._onMouseWheel,this)},_onMouseWheel:function(t){var e=cc.p(0,0),i=.025;if(cc.sys.isNative)i=7;if(this.vertical)e=cc.p(0,t.getScrollY()*i);else if(this.horizontal)e=cc.p(t.getScrollY()*i,0);if(this._mouseWheelEventElapsedTime=0,this._processDeltaMove(e),!this._stopMouseWheel)this._handlePressLogic(),this.schedule(this._checkMouseWheel,1/60),this._stopMouseWheel=!0;t.stopPropagation()},_checkMouseWheel:function(t){var e=this._getHowMuchOutOfBoundary(),i=.1;if(!cc.pFuzzyEqual(e,cc.p(0,0),s))return this._processInertiaScroll(),this.unschedule(this._checkMouseWheel),void(this._stopMouseWheel=!1);if(this._mouseWheelEventElapsedTime+=t,this._mouseWheelEventElapsedTime>i)this._onScrollBarTouchEnded(),this.unschedule(this._checkMouseWheel),this._stopMouseWheel=!1},_calculateMovePercentDelta:function(t){var e=t.anchor,i=t.applyToHorizontal,n=t.applyToVertical;e=cc.pClamp(e,cc.p(0,0),cc.p(1,1));var r=this.node.getContentSize(),s=this.content.getContentSize(),o=Math.abs(this._getContentBottomBoundary()-this._bottomBoundary),a=Math.abs(this._getContentLeftBoundary()-this._leftBoundary),c=cc.p(0,0);if(i)c.x=(s.width-r.width)*e.x-a;if(n)c.y=(s.height-r.height)*e.y-o;return c=cc.pNeg(c)},_calculateBoundary:function(){if(this.content){var t=this.node.getContentSize(),e=this._convertToContentParentSpace(cc.p(0,0));this._leftBoundary=e.x,this._bottomBoundary=e.y;var i=this._convertToContentParentSpace(cc.p(t.width,t.height));this._rightBoundary=i.x,this._topBoundary=i.y}},_convertToContentParentSpace:function(t){var e=this.node.convertToWorldSpace(t),i=this.content.parent;return i.convertToNodeSpaceAR(e)},_onTouchBegan:function(t){var e=t.touch;if(this.content)this._handlePressLogic(e);t.stopPropagation()},_cancelButtonClick:function(t){var e=t.getDelta(),i=!1;if(cc.sys.isMobile){var n=7;if(cc.pLength(e)>n)i=!0}else i=!0;return i},_onTouchMoved:function(t){var e=t.touch;if(this.content){var i=t.target.getComponent(cc.Button);if(i&&this._cancelButtonClick(e))i._cancelButtonClick();this._handleMoveLogic(e)}t.stopPropagation()},_onTouchEnded:function(t){var e=t.touch;if(this.content)this._handleReleaseLogic(e);t.stopPropagation()},_onTouchCancelled:function(t){var e=t.touch;if(this.content)this._handleReleaseLogic(e);t.stopPropagation()},_processDeltaMove:function(t){this._scrollChildren(t),this._gatherTouchMove(t)},_handleMoveLogic:function(t){var e=t.getDelta();this._processDeltaMove(e)},_scrollChildren:function(t){t=this._clampDelta(t);var e,i=t;if(this.elastic)e=this._getHowMuchOutOfBoundary(),i.x*=0===e.x?1:.5,i.y*=0===e.y?1:.5;if(!this.elastic)e=this._getHowMuchOutOfBoundary(i),i=cc.pAdd(i,e);this._moveContent(i,!1)},_handlePressLogic:function(){this._autoScrolling=!1,this._touchMovePreviousTimestamp=c(),this._touchMoveDisplacements=[],this._touchMoveTimeDeltas=[],this._onScrollBarTouchBegan()},_clampDelta:function(t){var e=this.content.getContentSize(),i=this.node.getContentSize();if(e.width<=i.width)t.x=0;if(e.height<=i.height)t.y=0;return t},_gatherTouchMove:function(t){for(t=this._clampDelta(t);this._touchMoveDisplacements.length>=n;)this._touchMoveDisplacements.shift(),this._touchMoveTimeDeltas.shift();this._touchMoveDisplacements.push(t);var e=c();this._touchMoveTimeDeltas.push((e-this._touchMovePreviousTimestamp)/1e3),this._touchMovePreviousTimestamp=e},_startBounceBackIfNeeded:function(){if(!this.elastic)return!1;var t=this._getHowMuchOutOfBoundary();if(t=this._clampDelta(t),cc.pFuzzyEqual(t,cc.p(0,0),s))return!1;var e=Math.max(this.bounceDuration,0);return this._startAutoScroll(t,e,!0),!0},_processInertiaScroll:function(){var t=this._startBounceBackIfNeeded();if(!t&&this.inertia){var e=this._calculateTouchMoveVelocity();if(!cc.pFuzzyEqual(e,cc.p(0,0),s)&&this.brake<1)this._startInertiaScroll(e)}this._onScrollBarTouchEnded()},_handleReleaseLogic:function(t){var e=t.getDelta();this._gatherTouchMove(e),this._processInertiaScroll()},_isOutOfBoundary:function(){var t=this._getHowMuchOutOfBoundary();return!cc.pFuzzyEqual(t,cc.p(0,0),s)},_isNecessaryAutoScrollBrake:function(){if(this._autoScrollBraking)return!0;if(this._isOutOfBoundary()){if(!this._autoScrollCurrentlyOutOfBoundary)return this._autoScrollCurrentlyOutOfBoundary=!0,this._autoScrollBraking=!0,this._autoScrollBrakingStartPosition=this.getContentPosition(),!0}else this._autoScrollCurrentlyOutOfBoundary=!1;return!1},_processAutoScrolling:function(t){var e=this._isNecessaryAutoScrollBrake(),i=e?r:1;this._autoScrollAccumulatedTime+=t*(1/i);var n=Math.min(1,this._autoScrollAccumulatedTime/this._autoScrollTotalTime);if(this._autoScrollAttenuate)n=a(n);var o=cc.pAdd(this._autoScrollStartPosition,cc.pMult(this._autoScrollTargetDelta,n)),c=1===n;if(this.elastic){var l=cc.pSub(o,this._autoScrollBrakingStartPosition);if(e)l=cc.pMult(l,i);o=cc.pAdd(this._autoScrollBrakingStartPosition,l)}else{var h=cc.pSub(o,this.getContentPosition()),u=this._getHowMuchOutOfBoundary(h);if(!cc.pFuzzyEqual(u,cc.p(0,0),s))o=cc.pAdd(o,u),c=!0}if(c)this._autoScrolling=!1;var d=cc.pSub(o,this.getContentPosition());this._moveContent(d,c)},_startInertiaScroll:function(t){var e=cc.pMult(t,o);this._startAttenuatingAutoScroll(e,t)},_calculateAttenuatedFactor:function(t){if(this.brake<=0)return 1-this.brake;var e=(1-this.brake)*(1/(1+14e-6*t+t*t*8e-9));return e},_startAttenuatingAutoScroll:function(t,e){var i=this._calculateAutoScrollTimeByInitalSpeed(cc.pLength(e)),n=cc.pLength(t),r=cc.pNormalize(t),s=this.content.getContentSize(),o=this.node.getContentSize(),a=s.width-o.width,c=s.height-o.height,l=this._calculateAttenuatedFactor(a),h=this._calculateAttenuatedFactor(c);r=cc.p(r.x*a*(1-this.brake)*l,r.y*c*h*(1-this.brake)),r=cc.pAdd(t,r);var u=cc.pLength(r)/n;i*=u,this._startAutoScroll(r,i,!0)},_calculateAutoScrollTimeByInitalSpeed:function(t){var e=Math.sqrt(Math.sqrt(t/5));return e},_startAutoScroll:function(t,e,i){var n=this._flattenVectorByDirection(t);this._autoScrolling=!0,this._autoScrollTargetDelta=n,this._autoScrollAttenuate=i,this._autoScrollStartPosition=this.getContentPosition(),this._autoScrollTotalTime=e,this._autoScrollAccumulatedTime=0,this._autoScrollBraking=!1,this._autoScrollBrakingStartPosition=cc.p(0,0);var r=this._getHowMuchOutOfBoundary();if(!cc.pFuzzyEqual(r,cc.p(0,0),s)){this._autoScrollCurrentlyOutOfBoundary=!0;var o=this._getHowMuchOutOfBoundary(n);if(r.x*o.x>0||r.y*o.y>0)this._autoScrollBraking=!0}},_calculateTouchMoveVelocity:function(){var t=0;if(t=this._touchMoveTimeDeltas.reduce(function(t,e){return t+e},t),0>=t||t>=.5)return cc.p(0,0);var e=cc.p(0,0);return e=this._touchMoveDisplacements.reduce(function(t,e){return cc.pAdd(t,e)},e),cc.p(e.x/t,e.y/t)},_flattenVectorByDirection:function(t){var e=t;return e.x=this.horizontal?e.x:0,e.y=this.vertical?e.y:0,e},_moveContent:function(t,e){var i=this._flattenVectorByDirection(t),n=cc.pAdd(this.getContentPosition(),i);this.setContentPosition(n);var r=this._getHowMuchOutOfBoundary();if(this._updateScrollBar(r),this.elastic&&e)this._startBounceBackIfNeeded()},_getContentLeftBoundary:function(){var t=this.getContentPosition(),e=t.x-this.content.getAnchorPoint().x*this.content.getContentSize().width;return e},_getContentRightBoundary:function(){var t=this.content.getContentSize();return this._getContentLeftBoundary()+t.width},_getContentTopBoundary:function(){var t=this.content.getContentSize();return this._getContentBottomBoundary()+t.height},_getContentBottomBoundary:function(){var t=this.getContentPosition(),e=t.y-this.content.getAnchorPoint().y*this.content.getContentSize().height;return e},_getHowMuchOutOfBoundary:function(t){if(t=t||cc.p(0,0),cc.pFuzzyEqual(t,cc.p(0,0),s)&&!this._outOfBoundaryAmountDirty)return this._outOfBoundaryAmount;var e=cc.p(0,0);if(this._getContentLeftBoundary()+t.x>this._leftBoundary)e.x=this._leftBoundary-(this._getContentLeftBoundary()+t.x);else if(this._getContentRightBoundary()+t.x<this._rightBoundary)e.x=this._rightBoundary-(this._getContentRightBoundary()+t.x);if(this._getContentTopBoundary()+t.y<this._topBoundary)e.y=this._topBoundary-(this._getContentTopBoundary()+t.y);else if(this._getContentBottomBoundary()+t.y>this._bottomBoundary)e.y=this._bottomBoundary-(this._getContentBottomBoundary()+t.y);if(cc.pFuzzyEqual(t,cc.p(0,0),s))this._outOfBoundaryAmount=e,this._outOfBoundaryAmountDirty=!1;return e=this._clampDelta(e)},_updateScrollBar:function(t){if(this.horizontalScrollBar)this.horizontalScrollBar._onScroll(t);if(this.verticalScrollBar)this.verticalScrollBar._onScroll(t)},_onScrollBarTouchBegan:function(){if(this.horizontalScrollBar)this.horizontalScrollBar._onTouchBegan();if(this.verticalScrollBar)this.verticalScrollBar._onTouchBegan()},_onScrollBarTouchEnded:function(){if(this.horizontalScrollBar)this.horizontalScrollBar._onTouchEnded();if(this.verticalScrollBar)this.verticalScrollBar._onTouchEnded()},onLoad:function(){if(1)this._registerEvent()},start:function(){this._calculateBoundary()},update:function(t){if(this._autoScrolling)this._processAutoScrolling(t)}});cc.ScrollView=e.exports=l},{"./CCComponent":52}],64:[function(t,e,i){var n=cc.Scale9Sprite.RenderingType,r=cc.Scale9Sprite.FillType,s=cc.BlendFunc.BlendFactor,o=cc.Enum({CUSTOM:0,TRIMMED:1,RAW:2}),a=cc.Class({name:"cc.Sprite","extends":t("./CCRendererUnderSG"),editor:!1,ctor:function(){this._blendFunc=new cc.BlendFunc(this._srcBlendFactor,this._dstBlendFactor)},properties:{_spriteFrame:{"default":null,type:cc.SpriteFrame},_type:n.SIMPLE,_useOriginalSize:!0,_sizeMode:-1,_fillType:0,_fillCenter:cc.v2(0,0),_fillStart:0,_fillRange:0,_isTrimmedMode:!0,_srcBlendFactor:s.SRC_ALPHA,_dstBlendFactor:s.ONE_MINUS_SRC_ALPHA,_atlas:{"default":null,type:cc.SpriteAtlas,tooltip:"i18n:COMPONENT.sprite.atlas",editorOnly:!0,visible:!0,animatable:!1},spriteFrame:{get:function(){return this._spriteFrame},set:function(t,e){var i=this._spriteFrame;this._spriteFrame=t,this._applySpriteFrame(i)},type:cc.SpriteFrame},type:{get:function(){return this._type},set:function(t){this._type=t,this._sgNode.setRenderingType(this._type),this._applyCapInset()},type:n,animatable:!1,tooltip:"i18n:COMPONENT.sprite.type"},fillType:{get:function(){return this._fillType},set:function(t){this._fillType=t,this._sgNode&&this._sgNode.setFillType(t)},type:r,tooltip:"i18n:COMPONENT.sprite.fill_type"},fillCenter:{get:function(){return this._fillCenter},set:function(t){this._fillCenter=cc.v2(t),this._sgNode&&this._sgNode.setFillCenter(this._fillCenter)},tooltip:"i18n:COMPONENT.sprite.fill_center"},fillStart:{get:function(){return this._fillStart},set:function(t){this._fillStart=cc.clampf(t,-1,1),this._sgNode&&this._sgNode.setFillStart(t)},tooltip:"i18n:COMPONENT.sprite.fill_start"},fillRange:{get:function(){return this._fillRange},set:function(t){this._fillRange=cc.clampf(t,-1,1),this._sgNode&&this._sgNode.setFillRange(t)},tooltip:"i18n:COMPONENT.sprite.fill_range"},trim:{get:function(){return this._isTrimmedMode},set:function(t){if(this._isTrimmedMode!==t)this._isTrimmedMode=t,this._sgNode.enableTrimmedContentSize(t)},animatable:!1,tooltip:"i18n:COMPONENT.sprite.trim"},srcBlendFactor:{get:function(){return this._srcBlendFactor},set:function(t){this._srcBlendFactor=t,this._blendFunc.src=t,this._sgNode.setBlendFunc(this._blendFunc)},animatable:!1,type:s,tooltip:"i18n:COMPONENT.sprite.src_blend_factor"},dstBlendFactor:{get:function(){return this._dstBlendFactor},set:function(t){this._dstBlendFactor=t,this._blendFunc.dst=t,this._sgNode.setBlendFunc(this._blendFunc)},animatable:!1,type:s,tooltip:"i18n:COMPONENT.sprite.dst_blend_factor"},useOriginalSize:{get:function(){return this._useOriginalSize},set:function(t){if(this._useOriginalSize=t,t)this._applySpriteSize()},animatable:!1,tooltip:"i18n:COMPONENT.sprite.original_size"},sizeMode:{get:function(){return this._sizeMode},set:function(t){if(this._sizeMode=t,t!==o.CUSTOM)this._applySpriteSize()},animatable:!1,type:o,tooltip:"i18n:COMPONENT.sprite.size_mode"}},statics:{FillType:r,Type:n,SizeMode:o},setVisible:function(t){this.enabled=t},getOriginalSize:function(){return this._sgNode.getOriginalSize()},setInsetLeft:function(t){this._sgNode.setInsetLeft(t)},getInsetLeft:function(){return this._sgNode.getInsetLeft()},setInsetTop:function(t){this._sgNode.setInsetTop(t)},getInsetTop:function(){return this._sgNode.getInsetTop()},setInsetRight:function(t){this._sgNode.setInsetRight(t)},getInsetRight:function(){return this._sgNode.getInsetRight()},setInsetBottom:function(t){this._sgNode.setInsetBottom(t)},getInsetBottom:function(){return this._sgNode.getInsetBottom()},onLoad:function(){this._super(),this.node.on("size-changed",this._resized,this)},onEnable:function(){if(this._sgNode)if(this._spriteFrame&&this._spriteFrame.textureLoaded())this._sgNode.setVisible(!0)},onDestroy:function(){this._super(),this.node.off("size-changed",this._resized,this)},_validateSizeMode:function(){if(-1===this._sizeMode){if(this._useOriginalSize)this._sizeMode=o.TRIMMED;else this._sizeMode=o.CUSTOM;this._isTrimmedMode=!0}},_applyAtlas:!1,_applyCapInset:function(){if(this._type===n.SLICED&&this._spriteFrame){var t=this._sgNode;t.setInsetTop(this._spriteFrame.insetTop),t.setInsetBottom(this._spriteFrame.insetBottom),t.setInsetRight(this._spriteFrame.insetRight),t.setInsetLeft(this._spriteFrame.insetLeft)}},_applySpriteSize:function(){if(o.CUSTOM===this._sizeMode||!this._spriteFrame)this.node.setContentSize(this.node.getContentSize(!0));else if(o.RAW===this._sizeMode){var t=this._spriteFrame.getOriginalSize();this.node.setContentSize(t)}else if(o.TRIMMED===this._sizeMode){var e=this._spriteFrame.getRect();this.node.setContentSize(cc.size(e.width,e.height))}else this.node.setContentSize(this.node.getContentSize(!0))},_onSpriteFrameLoaded:function(t){var e=this,i=this._sgNode;if(i.setSpriteFrame(e._spriteFrame),e._applyCapInset(),e._applySpriteSize(),e.enabledInHierarchy&&!i.isVisible())i.setVisible(!0)},_applySpriteFrame:function(t){var e=this._sgNode;if(t&&t.off)t.off("load",this._onSpriteFrameLoaded,this);if(this._spriteFrame)if(this._spriteFrame.textureLoaded())this._onSpriteFrameLoaded(null);else this._spriteFrame.once("load",this._onSpriteFrameLoaded,this);else e.setVisible(!1);if(!1)this._applyAtlas(this._spriteFrame)},_createSgNode:function(){return new cc.Scale9Sprite},_initSgNode:function(){var t=this._sgNode;this._validateSizeMode(),this._applySpriteFrame(null),t.setContentSize(this.node.getContentSize(!0)),this._applySpriteSize(),t.setRenderingType(this._type),t.setFillType(this._fillType),t.setFillCenter(this._fillCenter),t.setFillStart(this._fillStart),t.setFillRange(this._fillRange),t.enableTrimmedContentSize(this._isTrimmedMode),this._blendFunc.src=this._srcBlendFactor,this._blendFunc.dst=this._dstBlendFactor,t.setBlendFunc(this._blendFunc)},_resized:function(){if(this._spriteFrame){var t=this.node.getContentSize(),e=t.width,i=t.height;if(this._sizeMode===o.RAW){var n=this._spriteFrame.getOriginalSize();e=n.width,i=n.height}else if(this._sizeMode===o.TRIMMED){var r=this._spriteFrame.getRect();e=r.width,i=r.height}else;if(e!==t.width||i!==t.height)this._sizeMode=o.CUSTOM}}}),c=t("../utils/misc"),l=["atlas","capInsets","insetLeft","insetTop","insetRight","insetBottom"],h={type:[null,"setRenderingType"]};c.propertyDefine(a,l,h),cc.Sprite=e.exports=a},{"../utils/misc":126,"./CCRendererUnderSG":60}],65:[function(t,e,i){var n=1,r=2,s=4,o=8,a=16,c=32,l=n|s,h=o|c,u=cc.Class({name:"cc.Widget","extends":t("./CCComponent"),editor:!1,properties:{isAlignTop:{get:function(){return(this._alignFlags&n)>0},set:function(t){this._setAlign(n,t)},animatable:!1,tooltip:"i18n:COMPONENT.widget.align_top"},isAlignVerticalCenter:{get:function(){return(this._alignFlags&r)>0},set:function(t){if(t)this.isAlignTop=!1,this.isAlignBottom=!1,this._alignFlags|=r;else this._alignFlags&=~r},animatable:!1,tooltip:"i18n:COMPONENT.widget.align_v_center"},isAlignBottom:{get:function(){return(this._alignFlags&s)>0},set:function(t){this._setAlign(s,t)},animatable:!1,tooltip:"i18n:COMPONENT.widget.align_bottom"},isAlignLeft:{get:function(){return(this._alignFlags&o)>0},set:function(t){this._setAlign(o,t)},animatable:!1,tooltip:"i18n:COMPONENT.widget.align_left"},isAlignHorizontalCenter:{get:function(){return(this._alignFlags&a)>0},set:function(t){if(t)this.isAlignLeft=!1,this.isAlignRight=!1,this._alignFlags|=a;else this._alignFlags&=~a},animatable:!1,tooltip:"i18n:COMPONENT.widget.align_h_center"},isAlignRight:{get:function(){return(this._alignFlags&c)>0},set:function(t){this._setAlign(c,t)},animatable:!1,tooltip:"i18n:COMPONENT.widget.align_right"},isStretchWidth:{get:function(){return(this._alignFlags&h)===h},visible:!1},isStretchHeight:{get:function(){return(this._alignFlags&l)===l},visible:!1},top:{get:function(){return this._top},set:function(t){this._top=t},tooltip:"i18n:COMPONENT.widget.top"},bottom:{get:function(){return this._bottom},set:function(t){this._bottom=t},tooltip:"i18n:COMPONENT.widget.bottom"},left:{get:function(){return this._left},set:function(t){this._left=t},tooltip:"i18n:COMPONENT.widget.left"},right:{get:function(){return this._right},set:function(t){this._right=t},tooltip:"i18n:COMPONENT.widget.right"},isAbsoluteTop:{get:function(){return this._isAbsTop},set:function(t){this._isAbsTop=t},animatable:!1},isAbsoluteBottom:{get:function(){return this._isAbsBottom},set:function(t){this._isAbsBottom=t},animatable:!1},isAbsoluteLeft:{get:function(){return this._isAbsLeft},set:function(t){this._isAbsLeft=t},animatable:!1},isAbsoluteRight:{get:function(){return this._isAbsRight},set:function(t){this._isAbsRight=t},animatable:!1},isAlignOnce:{"default":!1,tooltip:"i18n:COMPONENT.widget.align_once",displayName:"AlignOnce"},_alignFlags:0,_left:0,_right:0,_top:0,_bottom:0,_isAbsLeft:!0,_isAbsRight:!0,_isAbsTop:!0,_isAbsBottom:!0,_originalWidth:0,_originalHeight:0},onEnable:function(){cc._widgetManager.add(this)},onDisable:function(){cc._widgetManager.remove(this)},_setAlign:function(t,e){var i=(this._alignFlags&t)>0;if(e!=i){var r=(t&h)>0;if(e){if(this._alignFlags|=t,r){if(this.isAlignHorizontalCenter=!1,this.isStretchWidth)if(this._originalWidth=this.node.width,false)_Scene.DetectConflict.checkConflict_Widget(this)}else if(this.isAlignVerticalCenter=!1,this.isStretchHeight)if(this._originalHeight=this.node.height,false)_Scene.DetectConflict.checkConflict_Widget(this);if(false){var a;if(t&n)a="top";else if(t&o)a="left";else if(t&c)a="right";else if(t&s)a="bottom";cc._widgetManager.updateOffsetsToStayPut(this,a)}}else{if(r){if(this.isStretchWidth)this.node.width=this._originalWidth}else if(this.isStretchHeight)this.node.height=this._originalHeight;this._alignFlags&=~t}}}});cc.Widget=e.exports=u},{"./CCComponent":52}],66:[function(t,e,i){t("./CCComponent"),t("./CCRendererInSG"),t("./CCRendererUnderSG"),t("./CCComponentEventHandler"),t("./missing-script"),e.exports=[t("./CCSprite"),t("./CCWidget"),t("./CCCanvas"),t("./CCAudioSource"),t("./CCAnimation"),t("./CCButton"),t("./CCLabel"),t("./CCProgressBar"),t("./CCMask"),t("./CCScrollBar"),t("./CCScrollView"),t("./CCLayout"),t("./CCEditBox")]},{"./CCAnimation":48,"./CCAudioSource":49,"./CCButton":50,"./CCCanvas":51,"./CCComponent":52,"./CCComponentEventHandler":53,"./CCEditBox":54,"./CCLabel":55,"./CCLayout":56,"./CCMask":57,"./CCProgressBar":58,"./CCRendererInSG":59,"./CCRendererUnderSG":60,"./CCScrollBar":62,"./CCScrollView":63,"./CCSprite":64,"./CCWidget":65,"./missing-script":67}],67:[function(t,e,i){var n=cc.js,r=cc.Class({name:"cc.MissingScript","extends":cc.Component,editor:{inspector:"app://editor/page/inspector/missing-script.html"},properties:{compiled:{"default":!1,serializable:!1},_$erialized:{"default":null,visible:!1,editorOnly:!0}},ctor:!1,statics:{safeFindClass:function(t){var e=n._getClassById(t);if(e)return e;if(t)return r;else return null}},onLoad:function(){cc.warn('The referenced script on "%s" is missing!',this.name)}});cc._MissingScript=e.exports=r},{}],68:[function(t,e,i){cc.EventListener=cc._Class.extend({_onEvent:null,_type:0,_listenerID:null,_registered:!1,_fixedPriority:0,_node:null,_target:null,_paused:!0,_isEnabled:!0,ctor:function(t,e,i){this._onEvent=i,this._type=t||0,this._listenerID=e||""},_setPaused:function(t){this._paused=t},_isPaused:function(){return this._paused},_setRegistered:function(t){this._registered=t},_isRegistered:function(){return this._registered},_getType:function(){return this._type},_getListenerID:function(){return this._listenerID},_setFixedPriority:function(t){this._fixedPriority=t},_getFixedPriority:function(){return this._fixedPriority},_setSceneGraphPriority:function(t){this._target=t,this._node=t},_getSceneGraphPriority:function(){return this._node},checkAvailable:function(){return null!==this._onEvent},clone:function(){return null},setEnabled:function(t){this._isEnabled=t},isEnabled:function(){return this._isEnabled},retain:function(){},release:function(){}}),cc.EventListener.UNKNOWN=0,cc.EventListener.TOUCH_ONE_BY_ONE=1,cc.EventListener.TOUCH_ALL_AT_ONCE=2,cc.EventListener.KEYBOARD=3,cc.EventListener.MOUSE=4,cc.EventListener.ACCELERATION=6,cc.EventListener.FOCUS=7,cc.EventListener.CUSTOM=8,cc._EventListenerCustom=cc.EventListener.extend({_onCustomEvent:null,ctor:function(t,e){this._onCustomEvent=e;var i=this,n=function(t){if(null!==i._onCustomEvent)i._onCustomEvent(t)};cc.EventListener.prototype.ctor.call(this,cc.EventListener.CUSTOM,t,n)},checkAvailable:function(){return cc.EventListener.prototype.checkAvailable.call(this)&&null!==this._onCustomEvent},clone:function(){return new cc._EventListenerCustom(this._listenerID,this._onCustomEvent)}}),cc._EventListenerMouse=cc.EventListener.extend({onMouseDown:null,onMouseUp:null,onMouseMove:null,onMouseScroll:null,ctor:function(){var t=this,e=function(e){var i=cc.Event.EventMouse;switch(e._eventType){case i.DOWN:if(t.onMouseDown)t.onMouseDown(e);break;case i.UP:if(t.onMouseUp)t.onMouseUp(e);break;case i.MOVE:if(t.onMouseMove)t.onMouseMove(e);break;case i.SCROLL:if(t.onMouseScroll)t.onMouseScroll(e)}};cc.EventListener.prototype.ctor.call(this,cc.EventListener.MOUSE,cc._EventListenerMouse.LISTENER_ID,e)},clone:function(){var t=new cc._EventListenerMouse;return t.onMouseDown=this.onMouseDown,t.onMouseUp=this.onMouseUp,t.onMouseMove=this.onMouseMove,t.onMouseScroll=this.onMouseScroll,t},checkAvailable:function(){return!0}}),cc._EventListenerMouse.LISTENER_ID="__cc_mouse",cc._EventListenerTouchOneByOne=cc.EventListener.extend({_claimedTouches:null,swallowTouches:!1,onTouchBegan:null,onTouchMoved:null,onTouchEnded:null,onTouchCancelled:null,ctor:function(){cc.EventListener.prototype.ctor.call(this,cc.EventListener.TOUCH_ONE_BY_ONE,cc._EventListenerTouchOneByOne.LISTENER_ID,null),this._claimedTouches=[]},setSwallowTouches:function(t){this.swallowTouches=t},isSwallowTouches:function(){return this.swallowTouches},clone:function(){var t=new cc._EventListenerTouchOneByOne;return t.onTouchBegan=this.onTouchBegan,t.onTouchMoved=this.onTouchMoved,t.onTouchEnded=this.onTouchEnded,t.onTouchCancelled=this.onTouchCancelled,t.swallowTouches=this.swallowTouches,t},checkAvailable:function(){if(!this.onTouchBegan)return cc.log(cc._LogInfos._checkEventListenerAvailable.touchOneByOne),!1;else return!0}}),cc._EventListenerTouchOneByOne.LISTENER_ID="__cc_touch_one_by_one",cc._EventListenerTouchAllAtOnce=cc.EventListener.extend({onTouchesBegan:null,onTouchesMoved:null,onTouchesEnded:null,onTouchesCancelled:null,ctor:function(){cc.EventListener.prototype.ctor.call(this,cc.EventListener.TOUCH_ALL_AT_ONCE,cc._EventListenerTouchAllAtOnce.LISTENER_ID,null)},clone:function(){var t=new cc._EventListenerTouchAllAtOnce;return t.onTouchesBegan=this.onTouchesBegan,t.onTouchesMoved=this.onTouchesMoved,t.onTouchesEnded=this.onTouchesEnded,t.onTouchesCancelled=this.onTouchesCancelled,t},checkAvailable:function(){if(null===this.onTouchesBegan&&null===this.onTouchesMoved&&null===this.onTouchesEnded&&null===this.onTouchesCancelled)return cc.log(cc._LogInfos._checkEventListenerAvailable.touchAllAtOnce),!1;else return!0}}),cc._EventListenerTouchAllAtOnce.LISTENER_ID="__cc_touch_all_at_once",cc.EventListener.create=function(t){cc.assert(t&&t.event,cc._LogInfos.EventListener.create);var e=t.event;delete t.event;var i=null;if(e===cc.EventListener.TOUCH_ONE_BY_ONE)i=new cc._EventListenerTouchOneByOne;else if(e===cc.EventListener.TOUCH_ALL_AT_ONCE)i=new cc._EventListenerTouchAllAtOnce;else if(e===cc.EventListener.MOUSE)i=new cc._EventListenerMouse;else if(e===cc.EventListener.CUSTOM)i=new cc._EventListenerCustom(t.eventName,t.callback),delete t.eventName,delete t.callback;else if(e===cc.EventListener.KEYBOARD)i=new cc._EventListenerKeyboard;else if(e===cc.EventListener.ACCELERATION)i=new cc._EventListenerAcceleration(t.callback),delete t.callback;else if(e===cc.EventListener.FOCUS)i=new cc._EventListenerFocus;for(var n in t)i[n]=t[n];return i},cc._EventListenerFocus=cc.EventListener.extend({clone:function(){var t=new cc._EventListenerFocus;return t.onFocusChanged=this.onFocusChanged,
t},checkAvailable:function(){if(!this.onFocusChanged)return cc.log("Invalid EventListenerFocus!"),!1;else return!0},onFocusChanged:null,ctor:function(){var t=function(t){if(this.onFocusChanged)this.onFocusChanged(t._widgetLoseFocus,t._widgetGetFocus)};cc.EventListener.prototype.ctor.call(this,cc.EventListener.FOCUS,cc._EventListenerFocus.LISTENER_ID,t)}}),cc._EventListenerFocus.LISTENER_ID="__cc_focus_event",cc._EventListenerAcceleration=cc.EventListener.extend({_onAccelerationEvent:null,ctor:function(t){this._onAccelerationEvent=t;var e=this,i=function(t){e._onAccelerationEvent(t._acc,t)};cc.EventListener.prototype.ctor.call(this,cc.EventListener.ACCELERATION,cc._EventListenerAcceleration.LISTENER_ID,i)},checkAvailable:function(){return cc.assert(this._onAccelerationEvent,cc._LogInfos._checkEventListenerAvailable.acceleration),!0},clone:function(){return new cc._EventListenerAcceleration(this._onAccelerationEvent)}}),cc._EventListenerAcceleration.LISTENER_ID="__cc_acceleration",cc._EventListenerKeyboard=cc.EventListener.extend({onKeyPressed:null,onKeyReleased:null,ctor:function(){var t=this,e=function(e){if(e._isPressed){if(t.onKeyPressed)t.onKeyPressed(e._keyCode,e)}else if(t.onKeyReleased)t.onKeyReleased(e._keyCode,e)};cc.EventListener.prototype.ctor.call(this,cc.EventListener.KEYBOARD,cc._EventListenerKeyboard.LISTENER_ID,e)},clone:function(){var t=new cc._EventListenerKeyboard;return t.onKeyPressed=this.onKeyPressed,t.onKeyReleased=this.onKeyReleased,t},checkAvailable:function(){if(null===this.onKeyPressed&&null===this.onKeyReleased)return cc.log(cc._LogInfos._checkEventListenerAvailable.keyboard),!1;else return!0}}),cc._EventListenerKeyboard.LISTENER_ID="__cc_keyboard"},{}],69:[function(t,e,i){var n=cc._Class.extend({_fixedListeners:null,_sceneGraphListeners:null,gt0Index:0,ctor:function(){this._fixedListeners=[],this._sceneGraphListeners=[]},size:function(){return this._fixedListeners.length+this._sceneGraphListeners.length},empty:function(){return 0===this._fixedListeners.length&&0===this._sceneGraphListeners.length},push:function(t){if(0===t._getFixedPriority())this._sceneGraphListeners.push(t);else this._fixedListeners.push(t)},clearSceneGraphListeners:function(){this._sceneGraphListeners.length=0},clearFixedListeners:function(){this._fixedListeners.length=0},clear:function(){this._sceneGraphListeners.length=0,this._fixedListeners.length=0},getFixedPriorityListeners:function(){return this._fixedListeners},getSceneGraphPriorityListeners:function(){return this._sceneGraphListeners}}),r=function(t){var e=cc.Event,i=t.getType();if(i===e.ACCELERATION)return cc._EventListenerAcceleration.LISTENER_ID;if(i===e.KEYBOARD)return cc._EventListenerKeyboard.LISTENER_ID;if(i===e.MOUSE)return cc._EventListenerMouse.LISTENER_ID;if(i===e.FOCUS)return cc._EventListenerFocus.LISTENER_ID;if(i===e.TOUCH)cc.log(cc._LogInfos._getListenerID);return i};cc.eventManager={DIRTY_NONE:0,DIRTY_FIXED_PRIORITY:1,DIRTY_SCENE_GRAPH_PRIORITY:2,DIRTY_ALL:3,_listenersMap:{},_priorityDirtyFlagMap:{},_nodeListenersMap:{},_nodePriorityMap:{},_globalZOrderNodeMap:{},_toAddedListeners:[],_dirtyNodes:[],_inDispatch:0,_isEnabled:!1,_nodePriorityIndex:0,_internalCustomListenerIDs:[cc.game.EVENT_HIDE,cc.game.EVENT_SHOW],_setDirtyForNode:function(t){if(void 0!==this._nodeListenersMap[t.__instanceId])this._dirtyNodes.push(t);if(t.getChildren)for(var e=t.getChildren(),i=0,n=e.length;n>i;i++)this._setDirtyForNode(e[i])},pauseTarget:function(t,e){var i,n,r=this._nodeListenersMap[t.__instanceId];if(r)for(i=0,n=r.length;n>i;i++)r[i]._setPaused(!0);if(e===!0){var s=t.getChildren();for(i=0,n=s.length;n>i;i++)this.pauseTarget(s[i],!0)}},resumeTarget:function(t,e){var i,n,r=this._nodeListenersMap[t.__instanceId];if(r)for(i=0,n=r.length;n>i;i++)r[i]._setPaused(!1);if(this._setDirtyForNode(t),e===!0&&t.getChildren){var s=t.getChildren();for(i=0,n=s.length;n>i;i++)this.resumeTarget(s[i],!0)}},_addListener:function(t){if(0===this._inDispatch)this._forceAddEventListener(t);else this._toAddedListeners.push(t)},_forceAddEventListener:function(t){var e=t._getListenerID(),i=this._listenersMap[e];if(!i)i=new n,this._listenersMap[e]=i;if(i.push(t),0===t._getFixedPriority()){this._setDirty(e,this.DIRTY_SCENE_GRAPH_PRIORITY);var r=t._getSceneGraphPriority();if(null===r)cc.log(cc._LogInfos.EventManager._forceAddEventListener);if(this._associateNodeAndEventListener(r,t),r.isRunning())this.resumeTarget(r)}else this._setDirty(e,this.DIRTY_FIXED_PRIORITY)},_getListeners:function(t){return this._listenersMap[t]},_updateDirtyFlagForSceneGraph:function(){if(0!==this._dirtyNodes.length){for(var t,e,i=this._dirtyNodes,n=this._nodeListenersMap,r=0,s=i.length;s>r;r++)if(t=n[i[r].__instanceId])for(var o=0,a=t.length;a>o;o++)if(e=t[o])this._setDirty(e._getListenerID(),this.DIRTY_SCENE_GRAPH_PRIORITY);this._dirtyNodes.length=0}},_removeAllListenersInVector:function(t){if(t)for(var e,i=0;i<t.length;){if(e=t[i],e._setRegistered(!1),null!=e._getSceneGraphPriority())this._dissociateNodeAndEventListener(e._getSceneGraphPriority(),e),e._setSceneGraphPriority(null);if(0===this._inDispatch)cc.js.array.remove(t,e);else++i}},_removeListenersForListenerID:function(t){var e,i=this._listenersMap[t];if(i){var n=i.getFixedPriorityListeners(),r=i.getSceneGraphPriorityListeners();if(this._removeAllListenersInVector(r),this._removeAllListenersInVector(n),delete this._priorityDirtyFlagMap[t],!this._inDispatch)i.clear(),delete this._listenersMap[t]}var s,o=this._toAddedListeners;for(e=0;e<o.length;)if(s=o[e],s&&s._getListenerID()===t)cc.js.array.remove(o,s);else++e},_sortEventListeners:function(t){var e=this.DIRTY_NONE,i=this._priorityDirtyFlagMap;if(i[t])e=i[t];if(e!==this.DIRTY_NONE){if(i[t]=this.DIRTY_NONE,e&this.DIRTY_FIXED_PRIORITY)this._sortListenersOfFixedPriority(t);if(e&this.DIRTY_SCENE_GRAPH_PRIORITY){var n=cc.director.getScene();if(n)this._sortListenersOfSceneGraphPriority(t,n)}}},_sortListenersOfSceneGraphPriority:function(t,e){var i=this._getListeners(t);if(i){var n=i.getSceneGraphPriorityListeners();if(n&&0!==n.length)this._nodePriorityIndex=0,this._nodePriorityMap={},this._visitTarget(e,!0),i.getSceneGraphPriorityListeners().sort(this._sortEventListenersOfSceneGraphPriorityDes)}},_sortEventListenersOfSceneGraphPriorityDes:function(t,e){var i=cc.eventManager._nodePriorityMap,n=t._getSceneGraphPriority(),r=e._getSceneGraphPriority();if(!e||!r||!i[r.__instanceId])return-1;else if(!t||!n||!i[n.__instanceId])return 1;return i[r.__instanceId]-i[n.__instanceId]},_sortListenersOfFixedPriority:function(t){var e=this._listenersMap[t];if(e){var i=e.getFixedPriorityListeners();if(i&&0!==i.length){i.sort(this._sortListenersOfFixedPriorityAsc);for(var n=0,r=i.length;r>n&&!(i[n]._getFixedPriority()>=0);)++n;e.gt0Index=n}}},_sortListenersOfFixedPriorityAsc:function(t,e){return t._getFixedPriority()-e._getFixedPriority()},_onUpdateListeners:function(t){var e=this._listenersMap[t];if(e){var i,n,r=e.getFixedPriorityListeners(),s=e.getSceneGraphPriorityListeners();if(s)for(i=0;i<s.length;)if(n=s[i],!n._isRegistered())cc.js.array.remove(s,n);else++i;if(r)for(i=0;i<r.length;)if(n=r[i],!n._isRegistered())cc.js.array.remove(r,n);else++i;if(s&&0===s.length)e.clearSceneGraphListeners();if(r&&0===r.length)e.clearFixedListeners()}},_updateListeners:function(t){var e=this._inDispatch;if(cc.assert(e>0,cc._LogInfos.EventManager._updateListeners),!(e>1)){if(t.getType()===cc.Event.TOUCH)this._onUpdateListeners(cc._EventListenerTouchOneByOne.LISTENER_ID),this._onUpdateListeners(cc._EventListenerTouchAllAtOnce.LISTENER_ID);else this._onUpdateListeners(r(t));cc.assert(1===e,cc._LogInfos.EventManager._updateListeners_2);var i=this._listenersMap,n=this._priorityDirtyFlagMap;for(var s in i)if(i[s].empty())delete n[s],delete i[s];var o=this._toAddedListeners;if(0!==o.length){for(var a=0,c=o.length;c>a;a++)this._forceAddEventListener(o[a]);this._toAddedListeners.length=0}}},_onTouchEventCallback:function(t,e){if(!t._isRegistered)return!1;var i=e.event,n=i.currentTouch;i.currentTarget=t._node;var r,s=!1,o=i.getEventCode(),a=cc.Event.EventTouch;if(o===a.BEGAN){if(t.onTouchBegan)if(s=t.onTouchBegan(n,i),s&&t._registered)t._claimedTouches.push(n)}else if(t._claimedTouches.length>0&&-1!==(r=t._claimedTouches.indexOf(n)))if(s=!0,o===a.MOVED&&t.onTouchMoved)t.onTouchMoved(n,i);else if(o===a.ENDED){if(t.onTouchEnded)t.onTouchEnded(n,i);if(t._registered)t._claimedTouches.splice(r,1)}else if(o===a.CANCELLED){if(t.onTouchCancelled)t.onTouchCancelled(n,i);if(t._registered)t._claimedTouches.splice(r,1)}if(i.isStopped())return cc.eventManager._updateListeners(i),!0;if(s&&t._registered&&t.swallowTouches){if(e.needsMutableSet)e.touches.splice(n,1);return!0}return!1},_dispatchTouchEvent:function(t){this._sortEventListeners(cc._EventListenerTouchOneByOne.LISTENER_ID),this._sortEventListeners(cc._EventListenerTouchAllAtOnce.LISTENER_ID);var e=this._getListeners(cc._EventListenerTouchOneByOne.LISTENER_ID),i=this._getListeners(cc._EventListenerTouchAllAtOnce.LISTENER_ID);if(null!==e||null!==i){var n=t.getTouches(),r=cc.js.array.copy(n),s={event:t,needsMutableSet:e&&i,touches:r,selTouch:null};if(e)for(var o=0;o<n.length;o++)if(t.currentTouch=n[o],this._dispatchEventToListeners(e,this._onTouchEventCallback,s),t.isStopped())return;if(i&&r.length>0)if(this._dispatchEventToListeners(i,this._onTouchesEventCallback,{event:t,touches:r}),t.isStopped())return;this._updateListeners(t)}},_onTouchesEventCallback:function(t,e){if(!t._registered)return!1;var i=cc.Event.EventTouch,n=e.event,r=e.touches,s=n.getEventCode();if(n.currentTarget=t._node,s===i.BEGAN&&t.onTouchesBegan)t.onTouchesBegan(r,n);else if(s===i.MOVED&&t.onTouchesMoved)t.onTouchesMoved(r,n);else if(s===i.ENDED&&t.onTouchesEnded)t.onTouchesEnded(r,n);else if(s===i.CANCELLED&&t.onTouchesCancelled)t.onTouchesCancelled(r,n);if(n.isStopped())return cc.eventManager._updateListeners(n),!0;else return!1},_associateNodeAndEventListener:function(t,e){var i=this._nodeListenersMap[t.__instanceId];if(!i)i=[],this._nodeListenersMap[t.__instanceId]=i;i.push(e)},_dissociateNodeAndEventListener:function(t,e){var i=this._nodeListenersMap[t.__instanceId];if(i)if(cc.js.array.remove(i,e),0===i.length)delete this._nodeListenersMap[t.__instanceId]},_dispatchEventToListeners:function(t,e,i){var n,r,s=!1,o=t.getFixedPriorityListeners(),a=t.getSceneGraphPriorityListeners(),c=0;if(o)if(0!==o.length)for(;c<t.gt0Index;++c)if(r=o[c],r.isEnabled()&&!r._isPaused()&&r._isRegistered()&&e(r,i)){s=!0;break}if(a&&!s)for(n=0;n<a.length;n++)if(r=a[n],r.isEnabled()&&!r._isPaused()&&r._isRegistered()&&e(r,i)){s=!0;break}if(o&&!s)for(;c<o.length;++c)if(r=o[c],r.isEnabled()&&!r._isPaused()&&r._isRegistered()&&e(r,i)){s=!0;break}},_setDirty:function(t,e){var i=this._priorityDirtyFlagMap;if(null==i[t])i[t]=e;else i[t]=e|i[t]},_visitTarget:function(t,e){var i=t.getChildren(),n=0,r=i.length,s=this._globalZOrderNodeMap,o=this._nodeListenersMap;if(r>0){for(var a;r>n&&(a=i[n],a&&a.getLocalZOrder()<0);n++)this._visitTarget(a,!1);if(void 0!==o[t.__instanceId]){if(!s[t.getGlobalZOrder()])s[t.getGlobalZOrder()]=[];s[t.getGlobalZOrder()].push(t.__instanceId)}for(;r>n;n++)if(a=i[n])this._visitTarget(a,!1)}else if(void 0!==o[t.__instanceId]){if(!s[t.getGlobalZOrder()])s[t.getGlobalZOrder()]=[];s[t.getGlobalZOrder()].push(t.__instanceId)}if(e){var c=[];for(var l in s)c.push(l);c.sort(this._sortNumberAsc);var h,u,d=c.length,f=this._nodePriorityMap;for(n=0;d>n;n++)for(h=s[c[n]],u=0;u<h.length;u++)f[h[u]]=++this._nodePriorityIndex;this._globalZOrderNodeMap={}}},_sortNumberAsc:function(t,e){return t-e},addListener:function(t,e){if(cc.assert(t&&e,cc._LogInfos.EventManager.addListener_2),!(t instanceof cc.EventListener))cc.assert(!cc.js.isNumber(e),cc._LogInfos.EventManager.addListener_3),t=cc.EventListener.create(t);else if(t._isRegistered())return void cc.log(cc._LogInfos.EventManager.addListener_4);if(t.checkAvailable()){if(cc.js.isNumber(e)){if(0===e)return void cc.log(cc._LogInfos.EventManager.addListener);t._setSceneGraphPriority(null),t._setFixedPriority(e),t._setRegistered(!0),t._setPaused(!1),this._addListener(t)}else t._setSceneGraphPriority(e),t._setFixedPriority(0),t._setRegistered(!0),this._addListener(t);return t}},addCustomListener:function(t,e){var i=new cc._EventListenerCustom(t,e);return this.addListener(i,1),i},removeListener:function(t){if(null!=t){var e,i=this._listenersMap;for(var n in i){var r=i[n],s=r.getFixedPriorityListeners(),o=r.getSceneGraphPriorityListeners();if(e=this._removeListenerInVector(o,t))this._setDirty(t._getListenerID(),this.DIRTY_SCENE_GRAPH_PRIORITY);else if(e=this._removeListenerInVector(s,t))this._setDirty(t._getListenerID(),this.DIRTY_FIXED_PRIORITY);if(r.empty())delete this._priorityDirtyFlagMap[t._getListenerID()],delete i[n];if(e)break}if(!e)for(var a=this._toAddedListeners,c=0,l=a.length;l>c;c++){var h=a[c];if(h===t){cc.js.array.remove(a,h),h._setRegistered(!1);break}}}},_removeListenerInCallback:function(t,e){if(null==t)return!1;for(var i=0,n=t.length;n>i;i++){var r=t[i];if(r._onCustomEvent===e||r._onEvent===e){if(r._setRegistered(!1),null!=r._getSceneGraphPriority())this._dissociateNodeAndEventListener(r._getSceneGraphPriority(),r),r._setSceneGraphPriority(null);if(0===this._inDispatch)cc.js.array.remove(t,r);return!0}}return!1},_removeListenerInVector:function(t,e){if(null==t)return!1;for(var i=0,n=t.length;n>i;i++){var r=t[i];if(r===e){if(r._setRegistered(!1),null!=r._getSceneGraphPriority())this._dissociateNodeAndEventListener(r._getSceneGraphPriority(),r),r._setSceneGraphPriority(null);if(0===this._inDispatch)cc.js.array.remove(t,r);return!0}}return!1},removeListeners:function(t,e){var i,n=this;if(void 0!==t.__instanceId){delete n._nodePriorityMap[t.__instanceId],cc.js.array.remove(n._dirtyNodes,t);var i,r=n._nodeListenersMap[t.__instanceId];if(r){var s=cc.js.array.copy(r);for(i=0;i<s.length;i++)n.removeListener(s[i]);delete n._nodeListenersMap[t.__instanceId]}var o=n._toAddedListeners;for(i=0;i<o.length;){var a=o[i];if(a._getSceneGraphPriority()===t)a._setSceneGraphPriority(null),a._setRegistered(!1),o.splice(i,1);else++i}if(e===!0){var c,l=t.getChildren();for(i=0,c=l.length;c>i;i++)n.removeListeners(l[i],!0)}}else if(t===cc.EventListener.TOUCH_ONE_BY_ONE)n._removeListenersForListenerID(cc._EventListenerTouchOneByOne.LISTENER_ID);else if(t===cc.EventListener.TOUCH_ALL_AT_ONCE)n._removeListenersForListenerID(cc._EventListenerTouchAllAtOnce.LISTENER_ID);else if(t===cc.EventListener.MOUSE)n._removeListenersForListenerID(cc._EventListenerMouse.LISTENER_ID);else if(t===cc.EventListener.ACCELERATION)n._removeListenersForListenerID(cc._EventListenerAcceleration.LISTENER_ID);else if(t===cc.EventListener.KEYBOARD)n._removeListenersForListenerID(cc._EventListenerKeyboard.LISTENER_ID);else cc.log(cc._LogInfos.EventManager.removeListeners)},removeCustomListeners:function(t){this._removeListenersForListenerID(t)},removeAllListeners:function(){var t=this._listenersMap,e=this._internalCustomListenerIDs;for(var i in t)if(-1===e.indexOf(i))this._removeListenersForListenerID(i)},setPriority:function(t,e){if(null!=t){var i=this._listenersMap;for(var n in i){var r=i[n],s=r.getFixedPriorityListeners();if(s){var o=s.indexOf(t);if(-1!==o){if(null!=t._getSceneGraphPriority())cc.log(cc._LogInfos.EventManager.setPriority);if(t._getFixedPriority()!==e)t._setFixedPriority(e),this._setDirty(t._getListenerID(),this.DIRTY_FIXED_PRIORITY);return}}}}},setEnabled:function(t){this._isEnabled=t},isEnabled:function(){return this._isEnabled},dispatchEvent:function(t){if(this._isEnabled){if(this._updateDirtyFlagForSceneGraph(),this._inDispatch++,!t||!t.getType)throw new Error("event is undefined");if(t.getType()===cc.Event.TOUCH)return this._dispatchTouchEvent(t),void this._inDispatch--;var e=r(t);this._sortEventListeners(e);var i=this._listenersMap[e];if(null!=i)this._dispatchEventToListeners(i,this._onListenerCallback,t);this._updateListeners(t),this._inDispatch--}},_onListenerCallback:function(t,e){return e.currentTarget=t._target,t._onEvent(e),e.isStopped()},dispatchCustomEvent:function(t,e){var i=new cc.Event.EventCustom(t);i.setUserData(e),this.dispatchEvent(i)}}},{}],70:[function(t,e,i){var n=cc.js,r=cc.Event;cc.Event.TOUCH="touch",cc.Event.MOUSE="mouse",cc.Event.KEYBOARD="keyboard",cc.Event.ACCELERATION="acceleration";var s=function(t,e){cc.Event.call(this,cc.Event.MOUSE,e),this._eventType=t,this._button=0,this._x=0,this._y=0,this._prevX=0,this._prevY=0,this._scrollX=0,this._scrollY=0};n.extend(s,cc.Event),n.mixin(s.prototype,{setScrollData:function(t,e){this._scrollX=t,this._scrollY=e},getScrollX:function(){return this._scrollX},getScrollY:function(){return this._scrollY},setLocation:function(t,e){this._x=t,this._y=e},getLocation:function(){return{x:this._x,y:this._y}},getLocationInView:function(){return{x:this._x,y:cc.view._designResolutionSize.height-this._y}},_setPrevCursor:function(t,e){this._prevX=t,this._prevY=e},getPreviousLocation:function(){return{x:this._prevX,y:this._prevY}},getDelta:function(){return{x:this._x-this._prevX,y:this._y-this._prevY}},getDeltaX:function(){return this._x-this._prevX},getDeltaY:function(){return this._y-this._prevY},setButton:function(t){this._button=t},getButton:function(){return this._button},getLocationX:function(){return this._x},getLocationY:function(){return this._y}}),s.NONE=0,s.DOWN=1,s.UP=2,s.MOVE=3,s.SCROLL=4,s.BUTTON_LEFT=0,s.BUTTON_RIGHT=2,s.BUTTON_MIDDLE=1,s.BUTTON_4=3,s.BUTTON_5=4,s.BUTTON_6=5,s.BUTTON_7=6,s.BUTTON_8=7;var o=function(t,e){cc.Event.call(this,cc.Event.TOUCH,e),this._eventCode=0,this._touches=t||[],this.currentTouch=null};n.extend(o,cc.Event),n.mixin(o.prototype,{getEventCode:function(){return this._eventCode},getTouches:function(){return this._touches},_setEventCode:function(t){this._eventCode=t},_setTouches:function(t){this._touches=t},setLocation:function(t,e){this.touch&&this.touch.setTouchInfo(this.touch.getID(),t,e)},getLocation:function(){return this.touch?this.touch.getLocation():cc.v2()},getLocationInView:function(){return this.touch?this.touch.getLocationInView():cc.v2()},getPreviousLocation:function(){return this.touch?this.touch.getPreviousLocation():cc.v2()},getStartLocation:function(){return this.touch?this.touch.getStartLocation():cc.v2()},getID:function(){return this.touch?this.getID():null},getDelta:function(){return this.touch?this.touch.getDelta():cc.v2()},getDeltaX:function(){return this.touch?this.touch.getDelta().x:0},getDeltaY:function(){return this.touch?this.touch.getDelta().y:0},getLocationX:function(){return this.touch?this.touch.getLocationX():0},getLocationY:function(){return this.touch?this.touch.getLocationY():0}}),o.MAX_TOUCHES=5,o.BEGAN=0,o.MOVED=1,o.ENDED=2,o.CANCELED=3,EventAcceleration=function(t,e){cc.Event.call(this,r.ACCELERATION,e),this._acc=t},n.extend(EventAcceleration,cc.Event),EventKeyboard=function(t,e,i){cc.Event.call(this,r.KEYBOARD,i),this._keyCode=t,this._isPressed=e},n.extend(EventKeyboard,cc.Event),cc.Event.EventMouse=s,cc.Event.EventTouch=o,cc.Event.EventAcceleration=EventAcceleration,cc.Event.EventKeyboard=EventKeyboard,e.exports=r},{}],71:[function(t,e,i){cc.Touch=cc._Class.extend({_point:null,_prevPoint:null,_id:0,_startPointCaptured:!1,_startPoint:null,ctor:function(t,e,i){this.setTouchInfo(i,t,e)},getLocation:function(){return{x:this._point.x,y:this._point.y}},getLocationX:function(){return this._point.x},getLocationY:function(){return this._point.y},getPreviousLocation:function(){return{x:this._prevPoint.x,y:this._prevPoint.y}},getStartLocation:function(){return{x:this._startPoint.x,y:this._startPoint.y}},getDelta:function(){return cc.pSub(this._point,this._prevPoint)},getLocationInView:function(){return{x:this._point.x,y:cc.view._designResolutionSize.height-this._point.y}},getPreviousLocationInView:function(){return{x:this._prevPoint.x,y:cc.view._designResolutionSize.height-this._prevPoint.y}},getStartLocationInView:function(){return{x:this._startPoint.x,y:cc.view._designResolutionSize.height-this._startPoint.y}},getID:function(){return this._id},setTouchInfo:function(t,e,i){if(this._prevPoint=this._point,this._point=cc.p(e||0,i||0),this._id=t,!this._startPointCaptured)this._startPoint=cc.p(this._point),this._startPointCaptured=!0},_setPoint:function(t,e){if(void 0===e)this._point.x=t.x,this._point.y=t.y;else this._point.x=t,this._point.y=e},_setPrevPoint:function(t,e){if(void 0===e)this._prevPoint=cc.p(t.x,t.y);else this._prevPoint=cc.p(t||0,e||0)}})},{}],72:[function(t,e,i){t("./CCTouch"),t("./CCSystemEvent"),t("./CCEventListener"),t("./CCEventManager")},{"./CCEventListener":68,"./CCEventManager":69,"./CCSystemEvent":70,"./CCTouch":71}],73:[function(t,e,i){function n(){s.call(this),this._invoking={},this._toRemove={},this._toRemoveAll=null}var r=cc.js,s=t("../platform/callbacks-invoker").CallbacksHandler;r.extend(n,s),n.prototype.invoke=function(t){var e,i,n,r,s,o=t.type,a=this._callbackTable[o];if(this._invoking[o]=!0,a)if(1===a.length)a[0].call(t.currentTarget,t);else for(i=a.length-1,e=0;i>=e;){n=a[e],r=a[e+1],s=r&&"object"==typeof r;var c;if(s)n.call(r,t),c=2;else n.call(t.currentTarget,t),c=1;if(t._propagationImmediateStopped||e+c>i)break;e+=c}this._invoking[o]=!1;var l=this._toRemove[o];if(l){for(e=0;e<l.length;++e){var h=l[e];this.remove(o,h[0],h[1])}delete this._toRemove[o]}if(this._toRemoveAll)this.removeAll(this._toRemoveAll),this._toRemoveAll=null},e.exports=n},{"../platform/callbacks-invoker":100}],74:[function(t,e,i){var n=t("./event-listeners");t("./event");var r=cc.js,s=new Array(16);s.length=0;var o=function(t,e){var i,n;for(e.target=t,t._getCapturingTargets(e.type,s),e.eventPhase=1,n=s.length-1;n>=0;--n)if(i=s[n],i._isTargetActive(e.type)&&i._capturingListeners)if(e.currentTarget=i,i._capturingListeners.invoke(e),e._propagationStopped)return;if(s.length=0,t._isTargetActive(e.type))if(a(t,e),e._propagationStopped)return;if(e.bubbles)for(t._getBubblingTargets(e.type,s),e.eventPhase=3,n=0;n<s.length;++n)if(i=s[n],i._isTargetActive(e.type)&&i._bubblingListeners)if(e.currentTarget=i,i._bubblingListeners.invoke(e),e._propagationStopped)return;s.length=0},a=function(t,e){if(e.eventPhase=2,e.currentTarget=t,t._capturingListeners)if(t._capturingListeners.invoke(e),e._propagationStopped)return;if(t._bubblingListeners)t._bubblingListeners.invoke(e)},c=function(){this._capturingListeners=null,this._bubblingListeners=null};r.mixin(c.prototype,{hasEventListener:function(t){if(this._bubblingListeners&&this._bubblingListeners.has(t))return!0;if(this._capturingListeners&&this._capturingListeners.has(t))return!0;else return!1},on:function(t,e,i,r){if("boolean"==typeof i)r=i,i=void 0;else r=!!r;if(!e)return void cc.error("Callback of event must be non-nil");var s=null;if(r)s=this._capturingListeners=this._capturingListeners||new n;else s=this._bubblingListeners=this._bubblingListeners||new n;if(!s.has(t,e,i))if(s.add(t,e,i),i&&i.__eventTargets)i.__eventTargets.push(this);return e},off:function(t,e,i,n){if("boolean"==typeof i)n=i,i=void 0;else n=!!n;if(e){var r=n?this._capturingListeners:this._bubblingListeners;if(r)if(r.remove(t,e,i),i&&i.__eventTargets){var s=i.__eventTargets.indexOf(this);i.__eventTargets.splice(s,1)}}},targetOff:function(t){if(this._capturingListeners)this._capturingListeners.removeAll(t);if(this._bubblingListeners)this._bubblingListeners.removeAll(t)},once:function(t,e,i,n){var r=this,s=function(o){r.off(t,s,i,n),e.call(this,o)};this.on(t,s,i,n)},dispatchEvent:function(t){o(this,t),s.length=0;var e=!t._defaultPrevented;return e},emit:function(t,e){if("string"==typeof t){var i=new cc.Event.EventCustom(t);i.detail=e,a(this,i)}else cc.error("The message must be provided")},_isTargetActive:function(t){return!0},_getCapturingTargets:function(t,e){},_getBubblingTargets:function(t,e){}}),cc.EventTarget=e.exports=c},{"./event":75,"./event-listeners":73}],75:[function(t,e,i){var n=t("../platform/js");cc.Event=function(t,e){this.type=t,this.bubbles=e||!1,this.target=null,this.currentTarget=null,this.eventPhase=0,this._defaultPrevented=!1,this._propagationStopped=!1,this._propagationImmediateStopped=!1},cc.Event.prototype={constructor:cc.Event,unuse:function(){this.type=cc.Event.NO_TYPE,this.target=null,this.currentTarget=null,this.eventPhase=cc.Event.NONE,this._defaultPrevented=!1,this._propagationStopped=!1,this._propagationImmediateStopped=!1},reuse:function(t,e){this.type=t,this.bubbles=e||!1},preventDefault:function(){this._defaultPrevented=!0},stopPropagation:function(){this._propagationStopped=!0},stopPropagationImmediate:function(){this._propagationImmediateStopped=!0},isStopped:function(){return this._propagationStopped||this._propagationImmediateStopped},getCurrentTarget:function(){return this.currentTarget},getType:function(){return this.type}},cc.Event.NO_TYPE="no_type",cc.Event.NONE=0,cc.Event.CAPTURING_PHASE=1,cc.Event.AT_TARGET=2,cc.Event.BUBBLING_PHASE=3;var r=function(t,e){cc.Event.call(this,t,e),this.detail=null};n.extend(r,cc.Event),n.mixin(r.prototype,{setUserData:function(t){this.detail=t},getUserData:function(){return this.detail},getEventName:cc.Event.prototype.getType}),cc.Event.EventCustom=r,e.exports=cc.Event},{"../platform/js":105}],76:[function(t,e,i){t("./event.js"),t("./event-listeners.js"),t("./event-target.js")},{"./event-listeners.js":73,"./event-target.js":74,"./event.js":75}],77:[function(t,e,i){if(t("./platform"),t("./assets"),true){if(1)t("./sprites/CCSpriteFrameCache");t("./CCNode"),t("./CCScene"),t("./components")}t("./base-ui/CCWidgetManager")},{"./CCNode":33,"./CCScene":34,"./assets":46,"./base-ui/CCWidgetManager":47,"./components":66,"./platform":103,"./sprites/CCSpriteFrameCache":116}],78:[function(t,e,i){var n=t("../platform/js"),r=t("./pipeline"),s=t("./downloader"),o=t("./loader"),a=t("./asset-table"),c=t("../platform/utils").callInNextTick,l=new s,h=new o,u=new a;cc.loader=new r([l,h]),n.mixin(cc.loader,{downloader:l,loader:h,getXMLHttpRequest:r.getXMLHttpRequest,addDownloadHandlers:function(t){l.addHandlers(t)},addLoadHandlers:function(t){h.addHandlers(t)},load:function(t,e,i){function n(t){if(a[t.id]=t,t.error)o=o||[],o.push(t.id);h++,e&&e.call(r,h,l,t);for(var n in a)if(!a[n])return;if(i)if(s)i.call(r,t.error,t.content);else i.call(r,o,r._items);i=null}if("string"==typeof t&&t.startsWith("resources://"))return cc.warn('Sorry, the "resources://" protocol is obsoleted, use cc.loader.loadRes instead please.'),void this.loadRes(t.slice("resources://".length),e,i);if(void 0===i)i=e,e=null;var r=this,s=!1;if(!(t instanceof Array))t=t?[t]:[],s=!0;if(0!==t.length){for(var o=null,a={},l=0,h=0,u=0;u<t.length;++u){var d=t[u].id||t[u];if("string"==typeof d){var f=this._items.map[d];if(!f||f&&!f.complete)this._items.addListener(d,n),a[d]=null,l++;else if(f&&f.complete)a[d]=f,l++,h++}else;}if(l===h){var _=t[0].id||t[0],p=this._items.map[_];if(i)c(function(){if(s)i.call(r,p.error,p.content);else i.call(r,null,r._items);i=null})}else this.flowIn(t)}else if(i)c(function(){i.call(r,null,r._items),i=null})},_resources:u,_getResUuid:function(t){t=cc.url.normalize(t);var e=u.getUuid(t);if(!e){var i=cc.path.extname(t);if(i)t=t.slice(0,-i.length),e=u.getUuid(t)}return e},loadRes:function(t,e){var i=this._getResUuid(t);if(i)this.load({id:i,type:"uuid",uuid:i},e);else c(function(){e.call(null,new Error('Resources url "'+t+'" does not exist.'),null)})},getRes:function(t){return this._items.getContent(t)},getResCount:function(){return this._items.totalCount},release:function(t){this.removeItem(t)},releaseAsset:function(t){var e=t._uuid;if(e)this.removeItem(e)},releaseRes:function(t){var e=this._getResUuid(t);if(e)this.removeItem(e);else cc.error('Resources url "%s" does not exist.',t)},releaseAll:function(){this.clear()}}),e.exports=cc.loader},{"../platform/js":105,"../platform/utils":111,"./asset-table":79,"./downloader":81,"./loader":83,"./pipeline":85}],79:[function(t,e,i){function n(t){if(46===t.charCodeAt(0)&&47===t.charCodeAt(1))t=t.slice(2);else if(47===t.charCodeAt(0))t=t.slice(1);return t}function r(){this._pathToUuid={}}var s=(t("./../platform/utils").callInNextTick,"**/*");r._hasWildcard=function(t){return t.endsWith(s)},cc.js.mixin(r.prototype,{getUuid:function(t){if(t=n(t),!t)return"";var e=this._pathToUuid[t];if(e)return e;else if(r._hasWildcard(t)){var i=[],o=t.slice(0,-s.length);for(var a in this._pathToUuid)if(a.startsWith(o)){var e=this._pathToUuid[a];i.push(e)}return i}else return""},getAllPaths:function(){return Object.keys(this._pathToUuid)},add:function(t,e){this._pathToUuid[t]=e},_removeByPath:function(t){delete this._pathToUuid[t]}}),e.exports=r},{"./../platform/utils":111}],80:[function(t,e,i){function n(t,e,i,r){if(0===e.length){var o="can not found the resource of audio! Last match url is : ";return o+=t.replace(/\.(.*)?$/,"("),l.forEach(function(t){o+=t+"|"}),o=o.replace(/\|$/,")"),r({status:520,errorMessage:o},null)}if(t=s.changeExtname(t,e.splice(0,1)),c.WEB_AUDIO){if(c.webAudioCallback)c.webAudioCallback(t);var u=a.getXMLHttpRequest();u.open("GET",t,!0),u.responseType="arraybuffer",u.onload=function(){h.decodeAudioData(u.response,function(t){i.setBuffer(t),r(null,i.src)},function(){n(t,e,i,r)})},u.onerror=function(){r({status:520,errorMessage:o},null)},u.send()}else{var d=document.createElement("audio"),f=!1,_=!1,p=setTimeout(function(){if(0===d.readyState)v();else _=!0,d.pause(),document.body.removeChild(d),r("Audio load timeout : "+t,null)},8e3),g=function(){if(!f){try{d.currentTime=0,d.volume=1}catch(e){}document.body.removeChild(d),i.setElement(d),d.removeEventListener("canplaythrough",g,!1),d.removeEventListener("error",m,!1),d.removeEventListener("emptied",v,!1),!_&&r(null,t),f=!0,clearTimeout(p)}},m=function(){if(f)document.body.removeChild(d),d.removeEventListener("canplaythrough",g,!1),d.removeEventListener("error",m,!1),d.removeEventListener("emptied",v,!1),!_&&n(t,e,i,r),f=!0,clearTimeout(p)},v=function(){_=!0,g(),r(null,t)};if(d.addEventListener("canplaythrough",g,!1),d.addEventListener("error",m,!1),c.USE_EMPTIED_EVENT)d.addEventListener("emptied",v,!1);document.body.appendChild(d),d.src=t,d.volume=0}}function r(t,e){if(0===l.length)return e(new Error("Audio Downloader: audio not supported on this browser!"));var i,r,o=t.url,a=s.extname(o),u=[a];for(i=0;i<l.length;i++)if(a!==l[i])u.push(l[i]);if(c.WEB_AUDIO)try{var d=h.createGain();if(d.gain.value=1,d.connect(h.destination),r=new cc.Audio(h,d,o),c.NEED_MANUAL_LOOP)r._manualLoop=!0}catch(f){c.WEB_AUDIO=!1,cc.warn("The current browser don't support web audio"),r=new cc.Audio(null,null,o)}else r=new cc.Audio(null,null,o);t.content=o,t.audio=r,n(o,u,r,e)}var s=t("../utils/CCPath"),o=t("../platform/CCSys"),a=t("./pipeline");t("../../audio/CCAudio");var c=o.__audioSupport,l=c.format,h=c.context;e.exports=r},{"../../audio/CCAudio":22,"../platform/CCSys":95,"../utils/CCPath":121,"./pipeline":85}],81:[function(t,e,i){function n(t){if(cc.game.config.noCache&&"string"==typeof t)if(_.test(t))t+="&_t="+(new Date-0);else t+="?_t="+(new Date-0);return t}function r(t,e,i){function r(){c.parentNode.removeChild(c),c.removeEventListener("load",r,!1),c.removeEventListener("error",s,!1),e(null,o)}function s(){c.parentNode.removeChild(c),c.removeEventListener("load",r,!1),c.removeEventListener("error",s,!1),e(new Error("Load "+o+" failed!"),o)}var o=t.url,a=document,c=document.createElement("script");c.async=i,c.src=n(o),c.addEventListener("load",r,!1),c.addEventListener("error",s,!1),a.body.appendChild(c)}function s(t,e){var i=t.url,r=f.getXMLHttpRequest(),s="Load "+i+" failed!",o=window.navigator;if(i=n(i),r.open("GET",i,!0),/msie/i.test(o.userAgent)&&!/opera/i.test(o.userAgent))r.setRequestHeader("Accept-Charset","utf-8"),r.onreadystatechange=function(){if(4===r.readyState)if(200===r.status||0===r.status)e(null,r.responseText);else e({status:r.status,errorMessage:s})};else{if(r.overrideMimeType)r.overrideMimeType("text/plain; charset=utf-8");r.onload=function(){if(4===r.readyState)if(200===r.status||0===r.status)e(null,r.responseText);else e({status:r.status,errorMessage:s})},
r.onerror=function(){e({status:r.status,errorMessage:s})}}r.send(null)}function o(t,e,i){function r(){if(c.removeEventListener("load",r),c.removeEventListener("error",s),e)e(null,c)}function s(){if(c.removeEventListener("load",r),c.removeEventListener("error",s),c.crossOrigin&&"anonymous"===c.crossOrigin.toLowerCase())o(a,e,!1);else e("Load image ("+a+") failed")}if(void 0===i)i=!0;var a=n(t.url),c=new Image;if(i&&"file://"!==window.location.origin)c.crossOrigin="anonymous";if(c.complete&&c.naturalWidth>0)e(null,c);else c.addEventListener("load",r),c.addEventListener("error",s);c.src=a}function a(t,e,i){var n=document,r=cc.path,s=document.createElement("style");s.type="text/css",n.body.appendChild(s);var o="";if(isNaN(t-0))o+="@font-face { font-family:"+t+"; src:";else o+="@font-face { font-family:'"+t+"'; src:";if(e instanceof Array)for(var a=0,c=e.length;c>a;a++){var l=e[a];i=r.extname(l).toLowerCase(),o+="url('"+e[a]+"') format('"+p[i]+"')",o+=a===c-1?";":","}else i=i.toLowerCase(),o+="url('"+e+"') format('"+p[i]+"');";s.textContent+=o+"}";var h=document.createElement("div"),u=h.style;u.fontFamily=t,h.innerHTML=".",u.position="absolute",u.left="-100px",u.top="-100px",n.body.appendChild(h)}function c(t,e){var i=t.url,n=t.type,r=t.name,s=t.srcs;if(r&&s){if(-1===s.indexOf(i))s.push(i);a(r,s)}else n=cc.path.extname(i),r=cc.path.basename(i,n),a(r,i,n);if(document.fonts)document.fonts.load("1em "+r).then(function(){e(null,null)},function(t){e(t)});else e(null,null)}function l(t,e){var i=t.id,n=this;cc.AssetLibrary.queryAssetInfo(i,function(r,s,o){if(r)e(r);else if(t.url=s,t.isRawAsset=o,o){var a=d.extname(s).toLowerCase();if(!a)return void e(new Error("Download Uuid: can not find type of raw asset["+i+"]: "+s));a=a.substr(1);var c=n.extMap[a]||n.extMap["default"];t.type=a,c(t,e)}else n.extMap.json(t,e)})}var h,u=t("../platform/js"),d=t("../utils/CCPath"),f=t("./pipeline");if(true)h=t("./audio-downloader");else h=null;var _=/\?/,p={".eot":"embedded-opentype",".ttf":"truetype",".ttc":"truetype",".woff":"woff",".svg":"svg"},g={js:r,png:o,jpg:o,bmp:o,jpeg:o,gif:o,ico:o,tiff:o,webp:o,image:o,mp3:h,ogg:h,wav:h,mp4:h,m4a:h,txt:s,xml:s,vsh:s,fsh:s,atlas:s,tmx:s,tsx:s,json:s,ExportJson:s,plist:s,fnt:s,font:c,eot:c,ttf:c,woff:c,svg:c,ttc:c,uuid:l,prefab:l,fire:l,scene:l,"default":s},m="Downloader",v=function(t){this.id=m,this.async=!0,this.pipeline=null,this.maxConcurrent=2,this._curConcurrent=0,this._loadQueue=[],this.extMap=u.mixin(t,g)};v.ID=m,u.mixin(v.prototype,{addHandlers:function(t){this.extMap=u.mixin(this.extMap,t)},handle:function(t,e){var i=this,n=this.extMap[t.type]||this.extMap["default"];if(this._curConcurrent<this.maxConcurrent){if(cc.sys.isMobile)this._curConcurrent++;n.call(this,t,function(t,n){if(cc.sys.isMobile)for(i._curConcurrent=Math.max(0,i._curConcurrent-1);i._curConcurrent<i.maxConcurrent;){var r=i._loadQueue.shift();if(!r)break;i.handle(r.item,r.callback)}e&&e(t,n)})}else this._loadQueue.push({item:t,callback:e})}}),f.Downloader=e.exports=v},{"../platform/js":105,"../utils/CCPath":121,"./audio-downloader":80,"./pipeline":85}],82:[function(t,e,i){t("./downloader"),t("./loader"),t("./loading-items"),t("./pipeline"),t("./CCLoader")},{"./CCLoader":78,"./downloader":81,"./loader":83,"./loading-items":84,"./pipeline":85}],83:[function(t,e,i){function n(t,e){e(null,null)}function r(t,e){if("string"!=typeof t.content)e(new Error("JSON Loader: Input item doesn't contain string content"));try{var i=JSON.parse(t.content);e(null,i)}catch(n){e(new Error("JSON Loader: Parse json ["+t.id+"] failed : "+n))}}function s(t,e){if(!(t.content instanceof Image))e(new Error("Image Loader: Input item doesn't contain Image content"));var i=t.url,n=cc.textureCache.getTextureForKey(i)||new u;n.url=i,n.initWithElement(t.content),n.handleLoadedTexture(),cc.textureCache.cacheImage(i,n),e(null,n)}function o(t,e){if("string"!=typeof t.content)e(new Error("Plist Loader: Input item doesn't contain string content"));var i=cc.plistParser.parse(t.content);if(i)e(null,i);else e(new Error("Plist Loader: Parse ["+t.id+"] failed"))}function a(t){var e=t.match(f.ITEM_EXP),i={};if(e)for(var n=0,r=e.length;r>n;n++){var s=e[n],o=s.indexOf("="),a=s.substring(0,o),c=s.substring(o+1);if(c.match(f.INT_EXP))c=parseInt(c);else if('"'===c[0])c=c.substring(1,c.length-1);i[a]=c}return i}function c(t,e){var i,n,r=t.content,s=t.url,o={},c=a(r.match(f.INFO_EXP)[0]),l=c.padding.split(","),h=({left:parseInt(l[0]),top:parseInt(l[1]),right:parseInt(l[2]),bottom:parseInt(l[3])},a(r.match(f.COMMON_EXP)[0]));if(o.commonHeight=h.lineHeight,o.fontSize=c.size,cc._renderType===cc.game.RENDER_TYPE_WEBGL){var u=cc.configuration.getMaxTextureSize();if(h.scaleW>u.width||h.scaleH>u.height)cc.log("cc.LabelBMFont._parseCommonArguments(): page can't be larger than supported")}if(1!==h.pages)cc.log("cc.LabelBMFont._parseCommonArguments(): only supports 1 page");var d=a(r.match(f.PAGE_EXP)[0]);if(0!==d.id)cc.log("cc.LabelBMFont._parseImageFileName() : file could not be found");o.atlasName=cc.path.changeBasename(s,d.file);var _=r.match(f.CHAR_EXP),p=o.fontDefDictionary={};for(i=0,n=_.length;n>i;i++){var g=a(_[i]),m=g.id;p[m]={rect:{x:g.x,y:g.y,width:g.width,height:g.height},xOffset:g.xoffset,yOffset:g.yoffset,xAdvance:g.xadvance}}var v=o.kerningDict={},y=r.match(f.KERNING_EXP);if(y)for(i=0,n=y.length;n>i;i++){var T=a(y[i]);v[T.first<<16|65535&T.second]=T.amount}e(null,o)}var l=t("../platform/js"),h=t("./pipeline"),u=t("../textures/CCTexture2D"),d=t("./uuid-loader"),f={INFO_EXP:/info [^\n]*(\n|$)/gi,COMMON_EXP:/common [^\n]*(\n|$)/gi,PAGE_EXP:/page [^\n]*(\n|$)/gi,CHAR_EXP:/char [^\n]*(\n|$)/gi,KERNING_EXP:/kerning [^\n]*(\n|$)/gi,ITEM_EXP:/\w+=[^ \r\n]+/gi,INT_EXP:/^[\-]?\d+$/},_={png:s,jpg:s,bmp:s,jpeg:s,gif:s,ico:s,tiff:s,webp:s,image:s,json:r,ExportJson:r,plist:o,fnt:c,uuid:d,prefab:d,fire:d,scene:d,"default":n},p="Loader",g=function(t){this.id=p,this.async=!0,this.pipeline=null,this.extMap=l.mixin(t,_)};g.ID=p,l.mixin(g.prototype,{addHandlers:function(t){this.extMap=l.mixin(this.extMap,t)},handle:function(t,e){var i=this.extMap[t.type]||this.extMap["default"];i.call(this,t,function(t,i){if(t)e&&e(t);else e&&e(null,i)})}}),h.Loader=e.exports=g},{"../platform/js":105,"../textures/CCTexture2D":117,"./pipeline":85,"./uuid-loader":86}],84:[function(t,e,i){var n=t("../platform/callbacks-invoker"),r=t("../platform/js"),s=function(){n.call(this),this.map={},this.completed={},this.totalCount=0,this.completedCount=0};r.mixin(s.prototype,n.prototype,{append:function(t){for(var e=[],i=0;i<t.length;++i){var n=t[i],r=n.id;if(!this.map[r])this.map[n.id]=n,e.push(n)}return this.totalCount+=e.length,e},isCompleted:function(){return this.completedCount>=this.totalCount},isItemCompleted:function(t){return!!this.completed[t]},exists:function(t){return!!this.map[t]},getContent:function(t){var e=this.map[t];return e?e.content:null},getError:function(t){var e=this.map[t];return e?e.error:null},addListener:n.prototype.add,hasListener:n.prototype.has,removeListener:n.prototype.remove,removeAllListeners:n.prototype.removeAll,removeItem:function(t){if(this.completed[t])delete this.completed[t],delete this.map[t],this.completedCount--,this.totalCount--},complete:function(t){if(this.map[t]&&!this.completed[t]){var e=this.map[t];e.complete=!0,this.completed[t]=e,this.completedCount++}}}),e.exports=s},{"../platform/callbacks-invoker":100,"../platform/js":105}],85:[function(t,e,i){function n(t){var e=this.id,i=t.states[e],n=this.next;if(!t.error&&i!==u.WORKING&&i!==u.ERROR)if(i===u.COMPLETE)if(n)n.flowIn(t);else this.pipeline.flowOut(t);else{t.states[e]=u.WORKING;var r=this;this.handle(t,function(i,s){if(i)t.error=i,t.states[e]=u.ERROR,r.pipeline.flowOut(t);else{if(s)t.content=s;if(t.states[e]=u.COMPLETE,n)n.flowIn(t);else r.pipeline.flowOut(t)}})}}function r(t){var e=this.id,i=t.states[e],n=this.next;if(!t.error&&i!==u.WORKING&&i!==u.ERROR)if(i===u.COMPLETE)if(n)n.flowIn(t);else this.pipeline.flowOut(t);else{t.states[e]=u.WORKING;var r=this.handle(t);if(r instanceof Error)t.error=r,t.states[e]=u.ERROR,this.pipeline.flowOut(t);else{if(r)t.content=r;if(t.states[e]=u.COMPLETE,n)n.flowIn(t);else this.pipeline.flowOut(t)}}}function s(t){var e=t.id||t;return"string"==typeof e}function o(t){var e;if("object"==typeof t&&t.id){if(!t.type)t.type=l.extname(t.id).toLowerCase().substr(1);e={url:t.url||t.id,error:null,content:null,complete:!1,states:{}},c.mixin(e,t)}else if("string"==typeof t)e={id:t,url:t,type:l.extname(t).toLowerCase().substr(1),error:null,content:null,complete:!1,states:{}};if(e.skips)for(var i=0,n=e.skips.length;n>i;i++){var r=e.skips[i];e.states[r]=u.COMPLETE}return e}function a(){return window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP")}var c=t("../platform/js"),l=t("../utils/CCPath"),h=t("./loading-items"),u={WORKING:1,COMPLETE:2,ERROR:3},d=function(t){this._pipes=t,this._items=new h,this._errorUrls=[],this._flowing=!1;for(var e=0;e<t.length;++e){var i=t[e];if(i.handle&&i.id)i.pipeline=this,i.next=e<t.length-1?t[e+1]:null,i.flowIn=i.async?n:r;else;}};d.ItemState=new cc.Enum(u),d.getXMLHttpRequest=a,c.mixin(d.prototype,{insertPipe:function(t,e){if(t.handle&&t.id)if(t.pipeline=this,t.flowIn=t.async?n:r,e<this._pipes.length)t.next=this._pipes[e],this._pipes.splice(e,0,t);else t.next=null,this._pipes.push(t)},appendPipe:function(t){if(t.handle&&t.id)t.pipeline=this,t.next=null,t.flowIn=t.async?n:r,this._pipes.push(t)},flowIn:function(t){var e,i,n,r=[];for(e=0;e<t.length;++e)if(i=t[e],s(i))n=o(i),r.push(n);else throw new Error("Pipeline flowIn: Invalid url: "+(i.id||i));var a=this._items.append(r);if(0===this._pipes.length||0===a.length)return this.complete(),a;this._flowing=!0;var c=this._pipes[0];if(c)for(e=0;e<a.length;e++)c.flowIn(a[e]);return a},flowInDeps:function(t,e){function i(t){n[t.id]=t;for(var i in n)if(!n[i])return;e&&e.call(this,n),e=null}for(var n={},r=0,s=this._items,o=0;o<t.length;++o){var a=t[o].id||t[o];if("string"==typeof a&&!n[a]){var c=s.map[a];if(!c)s.addListener(a,i),n[a]=null,r++;else n[a]=c}else;}if(0===r)e&&e.call(this,n),e=null;return this.flowIn(t)},complete:function(){if(this._items.isCompleted()){this._flowing=!1;var t=0===this._errorUrls.length?null:this._errorUrls;if(this.onComplete)this.onComplete(t,this._items);for(var e=0;e<this._errorUrls.length;++e){var i=this._errorUrls[e];this._items.removeItem(i)}this._errorUrls=[]}},flowOut:function(t){var e=t.id,i=this._items,n=i.map[e];if(n&&!n.complete){var r=this._errorUrls.indexOf(e);if(t.error&&-1===r)this._errorUrls.push(e);else if(!t.error&&-1!==r)this._errorUrls.splice(r,1);i.complete(t.id),this.onProgress&&this.onProgress(i.completedCount,i.totalCount,t),this.complete(),i.invokeAndRemove(e,t)}},copyItemStates:function(t,e){if(!(e instanceof Array))return void(e.states=t.states);for(var i=0;i<e.length;++i)e[i].states=t.states},isFlowing:function(){return this._flowing},getItems:function(){return this._items},getItem:function(t){return this._items.map[t]},removeItem:function(t){var e=this._items.map[t];if(e){if(!e.complete)e.error=new Error("Canceled manually"),this.flowOut(e);this._items.removeItem(t)}else return!1},clear:function(){if(this._flowing){var t=this._items.map;for(var e in t){var i=t[e];if(!i.complete)i.error=new Error("Canceled manually"),this.flowOut(i)}}this._items=new h,this._errorUrls=[],this._flowing=!1},onProgress:null,onComplete:null}),cc.Pipeline=e.exports=d},{"../platform/js":105,"../utils/CCPath":121,"./loading-items":84}],86:[function(t,e,i){function n(t,e,i,n,r){for(var o=e.id,a=e.url,c=s.array.copy(n.uuidList),l=s.array.copy(n.uuidObjList),h=s.array.copy(n.uuidPropList),u=new Array(c.length),d=0;d<c.length;d++){var f=c[d];u[d]={id:f,type:"uuid",uuid:f}}if(n.rawProp)c.push(a),l.push(i),h.push(n.rawProp),u.push(a);if(u.length>0)t.flowInDeps(u,function(e){var n;for(var s in e)if(n=e[s],n.uuid&&n.content)n.content._uuid=n.uuid;for(var a=0;a<c.length;a++){var u=c[a],d=l[a],f=h[a];if(n=e[u])if(n.complete){var _=n.isRawAsset?n.url:n.content;d[f]=_}else{var p=function(t){var e=t.isRawAsset?t.url:t.content;this.obj[this.prop]=e},g={obj:d,prop:f},m=t.getItems()._callbackTable[u];if(m)m.unshift(p,g);else t.getItems().add(u,p,g)}}i._uuid=o,r(null,i)});else i._uuid=o,r(null,i);n.reset()}function r(t,e){var i;if("string"==typeof t.content)try{i=JSON.parse(t.content)}catch(r){return void e(new Error("Uuid Loader: Parse asset ["+t.id+"] failed : "+r.stack))}else if("object"==typeof t.content)i=t.content;else return void e(new Error("JSON Loader: Input item doesn't contain string content"));var c,l=i&&(i[0]&&i[0].__type__===a||i[1]&&i[1].__type__===a),h=l?cc._MissingScript.safeFindClass:function(t){var e=s._getClassById(t);if(e)return e;else return cc.warn('Can not get class "%s"',t),Object},u=cc.sys.isNative?new cc.deserialize.Details:t.deserializeInfo||o;try{c=cc.deserialize(i,u,{classFinder:h,target:t.existingAsset})}catch(r){return void e(new Error("Uuid Loader: Deserialize asset ["+t.id+"] failed : "+r.stack))}n(this.pipeline,t,c,u,e)}var s=t("../platform/js");t("../platform/deserialize");var o=new cc.deserialize.Details,a="cc.Scene";e.exports=r},{"../platform/deserialize":101,"../platform/js":105}],87:[function(t,e,i){function n(t){return t&&(t.constructor===cc.SceneAsset||t instanceof cc.Scene)}var r,s=t("../assets/CCAsset"),o=t("./utils").callInNextTick,a=t("../load-pipeline/CCLoader"),c="",l="",h={loadAsset:function(t,e,i){var n={id:t,type:"uuid"};if(i&&i.deserializeInfo)n.deserializeInfo=i.deserializeInfo;if(i&&i.existingAsset)n.existingAsset=i.existingAsset;this._loadAssetByUuid(n,e)},getImportedDir:function(t){return c+t.slice(0,2)},_queryAssetInfoInEditor:function(t,e){if(!1)Editor.sendRequestToCore("scene:query-asset-info-by-uuid",t,function(i){if(i){Editor.UuidCache.cache(i.url,t);var n=Editor.assets[i.type];if(n){var r=!cc.isChildClassOf(n,s);e(null,i.url,r,n)}else e(new Error("Can not find asset type "+i.type))}else e(new Error("Can not get asset url by uuid "+t))})},_getAssetInfoInRuntime:function(t){var e=r[t];if(e&&e.raw)return{url:l+e.url,raw:!0};else{var i=this.getImportedDir(t)+"/"+t+".json";return{url:i,raw:!1}}},queryAssetInfo:function(t,e){if(false)this._queryAssetInfoInEditor(t,e);else{var i=this._getAssetInfoInRuntime(t);e(null,i.url,i.raw)}},parseUuidInEditor:function(t){if(!1){var e="",i=t.startsWith(c);if(i){var n=cc.path.dirname(t),r=cc.path.basename(n),s=2===r.length;if(s){e=cc.path.basename(t);var o=e.indexOf(".");if(-1!==o)e=e.slice(0,o)}else e=r}return e}},_loadAssetByUuid:function(t,e){var i=t.id,r=!0;if("string"!=typeof i)return o(e,new Error("[AssetLibrary] uuid must be string"),null);else return a.load(t,function(t,s){if(t||!s)t=new Error("[AssetLibrary] loading JSON or dependencies failed : "+JSON.stringify(t));if(r)o(function(){if(n(s))a.removeItem(i);e(t,s)});else{if(n(s))a.removeItem(i);e(t,s)}}),void(r=!1)},loadJson:function(t,e){var i=""+((new Date).getTime()+Math.random()),r=!0,s={id:i,type:"uuid",content:t,skips:[a.downloader.id]};a.load(s,function(t,s){if(t)t=new Error("[AssetLibrary] loading JSON or dependencies failed : "+JSON.stringify(t));if(r)o(function(){if(n(s))a.removeItem(i);s._uuid="",e(t,s)});else{if(n(s))a.removeItem(i);s._uuid="",e(t,s)}}),r=!1},getAssetByUuid:function(t){return h._uuidToAsset[t]||null},init:function(t){if(false)return void cc.error("AssetLibrary has already been initialized!");var e=t.libraryPath;e=e.replace(/\\/g,"/"),c=cc.path._setEndWithSep(e,"/"),l=t.rawAssetsBase,r={};var i=t.rawAssets;if(i){var n="resources/";for(var s in i){var o=i[s];for(var h in o){var u=o[h],d=u.url,f=u.raw;if(r[h]={url:s+"/"+d,raw:!!f},"assets"===s&&d.startsWith(n)){if(!f){var _=cc.path.extname(d);if(_)d=d.slice(n.length,-_.length);else d=d.slice(n.length)}else d=d.slice(n.length);a._resources.add(d,h)}}}}var p=t.mountPaths;if(!p)p={assets:l+"assets",internal:l+"internal"};cc.url._init(p)}};h._uuidToAsset={},cc.AssetLibrary=h},{"../assets/CCAsset":36,"../load-pipeline/CCLoader":78,"./utils":111}],88:[function(require,module,exports){function appendProp(t,e){if(!1)if(-1!==e.indexOf("."))return void cc.error('Disallow to use "." in property name');var i=t.__props__.indexOf(e);if(0>i)t.__props__.push(e)}function defineProp(t,e,i,n,r){if(!1){if("object"==typeof n&&n)if(Array.isArray(n)){if(n.length>0)return void cc.error('Default array must be empty, set default value of %s.%s to [], and initialize in "onLoad" or "ctor" please. (just like "this.%s = [...];")',e,i,i)}else if(!_isPlainEmptyObj_DEV(n))if(!_cloneable_DEV(n))return void cc.error('Do not set default value to non-empty object, unless the object defines its own "clone" function. Set default value of %s.%s to null or {}, and initialize in "onLoad" or "ctor" please. (just like "this.%s = {foo: bar};")',e,i,i);for(var s=t.$super;s;s=s.$super)if(s.prototype.hasOwnProperty(i))return void cc.error("Can not declare %s.%s, it is already defined in the prototype of %s",e,i,e)}if(Attr.attr(t,i,{"default":n}),appendProp(t,i),r){for(var o=null,a=0;a<r.length;a++){var c=r[a];if(Attr.attr(t,i,c),c._onAfterProp)o=o||[],o.push(c._onAfterProp)}if(o)for(var l=0;l<o.length;l++)o[l](t,i)}}function defineGetSet(t,e,i,n,r){var s=n.get,o=n.set,a=t.prototype,c=Object.getOwnPropertyDescriptor(a,i);if(s){if(c&&c.get,!1)return void cc.error('"%s": the getter of "%s" is already defined!',e,i);if(r)for(var l=0;l<r.length;++l){var h=r[l];if(h._canUsedInGetter===!1,1){if(Attr.attr(t,i,h),h.serializable===!1||h.editorOnly===!0,!1)cc.warn('No need to use "serializable: false" or "editorOnly: true" for the getter of "%s.%s", every getter is actually non-serialized.',e,i)}else cc.error('Can not apply the specified attribute to the getter of "%s.%s", attribute index: %s',e,i,l)}var u=!1;if(!u)Attr.attr(t,i,Attr.NonSerialized);if(u)appendProp(t,i);if(c)Object.defineProperty(a,i,{get:s});else Object.defineProperty(a,i,{get:s,configurable:!0,enumerable:!0});if(!1)Attr.attr(t,i,{hasGetter:!0})}if(o)if(!1){if(c&&c.set)return cc.error('"%s": the setter of "%s" is already defined!',e,i);Object.defineProperty(a,i,{set:o,configurable:!0,enumerable:!0}),Attr.attr(t,i,{hasSetter:!0})}else if(c)Object.defineProperty(a,i,{set:o});else Object.defineProperty(a,i,{set:o,configurable:!0,enumerable:!0})}function getDefault(t){if("function"==typeof t)if(!1)try{return t()}catch(e){return void cc._throw(e)}else return t();return t}function instantiateProps(t,e){var i=e.__props__;if(null===i)deferredInitializer.init(),i=e.__props__;for(var n=0;n<i.length;n++){var r=i[n],s=Attr.attr(e,r);if(s&&s.hasOwnProperty("default")){var o=s["default"];if(o)if("object"==typeof o&&o)if("function"==typeof o.clone)o=o.clone();else if(Array.isArray(o))o=[];else o={};else if("function"==typeof o)o=getDefault(o);t[r]=o}}}function doDefine(t,e,i,n,r){var s=_createCtor(n,e,i,t,r);if(Object.defineProperty(s,"extend",{value:function(t){return t["extends"]=this,CCClass(t)},writable:!0,configurable:!0}),e)JS.extend(s,e),s.$super=e;if(i){for(var o=0;o<i.length;++o){var a=i[o];JS.mixin(s.prototype,a.prototype);for(var c in a)if(a.hasOwnProperty(c)&&INVALID_STATICS.indexOf(c)<0)s[c]=a[c]}s.prototype.constructor=s}return JS.setClassName(t,s),s}function define(t,e,i,n,r){if(cc.isChildClassOf(e,cc.Component)){var s=cc._RFpeek();if(s){if(false)cc.warn("cc.Class: Should not define constructor for cc.Component.");if(s.beh)return void cc.error("Each script can have at most one Component.");var o=s.uuid;if(o)if(false)cc.warn("Should not specify class name for Component which defines in project.");t=t||s.script;var a=doDefine(t,e,i,n,r);if(o)if(JS._setClassId(o,a),!1)cc.Component._addMenuItem(a,"i18n:MAIN_MENU.component.scripts/"+t,-1),a.prototype.__scriptUuid=Editor.UuidUtils.decompressUuid(o);return s.beh=a,a}}return doDefine(t,e,i,n,r)}function _checkCtor(t){if(!1){if(CCClass._isCCClass(t))return void cc.error("Constructor can not be another CCClass");if("function"!=typeof t)return void cc.error("Constructor of CCClass must be function type");if(t.length>0)return void cc.warn("Can not instantiate CCClass with arguments.")}}function normalizeClassName(className){if(!1){var DefaultName="CCClass";if(className){if(className=className.replace(/\./g,"_"),className=className.split("").filter(function(t){return/^[a-zA-Z0-9_$]/.test(t)}).join(""),/^[0-9]/.test(className[0]))className="_"+className;try{eval("function "+className+"(){}")}catch(e){className="FireClass_"+className;try{eval("function "+className+"(){}")}catch(e){return DefaultName}}return className}return DefaultName}}function _createCtor(ctor,baseClass,mixins,className,options){var useTryCatch=!(className&&className.startsWith("cc.")),shouldAddProtoCtor;if(false){var originCtor=ctor;if(SuperCallReg.test(ctor))cc.warn(cc._LogInfos.Editor.Class.callSuperCtor,className),ctor=function(){this._super=function(){};var t=originCtor.apply(this,arguments);return this._super=null,t};if(/\bprototype.ctor\b/.test(originCtor))cc.warn(cc._LogInfos.Editor.Class.callSuperCtor,className),shouldAddProtoCtor=!0}var superCallBounded=options&&baseClass&&boundSuperCalls(baseClass,options);if(false)_checkCtor(ctor);for(var ctors=[],baseOrMixins=[baseClass].concat(mixins),b=0;b<baseOrMixins.length;b++){var baseOrMixin=baseOrMixins[b];if(baseOrMixin)if(CCClass._isCCClass(baseOrMixin)){var baseCtors=baseOrMixin.__ctors__;if(baseCtors)ctors=ctors.concat(baseCtors)}else if(baseOrMixin)ctors.push(baseOrMixin)}if(ctor)ctors.push(ctor);var body;if(!1)body="(function "+normalizeClassName(className)+"(){\n";else body="(function(){\n";if(superCallBounded)body+="this._super=null;\n";if(body+="instantiateProps(this,fireClass);\n",ctors.length>0){if(body+="var cs=fireClass.__ctors__;\n",useTryCatch)body+="try{\n";if(ctors.length<=5)for(var i=0;i<ctors.length;i++)body+="(cs["+i+"]).apply(this,arguments);\n";else body+="for(var i=0,l=cs.length;i<l;++i){\n",body+="(cs[i]).apply(this,arguments);\n}\n";if(useTryCatch)body+="}catch(e){\ncc._throw(e);\n}\n"}body+="})";var fireClass=eval(body);if(Object.defineProperty(fireClass,"__ctors__",{value:ctors.length>0?ctors:null}),false)fireClass.prototype.ctor=function(){};return fireClass}function _boundSuperCall(t,e,i){var n=null,r=JS.getPropertyDescriptor(i.prototype,e);if(r)if(n=r.value,"function"==typeof n){var s=SuperCallReg.test(t);if(s)return function(){var e=this._super;this._super=n;var i=t.apply(this,arguments);return this._super=e,i}}return null}function boundSuperCalls(t,e){var i=!1;for(var n in e)if(BUILTIN_ENTRIES.indexOf(n)<0){var r=e[n];if("function"==typeof r){var s=_boundSuperCall(r,n,t);if(s)i=!0,e[n]=s}}return i}function declareProperties(t,e,i,n,r){if(t.__props__=[],n&&n.__props__)t.__props__=n.__props__.slice();if(r)for(var s=0;s<r.length;++s){var o=r[s];if(o.__props__)t.__props__=t.__props__.concat(o.__props__.filter(function(e){return t.__props__.indexOf(e)<0}))}if(i){preprocessAttrs(i,e,t);for(var a in i){var c=i[a],l=parseAttributes(c,e,a);if("default"in c)defineProp(t,e,a,c["default"],l);else defineGetSet(t,e,a,c,l)}}}function CCClass(t){if(0===arguments.length)return define();if(!t)return cc.error("cc.Class: Option must be non-nil"),define();var e,i=t.name,n=t["extends"],r=t.mixins;if(e=define(i,n,r,t.ctor,t),!i)i=cc.js.getClassName(e);var s=t.properties;if("function"==typeof s||n&&null===n.__props__||r&&r.some(function(t){return null===t.__props__}))deferredInitializer.push({cls:e,props:s,mixins:r}),e.__props__=null;else declareProperties(e,i,s,n,t.mixins);var o=t.statics;if(o){var a;if(!1)for(a in o)if(-1===INVALID_STATICS.indexOf(a));else cc.error('Cannot define %s.%s because static member name can not be "%s".',i,a,a);for(a in o)e[a]=o[a]}for(var c in t)if(!(BUILTIN_ENTRIES.indexOf(c)>=0))if(!0){var l=t[c];if("function"==typeof l||null===l)Object.defineProperty(e.prototype,c,{value:l,enumerable:!0,configurable:!0,writable:!0});else if(!1){var h=TYPO_TO_CORRECT[c];if(h)cc.warn('Unknown type of %s.%s, maybe you want is "%s".',i,c,h);else if(l)cc.error('Unknown type of %s.%s, property should be defined in "properties" or "ctor"',i,c)}}else cc.error('Can not define a member called "constructor" in the class "%s", please use "ctor" instead.',i);else;if(!1){var u=t.editor;if(u)if(cc.isChildClassOf(n,cc.Component))cc.Component._registerEditorProps(e,u);else cc.warn('Can not use "editor" attribute, "%s" not inherits from Components.',i)}return e}function parseAttributes(t,e,i){function n(n,r,o){var a=t[n];if(a)if(typeof a===r)if("undefined"==typeof o){var c={};c[n]=a,s.push(c)}else s.push("function"==typeof o?o(a):o);else if(!1)cc.error("The %s of %s.%s must be type %s",n,e,i,r)}var r=!1?"The %s of %s must be type %s":"";tmpAttrs.length=0;var s=tmpAttrs,o=t.type;if(o)switch(o){case"Integer":s.push({type:"Integer"});break;case"Float":s.push({type:"Float"});break;case"Boolean":s.push({type:"Boolean",_onAfterProp:getTypeChecker("Boolean","Boolean")});break;case"String":s.push({type:"String",_onAfterProp:getTypeChecker("String","String")});break;case"Object":if(!1)cc.error('Please define "type" parameter of %s.%s as the actual constructor.',e,i);break;default:if(o===Attr.ScriptUuid){var a=Attr.ObjectType(cc.ScriptAsset);a.type="Script",s.push(a)}else if("object"==typeof o){if(Enum.isEnum(o))s.push({type:"Enum",enumList:Enum.getList(o)});else if(!1)cc.error('Please define "type" parameter of %s.%s as the constructor of %s.',e,i,o)}else if("function"==typeof o)s.push(Attr.ObjectType(o));else if(!1)cc.error('Unknown "type" parameter of %s.%s：%s',e,i,o)}if(n("rawType","string",Attr.RawType),n("editorOnly","boolean",Attr.EditorOnly),!1)n("displayName","string"),n("multiline","boolean",{multiline:!0}),n("readonly","boolean",{readonly:!0}),n("tooltip","string");if(t.url)s.push({saveUrlAsAsset:!0});if(t.serializable===!1)s.push(Attr.NonSerialized);if(!1)if("animatable"in t&&!t.animatable)s.push({animatable:!1});if(!1){var c=t.visible;if("undefined"!=typeof c){if(!t.visible)s.push({visible:!1})}else{var l=95===i.charCodeAt(0);if(l)s.push({visible:!1})}}var h=t.range;if(h)if(Array.isArray(h)){if(h.length>=2)s.push(Attr.Range(h[0],h[1]));else if(!1)cc.error("The length of range array must be 2")}else if(!1)cc.error(r,'"range"',e+"."+i,"array");return s}var JS=require("./js"),Enum=require("../value-types/CCEnum"),Utils=require("./utils"),_isPlainEmptyObj_DEV=Utils.isPlainEmptyObj_DEV,_cloneable_DEV=Utils.cloneable_DEV,Attr=require("./attribute"),getTypeChecker=Attr.getTypeChecker,preprocessAttrs=require("./preprocess-attrs"),BUILTIN_ENTRIES=["name","extends","mixins","ctor","properties","statics","editor"],TYPO_TO_CORRECT=!1,INVALID_STATICS=!1,deferredInitializer={datas:null,push:function(t){if(this.datas)this.datas.push(t);else{this.datas=[t];var e=this;setTimeout(function(){e.init()},0)}},init:function(){var t=this.datas;if(t){for(var e=0;e<t.length;++e){var i=t[e],n=i.cls,r=i.props;if("function"==typeof r)r=r();var s=JS.getClassName(n);if(r)declareProperties(n,s,r,n.$super,i.mixins);else cc.error('Properties function of "%s" should return an object!',s)}this.datas=null}}};cc.isChildClassOf=function(t,e){if(t&&e){if("function"!=typeof t)return!1;if("function"!=typeof e){if(!1)cc.warn("[isChildClassOf] superclass should be function type, not",e);return!1}for(;t&&t.$super;t=t.$super)if(t===e)return!0;if(t===e)return!0;for(var i=Object.getPrototypeOf(t.prototype);i;){if(t=i.constructor,t===e)return!0;i=Object.getPrototypeOf(t.prototype)}}return!1};var SuperCallReg=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;CCClass._isCCClass=function(t){return!!t&&"undefined"!=typeof t.__ctors__},CCClass._fastDefine=function(t,e,i){JS.setClassName(t,e),e.__props__=i;for(var n=0;n<i.length;n++)Attr.attr(e,i[n],{visible:!1})},CCClass.attr=Attr.attr;var tmpAttrs=[];if(cc.Class=CCClass,module.exports={instantiateProps:instantiateProps,isArray:function(t){return t=getDefault(t),Array.isArray(t)},fastDefine:CCClass._fastDefine},!1)module.exports.getDefault=getDefault},{"../value-types/CCEnum":130,"./attribute":99,"./js":105,"./preprocess-attrs":108,"./utils":111}],89:[function(t,e,i){var n=t("./CCInputManager");n.setAccelerometerEnabled=function(t){var e=this;if(e._accelEnabled!==t){e._accelEnabled=t;var i=cc.director.getScheduler();if(e._accelEnabled)e._accelCurTime=0,i.scheduleUpdate(e);else e._accelCurTime=0,i.scheduleUpdate(e)}},n.setAccelerometerInterval=function(t){if(this._accelInterval!==t)this._accelInterval=t},n._registerKeyboardEvent=function(){cc.game.canvas.addEventListener("keydown",function(t){cc.eventManager.dispatchEvent(new cc.Event.EventKeyboard(t.keyCode,!0)),t.stopPropagation(),t.preventDefault()},!1),cc.game.canvas.addEventListener("keyup",function(t){cc.eventManager.dispatchEvent(new cc.Event.EventKeyboard(t.keyCode,!1)),t.stopPropagation(),t.preventDefault()},!1)},n._registerAccelerometerEvent=function(){var t=window,e=this;if(e._acceleration=new cc.Acceleration,e._accelDeviceEvent=t.DeviceMotionEvent||t.DeviceOrientationEvent,cc.sys.browserType===cc.sys.BROWSER_TYPE_MOBILE_QQ)e._accelDeviceEvent=window.DeviceOrientationEvent;var i=e._accelDeviceEvent===t.DeviceMotionEvent?"devicemotion":"deviceorientation",n=navigator.userAgent;if(/Android/.test(n)||/Adr/.test(n)&&cc.sys.browserType===cc.BROWSER_TYPE_UC)e._minus=-1;t.addEventListener(i,e.didAccelerate.bind(e),!1)},n.didAccelerate=function(t){var e=this,i=window;if(e._accelEnabled){var n,r,s,o=e._acceleration;if(e._accelDeviceEvent===window.DeviceMotionEvent){var a=t.accelerationIncludingGravity;n=e._accelMinus*a.x*.1,r=e._accelMinus*a.y*.1,s=.1*a.z}else n=t.gamma/90*.981,r=.981*-(t.beta/90),s=t.alpha/90*.981;if(cc.sys.os===cc.sys.OS_ANDROID)o.x=-n,o.y=-r;else o.x=n,o.y=r;o.z=s,o.timestamp=t.timeStamp||Date.now();var c=o.x;if(i.orientation===cc.macro.WEB_ORIENTATION_LANDSCAPE_RIGHT)o.x=-o.y,o.y=c;else if(i.orientation===cc.macro.WEB_ORIENTATION_LANDSCAPE_LEFT)o.x=o.y,o.y=-c;else if(i.orientation===cc.macro.WEB_ORIENTATION_PORTRAIT_UPSIDE_DOWN)o.x=-o.x,o.y=-o.y}}},{"./CCInputManager":90}],90:[function(t,e,i){var n={_mousePressed:!1,_isRegisterEvent:!1,_preTouchPoint:cc.p(0,0),_prevMousePoint:cc.p(0,0),_preTouchPool:[],_preTouchPoolPointer:0,_touches:[],_touchesIntegerDict:{},_indexBitsUsed:0,_maxTouches:5,_accelEnabled:!1,_accelInterval:1/30,_accelMinus:1,_accelCurTime:0,_acceleration:null,_accelDeviceEvent:null,_getUnUsedIndex:function(){for(var t=this._indexBitsUsed,e=0;e<this._maxTouches;e++){if(!(1&t))return this._indexBitsUsed|=1<<e,e;t>>=1}return-1},_removeUsedIndexBit:function(t){if(!(0>t||t>=this._maxTouches)){var e=1<<t;e=~e,this._indexBitsUsed&=e}},_glView:null,handleTouchesBegin:function(t){for(var e,i,n,r,s=[],o=this._touchesIntegerDict,a=0,c=t.length;c>a;a++)if(e=t[a],r=e.getID(),i=o[r],null==i){var l=this._getUnUsedIndex();if(-1===l){cc.log(cc._LogInfos.inputManager.handleTouchesBegin,l);continue}n=this._touches[l]=new cc.Touch(e._point.x,e._point.y,e.getID()),n._setPrevPoint(e._prevPoint),o[r]=l,s.push(n)}if(s.length>0){this._glView._convertTouchesWithScale(s);var h=new cc.Event.EventTouch(s);h._eventCode=cc.Event.EventTouch.BEGAN,cc.eventManager.dispatchEvent(h)}},handleTouchesMove:function(t){for(var e,i,n,r=[],s=this._touches,o=0,a=t.length;a>o;o++)if(e=t[o],n=e.getID(),i=this._touchesIntegerDict[n],null!=i){if(s[i])s[i]._setPoint(e._point),s[i]._setPrevPoint(e._prevPoint),r.push(s[i])}else;if(r.length>0){this._glView._convertTouchesWithScale(r);var c=new cc.Event.EventTouch(r);c._eventCode=cc.Event.EventTouch.MOVED,cc.eventManager.dispatchEvent(c)}},handleTouchesEnd:function(t){var e=this.getSetOfTouchesEndOrCancel(t);if(e.length>0){this._glView._convertTouchesWithScale(e);var i=new cc.Event.EventTouch(e);i._eventCode=cc.Event.EventTouch.ENDED,cc.eventManager.dispatchEvent(i)}},handleTouchesCancel:function(t){var e=this.getSetOfTouchesEndOrCancel(t);if(e.length>0){this._glView._convertTouchesWithScale(e);var i=new cc.Event.EventTouch(e);i._eventCode=cc.Event.EventTouch.CANCELLED,cc.eventManager.dispatchEvent(i)}},getSetOfTouchesEndOrCancel:function(t){for(var e,i,n,r=[],s=this._touches,o=this._touchesIntegerDict,a=0,c=t.length;c>a;a++)if(e=t[a],
n=e.getID(),i=o[n],null!=i){if(s[i])s[i]._setPoint(e._point),s[i]._setPrevPoint(e._prevPoint),r.push(s[i]),this._removeUsedIndexBit(i),delete o[n]}else;return r},getHTMLElementPosition:function(t){var e=document.documentElement,i=window,n=null;if(cc.js.isFunction(t.getBoundingClientRect))n=t.getBoundingClientRect();else if(t instanceof HTMLCanvasElement)n={left:0,top:0,width:t.width,height:t.height};else n={left:0,top:0,width:parseInt(t.style.width),height:parseInt(t.style.height)};return{left:n.left+i.pageXOffset-e.clientLeft,top:n.top+i.pageYOffset-e.clientTop,width:n.width,height:n.height}},getPreTouch:function(t){for(var e=null,i=this._preTouchPool,n=t.getID(),r=i.length-1;r>=0;r--)if(i[r].getID()===n){e=i[r];break}if(!e)e=t;return e},setPreTouch:function(t){for(var e=!1,i=this._preTouchPool,n=t.getID(),r=i.length-1;r>=0;r--)if(i[r].getID()===n){i[r]=t,e=!0;break}if(!e)if(i.length<=50)i.push(t);else i[this._preTouchPoolPointer]=t,this._preTouchPoolPointer=(this._preTouchPoolPointer+1)%50},getTouchByXY:function(t,e,i){var n=this._preTouchPoint,r=this._glView.convertToLocationInView(t,e,i),s=new cc.Touch(r.x,r.y);return s._setPrevPoint(n.x,n.y),n.x=r.x,n.y=r.y,s},getMouseEvent:function(t,e,i){var n=this._prevMousePoint;this._glView._convertMouseToLocationInView(t,e);var r=new cc.Event.EventMouse(i);return r.setLocation(t.x,t.y),r._setPrevCursor(n.x,n.y),n.x=t.x,n.y=t.y,r},getPointByEvent:function(t,e){if(null!=t.pageX)return{x:t.pageX,y:t.pageY};else return e.left-=document.body.scrollLeft,e.top-=document.body.scrollTop,{x:t.clientX,y:t.clientY}},getTouchesByEvent:function(t,e){for(var i,n,r,s=[],o=this._glView,a=this._preTouchPoint,c=t.changedTouches.length,l=0;c>l;l++)if(i=t.changedTouches[l]){var h;if(cc.sys.BROWSER_TYPE_FIREFOX===cc.sys.browserType)h=o.convertToLocationInView(i.pageX,i.pageY,e);else h=o.convertToLocationInView(i.clientX,i.clientY,e);if(null!=i.identifier)n=new cc.Touch(h.x,h.y,i.identifier),r=this.getPreTouch(n).getLocation(),n._setPrevPoint(r.x,r.y),this.setPreTouch(n);else n=new cc.Touch(h.x,h.y),n._setPrevPoint(a.x,a.y);a.x=h.x,a.y=h.y,s.push(n)}return s},registerSystemEvent:function(t){if(!this._isRegisterEvent){var e=(this._glView=cc.view,this),i="mouse"in cc.sys.capabilities,n="touches"in cc.sys.capabilities,r=!1;if(cc.sys.isMobile)r=!0;if(i)!r&&window.addEventListener("mousedown",function(){e._mousePressed=!0},!1),!r&&window.addEventListener("mouseup",function(i){var n=e._mousePressed;if(e._mousePressed=!1,n){var r=e.getHTMLElementPosition(t),s=e.getPointByEvent(i,r);if(!cc.rectContainsPoint(new cc.Rect(r.left,r.top,r.width,r.height),s)){e.handleTouchesEnd([e.getTouchByXY(s.x,s.y,r)]);var o=e.getMouseEvent(s,r,cc.Event.EventMouse.UP);o.setButton(i.button),cc.eventManager.dispatchEvent(o)}}},!1),!r&&t.addEventListener("mousedown",function(i){e._mousePressed=!0;var n=e.getHTMLElementPosition(t),r=e.getPointByEvent(i,n);e.handleTouchesBegin([e.getTouchByXY(r.x,r.y,n)]);var s=e.getMouseEvent(r,n,cc.Event.EventMouse.DOWN);s.setButton(i.button),cc.eventManager.dispatchEvent(s),i.stopPropagation(),i.preventDefault(),t.focus()},!1),!r&&t.addEventListener("mouseup",function(i){e._mousePressed=!1;var n=e.getHTMLElementPosition(t),r=e.getPointByEvent(i,n);e.handleTouchesEnd([e.getTouchByXY(r.x,r.y,n)]);var s=e.getMouseEvent(r,n,cc.Event.EventMouse.UP);s.setButton(i.button),cc.eventManager.dispatchEvent(s),i.stopPropagation(),i.preventDefault()},!1),!r&&t.addEventListener("mousemove",function(i){var n=e.getHTMLElementPosition(t),r=e.getPointByEvent(i,n);e.handleTouchesMove([e.getTouchByXY(r.x,r.y,n)]);var s=e.getMouseEvent(r,n,cc.Event.EventMouse.MOVE);if(e._mousePressed)s.setButton(i.button);else s.setButton(null);cc.eventManager.dispatchEvent(s),i.stopPropagation(),i.preventDefault()},!1),t.addEventListener("mousewheel",function(i){var n=e.getHTMLElementPosition(t),r=e.getPointByEvent(i,n),s=e.getMouseEvent(r,n,cc.Event.EventMouse.SCROLL);s.setButton(i.button),s.setScrollData(0,i.wheelDelta),cc.eventManager.dispatchEvent(s),i.stopPropagation(),i.preventDefault()},!1),t.addEventListener("DOMMouseScroll",function(i){var n=e.getHTMLElementPosition(t),r=e.getPointByEvent(i,n),s=e.getMouseEvent(r,n,cc.Event.EventMouse.SCROLL);s.setButton(i.button),s.setScrollData(0,-120*i.detail),cc.eventManager.dispatchEvent(s),i.stopPropagation(),i.preventDefault()},!1);if(window.navigator.msPointerEnabled){var s={MSPointerDown:e.handleTouchesBegin,MSPointerMove:e.handleTouchesMove,MSPointerUp:e.handleTouchesEnd,MSPointerCancel:e.handleTouchesCancel};for(var o in s)!function(i,n){t.addEventListener(i,function(i){var r=e.getHTMLElementPosition(t);r.left-=document.documentElement.scrollLeft,r.top-=document.documentElement.scrollTop,n.call(e,[e.getTouchByXY(i.clientX,i.clientY,r)]),i.stopPropagation()},!1)}(o,s[o])}if(n)t.addEventListener("touchstart",function(i){if(i.changedTouches){var n=e.getHTMLElementPosition(t);n.left-=document.body.scrollLeft,n.top-=document.body.scrollTop,e.handleTouchesBegin(e.getTouchesByEvent(i,n)),i.stopPropagation(),i.preventDefault(),t.focus()}},!1),t.addEventListener("touchmove",function(i){if(i.changedTouches){var n=e.getHTMLElementPosition(t);n.left-=document.body.scrollLeft,n.top-=document.body.scrollTop,e.handleTouchesMove(e.getTouchesByEvent(i,n)),i.stopPropagation(),i.preventDefault()}},!1),t.addEventListener("touchend",function(i){if(i.changedTouches){var n=e.getHTMLElementPosition(t);n.left-=document.body.scrollLeft,n.top-=document.body.scrollTop,e.handleTouchesEnd(e.getTouchesByEvent(i,n)),i.stopPropagation(),i.preventDefault()}},!1),t.addEventListener("touchcancel",function(i){if(i.changedTouches){var n=e.getHTMLElementPosition(t);n.left-=document.body.scrollLeft,n.top-=document.body.scrollTop,e.handleTouchesCancel(e.getTouchesByEvent(i,n)),i.stopPropagation(),i.preventDefault()}},!1);this._registerKeyboardEvent(),this._registerAccelerometerEvent(),this._isRegisterEvent=!0}},_registerKeyboardEvent:function(){},_registerAccelerometerEvent:function(){},update:function(t){if(this._accelCurTime>this._accelInterval)this._accelCurTime-=this._accelInterval,cc.eventManager.dispatchEvent(new cc.Event.EventAcceleration(this._acceleration));this._accelCurTime+=t}};cc.inputManager=n,e.exports=n},{}],91:[function(t,e,i){t("./_CCClass"),cc._tmp=cc._tmp||{},cc.KEY={none:0,back:6,menu:18,backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,pause:19,capslock:20,escape:27,space:32,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,select:41,insert:45,Delete:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,num0:96,num1:97,num2:98,num3:99,num4:100,num5:101,num6:102,num7:103,num8:104,num9:105,"*":106,"+":107,"-":109,numdel:110,"/":111,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,numlock:144,scrolllock:145,";":186,semicolon:186,equal:187,"=":187,",":188,comma:188,dash:189,".":190,period:190,forwardslash:191,grave:192,"[":219,openbracket:219,backslash:220,"]":221,closebracket:221,quote:222,dpadLeft:1e3,dpadRight:1001,dpadUp:1003,dpadDown:1004,dpadCenter:1005},cc.ImageFormat=cc.Enum({JPG:0,PNG:1,TIFF:2,WEBP:3,PVR:4,ETC:5,S3TC:6,ATITC:7,TGA:8,RAWDATA:9,UNKNOWN:10}),cc.getImageFormatByData=function(t){if(t.length>8&&137===t[0]&&80===t[1]&&78===t[2]&&71===t[3]&&13===t[4]&&10===t[5]&&26===t[6]&&10===t[7])return cc.ImageFormat.PNG;if(t.length>2&&(73===t[0]&&73===t[1]||77===t[0]&&77===t[1]||255===t[0]&&216===t[1]))return cc.ImageFormat.TIFF;else return cc.ImageFormat.UNKNOWN},cc.macro={INVALID_INDEX:-1,NODE_TAG_INVALID:-1,PI:Math.PI,PI2:2*Math.PI,FLT_MAX:parseFloat("3.402823466e+38F"),FLT_MIN:parseFloat("1.175494351e-38F"),RAD:Math.PI/180,DEG:180/Math.PI,UINT_MAX:4294967295,REPEAT_FOREVER:cc.sys.isNative?4294967295:Number.MAX_VALUE-1,FLT_EPSILON:1.192092896e-7,ONE:1,ZERO:0,SRC_ALPHA:770,SRC_ALPHA_SATURATE:776,SRC_COLOR:768,DST_ALPHA:772,DST_COLOR:774,ONE_MINUS_SRC_ALPHA:771,ONE_MINUS_SRC_COLOR:769,ONE_MINUS_DST_ALPHA:773,ONE_MINUS_DST_COLOR:775,ONE_MINUS_CONSTANT_ALPHA:32772,ONE_MINUS_CONSTANT_COLOR:32770,LINEAR:9729,BLEND_DST:771,WEB_ORIENTATION_PORTRAIT:0,WEB_ORIENTATION_LANDSCAPE_LEFT:-90,WEB_ORIENTATION_PORTRAIT_UPSIDE_DOWN:180,WEB_ORIENTATION_LANDSCAPE_RIGHT:90,DEVICE_ORIENTATION_PORTRAIT:0,DEVICE_ORIENTATION_LANDSCAPE_LEFT:1,DEVICE_ORIENTATION_PORTRAIT_UPSIDE_DOWN:2,DEVICE_ORIENTATION_LANDSCAPE_RIGHT:3,DEVICE_MAX_ORIENTATIONS:2,DENSITYDPI_DEVICE:"device-dpi",DENSITYDPI_HIGH:"high-dpi",DENSITYDPI_MEDIUM:"medium-dpi",DENSITYDPI_LOW:"low-dpi",VERTEX_ATTRIB_FLAG_NONE:0,VERTEX_ATTRIB_FLAG_POSITION:1,VERTEX_ATTRIB_FLAG_COLOR:2,VERTEX_ATTRIB_FLAG_TEX_COORDS:4,VERTEX_ATTRIB_FLAG_POS_COLOR_TEX:7,GL_ALL:0,VERTEX_ATTRIB_POSITION:0,VERTEX_ATTRIB_COLOR:1,VERTEX_ATTRIB_TEX_COORDS:2,VERTEX_ATTRIB_MAX:3,UNIFORM_PMATRIX:0,UNIFORM_MVMATRIX:1,UNIFORM_MVPMATRIX:2,UNIFORM_TIME:3,UNIFORM_SINTIME:4,UNIFORM_COSTIME:5,UNIFORM_RANDOM01:6,UNIFORM_SAMPLER:7,UNIFORM_MAX:8,SHADER_POSITION_TEXTURECOLOR:"ShaderPositionTextureColor",SHADER_POSITION_TEXTURECOLORALPHATEST:"ShaderPositionTextureColorAlphaTest",SHADER_POSITION_COLOR:"ShaderPositionColor",SHADER_POSITION_TEXTURE:"ShaderPositionTexture",SHADER_POSITION_TEXTURE_UCOLOR:"ShaderPositionTexture_uColor",SHADER_POSITION_TEXTUREA8COLOR:"ShaderPositionTextureA8Color",SHADER_POSITION_UCOLOR:"ShaderPosition_uColor",SHADER_POSITION_LENGTHTEXTURECOLOR:"ShaderPositionLengthTextureColor",UNIFORM_PMATRIX_S:"CC_PMatrix",UNIFORM_MVMATRIX_S:"CC_MVMatrix",UNIFORM_MVPMATRIX_S:"CC_MVPMatrix",UNIFORM_TIME_S:"CC_Time",UNIFORM_SINTIME_S:"CC_SinTime",UNIFORM_COSTIME_S:"CC_CosTime",UNIFORM_RANDOM01_S:"CC_Random01",UNIFORM_SAMPLER_S:"CC_Texture0",UNIFORM_ALPHA_TEST_VALUE_S:"CC_alpha_value",ATTRIBUTE_NAME_COLOR:"a_color",ATTRIBUTE_NAME_POSITION:"a_position",ATTRIBUTE_NAME_TEX_COORD:"a_texCoord",ITEM_SIZE:32,CURRENT_ITEM:3233828865,ZOOM_ACTION_TAG:3233828866,NORMAL_TAG:8801,SELECTED_TAG:8802,DISABLE_TAG:8803,FIX_ARTIFACTS_BY_STRECHING_TEXEL:0,DIRECTOR_STATS_POSITION:cc.p(0,0),DIRECTOR_FPS_INTERVAL:.5,COCOSNODE_RENDER_SUBPIXEL:1,SPRITEBATCHNODE_RENDER_SUBPIXEL:1,AUTO_PREMULTIPLIED_ALPHA_FOR_PNG:0,OPTIMIZE_BLEND_FUNC_FOR_PREMULTIPLIED_ALPHA:0,TEXTURE_ATLAS_USE_TRIANGLE_STRIP:0,TEXTURE_ATLAS_USE_VAO:0,TEXTURE_NPOT_SUPPORT:0,USE_LA88_LABELS:1,SPRITE_DEBUG_DRAW:0,LABELBMFONT_DEBUG_DRAW:0,LABELATLAS_DEBUG_DRAW:0,ENABLE_STACKABLE_ACTIONS:1,ENABLE_GL_STATE_CACHE:1},cc.defineGetterSetter(cc.macro,"BLEND_SRC",function(){if(cc._renderType===cc.game.RENDER_TYPE_WEBGL&&cc.macro.OPTIMIZE_BLEND_FUNC_FOR_PREMULTIPLIED_ALPHA)return cc.macro.ONE;else return cc.macro.SRC_ALPHA}),cc.lerp=function(t,e,i){return t+(e-t)*i},cc.rand=function(){return 16777215*Math.random()},cc.randomMinus1To1=function(){return 2*(Math.random()-.5)},cc.random0To1=Math.random,cc.degreesToRadians=function(t){return t*cc.macro.RAD},cc.radiansToDegrees=function(t){return t*cc.macro.DEG},cc.nodeDrawSetup=function(t){if(t._shaderProgram)t._shaderProgram.use(),t._shaderProgram.setUniformForModelViewAndProjectionMatrixWithMat4()},cc.incrementGLDraws=function(t){cc.g_NumberOfDraws+=t},cc.checkGLErrorDebug=function(){if(cc.renderMode===cc.game.RENDER_TYPE_WEBGL){var t=cc._renderContext.getError();if(t)cc.log(cc._LogInfos.checkGLErrorDebug,t)}}},{"./_CCClass":98}],92:[function(t,e,i){function n(){this._name="",this._objFlags=0}function r(){for(var t=A.length,e=0;t>e;++e){var i=A[e];if(!(i._objFlags&o))i._destroyImmediate()}if(t===A.length)A.length=0;else A.splice(0,t);if(!1)O=null}var s=t("./js"),o=1,a=2,c=4,l=8,h=16,u=32,d=64,f=512,_=1024,p=4096,g=8192,m=16384,v=32768,y=65536,T=1<<17,C=1<<18,x=1<<19,S=1<<20,b=f|_,E=~(a|h|d|u|p|m|g|v);n.Flags={Destroyed:o,DontSave:c,EditorOnly:l,Dirty:h,DontDestroy:u,PersistentMask:E,Destroying:d,HideInGame:f,HideInEditor:_,Hide:b,IsOnLoadCalled:g,IsOnLoadStarted:m,IsOnEnableCalled:p,IsOnStartCalled:v,IsPositionLocked:S,IsRotationLocked:y,IsScaleLocked:T,IsAnchorLocked:C,IsSizeLocked:x},t("./CCClass").fastDefine("cc.Object",n,["_name","_objFlags"]);var A=[];if(Object.defineProperty(n,"_deferredDestroy",{value:r}),!1)Object.defineProperty(n,"_clearDeferredDestroyTimer",{value:function(){if(null!==O)clearImmediate(O),O=null},enumerable:!1});var w=n.prototype;s.getset(w,"name",function(){return this._name},function(t){this._name=t}),s.get(w,"isValid",function(){return!(this._objFlags&o)});var O=null;if(w.destroy=function(){if(this._objFlags&o)return cc.warn("object already destroyed"),!1;if(this._objFlags&a)return!1;if(this._objFlags|=a,A.push(this),null===O&&cc.engine&&!cc.engine._isUpdating,!1)O=setImmediate(r);return!0},!1)w.realDestroyInEditor=function(){if(this._objFlags&o)return cc.warn("object already destroyed"),!1;if(this._objFlags&a)return!1;if(this._objFlags|=a,A.push(this),null===O&&cc.engine&&!cc.engine._isUpdating,!1)O=setImmediate(r);return!0};if(w._destruct=function(){if(false)return cc.error("object not yet destroyed");for(var t in this)if(this.hasOwnProperty(t))switch(typeof this[t]){case"string":this[t]="";break;case"object":case"function":this[t]=null}},w._onPreDestroy=null,w._destroyImmediate=function(){if(this._objFlags&o)return void cc.error("object already destroyed");if(this._onPreDestroy)this._onPreDestroy();if(true)this._destruct();this._objFlags|=o},!1)w._serialize=null;if(w._deserialize=null,cc.isValid=function(t){if("object"==typeof t)return!(!t||t._objFlags&o);else return"undefined"!=typeof t},!1)Object.defineProperty(n,"_willDestroy",{value:function(t){return!(t._objFlags&o)&&(t._objFlags&a)>0}}),Object.defineProperty(n,"_cancelDestroy",{value:function(t){t._objFlags&=~a;var e=A.indexOf(t);if(-1!==e)A.splice(e,1)}});cc.Object=n,e.exports=n},{"./CCClass":88,"./js":105}],93:[function(t,e,i){cc.SAXParser=cc._Class.extend({_parser:null,_isSupportDOMParser:null,ctor:function(){if(window.DOMParser)this._isSupportDOMParser=!0,this._parser=new DOMParser;else this._isSupportDOMParser=!1},parse:function(t){return this._parseXML(t)},_parseXML:function(t){var e;if(this._isSupportDOMParser)e=this._parser.parseFromString(t,"text/xml");else e=new ActiveXObject("Microsoft.XMLDOM"),e.async="false",e.loadXML(t);return e}}),cc.PlistParser=cc.SAXParser.extend({parse:function(t){var e=this._parseXML(t),i=e.documentElement;if("plist"!==i.tagName)return cc.warn("Not a plist file!"),{};for(var n=null,r=0,s=i.childNodes.length;s>r&&(n=i.childNodes[r],1!==n.nodeType);r++);return e=null,this._parseNode(n)},_parseNode:function(t){var e=null,i=t.tagName;if("dict"===i)e=this._parseDict(t);else if("array"===i)e=this._parseArray(t);else if("string"===i)if(1===t.childNodes.length)e=t.firstChild.nodeValue;else{e="";for(var n=0;n<t.childNodes.length;n++)e+=t.childNodes[n].nodeValue}else if("false"===i)e=!1;else if("true"===i)e=!0;else if("real"===i)e=parseFloat(t.firstChild.nodeValue);else if("integer"===i)e=parseInt(t.firstChild.nodeValue,10);return e},_parseArray:function(t){for(var e=[],i=0,n=t.childNodes.length;n>i;i++){var r=t.childNodes[i];if(1===r.nodeType)e.push(this._parseNode(r));else;}return e},_parseDict:function(t){for(var e={},i=null,n=0,r=t.childNodes.length;r>n;n++){var s=t.childNodes[n];if(1===s.nodeType)if("key"===s.tagName)i=s.firstChild.nodeValue;else e[i]=this._parseNode(s);else;}return e}}),cc.saxParser=new cc.SAXParser,cc.plistParser=new cc.PlistParser},{}],94:[function(t,e,i){cc.screen={_supportsFullScreen:!1,_preOnFullScreenChange:null,_touchEvent:"",_fn:null,_fnMap:[["requestFullscreen","exitFullscreen","fullscreenchange","fullscreenEnabled","fullscreenElement"],["requestFullScreen","exitFullScreen","fullScreenchange","fullScreenEnabled","fullScreenElement"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitfullscreenchange","webkitIsFullScreen","webkitCurrentFullScreenElement"],["mozRequestFullScreen","mozCancelFullScreen","mozfullscreenchange","mozFullScreen","mozFullScreenElement"],["msRequestFullscreen","msExitFullscreen","MSFullscreenChange","msFullscreenEnabled","msFullscreenElement"]],init:function(){this._fn={};var t,e,i,n=this._fnMap;for(t=0,l=n.length;t<l;t++)if(e=n[t],e&&e[1]in document){for(t=0,i=e.length;i>t;t++)this._fn[n[0][t]]=e[t];break}this._supportsFullScreen="undefined"!=typeof this._fn.requestFullscreen,this._touchEvent="ontouchstart"in window?"touchstart":"mousedown"},fullScreen:function(){if(!this._supportsFullScreen)return!1;else if(void 0===document[this._fn.fullscreenElement]||null===document[this._fn.fullscreenElement])return!1;else return!0},requestFullScreen:function(t,e){if(this._supportsFullScreen){if(t=t||document.documentElement,e){var i=this._fn.fullscreenchange;if(this._preOnFullScreenChange)document.removeEventListener(i,this._preOnFullScreenChange);this._preOnFullScreenChange=e,document.addEventListener(i,e,!1)}return t[this._fn.requestFullscreen]()}},exitFullScreen:function(){return this._supportsFullScreen?document[this._fn.exitFullscreen]():!0},autoFullScreen:function(t,e){function i(){r.requestFullScreen(t,e),n.removeEventListener(r._touchEvent,i)}t=t||document.body;var n=cc._canvas||t,r=this;this.requestFullScreen(t,e),n.addEventListener(this._touchEvent,i)}},cc.screen.init()},{}],95:[function(t,e,i){if(!cc.sys){cc.sys={};var n=cc.sys;if(n.LANGUAGE_ENGLISH="en",n.LANGUAGE_CHINESE="zh",n.LANGUAGE_FRENCH="fr",n.LANGUAGE_ITALIAN="it",n.LANGUAGE_GERMAN="de",n.LANGUAGE_SPANISH="es",n.LANGUAGE_DUTCH="du",n.LANGUAGE_RUSSIAN="ru",n.LANGUAGE_KOREAN="ko",n.LANGUAGE_JAPANESE="ja",n.LANGUAGE_HUNGARIAN="hu",n.LANGUAGE_PORTUGUESE="pt",n.LANGUAGE_ARABIC="ar",n.LANGUAGE_NORWEGIAN="no",n.LANGUAGE_POLISH="pl",n.LANGUAGE_UNKNOWN="unkonwn",n.OS_IOS="iOS",n.OS_ANDROID="Android",n.OS_WINDOWS="Windows",n.OS_MARMALADE="Marmalade",n.OS_LINUX="Linux",n.OS_BADA="Bada",n.OS_BLACKBERRY="Blackberry",n.OS_OSX="OS X",n.OS_WP8="WP8",n.OS_WINRT="WINRT",n.OS_UNKNOWN="Unknown",n.UNKNOWN=-1,n.WIN32=0,n.LINUX=1,n.MACOS=2,n.ANDROID=3,n.IPHONE=4,n.IPAD=5,n.BLACKBERRY=6,n.NACL=7,n.EMSCRIPTEN=8,n.TIZEN=9,n.WINRT=10,n.WP8=11,n.MOBILE_BROWSER=100,n.DESKTOP_BROWSER=101,n.EDITOR_PAGE=102,n.EDITOR_CORE=103,n.BROWSER_TYPE_WECHAT="wechat",n.BROWSER_TYPE_ANDROID="androidbrowser",n.BROWSER_TYPE_IE="ie",n.BROWSER_TYPE_QQ="qqbrowser",n.BROWSER_TYPE_MOBILE_QQ="mqqbrowser",n.BROWSER_TYPE_UC="ucbrowser",n.BROWSER_TYPE_360="360browser",n.BROWSER_TYPE_BAIDU_APP="baiduboxapp",n.BROWSER_TYPE_BAIDU="baidubrowser",n.BROWSER_TYPE_MAXTHON="maxthon",n.BROWSER_TYPE_OPERA="opera",n.BROWSER_TYPE_OUPENG="oupeng",n.BROWSER_TYPE_MIUI="miuibrowser",n.BROWSER_TYPE_FIREFOX="firefox",n.BROWSER_TYPE_SAFARI="safari",n.BROWSER_TYPE_CHROME="chrome",n.BROWSER_TYPE_LIEBAO="liebao",n.BROWSER_TYPE_QZONE="qzone",n.BROWSER_TYPE_SOUGOU="sogou",n.BROWSER_TYPE_UNKNOWN="unknown",n.isNative=!1,n.isBrowser="object"==typeof window&&"object"==typeof document,"undefined"!=typeof Editor&&Editor.isCoreLevel)n.isMobile=!1,n.platform=n.EDITOR_CORE,n.language=n.LANGUAGE_UNKNOWN,n.os={darwin:n.OS_OSX,win32:n.OS_WINDOWS,linux:n.OS_LINUX}[process.platform]||n.OS_UNKNOWN,n.browserType=null,n.browserVersion=null,n.windowPixelResolution={width:0,height:0},n.__audioSupport={};else{var r=window,s=r.navigator,o=document,a=o.documentElement,c=s.userAgent.toLowerCase();if(cc.isEditor)n.isMobile=!1,n.platform=n.EDITOR_PAGE;else n.isMobile=-1!==c.indexOf("mobile")||-1!==c.indexOf("android"),n.platform=n.isMobile?n.MOBILE_BROWSER:n.DESKTOP_BROWSER;var l=s.language;l=l?l:s.browserLanguage,l=l?l.split("-")[0]:n.LANGUAGE_ENGLISH,n.language=l;var h=c.match(/(iPad|iPhone|iPod)/i)?!0:!1,u=c.match(/android/i)||s.platform.match(/android/i)?!0:!1,d=n.OS_UNKNOWN;if(-1!==s.appVersion.indexOf("Win"))d=n.OS_WINDOWS;else if(h)d=n.OS_IOS;else if(-1!==s.appVersion.indexOf("Mac"))d=n.OS_OSX;else if(-1!==s.appVersion.indexOf("X11")&&-1===s.appVersion.indexOf("Linux"))d=n.OS_UNIX;else if(u)d=n.OS_ANDROID;else if(-1!==s.appVersion.indexOf("Linux"))d=n.OS_LINUX;n.os=d,n.browserType=n.BROWSER_TYPE_UNKNOWN,function(){var t=/mqqbrowser|sogou|qzone|liebao|micromessenger|ucbrowser|360 aphone|360browser|baiduboxapp|baidubrowser|maxthon|mxbrowser|trident|miuibrowser/i,e=/qqbrowser|chrome|safari|firefox|opr|oupeng|opera/i,i=t.exec(c);if(!i)i=e.exec(c);var r=i?i[0]:n.BROWSER_TYPE_UNKNOWN;if("micromessenger"===r)r=n.BROWSER_TYPE_WECHAT;else if("safari"===r&&c.match(/android.*applewebkit/))r=n.BROWSER_TYPE_ANDROID;else if("trident"===r)r=n.BROWSER_TYPE_IE;else if("360 aphone"===r)r=n.BROWSER_TYPE_360;else if("mxbrowser"===r)r=n.BROWSER_TYPE_MAXTHON;else if("opr"===r)r=n.BROWSER_TYPE_OPERA;n.browserType=r}(),n.browserVersion="",function(){var t=/(micromessenger|qq|mx|maxthon|baidu|sogou)(mobile)?(browser)?\/?([\d.]+)/i,e=/(msie |rv:|firefox|chrome|ucbrowser|oupeng|opera|opr|safari|miui)(mobile)?(browser)?\/?([\d.]+)/i,i=c.match(t);if(!i)i=c.match(e);n.browserVersion=i?i[4]:""}();var f=window.innerWidth||document.documentElement.clientWidth,_=window.innerHeight||document.documentElement.clientHeight,p=window.devicePixelRatio||1;n.windowPixelResolution={width:p*f,height:p*_},n._checkWebGLRenderMode=function(){if(cc._renderType!==cc.game.RENDER_TYPE_WEBGL)throw new Error("This feature supports WebGL render mode only.")};var g=document.createElement("canvas"),m=document.createElement("canvas");if(cc.create3DContext=function(t,e){for(var i=["webgl","experimental-webgl","webkit-3d","moz-webgl"],n=null,r=0;r<i.length;++r){try{n=t.getContext(i[r],e)}catch(s){}if(n)break}return n},n._supportCanvasNewBlendModes=function(){var t,e,i=g;i.width=1,i.height=1;var n=i.getContext("2d");n.fillStyle="#000",n.fillRect(0,0,1,1),n.globalCompositeOperation="multiply";var r=m;r.width=1,r.height=1;var s=r.getContext("2d");s.fillStyle="#fff",s.fillRect(0,0,1,1),n.drawImage(r,0,0,1,1),t=n.getImageData(0,0,1,1).data[0],i=g,i.width=1,i.height=1;var n=i.getContext("2d");n.fillStyle="#fff",n.fillRect(0,0,1,1),n.globalCompositeOperation="destination-atop",r=m,r.width=1,r.height=1;var s=r.getContext("2d");return s.fillStyle="#000",s.fillRect(0,0,1,1),n.drawImage(r,0,0,1,1),e=n.getImageData(0,0,1,1).data[0],0===t&&0===e}(),cc.sys.isMobile){var v=document.createElement("style");v.type="text/css",document.body.appendChild(v),v.textContent="body,canvas,div{ -moz-user-select: none;-webkit-user-select: none;-ms-user-select: none;-khtml-user-select: none;-webkit-tap-highlight-color:rgba(0,0,0,0);}"}try{var y=n.localStorage=r.localStorage;y.setItem("storage",""),y.removeItem("storage"),y=null}catch(T){var C=function(){cc.warn("Warning: localStorage isn't enabled. Please confirm browser cookie or privacy option")};n.localStorage={getItem:C,setItem:C,removeItem:C,clear:C}}var x=!!g.getContext("2d"),S=!1,b=document.createElement("CANVAS");if(r.WebGLRenderingContext)try{var E=cc.create3DContext(b,{stencil:!0,preserveDrawingBuffer:!0});if(E)S=!0;if(n.os===n.OS_ANDROID){S=!1;var A=parseFloat(n.browserVersion);if(n.browserType===n.BROWSER_TYPE_MOBILE_QQ&&A>=6.2)S=!0;else if(n.osMainVersion&&n.osMainVersion>=5&&n.browserType===n.BROWSER_TYPE_ANDROID)S=!0}}catch(T){}var w=n.capabilities={canvas:x,opengl:S};if(void 0!==a.ontouchstart||void 0!==o.ontouchstart||s.msPointerEnabled)w.touches=!0;if(void 0!==a.onmouseup)w.mouse=!0;if(void 0!==a.onkeyup)w.keyboard=!0;if(r.DeviceMotionEvent||r.DeviceOrientationEvent)w.accelerometer=!0;delete g,delete m;var O;!function(){var t=!1,e=n.browserVersion,i=!!(window.AudioContext||window.webkitAudioContext||window.mozAudioContext),r={common:{MULTI_CHANNEL:!0,WEB_AUDIO:i,AUTOPLAY:!0}};if(r[n.BROWSER_TYPE_IE]={MULTI_CHANNEL:!0,WEB_AUDIO:i,AUTOPLAY:!0,USE_EMPTIED_EVENT:!0},r[n.BROWSER_TYPE_ANDROID]={MULTI_CHANNEL:!1,WEB_AUDIO:!1,AUTOPLAY:!1},r[n.BROWSER_TYPE_CHROME]={MULTI_CHANNEL:!0,WEB_AUDIO:!0,AUTOPLAY:!1},r[n.BROWSER_TYPE_FIREFOX]={MULTI_CHANNEL:!0,WEB_AUDIO:!0,AUTOPLAY:!0,DELAY_CREATE_CTX:!0},r[n.BROWSER_TYPE_UC]={MULTI_CHANNEL:!0,WEB_AUDIO:!1,AUTOPLAY:!1},r[n.BROWSER_TYPE_QQ]={MULTI_CHANNEL:!1,WEB_AUDIO:!1,AUTOPLAY:!0},r[n.BROWSER_TYPE_OUPENG]={MULTI_CHANNEL:!1,WEB_AUDIO:!1,AUTOPLAY:!1,REPLAY_AFTER_TOUCH:!0,USE_EMPTIED_EVENT:!0},r[n.BROWSER_TYPE_WECHAT]={MULTI_CHANNEL:!1,WEB_AUDIO:!1,AUTOPLAY:!1,REPLAY_AFTER_TOUCH:!0,USE_EMPTIED_EVENT:!0},r[n.BROWSER_TYPE_360]={MULTI_CHANNEL:!1,WEB_AUDIO:!1,AUTOPLAY:!0},r[n.BROWSER_TYPE_MIUI]={MULTI_CHANNEL:!1,WEB_AUDIO:!1,AUTOPLAY:!0},r[n.BROWSER_TYPE_LIEBAO]={MULTI_CHANNEL:!1,WEB_AUDIO:!1,AUTOPLAY:!1,REPLAY_AFTER_TOUCH:!0,USE_EMPTIED_EVENT:!0},r[n.BROWSER_TYPE_SOUGOU]={MULTI_CHANNEL:!1,WEB_AUDIO:!1,AUTOPLAY:!1,REPLAY_AFTER_TOUCH:!0,USE_EMPTIED_EVENT:!0},r[n.BROWSER_TYPE_BAIDU]={MULTI_CHANNEL:!1,WEB_AUDIO:!1,AUTOPLAY:!1,REPLAY_AFTER_TOUCH:!0,USE_EMPTIED_EVENT:!0},r[n.BROWSER_TYPE_BAIDU_APP]={MULTI_CHANNEL:!1,WEB_AUDIO:!1,AUTOPLAY:!1,REPLAY_AFTER_TOUCH:!0,USE_EMPTIED_EVENT:!0},r[n.BROWSER_TYPE_SAFARI]={MULTI_CHANNEL:!0,WEB_AUDIO:!0,AUTOPLAY:!1,webAudioCallback:function(t){document.createElement("audio").src=t}},n.isMobile)if(n.os!==n.OS_IOS)O=r[n.browserType]||r.common;else O=r[n.BROWSER_TYPE_SAFARI];else switch(n.browserType){case n.BROWSER_TYPE_IE:O=r[n.BROWSER_TYPE_IE];break;case n.BROWSER_TYPE_FIREFOX:O=r[n.BROWSER_TYPE_FIREFOX];break;default:O=r.common}if(e)switch(n.browserType){case n.BROWSER_TYPE_CHROME:if(e=parseInt(e),30>e)O={MULTI_CHANNEL:!1,WEB_AUDIO:!0,AUTOPLAY:!1};else if(42===e)O.NEED_MANUAL_LOOP=!0;break;case n.BROWSER_TYPE_MIUI:if(n.isMobile)if(e=e.match(/\d+/g),e[0]<2||2===e[0]&&0===e[1]&&e[2]<=1)O.AUTOPLAY=!1}if(t)setTimeout(function(){cc.log("browse type: "+n.browserType),cc.log("browse version: "+e),cc.log("MULTI_CHANNEL: "+O.MULTI_CHANNEL),cc.log("WEB_AUDIO: "+O.WEB_AUDIO),cc.log("AUTOPLAY: "+O.AUTOPLAY)},0)}();try{if(O.WEB_AUDIO)if(O.context=new(window.AudioContext||window.webkitAudioContext||window.mozAudioContext),O.DELAY_CREATE_CTX)setTimeout(function(){O.context=new(window.AudioContext||window.webkitAudioContext||window.mozAudioContext)},0)}catch(I){O.WEB_AUDIO=!1,cc.log("browser don't support web audio")}var R=[];!function(){var t=document.createElement("audio");if(t.canPlayType){var e=t.canPlayType('audio/ogg; codecs="vorbis"');if(e)R.push(".ogg");var i=t.canPlayType("audio/mpeg");if(i)R.push(".mp3");var n=t.canPlayType('audio/wav; codecs="1"');if(n)R.push(".wav");var r=t.canPlayType("audio/mp4");if(r)R.push(".mp4");var s=t.canPlayType("audio/x-m4a");if(s)R.push(".m4a")}}(),O.format=R,n.__audioSupport=O}n.garbageCollect=function(){},n.dumpRoot=function(){},n.restartVM=function(){},n.cleanScript=function(t){},n.isObjectValid=function(t){if(t)return!0;else return!1},n.dump=function(){var t=this,e="";e+="isMobile : "+t.isMobile+"\r\n",e+="language : "+t.language+"\r\n",e+="browserType : "+t.browserType+"\r\n",e+="browserVersion : "+t.browserVersion+"\r\n",e+="capabilities : "+JSON.stringify(t.capabilities)+"\r\n",e+="os : "+t.os+"\r\n",e+="osVersion : "+t.osVersion+"\r\n",e+="platform : "+t.platform+"\r\n",e+="Using "+(cc._renderType===cc.game.RENDER_TYPE_WEBGL?"WEBGL":"CANVAS")+" renderer.\r\n",cc.log(e)},n.openURL=function(t){window.open(t)},e.exports=n}},{}],96:[function(t,e,i){var n={init:function(){this.html=document.getElementsByTagName("html")[0]},availWidth:function(t){if(!t||t===this.html)return window.innerWidth;else return t.clientWidth},availHeight:function(t){if(!t||t===this.html)return window.innerHeight;else return t.clientHeight},meta:{width:"device-width"},adaptationType:cc.sys.browserType};if(window.navigator.userAgent.indexOf("OS 8_1_")>-1)n.adaptationType=cc.sys.BROWSER_TYPE_MIUI;if(cc.sys.os===cc.sys.OS_IOS)n.adaptationType=cc.sys.BROWSER_TYPE_SAFARI;switch(n.adaptationType){case cc.sys.BROWSER_TYPE_SAFARI:n.meta["minimal-ui"]="true",n.availWidth=function(t){return t.clientWidth},n.availHeight=function(t){return t.clientHeight};break;case cc.sys.BROWSER_TYPE_CHROME:n.__defineGetter__("target-densitydpi",function(){return cc.view._targetDensityDPI});case cc.sys.BROWSER_TYPE_SOUGOU:case cc.sys.BROWSER_TYPE_UC:n.availWidth=function(t){return t.clientWidth},n.availHeight=function(t){return t.clientHeight};break;case cc.sys.BROWSER_TYPE_MIUI:n.init=function(t){if(!t.__resizeWithBrowserSize){var e=function(){t.setDesignResolutionSize(t._designResolutionSize.width,t._designResolutionSize.height,t._resolutionPolicy),window.removeEventListener("resize",e,!1)};window.addEventListener("resize",e,!1)}}}var r=cc._Class.extend({_delegate:null,_frameSize:null,_designResolutionSize:null,_originalDesignResolutionSize:null,_viewPortRect:null,_visibleRect:null,_retinaEnabled:!1,_autoFullScreen:!0,_devicePixelRatio:1,_viewName:"",_resizeCallback:null,_scaleX:1,_originalScaleX:1,_scaleY:1,_originalScaleY:1,_indexBitsUsed:0,_maxTouches:5,_resolutionPolicy:null,_rpExactFit:null,_rpShowAll:null,_rpNoBorder:null,_rpFixedHeight:null,_rpFixedWidth:null,_initialized:!1,_captured:!1,_wnd:null,_hDC:null,_hRC:null,_supportTouch:!1,_contentTranslateLeftTop:null,_frameZoomFactor:1,__resizeWithBrowserSize:!1,_isAdjustViewPort:!0,_targetDensityDPI:null,ctor:function(){var t=this,e=(document,cc.ContainerStrategy),i=cc.ContentStrategy;n.init(this),t._frameSize=cc.size(0,0),t._initFrameSize();var r=cc.game.canvas.width,s=cc.game.canvas.height;t._designResolutionSize=cc.size(r,s),t._originalDesignResolutionSize=cc.size(r,s),t._viewPortRect=cc.rect(0,0,r,s),t._visibleRect=cc.rect(0,0,r,s),t._contentTranslateLeftTop={left:0,top:0},t._viewName="Cocos2dHTML5";var o=cc.sys;t.enableRetina(o.os===o.OS_IOS||o.os===o.OS_OSX),cc.visibleRect&&cc.visibleRect.init(t._visibleRect),t._rpExactFit=new cc.ResolutionPolicy(e.EQUAL_TO_FRAME,i.EXACT_FIT),t._rpShowAll=new cc.ResolutionPolicy(e.PROPORTION_TO_FRAME,i.SHOW_ALL),t._rpNoBorder=new cc.ResolutionPolicy(e.EQUAL_TO_FRAME,i.NO_BORDER),t._rpFixedHeight=new cc.ResolutionPolicy(e.EQUAL_TO_FRAME,i.FIXED_HEIGHT),t._rpFixedWidth=new cc.ResolutionPolicy(e.EQUAL_TO_FRAME,i.FIXED_WIDTH),t._hDC=cc.game.canvas,t._hRC=cc._renderContext,t._targetDensityDPI=cc.macro.DENSITYDPI_HIGH},_resizeEvent:function(){var t;if(this.setDesignResolutionSize)t=this;else t=cc.view;var e=t._frameSize.width,i=t._frameSize.height;if(t._initFrameSize(),t._frameSize.width!==e||t._frameSize.height!==i){var n=t._originalDesignResolutionSize.width,r=t._originalDesignResolutionSize.height;if(n>0)t.setDesignResolutionSize(n,r,t._resolutionPolicy);if(cc.eventManager.dispatchCustomEvent("canvas-resize"),t._resizeCallback)t._resizeCallback.call()}},setTargetDensityDPI:function(t){this._targetDensityDPI=t,this._adjustViewportMeta()},getTargetDensityDPI:function(){return this._targetDensityDPI},resizeWithBrowserSize:function(t){if(t){if(!this.__resizeWithBrowserSize)this.__resizeWithBrowserSize=!0,window.addEventListener("resize",this._resizeEvent),window.addEventListener("orientationchange",this._resizeEvent)}else if(this.__resizeWithBrowserSize)this.__resizeWithBrowserSize=!1,window.removeEventListener("resize",this._resizeEvent),window.removeEventListener("orientationchange",this._resizeEvent)},setResizeCallback:function(t){if(cc.js.isFunction(t)||null==t)this._resizeCallback=t},_initFrameSize:function(){var t=this._frameSize;t.width=n.availWidth(cc.game.frame),t.height=n.availHeight(cc.game.frame)},_adjustSizeKeepCanvasSize:function(){var t=this._originalDesignResolutionSize.width,e=this._originalDesignResolutionSize.height;if(t>0)this.setDesignResolutionSize(t,e,this._resolutionPolicy)},_setViewportMeta:function(t,e){var i=document.getElementById("cocosMetaElement");if(i&&e)document.head.removeChild(i);var n,r,s,o=document.getElementsByName("viewport"),a=o?o[0]:null;n=a?a.content:"",i=i||document.createElement("meta"),i.id="cocosMetaElement",i.name="viewport",i.content="";for(r in t)if(-1==n.indexOf(r))n+=","+r+"="+t[r];else if(e)s=new RegExp(r+"s*=s*[^,]+"),n.replace(s,r+"="+t[r]);if(/^,/.test(n))n=n.substr(1);if(i.content=n,a)a.content=n;document.head.appendChild(i)},_adjustViewportMeta:function(){if(this._isAdjustViewPort)this._setViewportMeta(n.meta,!1)},_resetScale:function(){this._scaleX=this._originalScaleX,this._scaleY=this._originalScaleY},_adjustSizeToBrowser:function(){},initialize:function(){this._initialized=!0},adjustViewPort:function(t){
this._isAdjustViewPort=t},enableRetina:function(t){this._retinaEnabled=!!t},isRetinaEnabled:function(){return this._retinaEnabled},enableAutoFullScreen:function(t){this._autoFullScreen=t?!0:!1},isAutoFullScreenEnabled:function(){return this._autoFullScreen},end:function(){},isOpenGLReady:function(){return null!==this._hDC&&null!==this._hRC},setFrameZoomFactor:function(t){this._frameZoomFactor=t,this.centerWindow(),cc.director.setProjection(cc.director.getProjection())},swapBuffers:function(){},setIMEKeyboardState:function(t){},setContentTranslateLeftTop:function(t,e){this._contentTranslateLeftTop={left:t,top:e}},getContentTranslateLeftTop:function(){return this._contentTranslateLeftTop},setCanvasSize:function(t,e){var i=cc.game.canvas,n=cc.game.container;i.width=t*this._devicePixelRatio,i.height=e*this._devicePixelRatio,i.style.width=t+"px",i.style.height=e+"px",n.style.width=t+"px",n.style.height=e+"px",this._resizeEvent()},getCanvasSize:function(){return cc.size(cc.game.canvas.width,cc.game.canvas.height)},getFrameSize:function(){return cc.size(this._frameSize.width,this._frameSize.height)},setFrameSize:function(t,e){this._frameSize.width=t,this._frameSize.height=e,cc.game.frame.style.width=t+"px",cc.game.frame.style.height=e+"px",this._resizeEvent(),cc.director.setProjection(cc.director.getProjection())},centerWindow:function(){},getVisibleSize:function(){return cc.size(this._visibleRect.width,this._visibleRect.height)},getVisibleSizeInPixel:function(){return cc.size(this._visibleRect.width*this._scaleX,this._visibleRect.height*this._scaleY)},getVisibleOrigin:function(){return cc.p(this._visibleRect.x,this._visibleRect.y)},getVisibleOriginInPixel:function(){return cc.p(this._visibleRect.x*this._scaleX,this._visibleRect.y*this._scaleY)},canSetContentScaleFactor:function(){return!0},getResolutionPolicy:function(){return this._resolutionPolicy},setResolutionPolicy:function(t){var e=this;if(t instanceof cc.ResolutionPolicy)e._resolutionPolicy=t;else{var i=cc.ResolutionPolicy;if(t===i.EXACT_FIT)e._resolutionPolicy=e._rpExactFit;if(t===i.SHOW_ALL)e._resolutionPolicy=e._rpShowAll;if(t===i.NO_BORDER)e._resolutionPolicy=e._rpNoBorder;if(t===i.FIXED_HEIGHT)e._resolutionPolicy=e._rpFixedHeight;if(t===i.FIXED_WIDTH)e._resolutionPolicy=e._rpFixedWidth}},setDesignResolutionSize:function(t,e,i){if(!(t>0||e>0))return void cc.log(cc._LogInfos.view.setDesignResolutionSize);this.setResolutionPolicy(i);var n=this._resolutionPolicy;if(!n)return void cc.log(cc._LogInfos.view.setDesignResolutionSize_2);if(n.preApply(this),cc.sys.isMobile)this._adjustViewportMeta();this._initFrameSize(),this._originalDesignResolutionSize.width=this._designResolutionSize.width=t,this._originalDesignResolutionSize.height=this._designResolutionSize.height=e;var r=n.apply(this,this._designResolutionSize);if(r.scale&&2===r.scale.length)this._scaleX=r.scale[0],this._scaleY=r.scale[1];if(r.viewport){var s=this._viewPortRect,o=this._visibleRect,a=r.viewport;s.x=a.x,s.y=a.y,s.width=a.width,s.height=a.height,o.x=-s.x/this._scaleX,o.y=-s.y/this._scaleY,o.width=cc.game.canvas.width/this._scaleX,o.height=cc.game.canvas.height/this._scaleY,cc._renderContext.setOffset&&cc._renderContext.setOffset(s.x,-s.y)}var c=cc.director;if(c._winSizeInPoints.width=this._designResolutionSize.width,c._winSizeInPoints.height=this._designResolutionSize.height,n.postApply(this),cc.winSize.width=c._winSizeInPoints.width,cc.winSize.height=c._winSizeInPoints.height,cc._renderType===cc.game.RENDER_TYPE_WEBGL)c.setGLDefaultValues();if(this._originalScaleX=this._scaleX,this._originalScaleY=this._scaleY,cc.DOM)cc.DOM._resetEGLViewDiv();cc.visibleRect&&cc.visibleRect.init(this._visibleRect)},getDesignResolutionSize:function(){return cc.size(this._designResolutionSize.width,this._designResolutionSize.height)},setRealPixelResolution:function(t,e,i){this._setViewportMeta({width:t},!0),document.body.style.width=t+"px",document.body.style.left="0px",document.body.style.top="0px",this.setDesignResolutionSize(t,e,i)},setViewPortInPoints:function(t,e,i,n){var r=this._frameZoomFactor,s=this._scaleX,o=this._scaleY;cc._renderContext.viewport(t*s*r+this._viewPortRect.x*r,e*o*r+this._viewPortRect.y*r,i*s*r,n*o*r)},setScissorInPoints:function(t,e,i,n){var r=this._frameZoomFactor,s=this._scaleX,o=this._scaleY;cc._renderContext.scissor(t*s*r+this._viewPortRect.x*r,e*o*r+this._viewPortRect.y*r,i*s*r,n*o*r)},isScissorEnabled:function(){var t=cc._renderContext;return t.isEnabled(t.SCISSOR_TEST)},getScissorRect:function(){var t=cc._renderContext,e=this._scaleX,i=this._scaleY,n=t.getParameter(t.SCISSOR_BOX);return cc.rect((n[0]-this._viewPortRect.x)/e,(n[1]-this._viewPortRect.y)/i,n[2]/e,n[3]/i)},setViewName:function(t){if(null!=t&&t.length>0)this._viewName=t},getViewName:function(){return this._viewName},getViewPortRect:function(){return this._viewPortRect},getScaleX:function(){return this._scaleX},getScaleY:function(){return this._scaleY},getDevicePixelRatio:function(){return this._devicePixelRatio},convertToLocationInView:function(t,e,i){return{x:this._devicePixelRatio*(t-i.left),y:this._devicePixelRatio*(i.top+i.height-e)}},_convertMouseToLocationInView:function(t,e){var i=this._viewPortRect,n=this;t.x=(n._devicePixelRatio*(t.x-e.left)-i.x)/n._scaleX,t.y=(n._devicePixelRatio*(e.top+e.height-t.y)-i.y)/n._scaleY},_convertTouchesWithScale:function(t){for(var e,i,n,r=this._viewPortRect,s=this._scaleX,o=this._scaleY,a=0;a<t.length;a++)e=t[a],i=e._point,n=e._prevPoint,selStartPoint=e._startPoint,e._setPoint((i.x-r.x)/s,(i.y-r.y)/o),e._setPrevPoint((n.x-r.x)/s,(n.y-r.y)/o),selStartPoint.x=(selStartPoint.x-r.x)/s,selStartPoint.y=(selStartPoint.y-r.y)/o}});r._getInstance=function(){if(!this._instance)this._instance=this._instance||new r,this._instance.initialize();return this._instance},cc.ContainerStrategy=cc._Class.extend({preApply:function(t){},apply:function(t,e){},postApply:function(t){},_setupContainer:function(t,e,i){var n=cc.game.frame;if(cc.view._autoFullScreen&&cc.sys.isMobile&&n===document.documentElement)cc.screen.autoFullScreen(n);var r=cc.game.canvas,s=cc.game.container;s.style.width=r.style.width=e+"px",s.style.height=r.style.height=i+"px";var o=t._devicePixelRatio=1;if(t.isRetinaEnabled())o=t._devicePixelRatio=window.devicePixelRatio||1;r.width=e*o,r.height=i*o,cc._renderContext.resetCache&&cc._renderContext.resetCache();var a,c=document.body;if(c&&(a=c.style))a.paddingTop=a.paddingTop||"0px",a.paddingRight=a.paddingRight||"0px",a.paddingBottom=a.paddingBottom||"0px",a.paddingLeft=a.paddingLeft||"0px",a.borderTop=a.borderTop||"0px",a.borderRight=a.borderRight||"0px",a.borderBottom=a.borderBottom||"0px",a.borderLeft=a.borderLeft||"0px",a.marginTop=a.marginTop||"0px",a.marginRight=a.marginRight||"0px",a.marginBottom=a.marginBottom||"0px",a.marginLeft=a.marginLeft||"0px"},_fixContainer:function(){document.body.insertBefore(cc.container,document.body.firstChild);var t=document.body.style;t.width=window.innerWidth+"px",t.height=window.innerHeight+"px",t.overflow="hidden";var e=cc.container.style;e.position="fixed",e.left=e.top="0px",document.body.scrollTop=0}}),cc.ContentStrategy=cc._Class.extend({_result:{scale:[1,1],viewport:null},_buildResult:function(t,e,i,n,r,s){Math.abs(t-i)<2&&(i=t),Math.abs(e-n)<2&&(n=e);var o=cc.rect(Math.round((t-i)/2),Math.round((e-n)/2),i,n);if(cc._renderType===cc.game.RENDER_TYPE_CANVAS);return this._result.scale=[r,s],this._result.viewport=o,this._result},preApply:function(t){},apply:function(t,e){return{scale:[1,1]}},postApply:function(t){}}),function(){var t=cc.ContainerStrategy.extend({apply:function(t){this._setupContainer(t,t._frameSize.width,t._frameSize.height)}}),e=cc.ContainerStrategy.extend({apply:function(t,e){var i,n,r=t._frameSize.width,s=t._frameSize.height,o=cc.container.style,a=e.width,c=e.height,l=r/a,h=s/c;h>l?(i=r,n=c*l):(i=a*h,n=s);var u=Math.round((r-i)/2),d=Math.round((s-n)/2);i=r-2*u,n=s-2*d,this._setupContainer(t,i,n),o.marginLeft=u+"px",o.marginRight=u+"px",o.marginTop=d+"px",o.marginBottom=d+"px"}}),i=(t.extend({preApply:function(t){this._super(t),cc.game.frame=document.documentElement},apply:function(t){this._super(t),this._fixContainer()}}),e.extend({preApply:function(t){this._super(t),cc.game.frame=document.documentElement},apply:function(t,e){this._super(t,e),this._fixContainer()}}),cc.ContainerStrategy.extend({apply:function(t){this._setupContainer(t,cc.game.canvas.width,cc.game.canvas.height)}}));cc.ContainerStrategy.EQUAL_TO_FRAME=new t,cc.ContainerStrategy.PROPORTION_TO_FRAME=new e,cc.ContainerStrategy.ORIGINAL_CONTAINER=new i;var n=cc.ContentStrategy.extend({apply:function(t,e){var i=cc.game.canvas.width,n=cc.game.canvas.height,r=i/e.width,s=n/e.height;return this._buildResult(i,n,i,n,r,s)}}),r=cc.ContentStrategy.extend({apply:function(t,e){var i,n,r=cc.game.canvas.width,s=cc.game.canvas.height,o=e.width,a=e.height,c=r/o,l=s/a,h=0;return l>c?(h=c,i=r,n=a*h):(h=l,i=o*h,n=s),this._buildResult(r,s,i,n,h,h)}}),s=cc.ContentStrategy.extend({apply:function(t,e){var i,n,r,s=cc.game.canvas.width,o=cc.game.canvas.height,a=e.width,c=e.height,l=s/a,h=o/c;return h>l?(i=h,n=a*i,r=o):(i=l,n=s,r=c*i),this._buildResult(s,o,n,r,i,i)}}),o=cc.ContentStrategy.extend({apply:function(t,e){var i=cc.game.canvas.width,n=cc.game.canvas.height,r=e.height,s=n/r,o=i,a=n;return this._buildResult(i,n,o,a,s,s)},postApply:function(t){cc.director._winSizeInPoints=t.getVisibleSize()}}),a=cc.ContentStrategy.extend({apply:function(t,e){var i=cc.game.canvas.width,n=cc.game.canvas.height,r=e.width,s=i/r,o=i,a=n;return this._buildResult(i,n,o,a,s,s)},postApply:function(t){cc.director._winSizeInPoints=t.getVisibleSize()}});cc.ContentStrategy.EXACT_FIT=new n,cc.ContentStrategy.SHOW_ALL=new r,cc.ContentStrategy.NO_BORDER=new s,cc.ContentStrategy.FIXED_HEIGHT=new o,cc.ContentStrategy.FIXED_WIDTH=new a}(),cc.ResolutionPolicy=cc._Class.extend({_containerStrategy:null,_contentStrategy:null,ctor:function(t,e){this.setContainerStrategy(t),this.setContentStrategy(e)},preApply:function(t){this._containerStrategy.preApply(t),this._contentStrategy.preApply(t)},apply:function(t,e){return this._containerStrategy.apply(t,e),this._contentStrategy.apply(t,e)},postApply:function(t){this._containerStrategy.postApply(t),this._contentStrategy.postApply(t)},setContainerStrategy:function(t){if(t instanceof cc.ContainerStrategy)this._containerStrategy=t},setContentStrategy:function(t){if(t instanceof cc.ContentStrategy)this._contentStrategy=t}}),cc.js.get(cc.ResolutionPolicy.prototype,"canvasSize",function(){return cc.v2(cc.game.canvas.width,cc.game.canvas.height)}),cc.ResolutionPolicy.EXACT_FIT=0,cc.ResolutionPolicy.NO_BORDER=1,cc.ResolutionPolicy.SHOW_ALL=2,cc.ResolutionPolicy.FIXED_HEIGHT=3,cc.ResolutionPolicy.FIXED_WIDTH=4,cc.ResolutionPolicy.UNKNOWN=5,e.exports=r},{}],97:[function(t,e,i){cc.visibleRect={topLeft:cc.p(0,0),topRight:cc.p(0,0),top:cc.p(0,0),bottomLeft:cc.p(0,0),bottomRight:cc.p(0,0),bottom:cc.p(0,0),center:cc.p(0,0),left:cc.p(0,0),right:cc.p(0,0),width:0,height:0,init:function(t){var e=this.width=t.width,i=this.height=t.height,n=t.x,r=t.y,s=r+i,o=n+e;this.topLeft.x=n,this.topLeft.y=s,this.topRight.x=o,this.topRight.y=s,this.top.x=n+e/2,this.top.y=s,this.bottomLeft.x=n,this.bottomLeft.y=r,this.bottomRight.x=o,this.bottomRight.y=r,this.bottom.x=n+e/2,this.bottom.y=r,this.center.x=n+e/2,this.center.y=r+i/2,this.left.x=n,this.left.y=r+i/2,this.right.x=o,this.right.y=r+i/2}}},{}],98:[function(t,e,i){var n=cc.ClassManager={id:0|998*Math.random(),instanceId:0|998*Math.random(),getNewID:function(){return this.id++},getNewInstanceId:function(){return this.instanceId++}},r=/\b_super\b/,s=function(){};s.extend=function(t){function e(){if(this.__instanceId=n.getNewInstanceId(),this.ctor)this.ctor.apply(this,arguments)}var i=this.prototype,o=Object.create(i),a=n.getNewID();n[a]=i;var c={writable:!0,enumerable:!1,configurable:!0};o.__instanceId=null,e.id=a,c.value=a,Object.defineProperty(o,"__cid__",c),e.prototype=o,c.value=e,Object.defineProperty(e.prototype,"constructor",c);for(var l=0,h=arguments.length;h>l;++l){var u=arguments[l];for(var d in u){var f="function"==typeof u[d],_="function"==typeof i[d],p=r.test(u[d]);if(f&&_&&p)c.value=function(t,e){return function(){var n=this._super;this._super=i[t];var r=e.apply(this,arguments);return this._super=n,r}}(d,u[d]),Object.defineProperty(o,d,c);else if(f)c.value=u[d],Object.defineProperty(o,d,c);else o[d]=u[d]}}return e.extend=s.extend,e.implement=function(t){for(var e in t)o[e]=t[e]},e},cc.defineGetterSetter=function(t,e,i,n,r,s){if(t.__defineGetter__)i&&t.__defineGetter__(e,i),n&&t.__defineSetter__(e,n);else if(Object.defineProperty){var o={enumerable:!1,configurable:!0};i&&(o.get=i),n&&(o.set=n),Object.defineProperty(t,e,o)}else throw new Error("browser does not support getters")},cc.clone=function(t){var e=t.constructor?new t.constructor:{};for(var i in t){var n=t[i];if("object"==typeof n&&n&&!(n instanceof _ccsg.Node)&&!(n instanceof HTMLElement))e[i]=cc.clone(n);else e[i]=n}return e},cc._Class=e.exports=s},{}],99:[function(t,e,i){function n(t,e,i){var n,r,s,o="_attr$"+e;if("function"==typeof t){if(n=t.prototype,r=n[o],"undefined"!=typeof i)if("object"==typeof i){if(!r)n[o]=r={};for(s in i)if("_"!==s[0])r[s]=i[s]}else return n[o]=i,i;return r}else if(n=t,"undefined"!=typeof i)if("object"==typeof i){if(n.hasOwnProperty(o))r=n[o];if(!r)n[o]=r={};for(s in i)if("_"!==s[0])r[s]=i[s];return c.addon({},r,n.constructor.prototype[o])}else return n[o]=i,i;else if(r=n[o],"object"==typeof r)return c.addon({},r,n.constructor.prototype[o]);else return r}function r(t,e,i){if(!1)return function(n,r){var s=cc.Class.attr(n,r)||{};if(s.type!==t)return void cc.warn("Can only indicate one type attribute for %s.%s.",c.getClassName(n),r);if(s.hasOwnProperty("default")){var o=s["default"];if("undefined"!=typeof o){var a=Array.isArray(o)||l(o);if(!a){var h=typeof o,u=t.toLowerCase();if(h===u)if("object"===u)if(o&&!(o instanceof i))cc.warn("The default value of %s.%s is not instance of %s.",c.getClassName(n),r,c.getClassName(i));else return;else cc.warn('No needs to indicate the "%s" attribute for %s.%s, which its default value is type of %s.',e,c.getClassName(n),r,t);else if("function"!==h)cc.warn('Can not indicate the "%s" attribute for %s.%s, which its default value is type of %s.',e,c.getClassName(n),r,h);delete s.type}}}};else;}function s(t){return{type:"Object",ctor:t}}function o(t){return{rawType:t,serializable:!1,_canUsedInGetter:!1,_onAfterProp:function(t,e){}}}function a(t,e){return{min:t,max:e}}var c=t("./js"),l=t("./utils").isPlainEmptyObj_DEV;if(cc.Integer="Integer",cc.Float="Float",!1)c.get(cc,"Number",function(){return cc.warn('Use "cc.Float" or "cc.Integer" instead of "cc.Number" please. 😂'),cc.Float});cc.Boolean="Boolean",cc.String="String";var h={serializable:!1,_canUsedInGetter:!1},u={editorOnly:!0,_canUsedInGetter:!1};e.exports={attr:n,getTypeChecker:r,NonSerialized:h,EditorOnly:u,ObjectType:s,RawType:o,ScriptUuid:{},Range:a}},{"./js":105,"./utils":111}],100:[function(t,e,i){var n=t("./js"),r=function(){this._callbackTable={}};r.prototype.add=function(t,e,i){var n=this._callbackTable[t];if("undefined"!=typeof n){if("function"==typeof e)if(n.push(e),"object"==typeof i)n.push(i);return!1}else{if(n="function"==typeof e?[e]:[],n&&"object"==typeof i)n.push(i);return this._callbackTable[t]=n,!0}},r.prototype.has=function(t,e,i){var n,r,s=this._callbackTable[t];if(s&&s.length>0){if(!e)return!0;else if("function"!=typeof e)return!1;for(r=s.indexOf(e);-1!==r;){if(n=s[r+1],"object"!=typeof n)n=void 0;if(n===i)return!0;r=cc.js.array.indexOf.call(s,e,r+1)}return!1}return!1},r.prototype.removeAll=function(t){if(this._invoking[t])return void(this._toRemoveAll=t);if("object"==typeof t){var e,i,n,r=t;for(t in this._callbackTable)for(e=this._callbackTable[t],i=e.lastIndexOf(r);-1!==i;){if(n=e[i-1],"function"==typeof n)e.splice(i-1,2);else e.splice(i,1);i=e.lastIndexOf(r)}}else delete this._callbackTable[t]},r.prototype.remove=function(t,e,i){var n,r,s=this._callbackTable[t];if(s){if(this._invoking[t]){if(!this._toRemove[t])this._toRemove[t]=[];return this._toRemove[t].push([e,i]),!0}for(n=s.indexOf(e);-1!==n;){if(r=s[n+1],"object"!=typeof r)r=void 0;if(r===i){s.splice(n,r?2:1);break}n=cc.js.array.indexOf.call(s,e,n+1)}return!0}return!1};var s=function(){r.call(this),this._invoking={},this._toRemove={},this._toRemoveAll=null};if(n.extend(s,r),!1)cc._Test.CallbacksInvoker=s;s.prototype.invoke=function(t,e,i,n,r,s){this._toRemove.length=0,this._invoking[t]=!0;var o,a=this._callbackTable[t];if(a){var c=a.length-1;for(o=0;c>=o;){var l,h=a[o],u=a[o+1],d=u&&"object"==typeof u;if(d)a[o].call(u,e,i,n,r,s),l=2;else h(e,i,n,r,s),l=1;o+=l}}this._invoking[t]=!1;var f=this._toRemove[t];if(f){for(o=0;o<f.length;++o){var _=f[o];this.remove(t,_[0],_[1])}delete this._toRemove[t]}if(this._toRemoveAll)this.removeAll(this._toRemoveAll),this._toRemoveAll=null},s.prototype.invokeAndRemove=function(t,e,i,n,r,s){this._invoking[t]=!0;var o,a,c,l=this._callbackTable[t];if(l)for(o=0,a=l.length;a>o;)if(c=l[o+1],c&&"object"==typeof c)l[o].call(c,e,i,n,r,s),o+=2;else l[o](e,i,n,r,s),++o;this._invoking[t]=!1,delete this._toRemove[t],this.removeAll(t)},s.prototype.bindKey=function(t,e){var i=this;return function(n,r,s,o,a){var c,l,h,u=i._callbackTable[t];if(u)for(c=0,l=u.length;l>c;)if(h=u[c+1],h&&"object"==typeof h)u[c].call(h,n,r,s,o,a),c+=2;else u[c](n,r,s,o,a),++c;if(e)i.removeAll(t)}},s.CallbacksHandler=r,e.exports=s},{"./js":105}],101:[function(t,e,i){var n=t("./js"),r=(t("./CCObject"),!1),s=r,o=function(){if(this.uuidList=[],this.uuidObjList=[],this.uuidPropList=[],this.rawProp="",r)this.visitorInEditor=null,this.visitObjList=[],this.visitPropList=[]};if(o.prototype.reset=function(){if(this.uuidList.length=0,this.uuidObjList.length=0,this.uuidPropList.length=0,this.rawProp="",r)this.visitorInEditor=null,this.visitObjList.length=0,this.visitPropList.length=0},r)o.prototype.visitLater=function(t,e){this.visitObjList.push(t),this.visitPropList.push(e)};o.prototype.getUuidOf=function(t,e){for(var i=0;i<this.uuidObjList.length;i++)if(this.uuidObjList[i]===t&&this.uuidPropList[i]===e)return this.uuidList[i];return""},o.prototype.assignAssetsBy=function(t){for(var e=!0,i=0,n=this.uuidList.length;n>i;i++){var r=this.uuidList[i],s=t(r);if(s){var o=this.uuidObjList[i],a=this.uuidPropList[i];o[a]=s}else cc.error("Failed to assign asset: "+r),e=!1}return e},o.prototype.push=function(t,e,i){this.uuidList.push(i),this.uuidObjList.push(t),this.uuidPropList.push(e)};var a=function(){function t(t,e,i,n){if(this._classFinder=n,s)this._target=i;if(this._idList=[],this._idObjList=[],this._idPropList=[],this.result=e||new o,Array.isArray(t)){var a=t,h=a.length;this.deserializedList=new Array(h);for(var u=0;h>u;u++)if(a[u]){var d;if(s)d=0===u&&i;this.deserializedList[u]=l(this,a[u],d)}this.deserializedData=h>0?this.deserializedList[0]:[]}else this.deserializedList=[null],this.deserializedData=t?l(this,t,i):null,this.deserializedList[0]=this.deserializedData;if(c(this),r)this._callVisitorInEditor()}function e(t,e,i){for(var n in i)if(i.hasOwnProperty(n)){var o=i[n];if("object"!=typeof o){if("__type__"!==n)if(e[n]=o,t.result.visitorInEditor&&r)t.result.visitLater(e,n)}else if(o)if(s)t._deserializeObjField(e,o,n,t._target&&e);else t._deserializeObjField(e,o,n);else e[n]=null}}function i(t,e,i){for(var n in e){var r=i[n];if("undefined"!=typeof r&&i.hasOwnProperty(n))if("object"!=typeof r)e[n]=r;else if(r)if(s)t._deserializeObjField(e,r,n,t._target&&e);else t._deserializeObjField(e,r,n);else e[n]=null}}function a(t,i,n,o,a){for(var c=o.__props__,l=0;l<c.length;l++){var h=c[l],u=cc.Class.attr(o,h),d=u.rawType;if(!d){if(!r&&u.editorOnly){var f=i instanceof cc.Node&&"_id"===h;if(!f)continue}if(u.serializable===!1)continue;var _=n[h];if("undefined"==typeof _)continue;if("object"!=typeof _)i[h]=_;else if(_)if(s)t._deserializeObjField(i,_,h,a&&i);else t._deserializeObjField(i,_,h);else i[h]=null}else{if(t.result.rawProp)cc.error("not support multi raw object in a file");t.result.rawProp=h}}if("_$erialized"===c[c.length-1])i._$erialized=n,e(t,i._$erialized,n)}var c=function(t){for(var e=t.deserializedList,i=0,n=t._idList.length;n>i;i++){var r=t._idPropList[i],s=t._idList[i];t._idObjList[i][r]=e[s]}};if(r)t.prototype._callVisitorInEditor=function(){var t=this.result;if(t.visitorInEditor)t.visitorInEditor(t.visitObjList,t.visitPropList,this)};t.prototype._deserializeObjField=function(t,e,i,n){var o=e.__id__;if("undefined"==typeof o){var a=e.__uuid__;if(a)this.result.uuidList.push(a),this.result.uuidObjList.push(t),this.result.uuidPropList.push(i);else{if(s)t[i]=l(this,e,n&&n[i]);else t[i]=l(this,e);if(this.result.visitorInEditor&&r)this.result.visitLater(t,i)}}else{var c=this.deserializedList[o];if(c)t[i]=c;else this._idList.push(o),this._idObjList.push(t),this._idPropList.push(i);if(this.result.visitorInEditor&&r)this.result.visitLater(t,i)}};var l=function(t,o,c){var l,h=null,u=null;if(o.__type__){var d=o.__type__;if(u=t._classFinder(d),!u)if(false)return d=Editor.UuidUtils.decompressUuid(d),cc.warn('Can not find script "%s"',d),null;else return cc.warn('Can not find class "%s"',d),null;if(s&&c){if(!(c instanceof u))cc.warn("Type of target to deserialize not matched with data: target is %s, data is %s",n.getClassName(c),u);h=c}else if(h=new u,cc.sys.isNative&&u===cc.SpriteFrame)h.retain();if(h._deserialize)return h._deserialize(o.content,t),h;if(cc.Class._isCCClass(u))a(t,h,o,u,c);else i(t,h,o)}else if(!Array.isArray(o))h=s&&c||{},e(t,h,o);else{if(s&&c)c.length=o.length,h=c;else h=new Array(o.length);for(var f=0;f<o.length;f++)if(l=o[f],"object"==typeof l&&l)if(s)t._deserializeObjField(h,l,""+f,c&&h);else t._deserializeObjField(h,l,""+f);else if(h[f]=l,t.result.visitorInEditor&&r)t.result.visitLater(h,""+f)}return h};return t}();cc.deserialize=function(t,e,i){var r=i&&i.classFinder||n._getClassById,c=i&&i.createAssetRefs||cc.sys.platform===cc.sys.EDITOR_CORE,l=s&&i&&i.target;if(false)t=t.toString();if("string"==typeof t)t=JSON.parse(t);if(c&&!e)e=new o;cc.game._isCloning=!0;var h=new a(t,e,l,r);if(cc.game._isCloning=!1,c)e.assignAssetsBy(Editor.serialize.asAsset);return h.deserializedData},cc.deserialize.Details=o},{"./CCObject":92,"./js":105}],102:[function(t,e,i){function n(t){this.id=0|998*Math.random(),this.prefix=t?""+t+r:""}var r=".";n.prototype.getNewId=function(){return this.prefix+ ++this.id},n.global=new n("global"),e.exports=n},{}],103:[function(t,e,i){if(t("./js"),t("./CCClass"),t("./CCObject"),t("./callbacks-invoker"),t("./url"),t("./deserialize"),t("./instantiate"),t("./prefab-info"),t("./requiring-frame"),t("./CCSys"),t("./CCMacro"),cc.sys.isBrowser||cc.sys.isNative)t("./CCAssetLibrary");if(!0)t("./miniFramework"),t("./CCVisibleRect")},{"./CCAssetLibrary":87,"./CCClass":88,"./CCMacro":91,"./CCObject":92,"./CCSys":95,"./CCVisibleRect":97,"./callbacks-invoker":100,"./deserialize":101,"./instantiate":104,"./js":105,"./miniFramework":106,"./prefab-info":107,"./requiring-frame":109,"./url":110}],104:[function(t,e,i){function n(t){if("object"!=typeof t||Array.isArray(t))return cc.error("The thing you want to instantiate must be an object"),null;if(!t)return cc.error("The thing you want to instantiate is nil"),null;if(t instanceof o&&!t.isValid)return cc.error("The thing you want to instantiate is destroyed"),null;var e;if(t instanceof o)if(t._instantiate)return cc.game._isCloning=!0,e=t._instantiate(),cc.game._isCloning=!1,e;else if(t instanceof cc.Asset)return cc.error("The instantiate method for given asset do not implemented"),null;return cc.game._isCloning=!0,e=r(t),cc.game._isCloning=!1,e}function r(t,e){if(Array.isArray(t))return cc.error("Can not instantiate array"),null;if(c&&c(t))return cc.error("Can not instantiate DOM element"),null;for(var i=h(t,e),n=0,r=l.length;r>n;++n)l[n]._iN$t=null;return l.length=0,i}function s(t,e,i,n){var r=t._iN$t;if(r)return r;if(!cc.isValid(t))return null;if(t instanceof cc.Asset)return t;else if(Array.isArray(t)){var o=t.length;r=new Array(o),t._iN$t=r;for(var a=0;o>a;++a){var c=t[a],u=typeof c;if("object"===u)r[a]=c?s(c,e,r,""+a):c;else r[a]="function"!==u?c:null}return l.push(t),r}else if(t instanceof cc.ValueType)return t.clone();else{var d=t.constructor;if(cc.Class._isCCClass(d)){if(e)if(e instanceof cc.Component){if(t instanceof cc._BaseNode||t instanceof cc.Component)return t}else if(e instanceof cc._BaseNode)if(t instanceof cc._BaseNode){if(!t.isChildOf(e))return t}else if(t instanceof cc.Component)if(!t.node.isChildOf(e))return t}else if(d!==Object)return t;return h(t,e)}}var o=t("./CCObject"),a=o.Flags.PersistentMask,c=t("./utils").isDomNode,l=[],h=function(t,e){var i,n,r,c=t.constructor,h=new c;if(t._iN$t=h,l.push(t),cc.Class._isCCClass(c)){for(var u=c.__props__,d=0;d<u.length;d++){r=u[d];var f=cc.Class.attr(c,r);if(f.serializable!==!1)if(i=t[r],n=typeof i,"object"===n)h[r]=i?s(i,e,h,r):i;else h[r]="function"!==n?i:null}if(h instanceof cc._BaseNode||h instanceof cc.Component,!1)h._id=""}else for(r in t)if(t.hasOwnProperty(r)&&(95!==r.charCodeAt(0)||95!==r.charCodeAt(1)))if(i=t[r],i!==h)if(n=typeof i,"object"===n)h[r]=i?s(i,e,h,r):i;else h[r]="function"!==n?i:null;else;else;if(t instanceof o)h._objFlags&=a;return h};n._clone=r,cc.instantiate=n,e.exports=n},{"./CCObject":92,"./utils":111}],105:[function(t,e,i){function n(t,e){var i=Object.getOwnPropertyDescriptor(t,e);if(i)return i;var r=Object.getPrototypeOf(t);if(r)return n(r,e);else return null}function r(t,e,i){var r=n(e,t);Object.defineProperty(i,t,r)}function s(){return a+c++}var o={isFunction:function(t){return"function"==typeof t},isNumber:function(t){return"number"==typeof t||"[object Number]"===Object.prototype.toString.call(t)},isString:function(t){return"string"==typeof t||"[object String]"===Object.prototype.toString.call(t)},isArray:function(t){return Array.isArray(t)||"object"==typeof t&&"[object Array]"===Object.prototype.toString.call(t)},isUndefined:function(t){return"undefined"==typeof t},isObject:function(t){return"object"==typeof t&&"[object Object]"===Object.prototype.toString.call(t)},addon:function(t){"use strict";t=t||{};for(var e=1,i=arguments.length;i>e;e++){var n=arguments[e];if(n){if("object"!=typeof n){cc.error("cc.js.addon called on non-object:",n);continue}for(var s in n)if(!(s in t))r(s,n,t)}}return t},mixin:function(t){"use strict";t=t||{};for(var e=1,i=arguments.length;i>e;e++){var n=arguments[e];if(n){if("object"!=typeof n){cc.error("cc.js.mixin: arguments must be type object:",n);continue}for(var s in n)r(s,n,t)}}return t},extend:function(t,e){if(!1){if(!e)return void cc.error("The base class to extend from must be non-nil");if(!t)return void cc.error("The class to extend must be non-nil")}for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i];return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t},clear:function(t){for(var e=Object.keys(t),i=0;i<e.length;i++)delete t[e[i]]},getPropertyDescriptor:n};o.getClassName=function(t){if("function"==typeof t){if(t.prototype.__classname__)return t.prototype.__classname__}else if(t&&t.constructor){if(t.constructor.prototype&&t.constructor.prototype.hasOwnProperty("__classname__"))return t.__classname__;var e;if(t.constructor.name)e=t.constructor.name;if(t.constructor.toString){var i,n=t.constructor.toString();if("["===n.charAt(0))i=n.match(/\[\w+\s*(\w+)\]/);else i=n.match(/function\s*(\w+)/);if(i&&2===i.length)e=i[1]}return"Object"!==e?e:""}return""};var a="cc.TmpCId.",c=0;o._isTempClassId=function(t){return!1},function(){function t(t,e){return function(i,n){if(n.prototype.hasOwnProperty(t))delete e[n.prototype[t]];if(n.prototype[t]=i,i){var r=e[i];if(r&&r!==n){var s="A Class already exists with the same "+t+' : "'+i+'".';if(!1)s+=' (This may be caused by error of unit test.) If you dont need serialization, you can set class id to "". You can also call cc.js.unregisterClass to remove the id of unused class';cc.error(s)}else e[i]=n}}}var e={},i={};o._setClassId=t("__cid__",e);var n=t("__classname__",i);if(o.setClassName=function(t,e){if(n(t,e),!e.prototype.hasOwnProperty("__cid__")){var i=t||s();if(i)o._setClassId(i,e)}},o.unregisterClass=function(t){"use strict";for(var n=0;n<arguments.length;n++){var r=arguments[n].prototype,s=r.__cid__;if(s)delete e[s];var o=r.__classname__;if(o)delete i[o]}},o._getClassById=function(t){return e[t]},o.getClassByName=function(t){return i[t]},o._getClassId=function(t,e){e="undefined"!=typeof e?e:!0;var i;if("function"==typeof t&&t.prototype.hasOwnProperty("__cid__"))if(i=t.prototype.__cid__,!e&&o._isTempClassId(i))return"";else return i;if(t&&t.constructor){var n=t.constructor.prototype;if(n&&n.hasOwnProperty("__cid__"))if(i=t.__cid__,!e&&o._isTempClassId(i))return"";else return i}return""},!1)Object.defineProperty(o,"_registeredClassIds",{get:function(){var t={};for(var i in e)t[i]=e[i];return t},set:function(t){o.clear(e);for(var i in t)e[i]=t[i]}}),Object.defineProperty(o,"_registeredClassNames",{get:function(){var t={};for(var e in i)t[e]=i[e];return t},set:function(t){o.clear(i);for(var e in t)i[e]=t[e]}})}(),o.getset=function(t,e,i,n,r){if("function"!=typeof n)r=n,n=void 0;Object.defineProperty(t,e,{get:i,set:n,enumerable:!!r})},o.get=function(t,e,i,n){Object.defineProperty(t,e,{get:i,enumerable:!!n})},o.set=function(t,e,i,n){Object.defineProperty(t,e,{set:i,enumerable:!!n})},o.obsolete=function(t,e,i,n){var r=e.split(".").slice(-1);if(o.get(t,r,function(){if(!1)cc.warn('"%s" is deprecated, use "%s" instead please.',e,i);return t[i]}),n)o.set(t,r,function(n){if(!1)cc.warn('"%s" is deprecated, use "%s" instead please.',e,i);t[i]=n})},o.obsoletes=function(t,e,i,n){for(var r in i){var s=i[r];o.obsolete(t,e+"."+r,s,n)}},o.formatStr=function(){var t=arguments,e=t.length;if(1>e)return"";var i=t[0],n=!0;if("object"==typeof i)n=!1;for(var r=1;e>r;++r){var s=t[r];if(n)for(;;){var o=null;if("number"==typeof s)if(o=i.match(/(%d)|(%s)/)){i=i.replace(/(%d)|(%s)/,s);break}if(o=i.match(/%s/))i=i.replace(/%s/,s);else i+="    "+s;break}else i+="    "+s}return i},o.array={remove:function(t,e){var i=t.indexOf(e);if(-1!==i)return t.splice(i,1),!0;else return!1},removeAt:function(t,e){t.splice(e,1)},contains:function(t,e){return-1!==t.indexOf(e)},verifyType:function(t,e){if(t&&t.length>0)for(var i=0;i<t.length;i++)if(!(t[i]instanceof e))return cc.log(cc._LogInfos.Array.verifyType),!1;return!0},removeArray:function(t,e){for(var i=0,n=e.length;n>i;i++)remove(t,e[i])},appendObjectsAt:function(t,e,i){return t.splice.apply(t,[i,0].concat(e)),t},copy:function(t){var e,i=t.length,n=new Array(i);for(e=0;i>e;e+=1)n[e]=t[e];return n},indexOf:Array.prototype.indexOf},cc.js=o,e.exports=o},{}],106:[function(t,e,i){switch(cc.$=function(t){var e=this===cc?document:this,i=t instanceof HTMLElement?t:e.querySelector(t);if(i)i.find=i.find||cc.$,i.hasClass=i.hasClass||function(t){return this.className.match(new RegExp("(\\s|^)"+t+"(\\s|$)"))},i.addClass=i.addClass||function(t){if(!this.hasClass(t)){if(this.className)this.className+=" ";this.className+=t}return this},i.removeClass=i.removeClass||function(t){if(this.hasClass(t))this.className=this.className.replace(t,"");return this},i.remove=i.remove||function(){if(this.parentNode)this.parentNode.removeChild(this);return this},i.appendTo=i.appendTo||function(t){return t.appendChild(this),this},i.prependTo=i.prependTo||function(t){return t.childNodes[0]?t.insertBefore(this,t.childNodes[0]):t.appendChild(this),this},i.transforms=i.transforms||function(){return this.style[cc.$.trans]=cc.$.translate(this.position)+cc.$.rotate(this.rotation)+cc.$.scale(this.scale)+cc.$.skew(this.skew),this},i.position=i.position||{x:0,y:0},i.rotation=i.rotation||0,i.scale=i.scale||{x:1,y:1},i.skew=i.skew||{x:0,y:0},i.translates=function(t,e){return this.position.x=t,this.position.y=e,this.transforms(),this},i.rotate=function(t){return this.rotation=t,this.transforms(),this},i.resize=function(t,e){return this.scale.x=t,this.scale.y=e,this.transforms(),this},i.setSkew=function(t,e){
return this.skew.x=t,this.skew.y=e,this.transforms(),this};return i},cc.sys.browserType){case cc.sys.BROWSER_TYPE_FIREFOX:cc.$.pfx="Moz",cc.$.hd=!0;break;case cc.sys.BROWSER_TYPE_CHROME:case cc.sys.BROWSER_TYPE_SAFARI:cc.$.pfx="webkit",cc.$.hd=!0;break;case cc.sys.BROWSER_TYPE_OPERA:cc.$.pfx="O",cc.$.hd=!1;break;case cc.sys.BROWSER_TYPE_IE:cc.$.pfx="ms",cc.$.hd=!1;break;default:cc.$.pfx="webkit",cc.$.hd=!0}cc.$.trans=cc.$.pfx+"Transform",cc.$.translate=cc.$.hd?function(t){return"translate3d("+t.x+"px, "+t.y+"px, 0) "}:function(t){return"translate("+t.x+"px, "+t.y+"px) "},cc.$.rotate=cc.$.hd?function(t){return"rotateZ("+t+"deg) "}:function(t){return"rotate("+t+"deg) "},cc.$.scale=function(t){return"scale("+t.x+", "+t.y+") "},cc.$.skew=function(t){return"skewX("+-t.x+"deg) skewY("+t.y+"deg)"},cc.$new=function(t){return cc.$(document.createElement(t))},cc.$.findpos=function(t){var e=0,i=0;do e+=t.offsetLeft,i+=t.offsetTop;while(t=t.offsetParent);return{x:e,y:i}}},{}],107:[function(t,e,i){var n=cc.Class({name:"cc.PrefabInfo",properties:{root:{"default":null},asset:{"default":null},fileId:{"default":""}}});cc._PrefabInfo=e.exports=n},{}],108:[function(t,e,i){function n(t,e,i,n){if(!t.get&&!t.set){if(t.hasOwnProperty("default")){var r="_N$"+e;t.get=function(){return this[r]},t.set=function(t){var e=this[r];this[r]=t,i.call(this,e)};var s={};n[r]=s;for(var o in c){var a=c[o];if(t.hasOwnProperty(o))if(s[o]=t[o],!a.canUsedInGet)delete t[o]}}else if(!1)cc.warn('"notify" must work with "default" !')}else if(!1)cc.warn('"notify" can\'t work with "get/set" !')}function r(t,e,i,n){if(Array.isArray(n))if(n.length>0)n=n[0];else if(!1)return cc.error("Invalid url of %s.%s",e,i);if(!1){if(null==n)return cc.warn('The "url" attribute of "%s.%s" is undefined when loading script.',e,i);if("function"!=typeof n||!cc.isChildClassOf(n,cc.RawAsset))return cc.error('The "url" type of "%s.%s" must be child class of cc.RawAsset.',e,i);if(cc.isChildClassOf(n,cc.Asset))return cc.error('The "url" type of "%s.%s" must not be child class of cc.Asset, otherwise you should use "type: %s" instead.',e,i,cc.js.getClassName(n));if(t.type)return cc.warn('Can not specify "type" attribute for "%s.%s", because its "url" is already defined.',e,i)}t.type=n}function s(e,i,n,r){if(Array.isArray(i)){if(!1){var s=t("./CCClass").isArray;if(!s(e["default"]))cc.warn('The "default" attribute of "%s.%s" must be an array',n,r)}if(i.length>0)e.type=i=i[0];else return cc.error("Invalid type of %s.%s",n,r)}if(!1)if("function"==typeof i){if(cc.RawAsset.isRawAssetType(i))cc.warn('The "type" attribute of "%s.%s" must be child class of cc.Asset, otherwise you should use "url: %s" instead',n,r,cc.js.getClassName(i))}else if("Number"===i)cc.warn('The "type" attribute of "%s.%s" can not be "Number", use "Float" or "Integer" instead please.',n,r);else if(null==i)cc.warn('The "type" attribute of "%s.%s" is undefined when loading script.',n,r)}function o(t,e,i,n){if(false)if(cc.Class._isCCClass(e)&&t.serializable!==!1&&!cc.js._getClassId(e,!1))cc.warn('Can not serialize "%s.%s" because the specified type is anonymous, please provide a class name or set the "serializable" attribute of "%s.%s" to "false".',i,n,i,n)}function a(t,e){if(!1){for(var i;e&&e.__props__&&-1!==e.__props__.indexOf(t);e=e.$super)i=e;if(!i)cc.error("unknown error");return i}}var c={url:{canUsedInGet:!0},"default":{},serializable:{},editorOnly:{},rawType:{}};e.exports=function(t,e,i){for(var c in t){var l=t[c],h=l&&l.constructor===Object;if(!h){if(Array.isArray(l)&&l.length>0)l={"default":[],type:l};else if("function"==typeof l){var u=l;if(cc.RawAsset.isRawAssetType(u))l={"default":"",url:u};else l={"default":cc.isChildClassOf(u,cc.ValueType)?new u:null,type:l}}else l={"default":l};t[c]=l}if(l){if(!1)if("default"in l){if(l.get)cc.error('The "default" value of "%s.%s" should not be used with a "get" function.',e,c);else if(l.set)cc.error('The "default" value of "%s.%s" should not be used with a "set" function.',e,c)}else if(!l.get&&!l.set)cc.error('Property "%s.%s" must define at least one of "default", "get" or "set".',e,c);if(!l.override&&-1!==i.__props__.indexOf(c),!1){var d=cc.js.getClassName(a(c,i));cc.warn('"%s.%s" hides inherited property "%s.%s". To make the current property override that implementation, add the `override: true` attribute please.',e,c,d,c)}var f=l.notify;if(f)n(l,c,f,t);if("type"in l)s(l,l.type,e,c);if("url"in l)r(l,e,c,l.url);if("type"in l)o(l,l.type,e,c)}}}},{"./CCClass":88}],109:[function(t,e,i){var n=[];if(cc._RFpush=function(t,e,i){if(2===arguments.length)i=e,e="";n.push({uuid:e,script:i,module:t,exports:t.exports,beh:null})},cc._RFpop=function(){var t=n.pop(),e=t.module,i=e.exports;if(i===t.exports){for(var r in i)return;e.exports=i=t.beh}},cc._RFpeek=function(){return n[n.length-1]},!1)cc._RFreset=function(){n=[]}},{}],110:[function(t,e,i){var n={};cc.url={_rawAssets:"",_builtinRawAssets:"",normalize:function(t){if("."===t[0]&&"/"===t[1])t=t.slice(2);else if("/"===t[0])t=t.slice(1);return t},raw:function(t){if(!this._rawAssets,!1)return cc.error("Failed to init asset's raw path."),"";if(t=this.normalize(t),!t.startsWith("resources/"))if(!1)cc.error('Should not load "%s" from script dynamically, unless it is placed in the "resources" folder.',t);else cc.error('Sorry can not load "%s" because it is not placed in the "resources" folder.',t);return this._rawAssets+t},builtinRaw:!1,_init:function(t){for(var e in t){var i=t[e];i=cc.path._setEndWithSep(i,"/"),n[e]=i}this._rawAssets=n.assets,this._builtinRawAssets=n.internal}},e.exports=cc.url},{}],111:[function(t,e,i){if(e.exports={isDomNode:"object"==typeof window&&function(t){return"object"==typeof Node?t instanceof Node:t&&"object"==typeof t&&"number"==typeof t.nodeType&&"string"==typeof t.nodeName},callInNextTick:!1?function(t,e,i){if(t)process.nextTick(function(){t(e,i)})}:function(t,e,i){if(t)setTimeout(function(){t(e,i)},0)}},!1)cc.js.mixin(e.exports,{isPlainEmptyObj_DEV:function(t){if(!t||t.constructor!==Object)return!1;for(var e in t)return!1;return!0},cloneable_DEV:function(t){return t&&"function"==typeof t.clone&&(t.constructor.prototype.hasOwnProperty("clone")||t.hasOwnProperty("clone"))}});if(!1)if("undefined"==typeof Editor)Editor={UuidUtils:{NonUuidMark:".",uuid:function(){return""+((new Date).getTime()+Math.random())}}}},{}],112:[function(t,e,i){cc.rendererCanvas={childrenOrderDirty:!0,_transformNodePool:[],_renderCmds:[],_isCacheToCanvasOn:!1,_cacheToCanvasCmds:{},_cacheInstanceIds:[],_currentID:0,_clearColor:cc.color(),_clearFillStyle:"rgb(0, 0, 0)",getRenderCmd:function(t){return t._createRenderCmd()},rendering:function(t){var e,i,n=this._renderCmds,r=cc.view.getScaleX(),s=cc.view.getScaleY(),o=t||cc._renderContext;for(o.computeRealOffsetY(),e=0,i=n.length;i>e;e++)n[e].rendering(o,r,s)},_renderingToCacheCanvas:function(t,e,i,n){if(!t)cc.log("The context of RenderTexture is invalid.");i=cc.js.isUndefined(i)?1:i,n=cc.js.isUndefined(n)?1:n,e=e||this._currentID;var r,s,o=this._cacheToCanvasCmds[e];for(t.computeRealOffsetY(),r=0,s=o.length;s>r;r++)o[r].rendering(t,i,n);o.length=0;var a=this._cacheInstanceIds;if(delete this._cacheToCanvasCmds[e],cc.js.array.remove(a,e),0===a.length)this._isCacheToCanvasOn=!1;else this._currentID=a[a.length-1]},_turnToCacheMode:function(t){if(this._isCacheToCanvasOn=!0,t=t||0,this._cacheToCanvasCmds[t]=[],-1===this._cacheInstanceIds.indexOf(t))this._cacheInstanceIds.push(t);this._currentID=t},_turnToNormalMode:function(){this._isCacheToCanvasOn=!1},resetFlag:function(){this.childrenOrderDirty=!1,this._transformNodePool.length=0},transform:function(){var t=this._transformNodePool;t.sort(this._sortNodeByLevelAsc);for(var e=0,i=t.length;i>e;e++)if(0!==t[e]._dirtyFlag)t[e].updateStatus();t.length=0},transformDirty:function(){return this._transformNodePool.length>0},_sortNodeByLevelAsc:function(t,e){return t._curLevel-e._curLevel},pushDirtyNode:function(t){this._transformNodePool.push(t)},clear:function(){var t=cc._canvas,e=cc._renderContext,i=e.getContext();if(i.setTransform(1,0,0,1,0,0),i.clearRect(0,0,t.width,t.height),0!==this._clearColor.r||0!==this._clearColor.g||0!==this._clearColor.b)e.setFillStyle(this._clearFillStyle),e.setGlobalAlpha(this._clearColor.a),i.fillRect(0,0,t.width,t.height)},clearRenderCommands:function(){this._renderCmds.length=0,this._cacheInstanceIds.length=0,this._isCacheToCanvasOn=!1},pushRenderCommand:function(t){if(t._needDraw)if(this._isCacheToCanvasOn){var e=this._currentID,i=this._cacheToCanvasCmds,n=i[e];if(-1===n.indexOf(t))n.push(t)}else if(-1===this._renderCmds.indexOf(t))this._renderCmds.push(t)}},function(){cc.CanvasContextWrapper=function(t){this._context=t,this._saveCount=0,this._currentAlpha=t.globalAlpha,this._currentCompositeOperation=t.globalCompositeOperation,this._currentFillStyle=t.fillStyle,this._currentStrokeStyle=t.strokeStyle,this._offsetX=0,this._offsetY=0,this._realOffsetY=this.height,this._armatureMode=0};var t=cc.CanvasContextWrapper.prototype;t.resetCache=function(){var t=this._context;this._currentAlpha=t.globalAlpha,this._currentCompositeOperation=t.globalCompositeOperation,this._currentFillStyle=t.fillStyle,this._currentStrokeStyle=t.strokeStyle,this._realOffsetY=this._context.canvas.height+this._offsetY},t.setOffset=function(t,e){this._offsetX=t,this._offsetY=e,this._realOffsetY=this._context.canvas.height+this._offsetY},t.computeRealOffsetY=function(){this._realOffsetY=this._context.canvas.height+this._offsetY},t.setViewScale=function(t,e){this._scaleX=t,this._scaleY=e},t.getContext=function(){return this._context},t.save=function(){this._context.save(),this._saveCount++},t.restore=function(){this._context.restore(),this._saveCount--},t.setGlobalAlpha=function(t){if(this._saveCount>0)this._context.globalAlpha=t;else if(this._currentAlpha!==t)this._currentAlpha=t,this._context.globalAlpha=t},t.setCompositeOperation=function(t){if(this._saveCount>0)this._context.globalCompositeOperation=t;else if(this._currentCompositeOperation!==t)this._currentCompositeOperation=t,this._context.globalCompositeOperation=t},t.setFillStyle=function(t){if(this._saveCount>0)this._context.fillStyle=t;else if(this._currentFillStyle!==t)this._currentFillStyle=t,this._context.fillStyle=t},t.setStrokeStyle=function(t){if(this._saveCount>0)this._context.strokeStyle=t;else if(this._currentStrokeStyle!==t)this._currentStrokeStyle=t,this._context.strokeStyle=t},t.setTransform=function(t,e,i){if(this._armatureMode>0)this.restore(),this.save(),this._context.transform(t.a,-t.b,-t.c,t.d,t.tx*e,-(t.ty*i));else this._context.setTransform(t.a,-t.b,-t.c,t.d,this._offsetX+t.tx*e,this._realOffsetY-t.ty*i)},t._switchToArmatureMode=function(t,e,i,n){if(t)this._armatureMode++,this._context.setTransform(e.a,e.c,e.b,e.d,this._offsetX+e.tx*i,this._realOffsetY-e.ty*n),this.save();else this._armatureMode--,this.restore()}}()},{}],113:[function(t,e,i){cc.rendererWebGL={childrenOrderDirty:!0,_transformNodePool:[],_renderCmds:[],_isCacheToBufferOn:!1,_cacheToBufferCmds:{},_cacheInstanceIds:[],_currentID:0,_clearColor:cc.color(),getRenderCmd:function(t){return t._createRenderCmd()},rendering:function(t){var e,i,n=this._renderCmds,r=t||cc._renderContext;for(e=0,i=n.length;i>e;e++)n[e].rendering(r)},_turnToCacheMode:function(t){this._isCacheToBufferOn=!0,t=t||0,this._cacheToBufferCmds[t]=[],this._cacheInstanceIds.push(t),this._currentID=t},_turnToNormalMode:function(){this._isCacheToBufferOn=!1},_renderingToBuffer:function(t){t=t||this._currentID;var e,i,n=this._cacheToBufferCmds[t],r=cc._renderContext,s=this._cacheInstanceIds;for(e=0,i=n.length;i>e;e++)n[e].rendering(r);if(n.length=0,delete this._cacheToBufferCmds[t],cc.js.array.remove(s,t),0===s.length)this._isCacheToBufferOn=!1;else this._currentID=s[s.length-1]},resetFlag:function(){this.childrenOrderDirty=!1,this._transformNodePool.length=0},transform:function(){var t=this._transformNodePool;t.sort(this._sortNodeByLevelAsc);for(var e=0,i=t.length;i>e;e++)t[e].updateStatus();t.length=0},transformDirty:function(){return this._transformNodePool.length>0},_sortNodeByLevelAsc:function(t,e){return t._curLevel-e._curLevel},pushDirtyNode:function(t){this._transformNodePool.push(t)},clearRenderCommands:function(){this._renderCmds.length=0},clear:function(){var t=cc._renderContext;t.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearColor.a),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)},setDepthTest:function(t){var e=cc._renderContext;if(t)e.clearDepth(1),e.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL);else e.disable(e.DEPTH_TEST)},pushRenderCommand:function(t){if(t._needDraw)if(this._isCacheToBufferOn){var e=this._currentID,i=this._cacheToBufferCmds,n=i[e];if(-1===n.indexOf(t))n.push(t)}else if(-1===this._renderCmds.indexOf(t))this._renderCmds.push(t)}}},{}],114:[function(t,e,i){t("./RendererCanvas"),t("./RendererWebGL")},{"./RendererCanvas":112,"./RendererWebGL":113}],115:[function(t,e,i){var n=t("../event/event-target");cc.SpriteFrame=cc.Class({name:"cc.SpriteFrame","extends":t("../assets/CCAsset"),mixins:[n],properties:{_textureFilenameSetter:{set:function(t){if(this._textureFilename=t,t){if(false)return;var e=cc.textureCache.addImage(t);this._refreshTexture(e)}}}},ctor:function(){var t=arguments[0],e=arguments[1],i=arguments[2],n=arguments[3],r=arguments[4];if(this._rect=null,this._offset=null,this._originalSize=null,this._rotated=!1,this.insetTop=0,this.insetBottom=0,this.insetLeft=0,this.insetRight=0,this._texture=null,this._textureFilename="",this._textureLoaded=!1,!1)this._atlasUuid="";if(void 0!==t)this.initWithTexture(t,e,i,n,r);else;},textureLoaded:function(){return this._textureLoaded},addLoadedEventListener:function(t,e){this.once("load",t,e)},isRotated:function(){return this._rotated},setRotated:function(t){this._rotated=t},getRect:function(){return cc.rect(this._rect)},setRect:function(t){this._rect=t},getOriginalSize:function(){return cc.size(this._originalSize)},setOriginalSize:function(t){if(!this._originalSize)this._originalSize=cc.size(t);else this._originalSize.width=t.width,this._originalSize.height=t.height},getTexture:function(){return this._texture},_refreshTexture:function(t){function e(){if(i._textureLoaded=!0,i._rotated&&cc._renderType===cc.game.RENDER_TYPE_CANVAS){var e=t.getHtmlElementObj();e=_ccsg.Sprite.CanvasRenderCmd._cutRotateImageToCanvas(e,i.getRect());var n=new cc.Texture2D;n.initWithElement(e),n.handleLoadedTexture(),i.setTexture(n);var r=i.getRect();i.setRect(cc.rect(0,0,r.width,r.height))}var s=t.width,o=t.height;if(i._rect)i._checkRect(t);else i.setRect(cc.rect(0,0,s,o));if(!i._originalSize)i.setOriginalSize(cc.size(s,o));if(!i._offset)i.setOffset(cc.v2(0,0));i.emit("load")}var i=this;if(i._texture!==t){var n=t.isLoaded();if(this._textureLoaded=n,this._texture=t,n)e();else t.once("load",e)}},getOffset:function(){return cc.v2(this._offset)},setOffset:function(t){this._offset=cc.v2(t)},clone:function(){return new cc.SpriteFrame(this._texture||this._textureFilename,this._rect,this._rotated,this._offset,this._originalSize)},initWithTexture:function(t,e,i,n,r){this.setTexture(t,e,i,n,r)},setTexture:function(t,e,i,n,r){if(e)this.setRect(e);else this._rect=null;if(n)this.setOffset(n);else this._offset=null;if(r)this.setOriginalSize(r);else this._originalSize=null;this._rotated=i||!1;var s=t;if(cc.js.isString(s))this._textureFilename=s,s=cc.textureCache.addImage(s);if(s instanceof cc.Texture2D)this._refreshTexture(s);else;return!0},_checkRect:function(t){var e=this._rect,i=e.x,n=e.y;if(this._rotated)i+=e.height,n+=e.width;else i+=e.width,n+=e.height;if(i>t.getPixelWidth())cc.error(cc._LogInfos.RectWidth,t.url);if(n>t.getPixelHeight())cc.error(cc._LogInfos.RectHeight,t.url)},_serialize:!1,_deserialize:function(t,e){var i=t.rect;if(i)this.setRect(new cc.Rect(i[0],i[1],i[2],i[3]));if(t.offset)this.setOffset(new cc.Vec2(t.offset[0],t.offset[1]));if(t.originalSize)this.setOriginalSize(new cc.Size(t.originalSize[0],t.originalSize[1]));this._rotated=1===t.rotated,this._name=t.name;var n=t.capInsets;if(n)this.insetLeft=n[0],this.insetTop=n[1],this.insetRight=n[2],this.insetBottom=n[3];if(!1)this._atlasUuid=t.atlas;var r=t.texture;if(r)e.result.push(this,"_textureFilenameSetter",r)}});var r=cc.SpriteFrame.prototype;r.copyWithZone=r.clone,r.copy=r.clone},{"../assets/CCAsset":36,"../event/event-target":74}],116:[function(t,e,i){t("./CCSpriteFrame"),cc.spriteFrameCache={_CCNS_REG1:/^\s*\{\s*([\-]?\d+[.]?\d*)\s*,\s*([\-]?\d+[.]?\d*)\s*\}\s*$/,_CCNS_REG2:/^\s*\{\s*\{\s*([\-]?\d+[.]?\d*)\s*,\s*([\-]?\d+[.]?\d*)\s*\}\s*,\s*\{\s*([\-]?\d+[.]?\d*)\s*,\s*([\-]?\d+[.]?\d*)\s*\}\s*\}\s*$/,_spriteFrames:{},_spriteFramesAliases:{},_frameConfigCache:{},_rectFromString:function(t){var e=this._CCNS_REG2.exec(t);if(!e)return cc.rect(0,0,0,0);else return cc.rect(parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]),parseFloat(e[4]))},_pointFromString:function(t){var e=this._CCNS_REG1.exec(t);if(!e)return cc.p(0,0);else return cc.p(parseFloat(e[1]),parseFloat(e[2]))},_sizeFromString:function(t){var e=this._CCNS_REG1.exec(t);if(!e)return cc.size(0,0);else return cc.size(parseFloat(e[1]),parseFloat(e[2]))},_getFrameConfig:function(t){var e=cc.loader.getRes(t);if(cc.assert(e,cc._LogInfos.spriteFrameCache._getFrameConfig_2,t),cc.loader.release(t),e._inited)return this._frameConfigCache[t]=e,e;else return this._frameConfigCache[t]=this._parseFrameConfig(e),this._frameConfigCache[t]},_getFrameConfigByJsonObject:function(t,e){return cc.assert(e,cc._LogInfos.spriteFrameCache._getFrameConfig_2,t),this._frameConfigCache[t]=this._parseFrameConfig(e),this._frameConfigCache[t]},_parseFrameConfig:function(t){var e=t.frames,i=t.metadata||t.meta,n={},r={},s=0;if(i){var o=i.format;s=o.length<=1?parseInt(o):o,r.image=i.textureFileName||i.textureFileName||i.image}for(var a in e){var c=e[a];if(c){var l={};if(0==s){l.rect=cc.rect(c.x,c.y,c.width,c.height),l.rotated=!1,l.offset=cc.p(c.offsetX,c.offsetY);var h=c.originalWidth,u=c.originalHeight;if(!h||!u)cc.log(cc._LogInfos.spriteFrameCache._getFrameConfig);h=Math.abs(h),u=Math.abs(u),l.size=cc.size(h,u)}else if(1==s||2==s)l.rect=this._rectFromString(c.frame),l.rotated=c.rotated||!1,l.offset=this._pointFromString(c.offset),l.size=this._sizeFromString(c.sourceSize);else if(3==s){var d=this._sizeFromString(c.spriteSize),f=this._rectFromString(c.textureRect);if(d)f=cc.rect(f.x,f.y,d.width,d.height);l.rect=f,l.rotated=c.textureRotated||!1,l.offset=this._pointFromString(c.spriteOffset),l.size=this._sizeFromString(c.spriteSourceSize),l.aliases=c.aliases}else{var _=c.frame,p=c.sourceSize;a=c.filename||a,l.rect=cc.rect(_.x,_.y,_.w,_.h),l.rotated=c.rotated||!1,l.offset=cc.p(0,0),l.size=cc.size(p.w,p.h)}n[a]=l}else;}return{_inited:!0,frames:n,meta:r}},_addSpriteFramesByObject:function(t,e,i){if(cc.assert(t,cc._LogInfos.spriteFrameCache.addSpriteFrames_2),e&&e.frames){var n=this._frameConfigCache[t]||this._getFrameConfigByJsonObject(t,e);this._createSpriteFrames(t,n,i)}},_createSpriteFrames:function(t,e,i){var n=e.frames,r=e.meta;if(!i){var s=cc.path.changeBasename(t,r.image||".png");i=cc.textureCache.addImage(s)}else if(i instanceof cc.Texture2D);else if(cc.js.isString(i))i=cc.textureCache.addImage(i);else cc.assert(0,cc._LogInfos.spriteFrameCache.addSpriteFrames_3);var o=this._spriteFramesAliases,a=this._spriteFrames;for(var c in n){var l=n[c],h=a[c];if(!h){h=new cc.SpriteFrame(i,l.rect,l.rotated,l.offset,l.size);var u=l.aliases;if(u)for(var d=0,f=u.length;f>d;d++){var _=u[d];if(o[_])cc.log(cc._LogInfos.spriteFrameCache.addSpriteFrames,_);o[_]=c}if(cc._renderType===cc.game.RENDER_TYPE_CANVAS&&h.isRotated()){var p=h.getTexture();if(p.isLoaded()){var g=h.getTexture().getHtmlElementObj();g=_ccsg.Sprite.CanvasRenderCmd._cutRotateImageToCanvas(g,h.getRect());var m=new cc.Texture2D;m.initWithElement(g),m.handleLoadedTexture(),h.setTexture(m);var v=h._rect;h.setRect(cc.rect(0,0,v.width,v.height))}}a[c]=h}}},addSpriteFrames:function(t,e){cc.assert(t,cc._LogInfos.spriteFrameCache.addSpriteFrames_2);var i=this._frameConfigCache[t]||cc.loader.getRes(t);if(i&&i.frames){var n=this._frameConfigCache[t]||this._getFrameConfig(t);this._createSpriteFrames(t,n,e)}},_checkConflict:function(t){var e=t.frames;for(var i in e)if(this._spriteFrames[i])cc.log(cc._LogInfos.spriteFrameCache._checkConflict,i)},addSpriteFrame:function(t,e){this._spriteFrames[e]=t},removeSpriteFrames:function(){this._spriteFrames={},this._spriteFramesAliases={}},removeSpriteFrameByName:function(t){if(t){if(this._spriteFramesAliases[t])delete this._spriteFramesAliases[t];if(this._spriteFrames[t])delete this._spriteFrames[t]}},removeSpriteFramesFromFile:function(t){var e=this,i=e._spriteFrames,n=e._spriteFramesAliases,r=e._frameConfigCache[t];if(r){var s=r.frames;for(var o in s)if(i[o]){delete i[o];for(var a in n)if(n[a]===o)delete n[a]}}},removeSpriteFramesFromTexture:function(t){var e=this,i=e._spriteFrames,n=e._spriteFramesAliases;for(var r in i){var s=i[r];if(s&&s.getTexture()===t){delete i[r];for(var o in n)if(n[o]===r)delete n[o]}}},getSpriteFrame:function(t){var e=this,i=e._spriteFrames[t];if(!i){var n=e._spriteFramesAliases[t];if(n)if(i=e._spriteFrames[n.toString()],!i)delete e._spriteFramesAliases[t]}return i},_clear:function(){this._spriteFrames={},this._spriteFramesAliases={},this._frameConfigCache={}}}},{"./CCSpriteFrame":115}],117:[function(t,e,i){var n=t("../event/event-target"),r=t("../platform/CCSys"),s=t("../platform/js"),o=t("../utils/misc"),a=t("../CCGame");t("../platform/_CCClass"),t("../platform/CCClass");var c=cc.Enum({REPEAT:10497,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648}),l=cc.Class({name:"cc.Texture2D","extends":t("../assets/CCRawAsset"),mixins:[n],statics:{WrapMode:c},ctor:function(){if(this.url=null,this._textureLoaded=!1,this._htmlElementObj=null,this._contentSize=cc.size(0,0),cc._renderType===a.RENDER_TYPE_CANVAS)this._pattern="",this._grayElementObj=null,this._backupElement=null,this._isGray=!1;else if(cc._renderType===a.RENDER_TYPE_WEBGL)this._hasPremultipliedAlpha=!1,this._pixelFormat=l.defaultPixelFormat,this._pixelsWide=0,this._pixelsHigh=0,this._hasPremultipliedAlpha=!1,this._hasMipmaps=!1,this._webTextureObj=null},getPixelWidth:function(){return this._contentSize.width},getPixelHeight:function(){return this._contentSize.height},getContentSize:function(){return cc.size(this._contentSize.width,this._contentSize.height)},_getWidth:function(){return this._contentSize.width},_getHeight:function(){return this._contentSize.height},getContentSizeInPixels:function(){return this._contentSize},initWithElement:function(t){if(t)this._htmlElementObj=t,this._contentSize.width=t.width,this._contentSize.height=t.height,this._textureLoaded=!0},initWithData:function(t,e,i,n,r){return!1},initWithImage:function(t){return!1},getHtmlElementObj:function(){return this._htmlElementObj},isLoaded:function(){return this._textureLoaded},handleLoadedTexture:function(){var t=this;if(!t._htmlElementObj){var e=cc.loader.getRes(t.url);if(!e)return;t.initWithElement(e)}if(t._htmlElementObj.width&&t._htmlElementObj.height){var i=t._htmlElementObj;t._contentSize.width=i.width,t._contentSize.height=i.height,t.emit("load")}},description:function(){return"<cc.Texture2D | Name = "+this.getName()+" | Dimensions = "+this.getPixelWidth()+" x "+this.getPixelHeight()+">"},releaseTexture:function(){if(this._webTextureObj)cc._renderContext.deleteTexture(this._webTextureObj);cc.loader.release(this._uuid||this.url)},getName:function(){return this._webTextureObj||null},getPixelFormat:function(){return this._pixelFormat||null},hasPremultipliedAlpha:function(){return this._hasPremultipliedAlpha||!1},hasMipmaps:function(){return this._hasMipmaps||!1},setTexParameters:function(t,e,i,n){if(void 0!==e)t={minFilter:t,magFilter:e,wrapS:i,wrapT:n};if(t.wrapS===c.REPEAT&&t.wrapT===c.REPEAT)return void(this._pattern="repeat");if(t.wrapS===c.REPEAT)return void(this._pattern="repeat-x");if(t.wrapT===c.REPEAT)return void(this._pattern="repeat-y");else return void(this._pattern="")},setAntiAliasTexParameters:function(){},setAliasTexParameters:function(){},generateMipmap:function(){},stringForFormat:function(){return""},bitsPerPixelForFormat:function(t){return-1}});l.WrapMode=c;var h=l;h.PIXEL_FORMAT_RGBA8888=2,h.PIXEL_FORMAT_RGB888=3,h.PIXEL_FORMAT_RGB565=4,h.PIXEL_FORMAT_A8=5,h.PIXEL_FORMAT_I8=6,h.PIXEL_FORMAT_AI88=7,h.PIXEL_FORMAT_RGBA4444=8,h.PIXEL_FORMAT_RGB5A1=7,h.PIXEL_FORMAT_PVRTC4=9,h.PIXEL_FORMAT_PVRTC2=10,h.PIXEL_FORMAT_DEFAULT=h.PIXEL_FORMAT_RGBA8888,h.defaultPixelFormat=h.PIXEL_FORMAT_DEFAULT;var u=l._M={};u[h.PIXEL_FORMAT_RGBA8888]="RGBA8888",u[h.PIXEL_FORMAT_RGB888]="RGB888",u[h.PIXEL_FORMAT_RGB565]="RGB565",u[h.PIXEL_FORMAT_A8]="A8",u[h.PIXEL_FORMAT_I8]="I8",u[h.PIXEL_FORMAT_AI88]="AI88",u[h.PIXEL_FORMAT_RGBA4444]="RGBA4444",u[h.PIXEL_FORMAT_RGB5A1]="RGB5A1",u[h.PIXEL_FORMAT_PVRTC4]="PVRTC4",u[h.PIXEL_FORMAT_PVRTC2]="PVRTC2";var d=l._B={};d[h.PIXEL_FORMAT_RGBA8888]=32,d[h.PIXEL_FORMAT_RGB888]=24,d[h.PIXEL_FORMAT_RGB565]=16,d[h.PIXEL_FORMAT_A8]=8,d[h.PIXEL_FORMAT_I8]=8,d[h.PIXEL_FORMAT_AI88]=16,d[h.PIXEL_FORMAT_RGBA4444]=16,d[h.PIXEL_FORMAT_RGB5A1]=16,d[h.PIXEL_FORMAT_PVRTC4]=4,d[h.PIXEL_FORMAT_PVRTC2]=3;var f=l.prototype;f.name,cc.defineGetterSetter(f,"name",f.getName),f.pixelFormat,cc.defineGetterSetter(f,"pixelFormat",f.getPixelFormat),f.pixelWidth,cc.defineGetterSetter(f,"pixelWidth",f.getPixelWidth),f.pixelHeight,cc.defineGetterSetter(f,"pixelHeight",f.getPixelHeight),f.width,cc.defineGetterSetter(f,"width",f._getWidth),f.height,cc.defineGetterSetter(f,"height",f._getHeight),a.once(a.EVENT_RENDERER_INITED,function(){if(cc._renderType===a.RENDER_TYPE_CANVAS){var t=function(t,e){var i=t.width,n=t.height;e[0].width=i,e[0].height=n,e[1].width=i,e[1].height=n,e[2].width=i,e[2].height=n,e[3].width=i,e[3].height=n;var r=e[3].getContext("2d");r.drawImage(t,0,0);for(var s,o=r.getImageData(0,0,i,n).data,a=0;4>a;a++){s=e[a].getContext("2d");for(var c=s.getImageData(0,0,i,n),l=c.data,h=0;h<o.length;h+=4)l[h]=0===a?o[h]:0,l[h+1]=1===a?o[h+1]:0,l[h+2]=2===a?o[h+2]:0,l[h+3]=o[h+3];s.putImageData(c,0,0)}t.onload=null},e=function(t,e,i){if(null===t)return null;i=i||document.createElement("canvas"),e=e||cc.rect(0,0,t.width,t.height),i.width=e.width,i.height=e.height;var n=i.getContext("2d");n.drawImage(t,e.x,e.y,e.width,e.height,0,0,e.width,e.height);for(var r=n.getImageData(0,0,e.width,e.height),s=r.data,o=0,a=s.length;a>o;o+=4)s[o]=s[o+1]=s[o+2]=.34*s[o]+.5*s[o+1]+.16*s[o+2];return n.putImageData(r,0,0),i};s.mixin(l.prototype,{_generateTextureCacheForColor:function(){if(this.channelCache)return this.channelCache;var e=[document.createElement("canvas"),document.createElement("canvas"),document.createElement("canvas"),document.createElement("canvas")];return t(this._htmlElementObj,e),this.channelCache=e},_switchToGray:function(t){if(this._textureLoaded&&this._isGray!==t)if(this._isGray=t,this._isGray){if(this._backupElement=this._htmlElementObj,!this._grayElementObj)this._grayElementObj=e(this._htmlElementObj);this._htmlElementObj=this._grayElementObj}else if(null!==this._backupElement)this._htmlElementObj=this._backupElement},_generateGrayTexture:function(){if(!this._textureLoaded)return null;var t=e(this._htmlElementObj),i=new l;return i.initWithElement(t),i.handleLoadedTexture(),i},_generateColorTexture:r._supportCanvasNewBlendModes?function(t,e,i,n,r){var s=!1;if(r)s=!0;else r=document.createElement("canvas");var o=this._htmlElementObj;if(!n)n=cc.rect(0,0,o.width,o.height);if(r.width=n.width,r.height=n.height,n.width&&n.height){var a=r.getContext("2d");a.globalCompositeOperation="source-over",a.fillStyle="rgb("+(0|t)+","+(0|e)+","+(0|i)+")",a.fillRect(0,0,n.width,n.height),a.globalCompositeOperation="multiply",a.drawImage(o,n.x,n.y,n.width,n.height,0,0,n.width,n.height),a.globalCompositeOperation="destination-atop",a.drawImage(o,n.x,n.y,n.width,n.height,0,0,n.width,n.height)}if(s)return r;var c=new l;return c.initWithElement(r),c.handleLoadedTexture(),c}:function(t,e,i,n,r){var s=!1;if(r)s=!0;else r=document.createElement("canvas");var o=this._htmlElementObj;if(!n)n=cc.rect(0,0,o.width,o.height);if(r.width=n.width,r.height=n.height,n.width&&n.height){var a=r.getContext("2d");a.drawImage(o,n.x,n.y,n.width,n.height,0,0,n.width,n.height);var c=a.getImageData(0,0,r.width,r.height),h=c.data;t/=255,e/=255,i/=255;for(var u=0;u<h.length;u+=4)h[u]=h[u]*t,h[u+1]=h[u+1]*e,h[u+2]=h[u+2]*i;a.putImageData(c,0,0)}if(s)return r;var d=new l;return d.initWithElement(r),d.handleLoadedTexture(),d}})}else if(cc._renderType===a.RENDER_TYPE_WEBGL)s.mixin(l.prototype,{getPixelWidth:function(){return this._pixelsWide},getPixelHeight:function(){return this._pixelsHigh},initWithData:function(t,e,i,n,r){var s=this,o=l,a=cc._renderContext,c=a.RGBA,h=a.UNSIGNED_BYTE,u=l._B[e],d=i*u/8;if(d%8===0)a.pixelStorei(a.UNPACK_ALIGNMENT,8);else if(d%4===0)a.pixelStorei(a.UNPACK_ALIGNMENT,4);else if(d%2===0)a.pixelStorei(a.UNPACK_ALIGNMENT,2);else a.pixelStorei(a.UNPACK_ALIGNMENT,1);switch(s._webTextureObj=a.createTexture(),cc.gl.bindTexture2D(s),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),e){case o.PIXEL_FORMAT_RGBA8888:c=a.RGBA;break;case o.PIXEL_FORMAT_RGB888:c=a.RGB;break;case o.PIXEL_FORMAT_RGBA4444:h=a.UNSIGNED_SHORT_4_4_4_4;break;case o.PIXEL_FORMAT_RGB5A1:h=a.UNSIGNED_SHORT_5_5_5_1;break;case o.PIXEL_FORMAT_RGB565:h=a.UNSIGNED_SHORT_5_6_5;break;case o.PIXEL_FORMAT_AI88:c=a.LUMINANCE_ALPHA;break;case o.PIXEL_FORMAT_A8:c=a.ALPHA;break;case o.PIXEL_FORMAT_I8:c=a.LUMINANCE;break;default:cc.assert(0,cc._LogInfos.Texture2D.initWithData)}return a.texImage2D(a.TEXTURE_2D,0,c,i,n,0,c,h,t),s._contentSize.width=r.width,s._contentSize.height=r.height,s._pixelsWide=i,s._pixelsHigh=n,s._pixelFormat=e,s._hasPremultipliedAlpha=!1,s._hasMipmaps=!1,s._textureLoaded=!0,!0},initWithImage:function(t){if(null==t)return cc.log(cc._LogInfos.Texture2D.initWithImage),!1;var e=t.getWidth(),i=t.getHeight(),n=cc.configuration.getMaxTextureSize();if(e>n||i>n)return cc.log(cc._LogInfos.Texture2D.initWithImage_2,e,i,n,n),!1;else return this._textureLoaded=!0,this._initPremultipliedATextureWithImage(t,e,i)},initWithElement:function(t){if(t)this._webTextureObj=cc._renderContext.createTexture(),this._htmlElementObj=t,this._textureLoaded=!0},handleLoadedTexture:function(t){t=!!t;var e=this;if(a._rendererInitialized){if(!e._htmlElementObj){var i=cc.loader.getRes(e.url);if(!i)return;e.initWithElement(i)}if(e._htmlElementObj.width&&e._htmlElementObj.height){var n=cc._renderContext;if(cc.gl.bindTexture2D(e),n.pixelStorei(n.UNPACK_ALIGNMENT,4),t)n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);if(n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,e._htmlElementObj),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),cc.gl.bindTexture2D(null),t)n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0);var r=e._htmlElementObj.width,s=e._htmlElementObj.height;e._pixelsWide=e._contentSize.width=r,e._pixelsHigh=e._contentSize.height=s,e._pixelFormat=l.PIXEL_FORMAT_RGBA8888,e._hasPremultipliedAlpha=t,e._hasMipmaps=!1,e.emit("load")}}},setTexParameters:function(t,e,i,n){var r=this,s=cc._renderContext;if(void 0!==e)t={minFilter:t,magFilter:e,wrapS:i,wrapT:n};cc.assert(r._pixelsWide===o.NextPOT(r._pixelsWide)&&r._pixelsHigh===o.NextPOT(r._pixelsHigh)||t.wrapS===s.CLAMP_TO_EDGE&&t.wrapT===s.CLAMP_TO_EDGE,"WebGLRenderingContext.CLAMP_TO_EDGE should be used in NPOT textures"),cc.gl.bindTexture2D(r),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,t.minFilter),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,t.magFilter),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,t.wrapS),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,t.wrapT)},setAntiAliasTexParameters:function(){
var t=cc._renderContext;if(cc.gl.bindTexture2D(this),!this._hasMipmaps)t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR);else t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR_MIPMAP_NEAREST);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR)},setAliasTexParameters:function(){var t=cc._renderContext;if(cc.gl.bindTexture2D(this),!this._hasMipmaps)t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST);else t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST_MIPMAP_NEAREST);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST)},generateMipmap:function(){var t=this;cc.assert(t._pixelsWide===o.NextPOT(t._pixelsWide)&&t._pixelsHigh===o.NextPOT(t._pixelsHigh),"Mimpap texture only works in POT textures"),cc.gl.bindTexture2D(t),cc._renderContext.generateMipmap(cc._renderContext.TEXTURE_2D),t._hasMipmaps=!0},stringForFormat:function(){return l._M[this._pixelFormat]},bitsPerPixelForFormat:function(t){t=t||this._pixelFormat;var e=l._B[t];if(null!=e)return e;else return cc.log(cc._LogInfos.Texture2D.bitsPerPixelForFormat,t),-1},_initPremultipliedATextureWithImage:function(t,e,i){var n,r=l,s=t.getData(),o=null,a=null,c=t.hasAlpha(),h=cc.size(t.getWidth(),t.getHeight()),u=r.defaultPixelFormat,d=t.getBitsPerComponent();if(!c)if(d>=8)u=r.PIXEL_FORMAT_RGB888;else cc.log(cc._LogInfos.Texture2D._initPremultipliedATextureWithImage),u=r.PIXEL_FORMAT_RGB565;var f=e*i;if(u===r.PIXEL_FORMAT_RGB565)if(c)for(s=new Uint16Array(e*i),o=t.getData(),n=0;f>n;++n)s[n]=(o[n]>>0&255)>>3<<11|(o[n]>>8&255)>>2<<5|(o[n]>>16&255)>>3<<0;else for(s=new Uint16Array(e*i),a=t.getData(),n=0;f>n;++n)s[n]=(255&a[n])>>3<<11|(255&a[n])>>2<<5|(255&a[n])>>3<<0;else if(u===r.PIXEL_FORMAT_RGBA4444)for(s=new Uint16Array(e*i),o=t.getData(),n=0;f>n;++n)s[n]=(o[n]>>0&255)>>4<<12|(o[n]>>8&255)>>4<<8|(o[n]>>16&255)>>4<<4|(o[n]>>24&255)>>4<<0;else if(u===r.PIXEL_FORMAT_RGB5A1)for(s=new Uint16Array(e*i),o=t.getData(),n=0;f>n;++n)s[n]=(o[n]>>0&255)>>3<<11|(o[n]>>8&255)>>3<<6|(o[n]>>16&255)>>3<<1|(o[n]>>24&255)>>7<<0;else if(u===r.PIXEL_FORMAT_A8)for(s=new Uint8Array(e*i),o=t.getData(),n=0;f>n;++n)s[n]=o>>24&255;if(c&&u===r.PIXEL_FORMAT_RGB888)for(o=t.getData(),s=new Uint8Array(e*i*3),n=0;f>n;++n)s[3*n]=o>>0&255,s[3*n+1]=o>>8&255,s[3*n+2]=o>>16&255;if(this.initWithData(s,u,e,i,h),s!=t.getData())s=null;return this._hasPremultipliedAlpha=t.isPremultipliedAlpha(),!0}})}),cc.Texture2D=e.exports=l},{"../CCGame":32,"../assets/CCRawAsset":41,"../event/event-target":74,"../platform/CCClass":88,"../platform/CCSys":95,"../platform/_CCClass":98,"../platform/js":105,"../utils/misc":126}],118:[function(t,e,i){var n=t("../platform/_CCClass"),r=t("../platform/js"),s=t("../CCGame"),o=n.extend({dirty:!1,texture:null,_indices:null,_buffersVBO:null,_capacity:0,_quads:null,_quadsArrayBuffer:null,_quadsWebBuffer:null,_quadsReader:null,ctor:function(t,e){if(this._buffersVBO=[],cc.js.isString(t))this.initWithFile(t,e);else if(t instanceof cc.Texture2D)this.initWithTexture(t,e)},getTotalQuads:function(){return this._totalQuads},getCapacity:function(){return this._capacity},getTexture:function(){return this.texture},setTexture:function(t){this.texture=t},setDirty:function(t){this.dirty=t},isDirty:function(){return this.dirty},getQuads:function(){return this._quads},setQuads:function(t){this._quads=t},_copyQuadsToTextureAtlas:function(t,e){if(t)for(var i=0;i<t.length;i++)this._setQuadToArray(t[i],e+i)},_setQuadToArray:function(t,e){var i=this._quads;if(!i[e])return void(i[e]=new cc.V3F_C4B_T2F_Quad(t.tl,t.bl,t.tr,t.br,this._quadsArrayBuffer,e*cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT));else return i[e].bl=t.bl,i[e].br=t.br,i[e].tl=t.tl,void(i[e].tr=t.tr)},description:function(){return"<cc.TextureAtlas | totalQuads ="+this._totalQuads+">"},_setupIndices:function(){if(0!==this._capacity)for(var t=this._indices,e=this._capacity,i=0;e>i;i++)if(cc.macro.TEXTURE_ATLAS_USE_TRIANGLE_STRIP)t[6*i+0]=4*i+0,t[6*i+1]=4*i+0,t[6*i+2]=4*i+2,t[6*i+3]=4*i+1,t[6*i+4]=4*i+3,t[6*i+5]=4*i+3;else t[6*i+0]=4*i+0,t[6*i+1]=4*i+1,t[6*i+2]=4*i+2,t[6*i+3]=4*i+3,t[6*i+4]=4*i+2,t[6*i+5]=4*i+1},initWithFile:function(t,e){var i=cc.textureCache.addImage(t);if(i)return this.initWithTexture(i,e);else return cc.log(cc._LogInfos.TextureAtlas.initWithFile,t),!1},initWithTexture:function(t,e){cc.assert(t,cc._LogInfos.TextureAtlas.initWithTexture),e=0|e,this._capacity=e,this._totalQuads=0,this.texture=t,this._quads=[],this._indices=new Uint16Array(6*e);var i=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT;if(this._quadsArrayBuffer=new ArrayBuffer(i*e),this._quadsReader=new Uint8Array(this._quadsArrayBuffer),(!this._quads||!this._indices)&&e>0)return!1;for(var n=this._quads,r=0;e>r;r++)n[r]=new cc.V3F_C4B_T2F_Quad(null,null,null,null,this._quadsArrayBuffer,r*i);return this._setupIndices(),this._setupVBO(),this.dirty=!0,!0},updateQuad:function(t,e){cc.assert(t,cc._LogInfos.TextureAtlas.updateQuad),cc.assert(e>=0&&e<this._capacity,cc._LogInfos.TextureAtlas.updateQuad_2),this._totalQuads=Math.max(e+1,this._totalQuads),this._setQuadToArray(t,e),this.dirty=!0},insertQuad:function(t,e){if(cc.assert(e<this._capacity,cc._LogInfos.TextureAtlas.insertQuad_2),this._totalQuads++,this._totalQuads>this._capacity)return void cc.log(cc._LogInfos.TextureAtlas.insertQuad);var i=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,n=this._totalQuads-1-e,r=e*i,s=n*i;this._quads[this._totalQuads-1]=new cc.V3F_C4B_T2F_Quad(null,null,null,null,this._quadsArrayBuffer,(this._totalQuads-1)*i),this._quadsReader.set(this._quadsReader.subarray(r,r+s),r+i),this._setQuadToArray(t,e),this.dirty=!0},insertQuads:function(t,e,i){i=i||t.length,cc.assert(e+i<=this._capacity,cc._LogInfos.TextureAtlas.insertQuads);var n=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT;if(this._totalQuads+=i,this._totalQuads>this._capacity)return void cc.log(cc._LogInfos.TextureAtlas.insertQuad);var r,s=this._totalQuads-1-e-i,o=e*n,a=s*n,c=this._totalQuads-1-i;for(r=0;i>r;r++)this._quads[c+r]=new cc.V3F_C4B_T2F_Quad(null,null,null,null,this._quadsArrayBuffer,(this._totalQuads-1)*n);for(this._quadsReader.set(this._quadsReader.subarray(o,o+a),o+n*i),r=0;i>r;r++)this._setQuadToArray(t[r],e+r);this.dirty=!0},insertQuadFromIndex:function(t,e){if(t!==e){cc.assert(e>=0||e<this._totalQuads,cc._LogInfos.TextureAtlas.insertQuadFromIndex),cc.assert(t>=0||t<this._totalQuads,cc._LogInfos.TextureAtlas.insertQuadFromIndex_2);var i,n,r=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,s=this._quadsReader,o=s.subarray(t*r,r);if(t>e)i=e*r,n=(t-e)*r,s.set(s.subarray(i,i+n),i+r),s.set(o,i);else i=(t+1)*r,n=(e-t)*r,s.set(s.subarray(i,i+n),i-r),s.set(o,e*r);this.dirty=!0}},removeQuadAtIndex:function(t){cc.assert(t<this._totalQuads,cc._LogInfos.TextureAtlas.removeQuadAtIndex);var e=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT;if(this._totalQuads--,this._quads.length=this._totalQuads,t!==this._totalQuads){var i=(t+1)*e,n=(this._totalQuads-t)*e;this._quadsReader.set(this._quadsReader.subarray(i,i+n),i-e)}this.dirty=!0},removeQuadsAtIndex:function(t,e){if(cc.assert(t+e<=this._totalQuads,cc._LogInfos.TextureAtlas.removeQuadsAtIndex),this._totalQuads-=e,t!==this._totalQuads){var i=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,n=(t+e)*i,r=(this._totalQuads-t)*i,s=t*i;this._quadsReader.set(this._quadsReader.subarray(n,n+r),s)}this.dirty=!0},removeAllQuads:function(){this._quads.length=0,this._totalQuads=0},_setDirty:function(t){this.dirty=t},resizeCapacity:function(t){if(t===this._capacity)return!0;var e=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,i=this._capacity;this._totalQuads=Math.min(this._totalQuads,t),this._capacity=0|t;var n,r=this._capacity,s=this._totalQuads;if(null===this._quads)for(this._quads=[],this._quadsArrayBuffer=new ArrayBuffer(e*r),this._quadsReader=new Uint8Array(this._quadsArrayBuffer),n=0;r>n;n++)this._quads=new cc.V3F_C4B_T2F_Quad(null,null,null,null,this._quadsArrayBuffer,n*e);else{var o,a,c=this._quads;if(r>i){for(o=[],a=new ArrayBuffer(e*r),n=0;s>n;n++)o[n]=new cc.V3F_C4B_T2F_Quad(c[n].tl,c[n].bl,c[n].tr,c[n].br,a,n*e);for(;r>n;n++)o[n]=new cc.V3F_C4B_T2F_Quad(null,null,null,null,a,n*e);this._quadsReader=new Uint8Array(a),this._quads=o,this._quadsArrayBuffer=a}else{var l=Math.max(s,r);for(o=[],a=new ArrayBuffer(e*r),n=0;l>n;n++)o[n]=new cc.V3F_C4B_T2F_Quad(c[n].tl,c[n].bl,c[n].tr,c[n].br,a,n*e);this._quadsReader=new Uint8Array(a),this._quads=o,this._quadsArrayBuffer=a}}if(null===this._indices)this._indices=new Uint16Array(6*r);else if(r>i){var h=new Uint16Array(6*r);h.set(this._indices,0),this._indices=h}else this._indices=this._indices.subarray(0,6*r);return this._setupIndices(),this._mapBuffers(),this.dirty=!0,!0},increaseTotalQuadsWith:function(t){this._totalQuads+=t},moveQuadsFromIndex:function(t,e,i){if(void 0===i){if(i=e,e=this._totalQuads-t,cc.assert(i+(this._totalQuads-t)<=this._capacity,cc._LogInfos.TextureAtlas.moveQuadsFromIndex),0===e)return}else if(cc.assert(i+e<=this._totalQuads,cc._LogInfos.TextureAtlas.moveQuadsFromIndex_2),cc.assert(t<this._totalQuads,cc._LogInfos.TextureAtlas.moveQuadsFromIndex_3),t===i)return;var n,r,s=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,o=t*s,a=e*s,c=this._quadsReader,l=c.subarray(o,o+a),h=i*s;if(t>i)n=(t-i)*s,r=i*s,c.set(c.subarray(r,r+n),r+a);else n=(i-t)*s,r=(t+e)*s,c.set(c.subarray(r,r+n),o);c.set(l,h),this.dirty=!0},fillWithEmptyQuadsFromIndex:function(t,e){for(var i=e*cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,n=new Uint8Array(this._quadsArrayBuffer,t*cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,i),r=0;i>r;r++)n[r]=0},_setupVBO:function(){},_mapBuffers:function(){},drawQuads:function(){},drawNumberOfQuads:null,_releaseBuffer:function(){var t=cc._renderContext;if(this._buffersVBO){if(this._buffersVBO[0])t.deleteBuffer(this._buffersVBO[0]);if(this._buffersVBO[1])t.deleteBuffer(this._buffersVBO[1])}if(this._quadsWebBuffer)t.deleteBuffer(this._quadsWebBuffer)}}),a=o.prototype;a.totalQuads,cc.defineGetterSetter(a,"totalQuads",a.getTotalQuads),a.capacity,cc.defineGetterSetter(a,"capacity",a.getCapacity),a.quads,cc.defineGetterSetter(a,"quads",a.getQuads,a.setQuads),s.once(s.EVENT_RENDERER_INITED,function(){if(cc._renderType===s.RENDER_TYPE_WEBGL)r.mixin(o.prototype,{_setupVBO:function(){var t=this,e=cc._renderContext;t._buffersVBO[0]=e.createBuffer(),t._buffersVBO[1]=e.createBuffer(),t._quadsWebBuffer=e.createBuffer(),t._mapBuffers()},_mapBuffers:function(){var t=this,e=cc._renderContext;e.bindBuffer(e.ARRAY_BUFFER,t._quadsWebBuffer),e.bufferData(e.ARRAY_BUFFER,t._quadsArrayBuffer,e.DYNAMIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t._buffersVBO[1]),e.bufferData(e.ELEMENT_ARRAY_BUFFER,t._indices,e.STATIC_DRAW)},drawQuads:function(){this.drawNumberOfQuads(this._totalQuads,0)},drawNumberOfQuads:function(t,e){var i=this;if(e=e||0,0!==t&&i.texture&&i.texture.isLoaded()){var n=cc._renderContext;if(cc.gl.bindTexture2D(i.texture),cc.gl.enableVertexAttribs(cc.macro.VERTEX_ATTRIB_FLAG_POS_COLOR_TEX),n.bindBuffer(n.ARRAY_BUFFER,i._quadsWebBuffer),i.dirty)n.bufferData(n.ARRAY_BUFFER,i._quadsArrayBuffer,n.DYNAMIC_DRAW),i.dirty=!1;if(n.vertexAttribPointer(cc.macro.VERTEX_ATTRIB_POSITION,3,n.FLOAT,!1,24,0),n.vertexAttribPointer(cc.macro.VERTEX_ATTRIB_COLOR,4,n.UNSIGNED_BYTE,!0,24,12),n.vertexAttribPointer(cc.macro.VERTEX_ATTRIB_TEX_COORDS,2,n.FLOAT,!1,24,16),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,i._buffersVBO[1]),cc.macro.TEXTURE_ATLAS_USE_TRIANGLE_STRIP)n.drawElements(n.TRIANGLE_STRIP,6*t,n.UNSIGNED_SHORT,6*e*i._indices.BYTES_PER_ELEMENT);else n.drawElements(n.TRIANGLES,6*t,n.UNSIGNED_SHORT,6*e*i._indices.BYTES_PER_ELEMENT);cc.g_NumberOfDraws++}}})}),cc.TextureAtlas=e.exports=o},{"../CCGame":32,"../platform/_CCClass":98,"../platform/js":105}],119:[function(t,e,i){var n=(t("../platform/js"),t("../CCGame")),r=t("./CCTexture2D"),s={_textures:{},_textureColorsCache:{},_textureKeySeq:0|1e3*Math.random(),_loadedTexturesBefore:{},handleLoadedTexture:null,_initializingRenderer:function(){var t,e=this._loadedTexturesBefore,i=this._textures;for(t in e){var n=e[t];n.handleLoadedTexture(),i[t]=n}this._loadedTexturesBefore={}},description:function(){return"<TextureCache | Number of textures = "+this._textures.length+">"},textureForKey:function(t){return cc.log(cc._LogInfos.textureCache.textureForKey),this.getTextureForKey(t)},getTextureForKey:function(t){return this._textures[t]},getKeyByTexture:function(t){for(var e in this._textures)if(this._textures[e]===t)return e;return null},_generalTextureKey:function(t){return"_textureKey_"+t},getTextureColors:function(t){var e=t._htmlElementObj,i=this.getKeyByTexture(e);if(!i)if(e instanceof HTMLImageElement)i=e.src;else i=this._generalTextureKey(t.__instanceId);if(!this._textureColorsCache[i])this._textureColorsCache[i]=t._generateTextureCacheForColor();return this._textureColorsCache[i]},removeAllTextures:function(){var t=this._textures;for(var e in t)if(t[e])t[e].releaseTexture();this._textures={}},removeTexture:function(t){if(t){var e=this._textures;for(var i in e)if(e[i]===t)e[i].releaseTexture(),delete e[i]}},removeTextureForKey:function(t){if("string"==typeof t){var e=this._textures;if(e[t])e[t].releaseTexture(),delete e[t]}},addImage:null,addImageAsync:null,cacheImage:function(t,e){if(cc.assert(t,cc._LogInfos.textureCache.invalidKey),e instanceof r)return void(this._textures[t]=e);var i=new r;i.initWithElement(e),i.handleLoadedTexture(),this._textures[t]=i},addUIImage:function(t,e){if(cc.assert(t,cc._LogInfos.textureCache.addUIImage_2),e&&this._textures[e])return this._textures[e];var i=new r;if(i.initWithImage(t),null!=e)this._textures[e]=i;else cc.log(cc._LogInfos.textureCache.addUIImage);return i},dumpCachedTextureInfo:function(){var t=0,e=0,i=this._textures;for(var n in i){var r=i[n];if(t++,r.getHtmlElementObj()instanceof HTMLImageElement)cc.log(cc._LogInfos.textureCache.dumpCachedTextureInfo,n,r.getHtmlElementObj().src,r.getPixelWidth(),r.getPixelHeight());else cc.log(cc._LogInfos.textureCache.dumpCachedTextureInfo_2,n,r.getPixelWidth(),r.getPixelHeight());e+=r.getPixelWidth()*r.getPixelHeight()*4}var s=this._textureColorsCache;for(n in s){var o=s[n];for(var a in o){var c=o[a];t++,cc.log(cc._LogInfos.textureCache.dumpCachedTextureInfo_2,n,c.width,c.height),e+=c.width*c.height*4}}cc.log(cc._LogInfos.textureCache.dumpCachedTextureInfo_3,t,e/1024,(e/1048576).toFixed(2))},_clear:function(){this._textures={},this._textureColorsCache={},this._textureKeySeq=0|1e3*Math.random(),this._loadedTexturesBefore={}}};n.once(n.EVENT_RENDERER_INITED,function(){var t=s;if(cc._renderType===n.RENDER_TYPE_CANVAS)t.handleLoadedTexture=function(t){var e=this._textures,i=e[t];if(!i)cc.assert(t,cc._LogInfos.textureCache.invalidKey),i=e[t]=new r,i.url=t;i.handleLoadedTexture()},t.addImage=function(t,e,i){cc.assert(t,cc._LogInfos.Texture2D.addImage);var n=this._textures,o=n[t];if(o)if(o.isLoaded())return e&&e.call(i,o),o;else return o.once("load",function(){e&&e.call(i,o)},i),o;return o=n[t]=new r,o.url=t,cc.loader.load(t,function(n,r){if(n)return e&&e.call(i,n||new Error("Unknown error"));else return s.handleLoadedTexture(t),void(e&&e.call(i,o))}),o},t.addImageAsync=t.addImage;else if(cc._renderType===n.RENDER_TYPE_WEBGL)t.handleLoadedTexture=function(t){var e,i,n=this._textures;if(!cc.game._rendererInitialized)n=this._loadedTexturesBefore;if(e=n[t],!e)cc.assert(t,cc._LogInfos.textureCache.invalidKey),e=n[t]=new r,e.url=t;i=cc.macro.AUTO_PREMULTIPLIED_ALPHA_FOR_PNG&&".png"===cc.path.extname(t),e.handleLoadedTexture(i)},t.addImage=function(t,e,i){cc.assert(t,cc._LogInfos.Texture2D.addImage_2);var n=this._textures;if(!cc.game._rendererInitialized)n=this._loadedTexturesBefore;var o=n[t];if(o)if(o.isLoaded())return e&&e.call(i,o),o;else return o.once("load",function(){e&&e.call(i,o)},i),o;return o=n[t]=new r,o.url=t,cc.loader.load(t,function(n,r){if(n)return e&&e.call(i,n||new Error("Unknown error"));else return s.handleLoadedTexture(t),void(e&&e.call(i,o))}),o},t.addImageAsync=t.addImage}),cc.textureCache=e.exports=s},{"../CCGame":32,"../platform/js":105,"./CCTexture2D":117}],120:[function(t,e,i){t("./CCTexture2D"),t("./CCTextureAtlas"),t("./CCTextureCache")},{"./CCTexture2D":117,"./CCTextureAtlas":118,"./CCTextureCache":119}],121:[function(t,e,i){t("../platform/CCSys");var n=/(\.[^\.\/\?\\]*)(\?.*)?$/,r=/[^\.\/]+\/\.\.\//;cc.path={join:function(){for(var t=arguments.length,e="",i=0;t>i;i++)e=(e+(""===e?"":"/")+arguments[i]).replace(/(\/|\\\\)$/,"");return e},extname:function(t){var e=n.exec(t);return e?e[1]:""},mainFileName:function(t){if(t){var e=t.lastIndexOf(".");if(-1!==e)return t.substring(0,e)}return t},basename:function(t,e){var i=t.indexOf("?");if(i>0)t=t.substring(0,i);var n=/(\/|\\\\)([^(\/|\\\\)]+)$/g,r=n.exec(t.replace(/(\/|\\\\)$/,""));if(!r)return null;var s=r[2];if(e&&t.substring(t.length-e.length).toLowerCase()===e.toLowerCase())return s.substring(0,s.length-e.length);else return s},dirname:function(t){return t.replace(/((.*)(\/|\\|\\\\))?(.*?\..*$)?/,"$2")},changeExtname:function(t,e){e=e||"";var i=t.indexOf("?"),n="";if(i>0)n=t.substring(i),t=t.substring(0,i);if(i=t.lastIndexOf("."),0>i)return t+e+n;else return t.substring(0,i)+e+n},changeBasename:function(t,e,i){if(0===e.indexOf("."))return this.changeExtname(t,e);var n=t.indexOf("?"),r="",s=i?this.extname(t):"";if(n>0)r=t.substring(n),t=t.substring(0,n);return n=t.lastIndexOf("/"),n=0>=n?0:n+1,t.substring(0,n)+e+s+r},_normalize:function(t){var e=t=String(t);do e=t,t=t.replace(r,"");while(e.length!==t.length);return t},sep:cc.sys.os===cc.sys.OS_WINDOWS?"\\":"/",_setEndWithSep:function(t,e){var i=cc.path.sep;if("undefined"==typeof e)e=!0;else if("string"==typeof e)i=e,e=!!e;var n=t[t.length-1],r="\\"===n||"/"===n;if(!r&&e)t+=i;else if(r&&!e)t=t.slice(0,-1);return t}},e.exports=cc.path},{"../platform/CCSys":95}],122:[function(t,e,i){cc.profiler=function(){var t=!1,e=!1,i=0,n=0,r=0,s=0,o=null,a=null,c=null,l=.6,h=10,u=[0,10,20,30],d=[0,0,0,0],f=3,_=0,p=0,g=function(){var t=0,e=cc.winSize.width,i=cc.winSize.height,n=cc.macro.DIRECTOR_STATS_POSITION;if(e>i)t=0|i/320*20;else t=0|e/320*20;o=new _ccsg.Label("000.0","Arial"),a=new _ccsg.Label("0.000","Arial"),c=new _ccsg.Label("0000","Arial"),o.setFontSize(t),a.setFontSize(t),c.setFontSize(t),o.setContentSize(120,40),a.setContentSize(120,40),c.setContentSize(120,40),c.setPosition(c.width/2+n.x,100+n.y),a.setPosition(a.width/2+n.x,60+n.y),o.setPosition(o.width/2+n.x,20+n.y)},m=function(t){var e,i=u.length-1,n=i,r=0;for(_++,p+=t;n>=0;n--)if(t>=u[n]){d[n]++;break}if(_>=h){for(r=p/h,n=i;n>0;n--)if(e=d[n]/h,e>=l&&r>=u[n]){if(n!==f)f=n,T.onFrameRateChange&&T.onFrameRateChange(r.toFixed(2));break}for(_=0,p=0,n=i;n>0;n--)d[n]=0}},v=function(){if(r=cc.director.getSecondsPerFrame(),i++,s+=cc.director.getDeltaTime(),s>cc.macro.DIRECTOR_FPS_INTERVAL){if(n=i/s,i=0,s=0,T.onFrameRateChange)m(n);if(e)a.setString(r.toFixed(3)),o.setString(n.toFixed(1)),c.setString((0|cc.g_NumberOfDraws).toString())}if(e)o.visit(),a.visit(),c.visit()},y=function(){o._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty),a._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty),c._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},T={onFrameRateChange:null,getSecondsPerFrame:function(){return r},getFrameRate:function(){return n},setProfileDuration:function(t){if(!isNaN(t)&&t>0)h=t/cc.macro.DIRECTOR_FPS_INTERVAL},resumeProfiling:function(){cc.director.on(cc.Director.EVENT_AFTER_VISIT,v),cc.director.on(cc.Director.EVENT_PROJECTION_CHANGED,y)},stopProfiling:function(){cc.director.off(cc.Director.EVENT_AFTER_VISIT,v),cc.director.off(cc.Director.EVENT_PROJECTION_CHANGED,y)},isShowingStats:function(){return e},showStats:function(){if(_ccsg.Label&&!o)g();if(o)e=!0;if(!t)this.init()},hideStats:function(){e=!1,cc.renderer.childrenOrderDirty=!0},init:function(){if(!t)this.resumeProfiling(),t=!0}};return T}(),e.exports=cc.profiler},{}],123:[function(t,e,i){function n(t){var e=t.parent.getChildren(),i=0;if(e.length>=2){var n=e[e.length-2];i=n.getOrderOfArrival()+1}return t.setOrderOfArrival(i),i}var r=cc.js,s=t("./scene-graph-helper"),o=t("../platform/CCObject").Flags.Destroying,a=t("./misc").DirtyFlags,c=t("../platform/id-generater"),l="position-changed",h="rotation-changed",u="scale-changed",d="size-changed",f="anchor-changed",_="color-changed",p="opacity-changed",g="child-added",m="child-removed",v="child-reorder",y=!1,T=new c("Node"),C=cc.Class({"extends":cc.Object,mixins:[cc.EventTarget],properties:{_opacity:255,_color:cc.Color.WHITE,_cascadeOpacityEnabled:!0,_parent:null,_anchorPoint:cc.p(.5,.5),_contentSize:cc.size(0,0),_children:[],_rotationX:0,_rotationY:0,_scaleX:1,_scaleY:1,_position:cc.p(0,0),_skewX:0,_skewY:0,_localZOrder:0,_globalZOrder:0,_tag:cc.macro.NODE_TAG_INVALID,_opacityModifyRGB:!1,_reorderChildDirty:!1,name:{get:function(){return this._name},set:function(t){this._name=t}},parent:{get:function(){return this._parent},set:function(t){if(this._parent!==t){if(false)if(_Scene.DetectConflict.beforeAddChild(this))return;var e=this._sgNode;if(e.parent)e.parent.removeChild(e,!1);if(t){var i=t._sgNode;i.addChild(e),n(e),t._children.push(this),t.emit(g,this)}var r=this._parent;if(this._parent=t||null,r){if(!(r._objFlags&o)){var s=r._children.indexOf(this);if(false)return cc.error("Internal error, should not remove unknown node from parent.");r._children.splice(s,1),r.emit(m,this),this._onHierarchyChanged(r)}}else if(t)this._onHierarchyChanged(null)}}},_id:{"default":"",editorOnly:!0},uuid:{get:function(){var t=this._id;if(!t)t=this._id=!1?Editor.UuidUtils.uuid():T.getNewId();return t}},skewX:{get:function(){return this._skewX},set:function(t){this._skewX=t,this._sgNode.skewX=t}},skewY:{get:function(){return this._skewY},set:function(t){this._skewY=t,this._sgNode.skewY=t}},zIndex:{get:function(){return this._localZOrder},set:function(t){if(this._localZOrder=t,this._sgNode.zIndex=t,this._parent)this._parent._reorderChildDirty=!0,this._parent._delaySort(),cc.eventManager._setDirtyForNode(this)}},rotation:{get:function(){if(this._rotationX!==this._rotationY)cc.log(cc._LogInfos.Node.getRotation);return this._rotationX},set:function(t){if(this._rotationX!==t||this._rotationY!==t){var e=this._rotationX;this._rotationX=this._rotationY=t,this._sgNode.rotation=t,this.emit(h,e)}}},rotationX:{get:function(){return this._rotationX},set:function(t){if(this._rotationX!==t){var e=this._rotationX;this._rotationX=t,this._sgNode.rotationX=t,this.emit(h,e)}}},rotationY:{get:function(){return this._rotationY},set:function(t){if(this._rotationY!==t){var e=this._rotationX;this._rotationY=t,this._sgNode.rotationY=t,this.emit(h,e)}}},scaleX:{get:function(){return this._scaleX},set:function(t){if(this._scaleX!==t){var e=this._scaleX;this._scaleX=t,this._sgNode.scaleX=t,this.emit(u,new cc.Vec2(e,this._scaleY))}}},scaleY:{get:function(){return this._scaleY},set:function(t){if(this._scaleY!==t){var e=this._scaleY;this._scaleY=t,this._sgNode.scaleY=t,this.emit(u,new cc.Vec2(this._scaleX,e))}}},x:{get:function(){return this._position.x},set:function(t){var e=this._position;if(t!==e.x)if(isFinite(t),!0){var i=e.x;if(e.x=t,this._sgNode.x=t,this.emit)this.emit(l,new cc.Vec2(i,e.y))}else cc.error(y,"new x")}},y:{get:function(){return this._position.y},set:function(t){var e=this._position;if(t!==e.y)if(isFinite(t),!0){var i=e.y;if(e.y=t,this._sgNode.y=t,this.emit)this.emit(l,new cc.Vec2(e.x,i))}else cc.error(y,"new y")}},children:{get:function(){return this._children}},childrenCount:{get:function(){return this._children.length}},anchorX:{get:function(){return this._anchorPoint.x},set:function(t){if(this._anchorPoint.x!==t){var e=cc.v2(this._anchorPoint);this._anchorPoint.x=t,this._onAnchorChanged(),this.emit(f,e)}}},anchorY:{get:function(){return this._anchorPoint.y},set:function(t){if(this._anchorPoint.y!==t){var e=cc.v2(this._anchorPoint);this._anchorPoint.y=t,this._onAnchorChanged(),this.emit(f,e)}}},width:{get:function(){if(this._sizeProvider){var t=this._sizeProvider._getWidth();return this._contentSize.width=t,t}else return this._contentSize.width},set:function(t){if(t!==this._contentSize.width){if(this._sizeProvider)this._sizeProvider.setContentSize(t,this._sizeProvider._getHeight());var e=cc.size(this._contentSize);this._contentSize.width=t,this.emit(d,e)}}},height:{get:function(){if(this._sizeProvider){var t=this._sizeProvider._getHeight();return this._contentSize.height=t,t}else return this._contentSize.height},set:function(t){if(t!==this._contentSize.height){if(this._sizeProvider)this._sizeProvider.setContentSize(this._sizeProvider._getWidth(),t);var e=cc.size(this._contentSize);this._contentSize.height=t,this.emit(d,e)}}},_ignoreAnchor:{get:function(){return this.__ignoreAnchor},set:function(t){if(this.__ignoreAnchor!==t)this.__ignoreAnchor=t,this._sgNode.ignoreAnchor=t,this._onAnchorChanged(),this.emit(f,this._anchorPoint)}},tag:{get:function(){return this._tag},set:function(t){this._tag=t,this._sgNode.tag=t}},opacity:{get:function(){return this._opacity},set:function(t){if(this._opacity!==t){var e=this._opacity;this._opacity=t,this._sgNode.opacity=t,this._onColorChanged(),this.emit(p,e)}},range:[0,255]},cascadeOpacity:{get:function(){return this._cascadeOpacityEnabled},set:function(t){if(this._cascadeOpacityEnabled!==t)this._cascadeOpacityEnabled=t,this._sgNode.cascadeOpacity=t,this._onCascadeChanged()}},color:{get:function(){var t=this._color;return new cc.Color(t.r,t.g,t.b,t.a)},set:function(t){if(!this._color.equals(t)){var e=this._color,i=cc.color(e);if(e.r=t.r,e.g=t.g,e.b=t.b,false)cc.warn('Should not set alpha via "color", use "opacity" please.');this._onColorChanged(),this.emit(_,i)}}}},ctor:function(){Object.defineProperty(this,"_id",{value:"",enumerable:!1});var t=this._sgNode=new _ccsg.Node;if(cc.sys.isNative){t.retain();var e=this;t.onEnter=function(){if(_ccsg.Node.prototype.onEnter.call(this),!e._active)cc.director.getActionManager().pauseTarget(this),cc.eventManager.pauseTarget(this)}}if(!cc.game._isCloning)t.cascadeOpacity=!0;this._dirtyFlags=a.ALL,this._sizeProvider=null,this.__ignoreAnchor=!1},_onPreDestroy:function(){this._sgNode.release()},_onHierarchyChanged:null,_onColorChanged:null,_onAnchorChanged:null,_onCascadeChanged:null,_onOpacityModifyRGBChanged:null,init:function(){return!0},attr:function(t){for(var e in t)this[e]=t[e]},setGlobalZOrder:function(t){this._globalZOrder=t,this._sgNode.setGlobalZOrder(t)},getGlobalZOrder:function(){return this._globalZOrder=this._sgNode.getGlobalZOrder(),this._globalZOrder},getScale:function(){if(this._scaleX!==this._scaleY)cc.log(cc._LogInfos.Node.getScale);return this._scaleX},setScale:function(t,e){if(t instanceof cc.Vec2)e=t.y,t=t.x;else e=e||0===e?e:t;if(this._scaleX!==t||this._scaleY!==e){var i=new cc.Vec2(this._scaleX,this._scaleY);this._scaleX=t,this._scaleY=e,this._sgNode.setScale(t,e),this.emit(u,i)}},getPosition:function(){return cc.p(this._position)},setPosition:function(t,e){var i;if(void 0===e)i=t.x,e=t.y;else i=t,e=e;var n=this._position;if(n.x!==i||n.y!==e){var r=new cc.Vec2(n);if(isFinite(i),!0)n.x=i;else return cc.error(y,"x of new position");if(isFinite(e),!0)n.y=e;else return cc.error(y,"y of new position");if(this._sgNode.setPosition(n),this.emit)this.emit(l,r)}},getAnchorPoint:function(){return cc.p(this._anchorPoint)},setAnchorPoint:function(t,e){var i,n=this._anchorPoint;if(void 0===e){if(t.x===n.x&&t.y===n.y)return;i=cc.v2(n),n.x=t.x,n.y=t.y}else{if(t===n.x&&e===n.y)return;i=cc.v2(n),n.x=t,n.y=e}this._onAnchorChanged(),this.emit(f,i)},getAnchorPointInPoints:function(){return this._sgNode.getAnchorPointInPoints()},getContentSize:function(t){if(this._sizeProvider&&!t){var e=this._sizeProvider.getContentSize();return this._contentSize=e,e}else return cc.size(this._contentSize)},setContentSize:function(t,e){var i,n=this._contentSize;if(void 0===e){if(t.width===n.width&&t.height===n.height)return;i=cc.size(n),n.width=t.width,n.height=t.height}else{if(t===n.width&&e===n.height)return;i=cc.size(n),n.width=t,n.height=e}if(this._sizeProvider)this._sizeProvider.setContentSize(n);this.emit(d,i)},getBoundingBox:function(){var t=this.getContentSize(),e=cc.rect(0,0,t.width,t.height);return cc._rectApplyAffineTransformIn(e,this.getNodeToParentTransform())},cleanup:function(){cc.director.getActionManager().removeAllActionsFromTarget(this),cc.eventManager.removeListeners(this);var t,e,i=this._children.length;for(t=0;i>t;++t)if(e=this._children[t])e.cleanup()},getChildByTag:function(t){var e=this._children;if(null!==e)for(var i=0;i<e.length;i++){var n=e[i];if(n&&n.tag===t)return n}return null},getChildByUuid:function(t){if(!t)return cc.log("Invalid uuid"),null;for(var e=this._children,i=0,n=e.length;n>i;i++)if(e[i]._id===t)return e[i];return null},getChildByName:function(t){if(!t)return cc.log("Invalid name"),null;for(var e=this._children,i=0,n=e.length;n>i;i++)if(e[i]._name===t)return e[i];return null},addChild:function(t,e,i){e=void 0===e?t._localZOrder:e;var n,r=!1;if(cc.js.isUndefined(i))i=void 0,n=t._name;else if(cc.js.isString(i))n=i,i=void 0;else if(cc.js.isNumber(i))r=!0,n="";cc.assert(t,cc._LogInfos.Node.addChild_3),cc.assert(null===t._parent,"child already added. It can't be added again"),this._addChildHelper(t,e,i,n,r)},_addChildHelper:function(t,e,i,n,r){if(this._insertChild(t,e),r)t.setTag(i);else t.setName(n)},_insertChild:function(t,e){t.parent=this,t.zIndex=e},removeFromParent:function(t){if(this._parent){if(void 0===t)t=!0;this._parent.removeChild(this,t)}},removeChild:function(t,e){if(0!==this._children.length){if(void 0===e)e=!0;if(this._children.indexOf(t)>-1)this._detachChild(t,e)}},removeChildByTag:function(t,e){if(t===cc.macro.NODE_TAG_INVALID)cc.log(cc._LogInfos.Node.removeChildByTag);var i=this.getChildByTag(t);if(!i)cc.log(cc._LogInfos.Node.removeChildByTag_2,t);else this.removeChild(i,e)},removeAllChildren:function(t){var e=this._children;if(void 0===t)t=!0;for(var i=e.length-1;i>=0;i--){var n=e[i];if(n){if(t)n.cleanup();n.parent=null}}this._children.length=0},_detachChild:function(t,e){if(e)t.cleanup();t.parent=null},setNodeDirty:function(){this._sgNode.setNodeDirty()},getParentToNodeTransform:function(){return this._sgNode.getParentToNodeTransform()},_isSgTransformArToMe:function(t){var e=this._sgNode.getContentSize();if(0===e.width&&0===e.height&&(0!==t.width||0!==t.height))return!0;if(this._sgNode.isIgnoreAnchorPointForPosition())return!0;else return!1},getNodeToWorldTransform:function(){var t=this.getContentSize(),e=this._sgNode.getNodeToWorldTransform();if(this._isSgTransformArToMe(t)){var i=-this._anchorPoint.x*t.width,n=-this._anchorPoint.y*t.height,r=cc.affineTransformMake(1,0,0,1,i,n);e=cc.affineTransformConcatIn(r,e)}return e},getNodeToWorldTransformAR:function(){var t=this.getContentSize(),e=this._sgNode.getNodeToWorldTransform();if(!this._isSgTransformArToMe(t)){var i=this._anchorPoint.x*t.width,n=this._anchorPoint.y*t.height,r=cc.affineTransformMake(1,0,0,1,i,n);e=cc.affineTransformConcatIn(r,e)}return e},getWorldToNodeTransform:function(){return this._sgNode.getWorldToNodeTransform()},convertToNodeSpace:function(t){var e=this._sgNode.convertToNodeSpace(t);return cc.pAdd(e,cc.p(this._anchorPoint.x*this._contentSize.width,this._anchorPoint.y*this._contentSize.height))},convertToWorldSpace:function(t){var e=this._sgNode.convertToWorldSpace(t);return cc.pSub(e,cc.p(this._anchorPoint.x*this._contentSize.width,this._anchorPoint.y*this._contentSize.height))},convertToNodeSpaceAR:function(t){if(this._sgNode.isIgnoreAnchorPointForPosition())return cc.v2(this._sgNode.convertToNodeSpace(t));else return this._sgNode.convertToNodeSpaceAR(t)},convertToWorldSpaceAR:function(t){if(this._sgNode.isIgnoreAnchorPointForPosition())return cc.v2(this._sgNode.convertToWorldSpace(t));else return cc.v2(this._sgNode.convertToWorldSpaceAR(t))},convertTouchToNodeSpace:function(t){return this.convertToNodeSpace(t.getLocation())},convertTouchToNodeSpaceAR:function(t){return this.convertToNodeSpaceAR(t.getLocation())},getNodeToParentTransform:function(){var t=this.getContentSize(),e=this._sgNode.getNodeToParentTransform();if(this._isSgTransformArToMe(t)){var i=-this._anchorPoint.x*t.width,n=-this._anchorPoint.y*t.height,r=cc.affineTransformMake(1,0,0,1,i,n);
e=cc.affineTransformConcatIn(r,e)}return e},getNodeToParentTransformAR:function(){var t=this.getContentSize(),e=this._sgNode.getNodeToParentTransform();if(!this._isSgTransformArToMe(t)){var i=this._anchorPoint.x*t.width,n=this._anchorPoint.y*t.height,r=cc.affineTransformMake(1,0,0,1,i,n);e=cc.affineTransformConcatIn(r,e)}return e},getBoundingBoxToWorld:function(){var t;if(this.parent)t=this.parent.getNodeToWorldTransformAR();return this._getBoundingBoxTo(t)},_getBoundingBoxTo:function(t){var e=this.getContentSize(),i=e.width,n=e.height,r=cc.rect(-this._anchorPoint.x*i,-this._anchorPoint.y*n,i,n),s=cc.affineTransformConcat(this.getNodeToParentTransformAR(),t);if(cc._rectApplyAffineTransformIn(r,s),!this._children)return r;for(var o=this._children,a=0;a<o.length;a++){var c=o[a];if(c&&c.active){var l=c._getBoundingBoxTo(s);if(l)r=cc.rectUnion(r,l)}}return r},getDisplayedOpacity:function(){return this._sgNode.getDisplayedOpacity()},_updateDisplayedOpacity:function(t){this._sgNode.updateDisplayedOpacity(t)},getDisplayedColor:function(){return this._sgNode.getDisplayedColor()},setOpacityModifyRGB:function(t){if(this._opacityModifyRGB!==t)this._opacityModifyRGB=t,this._sgNode.setOpacityModifyRGB(t),this._onOpacityModifyRGBChanged()},isOpacityModifyRGB:function(){return this._opacityModifyRGB},getSiblingIndex:function(){if(this._parent)return this._parent._children.indexOf(this);else return 0},setSiblingIndex:function(t){if(this._parent){var e=this._parent._children;t=-1!==t?t:e.length-1;var i=e.indexOf(this);if(t!==i){if(e.splice(i,1),t<e.length)e.splice(t,0,this);else e.push(this);for(var n=this._parent._children,r=0,s=n.length;s>r;r++){var o=n[r];o._sgNode.arrivalOrder=r}if(1)cc.renderer.childrenOrderDirty=!0,this._parent._sgNode._reorderChildDirty=!0,this._parent._reorderChildDirty=!0,this._parent._delaySort()}}},isChildOf:function(t){var e=this;do{if(e===t)return!0;e=e._parent}while(e);return!1},sortAllChildren:function(){if(this._reorderChildDirty){var t=this._children;if(!t)return void(this._reorderChildDirty=!1);var e,i,n,r=t.length;for(e=1;r>e;e++){for(n=t[e],i=e-1;i>=0;){if(n._localZOrder<t[i]._localZOrder)t[i+1]=t[i];else if(n._localZOrder===t[i]._localZOrder&&n._sgNode.arrivalOrder<t[i]._sgNode.arrivalOrder)t[i+1]=t[i];else break;i--}t[i+1]=n}this._reorderChildDirty=!1,this.emit(v)}cc.director.off(cc.Director.EVENT_AFTER_UPDATE,this.sortAllChildren,this)},_delaySort:function(){cc.director.on(cc.Director.EVENT_AFTER_UPDATE,this.sortAllChildren,this)},_updateDummySgNode:function(){var t=this._sgNode;t.setPosition(this._position),t.setRotationX(this._rotationX),t.setRotationY(this._rotationY),t.setScale(this._scaleX,this._scaleY),t.setSkewX(this._skewX),t.setSkewY(this._skewY),t.ignoreAnchorPointForPosition(this.__ignoreAnchor);var e=t.arrivalOrder;t.setLocalZOrder(this._localZOrder),t.arrivalOrder=e,t.setGlobalZOrder(this._globalZOrder),t.setOpacity(this._opacity),t.setOpacityModifyRGB(this._opacityModifyRGB),t.setCascadeOpacityEnabled(this._cascadeOpacityEnabled),t.setTag(this._tag)},_updateSgNode:function(){this._updateDummySgNode();var t=this._sgNode;if(t.setAnchorPoint(this._anchorPoint),t.setVisible(this._active),t.setColor(this._color),this._activeInHierarchy)cc.director.getActionManager().resumeTarget(this),cc.eventManager.resumeTarget(this);else cc.director.getActionManager().pauseTarget(this),cc.eventManager.pauseTarget(this)},_onBatchCreated:function(){if(this._updateDummySgNode(),this._parent)this._parent._sgNode.addChild(this._sgNode);if(!this._activeInHierarchy)cc.director.getActionManager().pauseTarget(this),cc.eventManager.pauseTarget(this);for(var t=this._children,e=0,i=t.length;i>e;e++)t[e]._onBatchCreated()},_removeSgNode:s.removeSgNode});!function(){for(var t,e=["name","skewX","skewY","position","rotation","rotationX","rotationY","scale","scaleX","scaleY","children","childrenCount","parent","running","scheduler","opacity","color","tag"],i={x:["getPositionX","setPositionX"],y:["getPositionY","setPositionY"],zIndex:["getLocalZOrder","setLocalZOrder"],opacityModifyRGB:["isOpacityModifyRGB"],cascadeOpacity:["isCascadeOpacityEnabled","setCascadeOpacityEnabled"],cascadeColor:["isCascadeColorEnabled","setCascadeColorEnabled"]},n=C.prototype,s=0;s<e.length;s++){t=e[s];var o=t[0].toUpperCase()+t.slice(1),a=Object.getOwnPropertyDescriptor(n,t);if(a){if(a.get)n["get"+o]=a.get;if(a.set)n["set"+o]=a.set}else r.getset(n,t,n["get"+o],n["set"+o])}for(t in i){var c=i[t],a=Object.getOwnPropertyDescriptor(n,t);if(a){if(n[c[0]]=a.get,c[1])n[c[1]]=a.set}else r.getset(n,t,n[c[0]],n[c[1]])}}(),cc._BaseNode=e.exports=C},{"../platform/CCObject":92,"../platform/id-generater":102,"./misc":126,"./scene-graph-helper":127}],124:[function(t,e,i){cc.find=e.exports=function(t,e){if(null==t)return cc.error("Argument must be non-nil"),null;if(!e){var i=cc.director.getScene();if(!i)return cc.warn("Can not get current scene."),null;e=i}for(var n=e,r="/"!==t[0]?0:1,s=t.split("/"),o=r;o<s.length;o++){var a=s[o],c=n._children;n=null;for(var l=0,h=c.length;h>l;++l){var u=c[l];if(u.name===a){n=u;break}}if(!n)return null}return n}},{}],125:[function(t,e,i){t("./CCPath"),t("./CCProfiler"),t("./find")},{"./CCPath":121,"./CCProfiler":122,"./find":124}],126:[function(t,e,i){var n=cc.js,r={};r.propertyDefine=function(t,e,i){for(var r,s=t.prototype,o=0;o<e.length;o++){r=e[o];var a=r[0].toUpperCase()+r.slice(1),c=Object.getOwnPropertyDescriptor(s,r);if(c){if(c.get)s["get"+a]=c.get;if(c.set)s["set"+a]=c.set}else n.getset(s,r,s["get"+a],s["set"+a])}for(r in i){var l=i[r],c=Object.getOwnPropertyDescriptor(s,r);if(c){if(s[l[0]]=c.get,l[1])s[l[1]]=c.set}else n.getset(s,r,s[l[0]],s[l[1]])}},r.NextPOT=function(t){return t-=1,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,t+1};var s=r.DirtyFlags={TRANSFORM:1,SIZE:2,ALL:3};s.WIDGET=s.TRANSFORM|s.SIZE,e.exports=r},{}],127:[function(t,e,i){var n={removeSgNode:function(){var t=this._sgNode;if(t){var e=t._parent;if(e)e.removeChild(t);t.release()}}};if(!1)n._getChildrenOffset=function(t){if(t){var e=t._sgNode,i=t._children[0];if(i){var n=i._sgNode,r=e._children.indexOf(n);if(-1!==r)return r;else return cc.error("%s's scene graph node not contains in the parent's children",i.name),-1}else return e._children.length}else return 0},n.checkMatchCurrentScene=function(){function t(e,i){if(e._sgNode!==i)throw new Error("scene graph node not equal: "+e.name);var r=e._children.length,s=n._getChildrenOffset(e);if(i._children.length!==r+s)throw new Error("Mismatched child scene graphs: "+e.name);for(var o=0;r>o;o++)t(e._children[o],i._children[s+o])}var e=cc.director.getScene(),i=cc.director.getRunningScene();t(e,i)},cc._Test.SceneGraphUtils=n;e.exports=n},{}],128:[function(t,e,i){cc.AffineTransform=function(t,e,i,n,r,s){this.a=t,this.b=e,this.c=i,this.d=n,this.tx=r,this.ty=s},cc.affineTransformMake=function(t,e,i,n,r,s){return{a:t,b:e,c:i,d:n,tx:r,ty:s}},cc.affineTransformClone=function(t){return{a:t.a,b:t.b,c:t.c,d:t.d,tx:t.tx,ty:t.ty}},cc.pointApplyAffineTransform=function(t,e,i){var n,r;if(void 0===i)i=e,n=t.x,r=t.y;else n=t,r=e;return{x:i.a*n+i.c*r+i.tx,y:i.b*n+i.d*r+i.ty}},cc._pointApplyAffineTransform=function(t,e,i){return cc.pointApplyAffineTransform(t,e,i)},cc.sizeApplyAffineTransform=function(t,e){return{width:e.a*t.width+e.c*t.height,height:e.b*t.width+e.d*t.height}},cc.affineTransformMakeIdentity=function(){return{a:1,b:0,c:0,d:1,tx:0,ty:0}},cc.affineTransformIdentity=function(){return{a:1,b:0,c:0,d:1,tx:0,ty:0}},cc.rectApplyAffineTransform=function(t,e){var i=cc.rectGetMinY(t),n=cc.rectGetMinX(t),r=cc.rectGetMaxX(t),s=cc.rectGetMaxY(t),o=cc.pointApplyAffineTransform(n,i,e),a=cc.pointApplyAffineTransform(r,i,e),c=cc.pointApplyAffineTransform(n,s,e),l=cc.pointApplyAffineTransform(r,s,e),h=Math.min(o.x,a.x,c.x,l.x),u=Math.max(o.x,a.x,c.x,l.x),d=Math.min(o.y,a.y,c.y,l.y),f=Math.max(o.y,a.y,c.y,l.y);return cc.rect(h,d,u-h,f-d)},cc._rectApplyAffineTransformIn=function(t,e){var i=cc.rectGetMinY(t),n=cc.rectGetMinX(t),r=cc.rectGetMaxX(t),s=cc.rectGetMaxY(t),o=cc.pointApplyAffineTransform(n,i,e),a=cc.pointApplyAffineTransform(r,i,e),c=cc.pointApplyAffineTransform(n,s,e),l=cc.pointApplyAffineTransform(r,s,e),h=Math.min(o.x,a.x,c.x,l.x),u=Math.max(o.x,a.x,c.x,l.x),d=Math.min(o.y,a.y,c.y,l.y),f=Math.max(o.y,a.y,c.y,l.y);return t.x=h,t.y=d,t.width=u-h,t.height=f-d,t},cc.affineTransformTranslate=function(t,e,i){return{a:t.a,b:t.b,c:t.c,d:t.d,tx:t.tx+t.a*e+t.c*i,ty:t.ty+t.b*e+t.d*i}},cc.affineTransformScale=function(t,e,i){return{a:t.a*e,b:t.b*e,c:t.c*i,d:t.d*i,tx:t.tx,ty:t.ty}},cc.affineTransformRotate=function(t,e){var i=Math.sin(e),n=Math.cos(e);return{a:t.a*n+t.c*i,b:t.b*n+t.d*i,c:t.c*n-t.a*i,d:t.d*n-t.b*i,tx:t.tx,ty:t.ty}},cc.affineTransformConcat=function(t,e){return{a:t.a*e.a+t.b*e.c,b:t.a*e.b+t.b*e.d,c:t.c*e.a+t.d*e.c,d:t.c*e.b+t.d*e.d,tx:t.tx*e.a+t.ty*e.c+e.tx,ty:t.tx*e.b+t.ty*e.d+e.ty}},cc.affineTransformConcatIn=function(t,e){var i=t.a,n=t.b,r=t.c,s=t.d,o=t.tx,a=t.ty;return t.a=i*e.a+n*e.c,t.b=i*e.b+n*e.d,t.c=r*e.a+s*e.c,t.d=r*e.b+s*e.d,t.tx=o*e.a+a*e.c+e.tx,t.ty=o*e.b+a*e.d+e.ty,t},cc.affineTransformEqualToTransform=function(t,e){return t.a===e.a&&t.b===e.b&&t.c===e.c&&t.d===e.d&&t.tx===e.tx&&t.ty===e.ty},cc.affineTransformInvert=function(t){var e=1/(t.a*t.d-t.b*t.c);return{a:e*t.d,b:-e*t.b,c:-e*t.c,d:e*t.a,tx:e*(t.c*t.ty-t.d*t.tx),ty:e*(t.b*t.tx-t.a*t.ty)}}},{}],129:[function(t,e,i){var n=t("./CCValueType"),r=t("../platform/js"),s=function(){function e(t,e,i,n){if("object"==typeof t)e=t.g,i=t.b,n=t.a,t=t.r;this.r="number"==typeof t?t:0,this.g="number"==typeof e?e:0,this.b="number"==typeof i?i:0,this.a="number"==typeof n?n:255}r.extend(e,n),t("../platform/CCClass").fastDefine("cc.Color",e,["r","g","b","a"]);var i={WHITE:[255,255,255,255],BLACK:[0,0,0,255],TRANSPARENT:[0,0,0,0],GRAY:[127.5,127.5,127.5],RED:[255,0,0],GREEN:[0,255,0],BLUE:[0,0,255],YELLOW:[255,235,4],ORANGE:[255,127,0],CYAN:[0,255,255],MAGENTA:[255,0,255]};for(var s in i){var o=function(t,i,n,r){return function(){return new e(t,i,n,r)}}.apply(null,i[s]);Object.defineProperty(e,s,{get:o})}return e.prototype.clone=function(){return new e(this.r,this.g,this.b,this.a)},e.prototype.equals=function(t){return t&&this.r===t.r&&this.g===t.g&&this.b===t.b&&this.a===t.a},e.prototype.lerp=function(t,i,n){n=n||new e;var r=this.r,s=this.g,o=this.b,a=this.a;return n.r=r+(t.r-r)*i,n.g=s+(t.g-s)*i,n.b=o+(t.b-o)*i,n.a=a+(t.a-a)*i,n},e.prototype.toString=function(){return"rgba("+this.r.toFixed()+", "+this.g.toFixed()+", "+this.b.toFixed()+", "+this.a.toFixed()+")"},e.prototype.setR=function(t){return this.r=t,this},e.prototype.setG=function(t){return this.g=t,this},e.prototype.setB=function(t){return this.b=t,this},e.prototype.setA=function(t){return this.a=t,this},e.prototype.toCSS=function(t){if("rgba"===t)return"rgba("+(0|this.r)+","+(0|this.g)+","+(0|this.b)+","+(this.a/255).toFixed(2)+")";else if("rgb"===t)return"rgb("+(0|this.r)+","+(0|this.g)+","+(0|this.b)+")";else return"#"+this.toHEX(t)},e.prototype.clamp=function(){this.r=cc.clampf(this.r,0,255),this.g=cc.clampf(this.g,0,255),this.b=cc.clampf(this.b,0,255),this.a=cc.clampf(this.a,0,255)},e.prototype.fromHEX=function(t){var e=parseInt(t.indexOf("#")>-1?t.substring(1):t,16);return this.r=e>>16,this.g=(65280&e)>>8,this.b=255&e,this},e.prototype.toHEX=function(t){var e=[(0|this.r).toString(16),(0|this.g).toString(16),(0|this.b).toString(16)],i=-1;if("#rgb"===t){for(i=0;i<e.length;++i)if(e[i].length>1)e[i]=e[i][0]}else if("#rrggbb"===t)for(i=0;i<e.length;++i)if(1===e[i].length)e[i]="0"+e[i];return e.join("")},e.prototype.toRGBValue=function(){return(cc.clampf(this.r,0,255)<<16)+(cc.clampf(this.g,0,255)<<8)+cc.clampf(this.b,0,255)},e.prototype.fromHSV=function(t,i,n){var r=e.hsv2rgb(t,i,n);return this.r=r.r,this.g=r.g,this.b=r.b,this},e.prototype.toHSV=function(){return e.rgb2hsv(this.r,this.g,this.b)},e}();s.rgb2hsv=function(t,e,i){t/=255,e/=255,i/=255;var n={h:0,s:0,v:0},r=Math.max(t,e,i),s=Math.min(t,e,i),o=0;if(n.v=r,n.s=r?(r-s)/r:0,!n.s)n.h=0;else{if(o=r-s,t===r)n.h=(e-i)/o;else if(e===r)n.h=2+(i-t)/o;else n.h=4+(t-e)/o;if(n.h/=6,n.h<0)n.h+=1}return n},s.hsv2rgb=function(t,e,i){var n={r:0,g:0,b:0};if(0===e)n.r=n.g=n.b=i;else if(0===i)n.r=n.g=n.b=0;else{if(1===t)t=0;t*=6,e=e,i=i;var r=Math.floor(t),s=t-r,o=i*(1-e),a=i*(1-e*s),c=i*(1-e*(1-s));switch(r){case 0:n.r=i,n.g=c,n.b=o;break;case 1:n.r=a,n.g=i,n.b=o;break;case 2:n.r=o,n.g=i,n.b=c;break;case 3:n.r=o,n.g=a,n.b=i;break;case 4:n.r=c,n.g=o,n.b=i;break;case 5:n.r=i,n.g=o,n.b=a}}return n.r*=255,n.g*=255,n.b*=255,n},cc.Color=s,cc.color=function(t,e,i,n){if(r.isString(t)){var s=new cc.Color;return s.fromHEX(t)}if(cc.js.isObject(t))return new cc.Color(t.r,t.g,t.b,t.a);else return new cc.Color(t,e,i,n)},cc.colorEqual=function(t,e){return t.r===e.r&&t.g===e.g&&t.b===e.b},cc.hexToColor=function(t){t=t.replace(/^#?/,"0x");var e=parseInt(t),i=e>>16,n=(65280&e)>>8,r=255&e;return cc.color(i,n,r)},cc.colorToHex=function(t){var e=t.r.toString(16),i=t.g.toString(16),n=t.b.toString(16);return"#"+(t.r<16?"0"+e:e)+(t.g<16?"0"+i:i)+(t.b<16?"0"+n:n)},e.exports=cc.Color},{"../platform/CCClass":88,"../platform/js":105,"./CCValueType":136}],130:[function(t,e,i){if(cc.Enum=function(t){var e={};Object.defineProperty(e,"__enums__",{value:void 0,writable:!0});var i=-1;for(var n in t){var r=t[n];if(-1===r)r=++i;else i=r;e[n]=r;var s=""+r;if(n!==s)Object.defineProperty(e,s,{value:n,enumerable:!1})}return e},cc.Enum.isEnum=function(t){return t&&t.hasOwnProperty("__enums__")},cc.Enum.getList=function(t){if(void 0!==t.__enums__)return t.__enums__;var e=[];for(var i in t)if(t.hasOwnProperty(i)){var n=t[i],r="number"==typeof n&&(0|n)===n;if(r)e.push({name:i,value:n})}return e.sort(function(t,e){return t.value-e.value}),t.__enums__=e,e},!1){var n=cc.Enum({ZERO:-1,ONE:-1,TWO:-1,THREE:-1});if(0!==n.ZERO||1!==n.ONE||2!==n.TWO||3!==n.THREE)cc.error('Sorry, "cc.Enum" not available on this platform, please report this error here: https://github.com/fireball-x/fireball/issues/new')}e.exports=cc.Enum},{}],131:[function(t,e,i){var n=parseFloat("1.192092896e-07F");cc.pNeg=function(t){return cc.p(-t.x,-t.y)},cc.pAdd=function(t,e){return cc.p(t.x+e.x,t.y+e.y)},cc.pSub=function(t,e){return cc.p(t.x-e.x,t.y-e.y)},cc.pMult=function(t,e){return cc.p(t.x*e,t.y*e)},cc.pMidpoint=function(t,e){return cc.pMult(cc.pAdd(t,e),.5)},cc.pDot=function(t,e){return t.x*e.x+t.y*e.y},cc.pCross=function(t,e){return t.x*e.y-t.y*e.x},cc.pPerp=function(t){return cc.p(-t.y,t.x)},cc.pRPerp=function(t){return cc.p(t.y,-t.x)},cc.pProject=function(t,e){return cc.pMult(e,cc.pDot(t,e)/cc.pDot(e,e))},cc.pRotate=function(t,e){return cc.p(t.x*e.x-t.y*e.y,t.x*e.y+t.y*e.x)},cc.pUnrotate=function(t,e){return cc.p(t.x*e.x+t.y*e.y,t.y*e.x-t.x*e.y)},cc.pLengthSQ=function(t){return cc.pDot(t,t)},cc.pDistanceSQ=function(t,e){return cc.pLengthSQ(cc.pSub(t,e))},cc.pLength=function(t){return Math.sqrt(cc.pLengthSQ(t))},cc.pDistance=function(t,e){return cc.pLength(cc.pSub(t,e))},cc.pNormalize=function(t){var e=cc.pLength(t);return 0===e?cc.p(t):cc.pMult(t,1/e)},cc.pForAngle=function(t){return cc.p(Math.cos(t),Math.sin(t))},cc.pToAngle=function(t){return Math.atan2(t.y,t.x)},cc.clampf=function(t,e,i){if(e>i){var n=e;e=i,i=n}return e>t?e:i>t?t:i},cc.clamp01=function(t){return 0>t?0:1>t?t:1},cc.pClamp=function(t,e,i){return cc.p(cc.clampf(t.x,e.x,i.x),cc.clampf(t.y,e.y,i.y))},cc.pFromSize=function(t){return cc.p(t.width,t.height)},cc.pCompOp=function(t,e){return cc.p(e(t.x),e(t.y))},cc.pLerp=function(t,e,i){return cc.pAdd(cc.pMult(t,1-i),cc.pMult(e,i))},cc.pFuzzyEqual=function(t,e,i){if(t.x-i<=e.x&&e.x<=t.x+i)if(t.y-i<=e.y&&e.y<=t.y+i)return!0;return!1},cc.pCompMult=function(t,e){return cc.p(t.x*e.x,t.y*e.y)},cc.pAngleSigned=function(t,e){var i=cc.pNormalize(t),r=cc.pNormalize(e),s=Math.atan2(i.x*r.y-i.y*r.x,cc.pDot(i,r));if(Math.abs(s)<n)return 0;else return s},cc.pAngle=function(t,e){var i=Math.acos(cc.pDot(cc.pNormalize(t),cc.pNormalize(e)));if(Math.abs(i)<n)return 0;else return i},cc.pRotateByAngle=function(t,e,i){var n=cc.pSub(t,e),r=Math.cos(i),s=Math.sin(i),o=n.x;return n.x=o*r-n.y*s+e.x,n.y=o*s+n.y*r+e.y,n},cc.pLineIntersect=function(t,e,i,n,r){if(t.x===e.x&&t.y===e.y||i.x===n.x&&i.y===n.y)return!1;var s=e.x-t.x,o=e.y-t.y,a=n.x-i.x,c=n.y-i.y,l=t.x-i.x,h=t.y-i.y,u=c*s-a*o;if(r.x=a*h-c*l,r.y=s*h-o*l,0===u)if(0===r.x||0===r.y)return!0;else return!1;return r.x=r.x/u,r.y=r.y/u,!0},cc.pSegmentIntersect=function(t,e,i,n){var r=cc.p(0,0);if(cc.pLineIntersect(t,e,i,n,r))if(r.x>=0&&r.x<=1&&r.y>=0&&r.y<=1)return!0;return!1},cc.pIntersectPoint=function(t,e,i,n){var r=cc.p(0,0);if(cc.pLineIntersect(t,e,i,n,r)){var s=cc.p(0,0);return s.x=t.x+r.x*(e.x-t.x),s.y=t.y+r.x*(e.y-t.y),s}return cc.p(0,0)},cc.pSameAs=function(t,e){if(null!=t&&null!=e)return t.x===e.x&&t.y===e.y;else return!1},cc.pZeroIn=function(t){t.x=0,t.y=0},cc.pIn=function(t,e){t.x=e.x,t.y=e.y},cc.pMultIn=function(t,e){t.x*=e,t.y*=e},cc.pSubIn=function(t,e){t.x-=e.x,t.y-=e.y},cc.pAddIn=function(t,e){t.x+=e.x,t.y+=e.y},cc.pNormalizeIn=function(t){cc.pMultIn(t,1/Math.sqrt(t.x*t.x+t.y*t.y))}},{}],132:[function(t,e,i){function n(t,e,i,n){if(t&&"object"==typeof t)e=t.y,i=t.width,n=t.height,t=t.x;this.x="number"==typeof t?t:0,this.y="number"==typeof e?e:0,this.width="number"==typeof i?i:0,this.height="number"==typeof n?n:0}var r=t("./CCValueType"),s=t("../platform/js");s.extend(n,r),t("../platform/CCClass").fastDefine("cc.Rect",n,["x","y","width","height"]),n.fromMinMax=function(t,e){var i=Math.min(t.x,e.x),r=Math.min(t.y,e.y),s=Math.max(t.x,e.x),o=Math.max(t.y,e.y);return new n(i,r,s-i,o-r)},n.contain=function(t,e){if(t.x<=e.x&&t.x+t.width>=e.x+e.width&&t.y<=e.y&&t.y+t.height>=e.y+e.height)return 1;if(e.x<=t.x&&e.x+e.width>=t.x+t.width&&e.y<=t.y&&e.y+e.height>=t.y+t.height)return-1;else return 0};var o=n.prototype;o.clone=function(){return new n(this.x,this.y,this.width,this.height)},o.equals=function(t){return t&&this.x===t.x&&this.y===t.y&&this.width===t.width&&this.height===t.height},o.lerp=function(t,e,i){i=i||new n;var r=this.x,s=this.y,o=this.width,a=this.height;return i.x=r+(t.x-r)*e,i.y=s+(t.y-s)*e,i.width=o+(t.width-o)*e,i.height=a+(t.height-a)*e,i},o.toString=function(){return"("+this.x.toFixed(2)+", "+this.y.toFixed(2)+", "+this.width.toFixed(2)+", "+this.height.toFixed(2)+")"},Object.defineProperty(o,"xMin",{get:function(){return this.x},set:function(t){this.width+=this.x-t,this.x=t}}),Object.defineProperty(o,"yMin",{get:function(){return this.y},set:function(t){this.height+=this.y-t,this.y=t}}),Object.defineProperty(o,"xMax",{get:function(){return this.x+this.width},set:function(t){this.width=t-this.x}}),Object.defineProperty(o,"yMax",{get:function(){return this.y+this.height},set:function(t){this.height=t-this.y}}),Object.defineProperty(o,"center",{get:function(){return new cc.Vec2(this.x+.5*this.width,this.y+.5*this.height)},set:function(t){this.x=t.x-.5*this.width,this.y=t.y-.5*this.height}}),Object.defineProperty(o,"size",{get:function(){return new cc.Size(this.width,this.height)},set:function(t){this.width=t.width,this.height=t.height}}),o.intersects=function(t){return cc.rectIntersectsRect(this,t)},o.contains=function(t){return this.x<=t.x&&this.x+this.width>=t.x&&this.y<=t.y&&this.y+this.height>=t.y},o.containsRect=function(t){return this.x<=t.x&&this.x+this.width>=t.x+t.width&&this.y<=t.y&&this.y+this.height>=t.y+t.height},cc.Rect=n,cc.rect=function(t,e,i,r){return new n(t,e,i,r)},cc.rectEqualToRect=function(t,e){return t&&e&&t.x===e.x&&t.y===e.y&&t.width===e.width&&t.height===e.height},cc._rectEqualToZero=function(t){return t&&0===t.x&&0===t.y&&0===t.width&&0===t.height},cc.rectContainsRect=function(t,e){if(!t||!e)return!1;else return!(t.x>=e.x||t.y>=e.y||t.x+t.width<=e.x+e.width||t.y+t.height<=e.y+e.height)},cc.rectGetMaxX=function(t){return t.x+t.width},cc.rectGetMidX=function(t){return t.x+t.width/2},cc.rectGetMinX=function(t){return t.x},cc.rectGetMaxY=function(t){return t.y+t.height},cc.rectGetMidY=function(t){return t.y+t.height/2},cc.rectGetMinY=function(t){return t.y},cc.rectContainsPoint=function(t,e){return e.x>=cc.rectGetMinX(t)&&e.x<=cc.rectGetMaxX(t)&&e.y>=cc.rectGetMinY(t)&&e.y<=cc.rectGetMaxY(t)},cc.rectIntersectsRect=function(t,e){var i=t.x+t.width,n=t.y+t.height,r=e.x+e.width,s=e.y+e.height;return!(i<e.x||r<t.x||n<e.y||s<t.y)},cc.rectOverlapsRect=function(t,e){return!(t.x+t.width<e.x||e.x+e.width<t.x||t.y+t.height<e.y||e.y+e.height<t.y)},cc.rectUnion=function(t,e){var i=cc.rect(0,0,0,0);return i.x=Math.min(t.x,e.x),i.y=Math.min(t.y,e.y),i.width=Math.max(t.x+t.width,e.x+e.width)-i.x,i.height=Math.max(t.y+t.height,e.y+e.height)-i.y,i},cc.rectIntersection=function(t,e){var i=cc.rect(Math.max(cc.rectGetMinX(t),cc.rectGetMinX(e)),Math.max(cc.rectGetMinY(t),cc.rectGetMinY(e)),0,0);return i.width=Math.min(cc.rectGetMaxX(t),cc.rectGetMaxX(e))-cc.rectGetMinX(i),i.height=Math.min(cc.rectGetMaxY(t),cc.rectGetMaxY(e))-cc.rectGetMinY(i),i},e.exports=cc.Rect},{"../platform/CCClass":88,"../platform/js":105,"./CCValueType":136}],133:[function(t,e,i){function n(t,e){if(t&&"object"==typeof t)e=t.height,t=t.width;this.width="number"==typeof t?t:0,this.height="number"==typeof e?e:0}var r=t("./CCValueType"),s=t("../platform/js");s.extend(n,r),t("../platform/CCClass").fastDefine("cc.Size",n,["width","height"]),s.get(n,"ZERO",function(){return new n(0,0)});var o=n.prototype;o.clone=function(){return new n(this.width,this.height)},o.equals=function(t){return t&&this.width===t.width&&this.height===t.height},o.lerp=function(t,e,i){i=i||new n;var r=this.width,s=this.height;return i.width=r+(t.width-r)*e,i.height=s+(t.height-s)*e,i},o.toString=function(){return"("+this.width.toFixed(2)+", "+this.height.toFixed(2)+")"},cc.size=function(t,e){return new n(t,e)},cc.sizeEqualToSize=function(t,e){return t&&e&&t.width===e.width&&t.height===e.height},cc.Size=e.exports=n},{"../platform/CCClass":88,"../platform/js":105,"./CCValueType":136}],134:[function(t,e,i){cc.Acceleration=function(t,e,i,n){this.x=t||0,this.y=e||0,this.z=i||0,this.timestamp=n||0},cc.BlendFunc=function(t,e){this.src=t,this.dst=e};var n=cc.Enum({ONE:1,ZERO:0,SRC_ALPHA:770,SRC_COLOR:768,DST_ALPHA:772,DST_COLOR:774,ONE_MINUS_SRC_ALPHA:771,ONE_MINUS_SRC_COLOR:769,ONE_MINUS_DST_ALPHA:773,ONE_MINUS_DST_COLOR:775});cc.BlendFunc._disable=function(){return new cc.BlendFunc(n.ONE,n.ZERO)},cc.BlendFunc._alphaPremultiplied=function(){return new cc.BlendFunc(n.ONE,n.ONE_MINUS_SRC_ALPHA)},cc.BlendFunc._alphaNonPremultiplied=function(){return new cc.BlendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA)},cc.BlendFunc._additive=function(){return new cc.BlendFunc(n.SRC_ALPHA,n.ONE)},cc.BlendFunc.BlendFactor=n,cc.BlendFunc.DISABLE,cc.js.get(cc.BlendFunc,"DISABLE",cc.BlendFunc._disable),cc.BlendFunc.ALPHA_PREMULTIPLIED,cc.js.get(cc.BlendFunc,"ALPHA_PREMULTIPLIED",cc.BlendFunc._alphaPremultiplied),cc.BlendFunc.ALPHA_NON_PREMULTIPLIED,cc.js.get(cc.BlendFunc,"ALPHA_NON_PREMULTIPLIED",cc.BlendFunc._alphaNonPremultiplied),cc.BlendFunc.ADDITIVE,cc.js.get(cc.BlendFunc,"ADDITIVE",cc.BlendFunc._additive),cc.blendFuncDisable=cc.BlendFunc._disable,cc.FontDefinition=function(t){var e=this;if(e.fontName="Arial",e.fontSize=12,e.textAlign=cc.TextAlignment.CENTER,e.verticalAlign=cc.VerticalTextAlignment.TOP,e.fillStyle=cc.color(255,255,255,255),e.boundingWidth=0,e.boundingHeight=0,e.strokeEnabled=!1,e.strokeStyle=cc.color(255,255,255,255),e.lineWidth=1,e.lineHeight="normal",e.fontStyle="normal",e.fontWeight="normal",e.shadowEnabled=!1,e.shadowOffsetX=0,e.shadowOffsetY=0,e.shadowBlur=0,e.shadowOpacity=1,t&&t instanceof Object)for(var i in t)e[i]=t[i]},cc.FontDefinition.prototype._getCanvasFontStr=function(){var t=!this.lineHeight.charAt?this.lineHeight+"px":this.lineHeight;return this.fontStyle+" "+this.fontWeight+" "+this.fontSize+"px/"+t+" '"+this.fontName+"'"},cc.TextAlignment=cc.Enum({LEFT:0,CENTER:1,RIGHT:2}),cc.VerticalTextAlignment=cc.Enum({TOP:0,CENTER:1,BOTTOM:2}),cc._Dictionary=cc.Class({ctor:function(){this._keyMapTb={},this._valueMapTb={},this.__currId=2<<(0|10*Math.random())},__getKey:function(){return this.__currId++,"key_"+this.__currId},setObject:function(t,e){if(null!=e){var i=this.__getKey();this._keyMapTb[i]=e,this._valueMapTb[i]=t}},objectForKey:function(t){if(null==t)return null;var e=this._keyMapTb;for(var i in e)if(e[i]===t)return this._valueMapTb[i];return null},valueForKey:function(t){return this.objectForKey(t)},removeObjectForKey:function(t){if(null!=t){var e=this._keyMapTb;for(var i in e)if(e[i]===t)return delete this._valueMapTb[i],void delete e[i]}},removeObjectsForKeys:function(t){if(null!=t)for(var e=0;e<t.length;e++)this.removeObjectForKey(t[e])},allKeys:function(){var t=[],e=this._keyMapTb;for(var i in e)t.push(e[i]);return t},removeAllObjects:function(){this._keyMapTb={},this._valueMapTb={}},count:function(){return this.allKeys().length}})},{}],135:[function(t,e,i){cc.WebGLColor=function(t,e,i,n,r,s){this._arrayBuffer=r||new ArrayBuffer(cc.WebGLColor.BYTES_PER_ELEMENT),this._offset=s||0;var o=this._arrayBuffer,a=this._offset,c=Uint8Array.BYTES_PER_ELEMENT;if(this._rU8=new Uint8Array(o,a,1),this._gU8=new Uint8Array(o,a+c,1),this._bU8=new Uint8Array(o,a+2*c,1),this._aU8=new Uint8Array(o,a+3*c,1),this._rU8[0]=t||0,this._gU8[0]=e||0,this._bU8[0]=i||0,this._aU8[0]=null==n?255:n,void 0===n)this.a_undefined=!0},cc.WebGLColor.BYTES_PER_ELEMENT=4;var n=cc.WebGLColor.prototype;n._getR=function(){return this._rU8[0]},n._setR=function(t){this._rU8[0]=0>t?0:t},n._getG=function(){return this._gU8[0]},n._setG=function(t){this._gU8[0]=0>t?0:t},n._getB=function(){return this._bU8[0]},n._setB=function(t){this._bU8[0]=0>t?0:t},n._getA=function(){return this._aU8[0]},n._setA=function(t){this._aU8[0]=0>t?0:t},n.r,cc.js.getset(n,"r",n._getR,n._setR),n.g,cc.js.getset(n,"g",n._getG,n._setG),n.b,cc.js.getset(n,"b",n._getB,n._setB),n.a,cc.js.getset(n,"a",n._getA,n._setA),cc.Vertex2F=function(t,e,i,n){this._arrayBuffer=i||new ArrayBuffer(cc.Vertex2F.BYTES_PER_ELEMENT),this._offset=n||0,this._xF32=new Float32Array(this._arrayBuffer,this._offset,1),this._yF32=new Float32Array(this._arrayBuffer,this._offset+4,1),this._xF32[0]=t||0,this._yF32[0]=e||0},cc.Vertex2F.BYTES_PER_ELEMENT=8,n=cc.Vertex2F.prototype,n._getX=function(){return this._xF32[0]},n._setX=function(t){this._xF32[0]=t},n._getY=function(){return this._yF32[0]},n._setY=function(t){this._yF32[0]=t},n.x,cc.js.getset(n,"x",n._getX,n._setX),n.y,cc.js.getset(n,"y",n._getY,n._setY),cc.Vertex3F=function(t,e,i,n,r){this._arrayBuffer=n||new ArrayBuffer(cc.Vertex3F.BYTES_PER_ELEMENT),this._offset=r||0;var s=this._arrayBuffer,o=this._offset;this._xF32=new Float32Array(s,o,1),this._xF32[0]=t||0,this._yF32=new Float32Array(s,o+Float32Array.BYTES_PER_ELEMENT,1),this._yF32[0]=e||0,this._zF32=new Float32Array(s,o+2*Float32Array.BYTES_PER_ELEMENT,1),this._zF32[0]=i||0},cc.Vertex3F.BYTES_PER_ELEMENT=12,n=cc.Vertex3F.prototype,n._getX=function(){return this._xF32[0]},n._setX=function(t){this._xF32[0]=t},n._getY=function(){return this._yF32[0]},n._setY=function(t){this._yF32[0]=t},n._getZ=function(){return this._zF32[0]},n._setZ=function(t){this._zF32[0]=t},n.x,cc.js.getset(n,"x",n._getX,n._setX),n.y,cc.js.getset(n,"y",n._getY,n._setY),n.z,cc.js.getset(n,"z",n._getZ,n._setZ),cc.Tex2F=function(t,e,i,n){this._arrayBuffer=i||new ArrayBuffer(cc.Tex2F.BYTES_PER_ELEMENT),this._offset=n||0,this._uF32=new Float32Array(this._arrayBuffer,this._offset,1),this._vF32=new Float32Array(this._arrayBuffer,this._offset+4,1),this._uF32[0]=t||0,this._vF32[0]=e||0},cc.Tex2F.BYTES_PER_ELEMENT=8,n=cc.Tex2F.prototype,n._getU=function(){return this._uF32[0]},n._setU=function(t){this._uF32[0]=t},n._getV=function(){return this._vF32[0]},n._setV=function(t){this._vF32[0]=t},n.u,cc.js.getset(n,"u",n._getU,n._setU),n.v,cc.js.getset(n,"v",n._getV,n._setV),cc.Quad2=function(t,e,i,n,r,s){this._arrayBuffer=r||new ArrayBuffer(cc.Quad2.BYTES_PER_ELEMENT),this._offset=s||0;var o=this._arrayBuffer,a=cc.Vertex2F.BYTES_PER_ELEMENT;this._tl=t?new cc.Vertex2F(t.x,t.y,o,0):new cc.Vertex2F(0,0,o,0),this._tr=e?new cc.Vertex2F(e.x,e.y,o,a):new cc.Vertex2F(0,0,o,a),this._bl=i?new cc.Vertex2F(i.x,i.y,o,2*a):new cc.Vertex2F(0,0,o,2*a),this._br=n?new cc.Vertex2F(n.x,n.y,o,3*a):new cc.Vertex2F(0,0,o,3*a)},cc.Quad2.BYTES_PER_ELEMENT=32,n=cc.Quad2.prototype,n._getTL=function(){return this._tl},n._setTL=function(t){this._tl.x=t.x,this._tl.y=t.y},n._getTR=function(){return this._tr},n._setTR=function(t){this._tr.x=t.x,this._tr.y=t.y},n._getBL=function(){return this._bl},n._setBL=function(t){this._bl.x=t.x,this._bl.y=t.y},n._getBR=function(){return this._br},n._setBR=function(t){this._br.x=t.x,this._br.y=t.y},n.tl,cc.js.getset(n,"tl",n._getTL,n._setTL),n.tr,cc.js.getset(n,"tr",n._getTR,n._setTR),n.bl,cc.js.getset(n,"bl",n._getBL,n._setBL),n.br,cc.js.getset(n,"br",n._getBR,n._setBR),cc.Quad3=function(t,e,i,n){this.bl=t||new cc.Vertex3F(0,0,0),this.br=e||new cc.Vertex3F(0,0,0),this.tl=i||new cc.Vertex3F(0,0,0),this.tr=n||new cc.Vertex3F(0,0,0)},cc.V3F_C4B_T2F=function(t,e,i,n,r){this._arrayBuffer=n||new ArrayBuffer(cc.V3F_C4B_T2F.BYTES_PER_ELEMENT),this._offset=r||0;var s=this._arrayBuffer,o=this._offset,a=cc.Vertex3F.BYTES_PER_ELEMENT;this._vertices=t?new cc.Vertex3F(t.x,t.y,t.z,s,o):new cc.Vertex3F(0,0,0,s,o),this._colors=e?new cc.WebGLColor(e.r,e.g,e.b,e.a,s,o+a):new cc.WebGLColor(0,0,0,0,s,o+a),this._texCoords=i?new cc.Tex2F(i.u,i.v,s,o+a+cc.WebGLColor.BYTES_PER_ELEMENT):new cc.Tex2F(0,0,s,o+a+cc.WebGLColor.BYTES_PER_ELEMENT)},cc.V3F_C4B_T2F.BYTES_PER_ELEMENT=24,n=cc.V3F_C4B_T2F.prototype,n._getVertices=function(){return this._vertices},n._setVertices=function(t){var e=this._vertices;e.x=t.x,e.y=t.y,e.z=t.z},n._getColor=function(){return this._colors},n._setColor=function(t){var e=this._colors;e.r=t.r,e.g=t.g,e.b=t.b,e.a=t.a},n._getTexCoords=function(){return this._texCoords},n._setTexCoords=function(t){this._texCoords.u=t.u,this._texCoords.v=t.v},n.vertices,cc.js.getset(n,"vertices",n._getVertices,n._setVertices),n.colors,cc.js.getset(n,"colors",n._getColor,n._setColor),n.texCoords,cc.js.getset(n,"texCoords",n._getTexCoords,n._setTexCoords),cc.V3F_C4B_T2F_Quad=function(t,e,i,n,r,s){this._arrayBuffer=r||new ArrayBuffer(cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT),this._offset=s||0;var o=this._arrayBuffer,a=this._offset,c=cc.V3F_C4B_T2F.BYTES_PER_ELEMENT;this._tl=t?new cc.V3F_C4B_T2F(t.vertices,t.colors,t.texCoords,o,a):new cc.V3F_C4B_T2F(null,null,null,o,a),this._bl=e?new cc.V3F_C4B_T2F(e.vertices,e.colors,e.texCoords,o,a+c):new cc.V3F_C4B_T2F(null,null,null,o,a+c),this._tr=i?new cc.V3F_C4B_T2F(i.vertices,i.colors,i.texCoords,o,a+2*c):new cc.V3F_C4B_T2F(null,null,null,o,a+2*c),this._br=n?new cc.V3F_C4B_T2F(n.vertices,n.colors,n.texCoords,o,a+3*c):new cc.V3F_C4B_T2F(null,null,null,o,a+3*c)},cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT=96,n=cc.V3F_C4B_T2F_Quad.prototype,n._getTL=function(){return this._tl},n._setTL=function(t){var e=this._tl;e.vertices=t.vertices,e.colors=t.colors,e.texCoords=t.texCoords},n._getBL=function(){return this._bl},n._setBL=function(t){var e=this._bl;e.vertices=t.vertices,e.colors=t.colors,e.texCoords=t.texCoords},n._getTR=function(){return this._tr},n._setTR=function(t){var e=this._tr;e.vertices=t.vertices,e.colors=t.colors,e.texCoords=t.texCoords},n._getBR=function(){return this._br},n._setBR=function(t){var e=this._br;e.vertices=t.vertices,e.colors=t.colors,e.texCoords=t.texCoords},n._getArrayBuffer=function(){return this._arrayBuffer},n.tl,cc.js.getset(n,"tl",n._getTL,n._setTL),n.tr,cc.js.getset(n,"tr",n._getTR,n._setTR),n.bl,cc.js.getset(n,"bl",n._getBL,n._setBL),n.br,cc.js.getset(n,"br",n._getBR,n._setBR),n.arrayBuffer,cc.js.get(n,"arrayBuffer",n._getArrayBuffer),cc.V3F_C4B_T2F_QuadZero=function(){return new cc.V3F_C4B_T2F_Quad},cc.V3F_C4B_T2F_QuadCopy=function(t){if(!t)return cc.V3F_C4B_T2F_QuadZero();var e=t.tl,i=t.bl,n=t.tr,r=t.br;return{tl:{vertices:{x:e.vertices.x,y:e.vertices.y,z:e.vertices.z},colors:{r:e.colors.r,g:e.colors.g,b:e.colors.b,a:e.colors.a},texCoords:{u:e.texCoords.u,v:e.texCoords.v}},bl:{vertices:{x:i.vertices.x,
y:i.vertices.y,z:i.vertices.z},colors:{r:i.colors.r,g:i.colors.g,b:i.colors.b,a:i.colors.a},texCoords:{u:i.texCoords.u,v:i.texCoords.v}},tr:{vertices:{x:n.vertices.x,y:n.vertices.y,z:n.vertices.z},colors:{r:n.colors.r,g:n.colors.g,b:n.colors.b,a:n.colors.a},texCoords:{u:n.texCoords.u,v:n.texCoords.v}},br:{vertices:{x:r.vertices.x,y:r.vertices.y,z:r.vertices.z},colors:{r:r.colors.r,g:r.colors.g,b:r.colors.b,a:r.colors.a},texCoords:{u:r.texCoords.u,v:r.texCoords.v}}}},cc.V3F_C4B_T2F_QuadsCopy=function(t){if(!t)return[];for(var e=[],i=0;i<t.length;i++)e.push(cc.V3F_C4B_T2F_QuadCopy(t[i]));return e},cc.V2F_C4B_T2F=function(t,e,i,n,r){this._arrayBuffer=n||new ArrayBuffer(cc.V2F_C4B_T2F.BYTES_PER_ELEMENT),this._offset=r||0;var s=this._arrayBuffer,o=this._offset,a=cc.Vertex2F.BYTES_PER_ELEMENT;this._vertices=t?new cc.Vertex2F(t.x,t.y,s,o):new cc.Vertex2F(0,0,s,o),this._colors=e?new cc.WebGLColor(e.r,e.g,e.b,e.a,s,o+a):new cc.WebGLColor(0,0,0,0,s,o+a),this._texCoords=i?new cc.Tex2F(i.u,i.v,s,o+a+cc.WebGLColor.BYTES_PER_ELEMENT):new cc.Tex2F(0,0,s,o+a+cc.WebGLColor.BYTES_PER_ELEMENT)},cc.V2F_C4B_T2F.BYTES_PER_ELEMENT=20,n=cc.V2F_C4B_T2F.prototype,n._getVertices=function(){return this._vertices},n._setVertices=function(t){this._vertices.x=t.x,this._vertices.y=t.y},n._getColor=function(){return this._colors},n._setColor=function(t){var e=this._colors;e.r=t.r,e.g=t.g,e.b=t.b,e.a=t.a},n._getTexCoords=function(){return this._texCoords},n._setTexCoords=function(t){this._texCoords.u=t.u,this._texCoords.v=t.v},n.vertices,cc.js.getset(n,"vertices",n._getVertices,n._setVertices),n.colors,cc.js.getset(n,"colors",n._getColor,n._setColor),n.texCoords,cc.js.getset(n,"texCoords",n._getTexCoords,n._setTexCoords),cc.V2F_C4B_T2F_Triangle=function(t,e,i,n,r){this._arrayBuffer=n||new ArrayBuffer(cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT),this._offset=r||0;var s=this._arrayBuffer,o=this._offset,a=cc.V2F_C4B_T2F.BYTES_PER_ELEMENT;this._a=t?new cc.V2F_C4B_T2F(t.vertices,t.colors,t.texCoords,s,o):new cc.V2F_C4B_T2F(null,null,null,s,o),this._b=e?new cc.V2F_C4B_T2F(e.vertices,e.colors,e.texCoords,s,o+a):new cc.V2F_C4B_T2F(null,null,null,s,o+a),this._c=i?new cc.V2F_C4B_T2F(i.vertices,i.colors,i.texCoords,s,o+2*a):new cc.V2F_C4B_T2F(null,null,null,s,o+2*a)},cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT=60,n=cc.V2F_C4B_T2F_Triangle.prototype,n._getA=function(){return this._a},n._setA=function(t){var e=this._a;e.vertices=t.vertices,e.colors=t.colors,e.texCoords=t.texCoords},n._getB=function(){return this._b},n._setB=function(t){var e=this._b;e.vertices=t.vertices,e.colors=t.colors,e.texCoords=t.texCoords},n._getC=function(){return this._c},n._setC=function(t){var e=this._c;e.vertices=t.vertices,e.colors=t.colors,e.texCoords=t.texCoords},n.a,cc.js.getset(n,"a",n._getA,n._setA),n.b,cc.js.getset(n,"b",n._getB,n._setB),n.c,cc.js.getset(n,"c",n._getC,n._setC)},{}],136:[function(t,e,i){function n(){}var r=t("../platform/js");r.setClassName("cc.ValueType",n),r.mixin(n.prototype,{clone:!1,equals:!1,toString:function(){return""+{}},lerp:!1}),cc.ValueType=n,e.exports=n},{"../platform/js":105}],137:[function(t,e,i){function n(t,e){if(t&&"object"==typeof t)e=t.y,t=t.x;this.x="number"==typeof t?t:0,this.y="number"==typeof e?e:0}var r=t("./CCValueType"),s=t("../platform/js"),o=t("../platform/CCClass");s.extend(n,r),o.fastDefine("cc.Vec2",n,["x","y"]),s.mixin(n.prototype,{clone:function(){return new n(this.x,this.y)},set:function(t){return this.x=t.x,this.y=t.y,this},equals:function(t){return t&&this.x===t.x&&this.y===t.y},toString:function(){return"("+this.x.toFixed(2)+", "+this.y.toFixed(2)+")"},lerp:function(t,e,i){i=i||new n;var r=this.x,s=this.y;return i.x=r+(t.x-r)*e,i.y=s+(t.y-s)*e,i},addSelf:function(t){return this.x+=t.x,this.y+=t.y,this},add:function(t,e){return e=e||new n,e.x=this.x+t.x,e.y=this.y+t.y,e},subSelf:function(t){return this.x-=t.x,this.y-=t.y,this},sub:function(t,e){return e=e||new n,e.x=this.x-t.x,e.y=this.y-t.y,e},mulSelf:function(t){return this.x*=t,this.y*=t,this},mul:function(t,e){return e=e||new n,e.x=this.x*t,e.y=this.y*t,e},scaleSelf:function(t){return this.x*=t.x,this.y*=t.y,this},scale:function(t,e){return e=e||new n,e.x=this.x*t.x,e.y=this.y*t.y,e},divSelf:function(t){return this.x/=t,this.y/=t,this},div:function(t,e){return e=e||new n,e.x=this.x/t,e.y=this.y/t,e},negSelf:function(){return this.x=-this.x,this.y=-this.y,this},neg:function(t){return t=t||new n,t.x=-this.x,t.y=-this.y,t},dot:function(t){return this.x*t.x+this.y*t.y},cross:function(t){return this.y*t.x-this.x*t.y},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},magSqr:function(){return this.x*this.x+this.y*this.y},normalizeSelf:function(){var t=this.x*this.x+this.y*this.y;if(1===t)return this;if(0===t)return console.warn("Can't normalize zero vector"),this;var e=1/Math.sqrt(t);return this.x*=e,this.y*=e,this},normalize:function(t){return t=t||new n,t.x=this.x,t.y=this.y,t.normalizeSelf(),t},angle:function(t){var e=this.magSqr(),i=t.magSqr();if(0===e||0===i)return console.warn("Can't get angle between zero vector"),0;var n=this.dot(t),r=n/Math.sqrt(e*i);return r=cc.clampf(r,-1,1),Math.acos(r)},signAngle:function(t){return Math.atan2(this.y,this.x)-Math.atan2(t.y,t.x)},rotate:function(t,e){return e=e||new n,e.x=this.x,e.y=this.y,e.rotateSelf(t)},rotateSelf:function(t){var e=Math.sin(t),i=Math.cos(t),n=this.x;return this.x=i*n-e*this.y,this.y=e*n+i*this.y,this}}),s.get(n,"ONE",function(){return new n(1,1)}),s.get(n,"ZERO",function(){return new n(0,0)}),s.get(n,"UP",function(){return new n(0,1)}),s.get(n,"RIGHT",function(){return new n(1,0)}),cc.Vec2=n,cc.v2=function(t,e){return new n(t,e)},cc.p=cc.v2,cc.pointEqualToPoint=function(t,e){return t&&e&&t.x===e.x&&t.y===e.y},e.exports=cc.Vec2},{"../platform/CCClass":88,"../platform/js":105,"./CCValueType":136}],138:[function(t,e,i){t("./CCValueType"),t("./CCEnum"),t("./CCVec2"),t("./CCPointExtension"),t("./CCSize"),t("./CCRect"),t("./CCColor"),t("./CCTypes"),t("./CCAffineTransform"),t("./CCTypesWebGL")},{"./CCAffineTransform":128,"./CCColor":129,"./CCEnum":130,"./CCPointExtension":131,"./CCRect":132,"./CCSize":133,"./CCTypes":134,"./CCTypesWebGL":135,"./CCValueType":136,"./CCVec2":137}],139:[function(require,module,exports){function deprecateEnum(obj,oldPath,newPath,hasTypePrefixBefore){hasTypePrefixBefore=hasTypePrefixBefore!==!1;for(var enumDef=eval(newPath),entries=cc.Enum.getList(enumDef),delimiter=hasTypePrefixBefore?"_":".",i=0;i<entries.length;i++){var entry=entries[i].name,oldPropName;if(hasTypePrefixBefore){var oldTypeName=oldPath.split(".").slice(-1)[0];oldPropName=oldTypeName+"_"+entry}else oldPropName=entry;js.get(obj,oldPropName,function(t){return cc.warn(INFO,oldPath+delimiter+t,newPath+"."+t),enumDef[t]}.bind(null,entry))}}function markAsRemoved(t,e,i){i=i||js.getClassName(t),e.forEach(function(e){function n(){cc.error("Sorry, %s.%s is removed.",i,e)}js.getset(t.prototype,e,n,n)})}function provideClearError(t,e,i){function n(e,i){function n(t){cc.error(s,e,t)}if(!Array.isArray(i))i=i.split(",").map(function(t){return t.trim()});js.getset(t,e,n.bind(null,i[0]),i[1]&&n.bind(null,i[1]))}var r=i||cc.js.getClassName(t),s="Sorry, "+r+".%s is removed, please use %s instead.";for(var o in e){var a=e[o];if("*"===o[0]){var c=o.slice(1);n("g"+c,a),n("s"+c,a)}else o.split(",").map(function(t){return t.trim()}).forEach(function(t){n(t,a)})}}function shouldNotUseNodeProp(t){var e=t.prototype;for(var i in cc.Node.prototype)!function(t){if(!(t in e)&&"_"!==t[0])Object.defineProperty(e,t,{get:function(){var e=cc.js.getClassName(this),i="Sorry, "+e+".%s is undefined, please use cc.Node.%s instead.";cc.error(i,t,t)},enumerable:!1,configurable:!0})}(i)}if(!1){var js=cc.js,INFO=cc._LogInfos.deprecated;if(js.get(cc,"inject",function(){return cc.warn(INFO+" The first argument should be the destination object","cc.inject","cc.js.addon"),js.addon}),js.get(cc,"extend",function(){return cc.warn(INFO,"cc.extend","cc.js.mixin"),js.mixin}),js.get(cc,"newElement",function(){return cc.warn(INFO,"cc.newElement","document.createElement"),document.createElement}),js.get(cc,"isFunction",function(){return cc.warn(INFO,"cc.isFunction","cc.js.isFunction"),js.isFunction}),js.get(cc,"isNumber",function(){return cc.warn(INFO,"cc.isNumber","cc.js.isNumber"),js.isNumber}),js.get(cc,"isString",function(){return cc.warn(INFO,"cc.isString","cc.js.isString"),js.isString}),js.get(cc,"isArray",function(){return cc.warn(INFO,"cc.isArray","cc.js.isArray"),js.isArray}),js.get(cc,"isUndefined",function(){return cc.warn(INFO,"cc.isUndefined","cc.js.isUndefined"),js.isUndefined}),js.get(cc,"isObject",function(){return cc.warn(INFO,"cc.isObject","cc.js.isObject"),js.isObject}),js.obsoletes(cc,"cc",{Point:"Vec2",EScene:"Scene",ENode:"Node",_ComponentInSG:"_RendererUnderSG"}),js.get(cc,"arrayVerifyType",function(){return cc.warn(INFO,"cc.arrayVerifyType","cc.js.array.verifyType"),cc.js.array.verifyType}),js.get(cc,"arrayRemoveObject",function(){return cc.warn(INFO,"cc.arrayRemoveObject","cc.js.array.remove"),cc.js.array.remove}),js.get(cc,"arrayRemoveArray",function(){return cc.warn(INFO,"cc.arrayRemoveArray","cc.js.array.removeArray"),cc.js.array.removeArray}),js.get(cc,"arrayAppendObjectsToIndex",function(){return cc.warn(INFO,"cc.arrayAppendObjectsToIndex","cc.js.array.appendObjectsAt"),cc.js.array.appendObjectsAt}),js.get(cc,"copyArray",function(){return cc.warn(INFO,"cc.copyArray","cc.js.array.copy"),cc.js.array.copy}),Object.defineProperty(cc._SGComponent.prototype,"visible",{get:function(){return cc.warn('The "visible" property of %s is deprecated, use "enabled" instead please.',cc.js.getClassName(this)),this.enabled},set:function(t){this.visible;this.enabled=t}}),deprecateEnum(cc,"cc.TEXT_ALIGNMENT","cc.TextAlignment"),deprecateEnum(cc,"cc.VERTICAL_TEXT_ALIGNMENT","cc.VerticalTextAlignment"),deprecateEnum(_ccsg.ParticleSystem,"_ccsg.ParticleSystem.TYPE","_ccsg.ParticleSystem.Type"),deprecateEnum(_ccsg.ParticleSystem,"_ccsg.ParticleSystem.MODE","_ccsg.ParticleSystem.Mode"),deprecateEnum(cc.ParticleSystem,"cc.ParticleSystem.TYPE","cc.ParticleSystem.PositionType"),deprecateEnum(cc.ParticleSystem,"cc.ParticleSystem.MODE","cc.ParticleSystem.EmitterMode"),deprecateEnum(cc.game,"cc.game.DEBUG_MODE","cc.DebugMode"),deprecateEnum(cc,"cc","cc.Texture2D.WrapMode",!1),_ccsg.EditBox)deprecateEnum(cc,"cc.KEYBOARD_RETURNTYPE","_ccsg.EditBox.KeyboardReturnType"),deprecateEnum(cc,"cc.EDITBOX_INPUT_MODE","_ccsg.EditBox.InputMode"),deprecateEnum(cc,"cc.EDITBOX_INPUT_FLAG","_ccsg.EditBox.InputFlag");if(markAsRemoved(cc.Pipeline,["loadJsWithImg","loadCsb","getUrl","loadAliases","register"],"cc.loader"),provideClearError(cc.loader,{loadJs:"load",loadTxt:"load",loadJson:"load",loadImg:"load"},"cc.loader"),markAsRemoved(cc.Node,["_componentContainer","_camera","_additionalTransform","_scheduler","_actionManager","actionManager","_isTransitionFinished","_additionalTransformDirty","_shaderProgram","shaderProgram","_normalizedPositionDirty","_normalizedPosition","_usingNormalizedPosition","_renderCmd","_vertexZ","_showNode","_arrayMakeObjectsPerformSelector","getActionManager","setActionManager","getScheduler","setScheduler","reorderChild","draw","transformAncestors","onEnter","onEnterTransitionDidFinish","onExitTransitionDidStart","onExit","getNumberOfRunningActions","scheduleUpdate","scheduleUpdateWithPriority","unscheduleUpdate","schedule","scheduleOnce","unschedule","unscheduleAllCallbacks","resumeSchedulerAndActions","resume","pauseSchedulerAndActions","pause","setAdditionalTransform","updateTransform","retain","release","visit","transform","getCamera","grid","getGrid","setGrid","getShaderProgram","setShaderProgram","getGLServerState","setGLServerState","_initRendererCmd","_createRenderCmd","updateDisplayedOpacity","updateDisplayedColor","userData","userObject","_cascadeColorEnabled","cascadeColor","ignoreAnchor","isIgnoreAnchorPointForPosition","ignoreAnchorPointForPosition"]),provideClearError(cc.Node.prototype,{arrivalOrder:"getSiblingIndex, setSiblingIndex",_visible:"_activeInHierarchy, active",_running:"_activeInHierarchy, active",running:"activeInHierarchy, active",_realOpacity:"_opacity, _opacity",_realColor:"_color, _color",getZOrder:"getLocalZOrder",setZOrder:"setLocalZOrder",getOrderOfArrival:"getSiblingIndex",setOrderOfArrival:"setSiblingIndex",boundingBox:"getBoundingBox",removeFromParentAndCleanup:"removeFromParent",removeAllChildrenWithCleanup:"removeAllChildren",parentToNodeTransform:"getParentToNodeTransform",nodeToWorldTransform:"getNodeToWorlshaderProgramdTransform",worldToNodeTransform:"getWorldToNodeTransform",nodeToParentTransform:"getNodeToParentTransform",removeAllComponents:"removeComponent",getNodeToParentAffineTransform:"getNodeToParentTransform"}),shouldNotUseNodeProp(cc._SGComponent),markAsRemoved(cc.Sprite,["textureLoaded","setBlendFunc","getBlendFunc","setState","getState","resizableSpriteWithCapInsets","flippedX","flippedY","setFlippedX","setFlippedY","isFlippedX","isFlippedY","getCapInsets","setCapInsets"]),provideClearError(cc.Sprite,{create:"node.addComponent",createWithTexture:"node.addComponent",createWithSpriteFrameName:"node.addComponent",createWithSpriteFrame:"node.addComponent"}),provideClearError(cc.Sprite.prototype,{getPreferredSize:"node.getContentSize",setPreferredSize:"node.setContentSize",updateWithSprite:"spriteFrame",getSpriteFrame:"spriteFrame",setSpriteFrame:"spriteFrame"}),markAsRemoved(cc.ParticleSystem,["batchNode","drawMode","getDrawMode","setDrawMode","shapeType","getShapeType","setShapeType","atlasIndex","init","initParticle","updateWithNoTime"]),provideClearError(cc.ParticleSystem,{initWithFile:"instance.file",initWithDictionary:"instance.file",initWithTotalParticles:"instance.totalParticles"}),provideClearError(cc.ParticleSystem.prototype,{destroyParticleSystem:"destroy",clone:"cc.instantiate",isActive:"active","*etParticleCount":"particleCount","*etDuration":"duration","*etSourcePosition":"sourcePos","*etPosVar":"posVar","*etGravity":"gravity","*etSpeed":"speed","*etSpeedVar":"speedVar","*etTangentialAccel":"tangentialAccel","*etTangentialAccelVar":"tangentialAccelVar","*etRadialAccel":"radialAccel","*etRadialAccelVar":"radialAccelVar","*etRotationIsDir":"rotationIsDir","*etStartRadius":"startRadius","*etStartRadiusVar":"startRadiusVar","*etEndRadius":"endRadius","*etEndRadiusVar":"endRadiusVar","*etRotatePerSecond":"rotatePerS","*etRotatePerSecondVar":"rotatePerSVar","*etStartColor":"startColor","*etStartColorVar":"startColorVar","*etEndColor":"endColor","*etEndColorVar":"endColorVar","*etTotalParticles":"totalParticles","*etTexture":"texture"}),js.obsoletes(cc.ParticleSystem,"cc.ParticleSystem",{Type:"PositionType",Mode:"EmitterMode"}),markAsRemoved(_ccsg.Node,["_normalizedPositionDirty","_normalizedPosition","_usingNormalizedPosition","grid","userData","userObject","getNormalizedPosition","setNormalizedPosition","getCamera","getUserData","setUserData","getUserObject","setUserObject","getComponent","addComponent","removeComponent","removeAllComponents","enumerateChildren","setCameraMask","getCameraMask"],"_ccsg.Node"),js.obsoletes(cc.Scale9Sprite.prototype,"cc.Scale9Sprite",{setPreferredSize:"setContentSize",getPreferredSize:"getContentSize"}),cc.js.obsolete(cc.Layout.prototype,"Layout.layoutType","type"),cc.js.obsolete(cc.Layout.prototype,"Layout.ResizeType","ResizeMode"),cc.js.obsolete(cc.Layout.prototype,"Layout.resize","resizeMode"),markAsRemoved(cc.Scale9Sprite,["init","resizableSpriteWithCapInsets","updateWithSprite","getOriginalSize","setCapInsets","getCapInsets","setScale9Enabled","isScale9Enabled","getSprite","setFlippedX","isFlippedX","setFlippedY","isFlippedY"]),"undefined"!=typeof sp)deprecateEnum(sp,"sp.ANIMATION_EVENT_TYPE","sp.AnimationEventType"),js.obsolete(sp,"sp.SkeletonAnimation","Skeleton"),provideClearError(sp.Skeleton,{create:"node.addComponent"}),provideClearError(sp.Skeleton.prototype,{"*etDebugSlotsEnabled":"debugSlots","*etDebugBonesEnabled":"debugBones",setDebugSolots:"debugSlots",setDebugBones:"debugBones","*etTimeScale":"timeScale"})}},{}],140:[function(t,e,i){cc.math.AABB=function(t,e){this.min=t||new cc.math.Vec3,this.max=e||new cc.math.Vec3},cc.math.AABB.prototype.containsPoint=function(t){return t.x>=this.min.x&&t.x<=this.max.x&&t.y>=this.min.y&&t.y<=this.max.y&&t.z>=this.min.z&&t.z<=this.max.z},cc.math.AABB.containsPoint=function(t,e){return t.x>=e.min.x&&t.x<=e.max.x&&t.y>=e.min.y&&t.y<=e.max.y&&t.z>=e.min.z&&t.z<=e.max.z},cc.math.AABB.prototype.assignFrom=function(t){this.min.assignFrom(t.min),this.max.assignFrom(t.max)},cc.math.AABB.assign=function(t,e){return t.min.assignFrom(e.min),t.max.assignFrom(e.max),t}},{}],141:[function(t,e,i){cc.math.Matrix4Stack=function(t,e){this.top=t,this.stack=e||[]};var n=cc.math.Matrix4Stack.prototype;n.initialize=function(){this.stack.length=0,this.top=null},n.push=function(t){t=t||this.top,this.stack.push(this.top),this.top=new cc.math.Matrix4(t)},n.pop=function(){this.top=this.stack.pop()},n.release=function(){this.stack=null,this.top=null,this._matrixPool=null},n._getFromPool=function(t){var e=this._matrixPool;if(0===e.length)return new cc.math.Matrix4(t);var i=e.pop();return i.assignFrom(t),i},n._putInPool=function(t){this._matrixPool.push(t)}},{}],142:[function(t,e,i){var n=cc.math;n.KM_GL_MODELVIEW=5888,n.KM_GL_PROJECTION=5889,n.KM_GL_TEXTURE=5890,n.modelview_matrix_stack=new n.Matrix4Stack,n.projection_matrix_stack=new n.Matrix4Stack,n.texture_matrix_stack=new n.Matrix4Stack,cc.current_stack=null;var r=!1,s=function(){if(!r){var t=new n.Matrix4;n.modelview_matrix_stack.initialize(),n.projection_matrix_stack.initialize(),n.texture_matrix_stack.initialize(),cc.current_stack=n.modelview_matrix_stack,r=!0,t.identity(),n.modelview_matrix_stack.push(t),n.projection_matrix_stack.push(t),n.texture_matrix_stack.push(t)}};s(),n.glFreeAll=function(){n.modelview_matrix_stack.release(),n.modelview_matrix_stack=null,n.projection_matrix_stack.release(),n.projection_matrix_stack=null,n.texture_matrix_stack.release(),n.texture_matrix_stack=null,r=!1,cc.current_stack=null},n.glPushMatrix=function(){cc.current_stack.push(cc.current_stack.top)},n.glPushMatrixWitMat4=function(t){cc.current_stack.stack.push(cc.current_stack.top),t.assignFrom(cc.current_stack.top),cc.current_stack.top=t},n.glPopMatrix=function(){cc.current_stack.top=cc.current_stack.stack.pop()},n.glMatrixMode=function(t){switch(t){case n.KM_GL_MODELVIEW:cc.current_stack=n.modelview_matrix_stack;break;case n.KM_GL_PROJECTION:cc.current_stack=n.projection_matrix_stack;break;case n.KM_GL_TEXTURE:cc.current_stack=n.texture_matrix_stack;break;default:throw new Error("Invalid matrix mode specified")}},n.glLoadIdentity=function(){cc.current_stack.top.identity()},n.glLoadMatrix=function(t){cc.current_stack.top.assignFrom(t)},n.glMultMatrix=function(t){cc.current_stack.top.multiply(t)};var o=new n.Matrix4;n.glTranslatef=function(t,e,i){var r=n.Matrix4.createByTranslation(t,e,i,o);cc.current_stack.top.multiply(r)};var a=new n.Vec3;n.glRotatef=function(t,e,i,r){a.fill(e,i,r);var s=n.Matrix4.createByAxisAndAngle(a,cc.degreesToRadians(t),o);cc.current_stack.top.multiply(s)},n.glScalef=function(t,e,i){var r=n.Matrix4.createByScale(t,e,i,o);cc.current_stack.top.multiply(r)},n.glGetMatrix=function(t,e){switch(t){case n.KM_GL_MODELVIEW:e.assignFrom(n.modelview_matrix_stack.top);break;case n.KM_GL_PROJECTION:e.assignFrom(n.projection_matrix_stack.top);break;case n.KM_GL_TEXTURE:e.assignFrom(n.texture_matrix_stack.top);break;default:throw new Error("Invalid matrix mode specified")}}},{}],143:[function(t,e,i){t("./utility"),t("./vec2"),t("./vec3"),t("./vec4"),t("./ray2"),t("./mat3"),t("./mat4"),t("./plane"),t("./quaternion"),t("./aabb"),t("./gl/mat4stack"),t("./gl/matrix")},{"./aabb":140,"./gl/mat4stack":141,"./gl/matrix":142,"./mat3":144,"./mat4":145,"./plane":146,"./quaternion":147,"./ray2":148,"./utility":149,"./vec2":150,"./vec3":151,"./vec4":152}],144:[function(t,e,i){if(!0)window.Uint16Array=window.Uint16Array||window.Array,window.Float32Array=window.Float32Array||window.Array;cc.math.Matrix3=function(t){if(t&&t.mat)this.mat=new Float32Array(t.mat);else this.mat=new Float32Array(9)};var n=cc.math.Matrix3.prototype;n.fill=function(t){var e=this.mat,i=t.mat;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],this},n.adjugate=function(){var t=this.mat,e=t[0],i=t[1],n=t[2],r=t[3],s=t[4],o=t[5],a=t[6],c=t[7],l=t[8];return t[0]=s*l-o*c,t[1]=n*c-i*l,t[2]=i*o-n*s,t[3]=o*a-r*l,t[4]=e*l-n*a,t[5]=n*r-e*o,t[6]=r*c-s*a,t[8]=e*s-i*r,this},n.identity=function(){var t=this.mat;return t[1]=t[2]=t[3]=t[5]=t[6]=t[7]=0,t[0]=t[4]=t[8]=1,this};var r=new cc.math.Matrix3;n.inverse=function(t){if(0===t)return this;r.assignFrom(this);var e=1/t;return this.adjugate(),this.multiplyScalar(e),this},n.isIdentity=function(){var t=this.mat;return 1===t[0]&&0===t[1]&&0===t[2]&&0===t[3]&&1===t[4]&&0===t[5]&&0===t[6]&&0===t[7]&&1===t[8]},n.transpose=function(){var t=this.mat,e=t[1],i=t[2],n=t[3],r=t[5],s=t[6],o=t[7];return t[1]=n,t[2]=s,t[3]=e,t[5]=o,t[6]=i,t[7]=r,this},n.determinant=function(){var t=this.mat,e=t[0]*t[4]*t[8]+t[1]*t[5]*t[6]+t[2]*t[3]*t[7];return e-=t[2]*t[4]*t[6]+t[0]*t[5]*t[7]+t[1]*t[3]*t[8]},n.multiply=function(t){var e=this.mat,i=t.mat,n=e[0],r=e[1],s=e[2],o=e[3],a=e[4],c=e[5],l=e[6],h=e[7],u=e[8],d=i[0],f=i[1],_=i[2],p=i[3],g=i[4],m=i[5],v=i[6],y=i[7],T=i[8];return e[0]=n*d+o*f+l*_,e[1]=r*d+a*f+h*_,e[2]=s*d+c*f+u*_,e[3]=s*d+c*f+u*_,e[4]=r*p+a*g+h*m,e[5]=s*p+c*g+u*m,e[6]=n*v+o*y+l*T,e[7]=r*v+a*y+h*T,e[8]=s*v+c*y+u*T,this},n.multiplyScalar=function(t){var e=this.mat;return e[0]*=t,e[1]*=t,e[2]*=t,e[3]*=t,e[4]*=t,e[5]*=t,e[6]*=t,e[7]*=t,e[8]*=t,this},cc.math.Matrix3.rotationAxisAngle=function(t,e){var i=Math.cos(e),n=Math.sin(e),r=new cc.math.Matrix3,s=r.mat;return s[0]=i+t.x*t.x*(1-i),s[1]=t.z*n+t.y*t.x*(1-i),s[2]=-t.y*n+t.z*t.x*(1-i),s[3]=-t.z*n+t.x*t.y*(1-i),s[4]=i+t.y*t.y*(1-i),s[5]=t.x*n+t.z*t.y*(1-i),s[6]=t.y*n+t.x*t.z*(1-i),s[7]=-t.x*n+t.y*t.z*(1-i),s[8]=i+t.z*t.z*(1-i),r},n.assignFrom=function(t){if(this===t)return cc.log("cc.math.Matrix3.assign(): current matrix equals matIn"),this;var e=this.mat,i=t.mat;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],this},n.equals=function(t){if(this===t)return!0;for(var e=cc.math.EPSILON,i=this.mat,n=t.mat,r=0;9>r;++r)if(!(i[r]+e>n[r]&&i[r]-e<n[r]))return!1;return!0},cc.math.Matrix3.createByRotationX=function(t){var e=new cc.math.Matrix3,i=e.mat;return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=Math.cos(t),i[5]=Math.sin(t),i[6]=0,i[7]=-Math.sin(t),i[8]=Math.cos(t),e},cc.math.Matrix3.createByRotationY=function(t){var e=new cc.math.Matrix3,i=e.mat;return i[0]=Math.cos(t),i[1]=0,i[2]=-Math.sin(t),i[3]=0,i[4]=1,i[5]=0,i[6]=Math.sin(t),i[7]=0,i[8]=Math.cos(t),e},cc.math.Matrix3.createByRotationZ=function(t){var e=new cc.math.Matrix3,i=e.mat;return i[0]=Math.cos(t),i[1]=-Math.sin(t),i[2]=0,i[3]=Math.sin(t),i[4]=Math.cos(t),i[5]=0,i[6]=0,i[7]=0,i[8]=1,e},cc.math.Matrix3.createByRotation=function(t){var e=new cc.math.Matrix3,i=e.mat;return i[0]=Math.cos(t),i[1]=Math.sin(t),i[2]=0,i[3]=-Math.sin(t),i[4]=Math.cos(t),i[5]=0,i[6]=0,i[7]=0,i[8]=1,e},cc.math.Matrix3.createByScale=function(t,e){var i=new cc.math.Matrix3;return i.identity(),i.mat[0]=t,i.mat[4]=e,i},cc.math.Matrix3.createByTranslation=function(t,e){var i=new cc.math.Matrix3;return i.identity(),i.mat[6]=t,i.mat[7]=e,i},cc.math.Matrix3.createByQuaternion=function(t){if(!t)return null;var e=new cc.math.Matrix3,i=e.mat;return i[0]=1-2*(t.y*t.y+t.z*t.z),i[1]=2*(t.x*t.y-t.w*t.z),i[2]=2*(t.x*t.z+t.w*t.y),i[3]=2*(t.x*t.y+t.w*t.z),i[4]=1-2*(t.x*t.x+t.z*t.z),i[5]=2*(t.y*t.z-t.w*t.x),i[6]=2*(t.x*t.z-t.w*t.y),i[7]=2*(t.y*t.z+t.w*t.x),i[8]=1-2*(t.x*t.x+t.y*t.y),e},n.rotationToAxisAngle=function(){return cc.math.Quaternion.rotationMatrix(this).toAxisAndAngle()}},{}],145:[function(t,e,i){cc.math.Matrix4=function(t){if(t&&t.mat)this.mat=new Float32Array(t.mat);else this.mat=new Float32Array(16)};var n=cc.math.Matrix4.prototype;n.fill=function(t){for(var e=this.mat,i=0;16>i;i++)e[i]=t[i];return this},cc.math.mat4Identity=function(t){var e=t.mat;return e[1]=e[2]=e[3]=e[4]=e[6]=e[7]=e[8]=e[9]=e[11]=e[12]=e[13]=e[14]=0,e[0]=e[5]=e[10]=e[15]=1,t},n.identity=function(){var t=this.mat;return t[1]=t[2]=t[3]=t[4]=t[6]=t[7]=t[8]=t[9]=t[11]=t[12]=t[13]=t[14]=0,t[0]=t[5]=t[10]=t[15]=1,this},n.get=function(t,e){return this.mat[t+4*e]},n.set=function(t,e,i){this.mat[t+4*e]=i},n.swap=function(t,e,i,n){var r=this.mat,s=r[t+4*e];r[t+4*e]=r[i+4*n],r[i+4*n]=s},cc.math.Matrix4._gaussj=function(t,e){var i,n,r,s,o,a,c,l,h,u=0,d=0,f=4,_=4,p=[0,0,0,0],g=[0,0,0,0],m=[0,0,0,0];for(i=0;f>i;i++){for(c=0,n=0;f>n;n++)if(1!==m[n])for(r=0;f>r;r++)if(0===m[r])if(a=Math.abs(t.get(n,r)),a>=c)c=a,d=n,u=r;if(++m[u],d!==u){for(s=0;f>s;s++)t.swap(d,s,u,s);for(s=0;_>s;s++)e.swap(d,s,u,s)}if(g[i]=d,p[i]=u,0===t.get(u,u))return!1;for(h=1/t.get(u,u),t.set(u,u,1),s=0;f>s;s++)t.set(u,s,t.get(u,s)*h);for(s=0;_>s;s++)e.set(u,s,e.get(u,s)*h);for(o=0;f>o;o++)if(o!==u){for(l=t.get(o,u),t.set(o,u,0),s=0;f>s;s++)t.set(o,s,t.get(o,s)-t.get(u,s)*l);for(s=0;_>s;s++)e.set(o,s,t.get(o,s)-e.get(u,s)*l)}}for(s=f-1;s>=0;s--)if(g[s]!==p[s])for(r=0;f>r;r++)t.swap(r,g[s],r,p[s]);return!0};var r=(new cc.math.Matrix4).identity();cc.math.mat4Inverse=function(t,e){var i=new cc.math.Matrix4(e),n=new cc.math.Matrix4(r);if(cc.math.Matrix4._gaussj(i,n)===!1)return null;else return t.assignFrom(i),t},n.inverse=function(){var t=new cc.math.Matrix4(this),e=new cc.math.Matrix4(r);if(cc.math.Matrix4._gaussj(t,e)===!1)return null;else return t},n.isIdentity=function(){var t=this.mat;return 1===t[0]&&0===t[1]&&0===t[2]&&0===t[3]&&0===t[4]&&1===t[5]&&0===t[6]&&0===t[7]&&0===t[8]&&0===t[9]&&1===t[10]&&0===t[11]&&0===t[12]&&0===t[13]&&0===t[14]&&1===t[15]},n.transpose=function(){var t=this.mat,e=t[1],i=t[2],n=t[3],r=t[4],s=t[6],o=t[7],a=t[8],c=t[9],l=t[11],h=t[12],u=t[13],d=t[14];return t[1]=r,t[2]=a,t[3]=h,t[4]=e,t[6]=c,t[7]=u,t[8]=i,t[9]=s,t[11]=d,t[12]=n,t[13]=o,t[14]=l,this},cc.math.mat4Multiply=function(t,e,i){var n=t.mat,r=e.mat,s=i.mat,o=r[0],a=r[1],c=r[2],l=r[3],h=r[4],u=r[5],d=r[6],f=r[7],_=r[8],p=r[9],g=r[10],m=r[11],v=r[12],y=r[13],T=r[14],C=r[15],x=s[0],S=s[1],b=s[2],E=s[3],A=s[4],w=s[5],O=s[6],I=s[7],R=s[8],P=s[9],N=s[10],L=s[11],F=s[12],D=s[13],M=s[14],B=s[15];return n[0]=x*o+S*h+b*_+E*v,n[1]=x*a+S*u+b*p+E*y,n[2]=x*c+S*d+b*g+E*T,n[3]=x*l+S*f+b*m+E*C,n[4]=A*o+w*h+O*_+I*v,n[5]=A*a+w*u+O*p+I*y,n[6]=A*c+w*d+O*g+I*T,n[7]=A*l+w*f+O*m+I*C,n[8]=R*o+P*h+N*_+L*v,n[9]=R*a+P*u+N*p+L*y,n[10]=R*c+P*d+N*g+L*T,n[11]=R*l+P*f+N*m+L*C,n[12]=F*o+D*h+M*_+B*v,n[13]=F*a+D*u+M*p+B*y,n[14]=F*c+D*d+M*g+B*T,n[15]=F*l+D*f+M*m+B*C,t},n.multiply=function(t){var e=this.mat,i=t.mat,n=e[0],r=e[1],s=e[2],o=e[3],a=e[4],c=e[5],l=e[6],h=e[7],u=e[8],d=e[9],f=e[10],_=e[11],p=e[12],g=e[13],m=e[14],v=e[15],y=i[0],T=i[1],C=i[2],x=i[3],S=i[4],b=i[5],E=i[6],A=i[7],w=i[8],O=i[9],I=i[10],R=i[11],P=i[12],N=i[13],L=i[14],F=i[15];return e[0]=y*n+T*a+C*u+x*p,e[1]=y*r+T*c+C*d+x*g,e[2]=y*s+T*l+C*f+x*m,e[3]=y*o+T*h+C*_+x*v,e[4]=S*n+b*a+E*u+A*p,e[5]=S*r+b*c+E*d+A*g,e[6]=S*s+b*l+E*f+A*m,e[7]=S*o+b*h+E*_+A*v,e[8]=w*n+O*a+I*u+R*p,e[9]=w*r+O*c+I*d+R*g,e[10]=w*s+O*l+I*f+R*m,e[11]=w*o+O*h+I*_+R*v,e[12]=P*n+N*a+L*u+F*p,e[13]=P*r+N*c+L*d+F*g,e[14]=P*s+N*l+L*f+F*m,e[15]=P*o+N*h+L*_+F*v,this},cc.math.getMat4MultiplyValue=function(t,e){var i=t.mat,n=e.mat,r=new Float32Array(16);return r[0]=i[0]*n[0]+i[4]*n[1]+i[8]*n[2]+i[12]*n[3],r[1]=i[1]*n[0]+i[5]*n[1]+i[9]*n[2]+i[13]*n[3],r[2]=i[2]*n[0]+i[6]*n[1]+i[10]*n[2]+i[14]*n[3],r[3]=i[3]*n[0]+i[7]*n[1]+i[11]*n[2]+i[15]*n[3],r[4]=i[0]*n[4]+i[4]*n[5]+i[8]*n[6]+i[12]*n[7],r[5]=i[1]*n[4]+i[5]*n[5]+i[9]*n[6]+i[13]*n[7],r[6]=i[2]*n[4]+i[6]*n[5]+i[10]*n[6]+i[14]*n[7],r[7]=i[3]*n[4]+i[7]*n[5]+i[11]*n[6]+i[15]*n[7],r[8]=i[0]*n[8]+i[4]*n[9]+i[8]*n[10]+i[12]*n[11],r[9]=i[1]*n[8]+i[5]*n[9]+i[9]*n[10]+i[13]*n[11],r[10]=i[2]*n[8]+i[6]*n[9]+i[10]*n[10]+i[14]*n[11],r[11]=i[3]*n[8]+i[7]*n[9]+i[11]*n[10]+i[15]*n[11],r[12]=i[0]*n[12]+i[4]*n[13]+i[8]*n[14]+i[12]*n[15],r[13]=i[1]*n[12]+i[5]*n[13]+i[9]*n[14]+i[13]*n[15],r[14]=i[2]*n[12]+i[6]*n[13]+i[10]*n[14]+i[14]*n[15],r[15]=i[3]*n[12]+i[7]*n[13]+i[11]*n[14]+i[15]*n[15],r},cc.math.mat4Assign=function(t,e){if(t===e)return cc.log("cc.math.mat4Assign(): pOut equals pIn"),t;var i=t.mat,n=e.mat;return i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[4]=n[4],i[5]=n[5],i[6]=n[6],i[7]=n[7],i[8]=n[8],i[9]=n[9],i[10]=n[10],i[11]=n[11],i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15],t},n.assignFrom=function(t){if(this===t)return cc.log("cc.mat.Matrix4.assignFrom(): mat4 equals current matrix"),this;var e=this.mat,i=t.mat;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],this},n.equals=function(t){if(this===t)return cc.log("cc.math.Matrix4 equal: pMat1 and pMat2 are same object."),!0;for(var e=this.mat,i=t.mat,n=cc.math.EPSILON,r=0;16>r;r++)if(!(e[r]+n>i[r]&&e[r]-n<i[r]))return!1;return!0},cc.math.Matrix4.createByRotationX=function(t,e){e=e||new cc.math.Matrix4;var i=e.mat;return i[0]=1,i[3]=i[2]=i[1]=0,i[4]=0,i[5]=Math.cos(t),i[6]=Math.sin(t),i[7]=0,i[8]=0,i[9]=-Math.sin(t),i[10]=Math.cos(t),i[11]=0,i[14]=i[13]=i[12]=0,i[15]=1,e},cc.math.Matrix4.createByRotationY=function(t,e){e=e||new cc.math.Matrix4;var i=e.mat;return i[0]=Math.cos(t),i[1]=0,i[2]=-Math.sin(t),i[3]=0,i[7]=i[6]=i[4]=0,i[5]=1,i[8]=Math.sin(t),i[9]=0,i[10]=Math.cos(t),i[11]=0,i[14]=i[13]=i[12]=0,i[15]=1,e},cc.math.Matrix4.createByRotationZ=function(t,e){e=e||new cc.math.Matrix4;var i=e.mat;return i[0]=Math.cos(t),i[1]=Math.sin(t),i[3]=i[2]=0,i[4]=-Math.sin(t),i[5]=Math.cos(t),i[7]=i[6]=0,i[11]=i[9]=i[8]=0,i[10]=1,i[14]=i[13]=i[12]=0,i[15]=1,e},cc.math.Matrix4.createByPitchYawRoll=function(t,e,i,n){n=n||new cc.math.Matrix4;var r=Math.cos(t),s=Math.sin(t),o=Math.cos(e),a=Math.sin(e),c=Math.cos(i),l=Math.sin(i),h=s*a,u=r*a,d=n.mat;return d[0]=o*c,d[4]=o*l,d[8]=-a,d[1]=h*c-r*l,d[5]=h*l+r*c,d[9]=s*o,d[2]=u*c+s*l,d[6]=u*l-s*c,d[10]=r*o,d[3]=d[7]=d[11]=0,d[15]=1,n},cc.math.Matrix4.createByQuaternion=function(t,e){e=e||new cc.math.Matrix4;var i=e.mat;return i[0]=1-2*(t.y*t.y+t.z*t.z),i[1]=2*(t.x*t.y+t.z*t.w),i[2]=2*(t.x*t.z-t.y*t.w),i[3]=0,i[4]=2*(t.x*t.y-t.z*t.w),i[5]=1-2*(t.x*t.x+t.z*t.z),i[6]=2*(t.z*t.y+t.x*t.w),i[7]=0,i[8]=2*(t.x*t.z+t.y*t.w),i[9]=2*(t.y*t.z-t.x*t.w),i[10]=1-2*(t.x*t.x+t.y*t.y),i[11]=0,i[14]=i[13]=i[12]=0,i[15]=1,e},cc.math.Matrix4.createByRotationTranslation=function(t,e,i){i=i||new cc.math.Matrix4;var n=i.mat,r=t.mat;return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=0,n[4]=r[3],n[5]=r[4],n[6]=r[5],n[7]=0,n[8]=r[6],n[9]=r[7],n[10]=r[8],n[11]=0,n[12]=e.x,n[13]=e.y,n[14]=e.z,n[15]=1,i},cc.math.Matrix4.createByScale=function(t,e,i,n){n=n||new cc.math.Matrix4;var r=n.mat;return r[0]=t,r[5]=e,r[10]=i,r[15]=1,r[1]=r[2]=r[3]=r[4]=r[6]=r[7]=r[8]=r[9]=r[11]=r[12]=r[13]=r[14]=0,n},cc.math.mat4Translation=function(t,e,i,n){return t.mat[0]=t.mat[5]=t.mat[10]=t.mat[15]=1,t.mat[1]=t.mat[2]=t.mat[3]=t.mat[4]=t.mat[6]=t.mat[7]=t.mat[8]=t.mat[9]=t.mat[11]=0,t.mat[12]=e,t.mat[13]=i,t.mat[14]=n,t},cc.math.Matrix4.createByTranslation=function(t,e,i,n){return n=n||new cc.math.Matrix4,n.identity(),n.mat[12]=t,n.mat[13]=e,n.mat[14]=i,n},n.getUpVec3=function(){var t=this.mat,e=new cc.math.Vec3(t[4],t[5],t[6]);return e.normalize()},n.getRightVec3=function(){var t=this.mat,e=new cc.math.Vec3(t[0],t[1],t[2]);return e.normalize()},n.getForwardVec3=function(){var t=this.mat,e=new cc.math.Vec3(t[8],t[9],t[10]);return e.normalize()},cc.math.mat4PerspectiveProjection=function(t,e,i,n,r){var s=cc.degreesToRadians(e/2),o=r-n,a=Math.sin(s);if(0===o||0===a||0===i)return null;var c=Math.cos(s)/a;return t.identity(),t.mat[0]=c/i,t.mat[5]=c,t.mat[10]=-(r+n)/o,t.mat[11]=-1,t.mat[14]=-2*n*r/o,t.mat[15]=0,t},cc.math.Matrix4.createPerspectiveProjection=function(t,e,i,n){var r=cc.degreesToRadians(t/2),s=n-i,o=Math.sin(r);if(0===s||0===o||0===e)return null;
var a=Math.cos(r)/o,c=new cc.math.Matrix4,l=c.mat;return c.identity(),l[0]=a/e,l[5]=a,l[10]=-(n+i)/s,l[11]=-1,l[14]=-2*i*n/s,l[15]=0,c},cc.math.mat4OrthographicProjection=function(t,e,i,n,r,s,o){return t.identity(),t.mat[0]=2/(i-e),t.mat[5]=2/(r-n),t.mat[10]=-2/(o-s),t.mat[12]=-((i+e)/(i-e)),t.mat[13]=-((r+n)/(r-n)),t.mat[14]=-((o+s)/(o-s)),t},cc.math.Matrix4.createOrthographicProjection=function(t,e,i,n,r,s){var o=new cc.math.Matrix4,a=o.mat;return o.identity(),a[0]=2/(e-t),a[5]=2/(n-i),a[10]=-2/(s-r),a[12]=-((e+t)/(e-t)),a[13]=-((n+i)/(n-i)),a[14]=-((s+r)/(s-r)),o},cc.math.mat4LookAt=function(t,e,i,n){var r=new cc.math.Vec3(i),s=new cc.math.Vec3(n);r.subtract(e),r.normalize(),s.normalize();var o=new cc.math.Vec3(r);o.cross(s),o.normalize();var a=new cc.math.Vec3(o);a.cross(r),o.normalize(),t.identity(),t.mat[0]=o.x,t.mat[4]=o.y,t.mat[8]=o.z,t.mat[1]=a.x,t.mat[5]=a.y,t.mat[9]=a.z,t.mat[2]=-r.x,t.mat[6]=-r.y,t.mat[10]=-r.z;var c=cc.math.Matrix4.createByTranslation(-e.x,-e.y,-e.z);return t.multiply(c),t};var s=new cc.math.Matrix4;n.lookAt=function(t,e,i){var n=new cc.math.Vec3(e),r=new cc.math.Vec3(i),o=this.mat;n.subtract(t),n.normalize(),r.normalize();var a=new cc.math.Vec3(n);a.cross(r),a.normalize();var c=new cc.math.Vec3(a);return c.cross(n),a.normalize(),this.identity(),o[0]=a.x,o[4]=a.y,o[8]=a.z,o[1]=c.x,o[5]=c.y,o[9]=c.z,o[2]=-n.x,o[6]=-n.y,o[10]=-n.z,s=cc.math.Matrix4.createByTranslation(-t.x,-t.y,-t.z,s),this.multiply(s),this},cc.math.mat4RotationAxisAngle=function(t,e,i){var n=Math.cos(i),r=Math.sin(i),s=new cc.math.Vec3(e);return s.normalize(),t.mat[0]=n+s.x*s.x*(1-n),t.mat[1]=s.z*r+s.y*s.x*(1-n),t.mat[2]=-s.y*r+s.z*s.x*(1-n),t.mat[3]=0,t.mat[4]=-s.z*r+s.x*s.y*(1-n),t.mat[5]=n+s.y*s.y*(1-n),t.mat[6]=s.x*r+s.z*s.y*(1-n),t.mat[7]=0,t.mat[8]=s.y*r+s.x*s.z*(1-n),t.mat[9]=-s.x*r+s.y*s.z*(1-n),t.mat[10]=n+s.z*s.z*(1-n),t.mat[11]=0,t.mat[12]=0,t.mat[13]=0,t.mat[14]=0,t.mat[15]=1,t},cc.math.Matrix4.createByAxisAndAngle=function(t,e,i){i=i||new cc.math.Matrix4;var n=this.mat,r=Math.cos(e),s=Math.sin(e),o=new cc.math.Vec3(t);return o.normalize(),n[0]=r+o.x*o.x*(1-r),n[1]=o.z*s+o.y*o.x*(1-r),n[2]=-o.y*s+o.z*o.x*(1-r),n[3]=0,n[4]=-o.z*s+o.x*o.y*(1-r),n[5]=r+o.y*o.y*(1-r),n[6]=o.x*s+o.z*o.y*(1-r),n[7]=0,n[8]=o.y*s+o.x*o.z*(1-r),n[9]=-o.x*s+o.y*o.z*(1-r),n[10]=r+o.z*o.z*(1-r),n[11]=0,n[12]=n[13]=n[14]=0,n[15]=1,i},n.extractRotation=function(){var t=new cc.math.Matrix3,e=this.mat,i=t.mat;return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[4],i[4]=e[5],i[5]=e[6],i[6]=e[8],i[7]=e[9],i[8]=e[10],t},n.extractPlane=function(t){var e=new cc.math.Plane,i=this.mat;switch(t){case cc.math.Plane.RIGHT:e.a=i[3]-i[0],e.b=i[7]-i[4],e.c=i[11]-i[8],e.d=i[15]-i[12];break;case cc.math.Plane.LEFT:e.a=i[3]+i[0],e.b=i[7]+i[4],e.c=i[11]+i[8],e.d=i[15]+i[12];break;case cc.math.Plane.BOTTOM:e.a=i[3]+i[1],e.b=i[7]+i[5],e.c=i[11]+i[9],e.d=i[15]+i[13];break;case cc.math.Plane.TOP:e.a=i[3]-i[1],e.b=i[7]-i[5],e.c=i[11]-i[9],e.d=i[15]-i[13];break;case cc.math.Plane.FAR:e.a=i[3]-i[2],e.b=i[7]-i[6],e.c=i[11]-i[10],e.d=i[15]-i[14];break;case cc.math.Plane.NEAR:e.a=i[3]+i[2],e.b=i[7]+i[6],e.c=i[11]+i[10],e.d=i[15]+i[14];break;default:cc.log("cc.math.Matrix4.extractPlane: Invalid plane index")}var n=Math.sqrt(e.a*e.a+e.b*e.b+e.c*e.c);return e.a/=n,e.b/=n,e.c/=n,e.d/=n,e},n.toAxisAndAngle=function(){var t=this.extractRotation(),e=cc.math.Quaternion.rotationMatrix(t);return e.toAxisAndAngle()}},{}],146:[function(t,e,i){cc.math.Plane=function(t,e,i,n){if(t&&void 0===e)this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d;else this.a=t||0,this.b=e||0,this.c=i||0,this.d=n||0};var n=cc.math.Plane.prototype;cc.math.Plane.LEFT=0,cc.math.Plane.RIGHT=1,cc.math.Plane.BOTTOM=2,cc.math.Plane.TOP=3,cc.math.Plane.NEAR=4,cc.math.Plane.FAR=5,cc.math.Plane.POINT_INFRONT_OF_PLANE=0,cc.math.Plane.POINT_BEHIND_PLANE=1,cc.math.Plane.POINT_ON_PLANE=2,n.dot=function(t){return this.a*t.x+this.b*t.y+this.c*t.z+this.d*t.w},n.dotCoord=function(t){return this.a*t.x+this.b*t.y+this.c*t.z+this.d},n.dotNormal=function(t){return this.a*t.x+this.b*t.y+this.c*t.z},cc.math.Plane.fromPointNormal=function(t,e){return new cc.math.Plane(e.x,e.y,e.z,-e.dot(t))},cc.math.Plane.fromPoints=function(t,e,i){var n=new cc.math.Vec3(e),r=new cc.math.Vec3(i),s=new cc.math.Plane;return n.subtract(t),r.subtract(t),n.cross(r),n.normalize(),s.a=n.x,s.b=n.y,s.c=n.z,s.d=n.scale(-1).dot(t),s},n.normalize=function(){var t=new cc.math.Vec3(this.a,this.b,this.c),e=1/t.length();return t.normalize(),this.a=t.x,this.b=t.y,this.c=t.z,this.d=this.d*e,this},n.classifyPoint=function(t){var e=this.a*t.x+this.b*t.y+this.c*t.z+this.d;if(e>.001)return cc.math.Plane.POINT_INFRONT_OF_PLANE;if(-.001>e)return cc.math.Plane.POINT_BEHIND_PLANE;else return cc.math.Plane.POINT_ON_PLANE}},{}],147:[function(t,e,i){cc.math.Quaternion=function(t,e,i,n){if(t&&void 0===e)this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w;else this.x=t||0,this.y=e||0,this.z=i||0,this.w=n||0};var n=cc.math.Quaternion.prototype;n.conjugate=function(t){return this.x=-t.x,this.y=-t.y,this.z=-t.z,this.w=t.w,this},n.dot=function(t){return this.w*t.w+this.x*t.x+this.y*t.y+this.z*t.z},n.exponential=function(){return this},n.identity=function(){return this.x=0,this.y=0,this.z=0,this.w=1,this},n.inverse=function(){var t=this.length();if(Math.abs(t)>cc.math.EPSILON)return this.x=0,this.y=0,this.z=0,this.w=0,this;else return this.conjugate(this).scale(1/t),this},n.isIdentity=function(){return 0===this.x&&0===this.y&&0===this.z&&1===this.w},n.length=function(){return Math.sqrt(this.lengthSq())},n.lengthSq=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},n.multiply=function(t){var e=this.x,i=this.y,n=this.z,r=this.w;return this.w=r*t.w-e*t.x-i*t.y-n*t.z,this.x=r*t.x+e*t.w+i*t.z-n*t.y,this.y=r*t.y+i*t.w+n*t.x-e*t.z,this.z=r*t.z+n*t.w+e*t.y-i*t.x,this},n.normalize=function(){var t=this.length();if(Math.abs(t)<=cc.math.EPSILON)throw new Error("current quaternion is an invalid value");return this.scale(1/t),this},n.rotationAxis=function(t,e){var i=.5*e,n=Math.sin(i);return this.w=Math.cos(i),this.x=t.x*n,this.y=t.y*n,this.z=t.z*n,this},cc.math.Quaternion.rotationMatrix=function(t){if(!t)return null;var e,i,n,r,s=[],o=t.mat,a=0;s[0]=o[0],s[1]=o[3],s[2]=o[6],s[4]=o[1],s[5]=o[4],s[6]=o[7],s[8]=o[2],s[9]=o[5],s[10]=o[8],s[15]=1;var c=s[0],l=c[0]+c[5]+c[10]+1;if(l>cc.math.EPSILON)a=2*Math.sqrt(l),e=(c[9]-c[6])/a,i=(c[2]-c[8])/a,n=(c[4]-c[1])/a,r=.25*a;else if(c[0]>c[5]&&c[0]>c[10])a=2*Math.sqrt(1+c[0]-c[5]-c[10]),e=.25*a,i=(c[4]+c[1])/a,n=(c[2]+c[8])/a,r=(c[9]-c[6])/a;else if(c[5]>c[10])a=2*Math.sqrt(1+c[5]-c[0]-c[10]),e=(c[4]+c[1])/a,i=.25*a,n=(c[9]+c[6])/a,r=(c[2]-c[8])/a;else a=2*Math.sqrt(1+c[10]-c[0]-c[5]),e=(c[2]+c[8])/a,i=(c[9]+c[6])/a,n=.25*a,r=(c[4]-c[1])/a;return new cc.math.Quaternion(e,i,n,r)},cc.math.Quaternion.rotationYawPitchRoll=function(t,e,i){var n,r,s,o,a,c,l,h,u,d,f;n=cc.degreesToRadians(e)/2,r=cc.degreesToRadians(t)/2,s=cc.degreesToRadians(i)/2,o=Math.cos(n),a=Math.cos(r),c=Math.cos(s),l=Math.sin(n),h=Math.sin(r),u=Math.sin(s),d=a*c,f=h*u;var _=new cc.math.Quaternion;return _.w=o*d+l*f,_.x=l*d-o*f,_.y=o*h*c+l*a*u,_.z=o*a*u-l*h*c,_.normalize(),_},n.slerp=function(t,e){if(this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w)return this;var i=this.dot(t),n=Math.acos(i),r=Math.sqrt(1-cc.math.square(i)),s=Math.sin(e*n)/r,o=Math.sin((1-e)*n)/r,a=new cc.math.Quaternion(t);return this.scale(o),a.scale(s),this.add(a),this},n.toAxisAndAngle=function(){var t,e,i,n=new cc.math.Vec3;if(t=Math.acos(this.w),e=Math.sqrt(cc.math.square(this.x)+cc.math.square(this.y)+cc.math.square(this.z)),e>-cc.math.EPSILON&&e<cc.math.EPSILON||e<2*Math.PI+cc.math.EPSILON&&e>2*Math.PI-cc.math.EPSILON)i=0,n.x=0,n.y=0,n.z=1;else i=2*t,n.x=this.x/e,n.y=this.y/e,n.z=this.z/e,n.normalize();return{axis:n,angle:i}},n.scale=function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},n.assignFrom=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},n.add=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this},cc.math.Quaternion.rotationBetweenVec3=function(t,e,i){var n=new cc.math.Vec3(t),r=new cc.math.Vec3(e);n.normalize(),r.normalize();var s=n.dot(r),o=new cc.math.Quaternion;if(s>=1)return o.identity(),o;if(1e-6-1>s)if(Math.abs(i.lengthSq())<cc.math.EPSILON)o.rotationAxis(i,Math.PI);else{var a=new cc.math.Vec3(1,0,0);if(a.cross(t),Math.abs(a.lengthSq())<cc.math.EPSILON)a.fill(0,1,0),a.cross(t);a.normalize(),o.rotationAxis(a,Math.PI)}else{var c=Math.sqrt(2*(1+s)),l=1/c;n.cross(r),o.x=n.x*l,o.y=n.y*l,o.z=n.z*l,o.w=.5*c,o.normalize()}return o},n.multiplyVec3=function(t){var e=this.x,i=this.y,n=this.z,r=new cc.math.Vec3(t),s=new cc.math.Vec3(e,i,n),o=new cc.math.Vec3(e,i,n);return s.cross(t),o.cross(s),s.scale(2*q.w),o.scale(2),r.add(s),r.add(o),r}},{}],148:[function(t,e,i){function n(t,e,i){var n=new cc.math.Vec2(e);n.subtract(t),i.x=-n.y,i.y=n.x,i.normalize()}cc.math.Ray2=function(t,e){this.start=t||new cc.math.Vec2,this.dir=e||new cc.math.Vec2},cc.math.Ray2.prototype.fill=function(t,e,i,n){this.start.x=t,this.start.y=e,this.dir.x=i,this.dir.y=n},cc.math.Ray2.prototype.intersectLineSegment=function(t,e,i){var n,r,s,o=this.start.x,a=this.start.y,c=this.start.x+this.dir.x,l=this.start.y+this.dir.y,h=t.x,u=t.y,d=e.x,f=e.y,_=(f-u)*(c-o)-(d-h)*(l-a);if(_>-cc.math.EPSILON&&_<cc.math.EPSILON)return!1;if(n=((d-h)*(a-u)-(f-u)*(o-h))/_,r=o+n*(c-o),s=a+n*(l-a),r<Math.min(t.x,e.x)-cc.math.EPSILON||r>Math.max(t.x,e.x)+cc.math.EPSILON||s<Math.min(t.y,e.y)-cc.math.EPSILON||s>Math.max(t.y,e.y)+cc.math.EPSILON)return!1;if(r<Math.min(o,c)-cc.math.EPSILON||r>Math.max(o,c)+cc.math.EPSILON||s<Math.min(a,l)-cc.math.EPSILON||s>Math.max(a,l)+cc.math.EPSILON)return!1;else return i.x=r,i.y=s,!0},cc.math.Ray2.prototype.intersectTriangle=function(t,e,i,r,s){var o,a=new cc.math.Vec2,c=new cc.math.Vec2,l=new cc.math.Vec2,h=1e4,u=!1;if(this.intersectLineSegment(t,e,a))if(u=!0,o=a.subtract(this.start).length(),h>o)c.x=a.x,c.y=a.y,h=o,n(t,e,l);if(this.intersectLineSegment(e,i,a))if(u=!0,o=a.subtract(this.start).length(),h>o)c.x=a.x,c.y=a.y,h=o,n(e,i,l);if(this.intersectLineSegment(i,t,a))if(u=!0,o=a.subtract(this.start).length(),h>o)c.x=a.x,c.y=a.y,h=o,n(i,t,l);if(u)if(r.x=c.x,r.y=c.y,s)s.x=l.x,s.y=l.y;return u}},{}],149:[function(t,e,i){cc.math=cc.math||{},cc.math.EPSILON=1/64,cc.math.square=function(t){return t*t},cc.math.almostEqual=function(t,e){return t+cc.math.EPSILON>e&&t-cc.math.EPSILON<e}},{}],150:[function(t,e,i){cc.math.Vec2=function(t,e){if(void 0===e)this.x=t.x,this.y=t.y;else this.x=t||0,this.y=e||0};var n=cc.math.Vec2.prototype;n.fill=function(t,e){this.x=t,this.y=e},n.length=function(){return Math.sqrt(cc.math.square(this.x)+cc.math.square(this.y))},n.lengthSq=function(){return cc.math.square(this.x)+cc.math.square(this.y)},n.normalize=function(){var t=1/this.length();return this.x*=t,this.y*=t,this},cc.math.Vec2.add=function(t,e,i){return t.x=e.x+i.x,t.y=e.y+i.y,t},n.add=function(t){return this.x+=t.x,this.y+=t.y,this},n.dot=function(t){return this.x*t.x+this.y*t.y},cc.math.Vec2.subtract=function(t,e,i){return t.x=e.x-i.x,t.y=e.y-i.y,t},n.subtract=function(t){return this.x-=t.x,this.y-=t.y,this},n.transform=function(t){var e=this.x,i=this.y;return this.x=e*t.mat[0]+i*t.mat[3]+t.mat[6],this.y=e*t.mat[1]+i*t.mat[4]+t.mat[7],this},cc.math.Vec2.scale=function(t,e,i){return t.x=e.x*i,t.y=e.y*i,t},n.scale=function(t){return this.x*=t,this.y*=t,this},n.equals=function(t){return this.x<t.x+cc.math.EPSILON&&this.x>t.x-cc.math.EPSILON&&this.y<t.y+cc.math.EPSILON&&this.y>t.y-cc.math.EPSILON}},{}],151:[function(t,e,i){cc.math.Vec3=cc.math.Vec3=function(t,e,i){if(t&&void 0===e)this.x=t.x,this.y=t.y,this.z=t.z;else this.x=t||0,this.y=e||0,this.z=i||0},cc.math.vec3=function(t,e,i){return new cc.math.Vec3(t,e,i)};var n=cc.math.Vec3.prototype;n.fill=function(t,e,i){if(t&&void 0===e)this.x=t.x,this.y=t.y,this.z=t.z;else this.x=t,this.y=e,this.z=i;return this},n.length=function(){return Math.sqrt(cc.math.square(this.x)+cc.math.square(this.y)+cc.math.square(this.z))},n.lengthSq=function(){return cc.math.square(this.x)+cc.math.square(this.y)+cc.math.square(this.z)},n.normalize=function(){var t=1/this.length();return this.x*=t,this.y*=t,this.z*=t,this},n.cross=function(t){var e=this.x,i=this.y,n=this.z;return this.x=i*t.z-n*t.y,this.y=n*t.x-e*t.z,this.z=e*t.y-i*t.x,this},n.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},n.add=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},n.subtract=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},n.transform=function(t){var e=this.x,i=this.y,n=this.z,r=t.mat;return this.x=e*r[0]+i*r[4]+n*r[8]+r[12],this.y=e*r[1]+i*r[5]+n*r[9]+r[13],this.z=e*r[2]+i*r[6]+n*r[10]+r[14],this},n.transformNormal=function(t){var e=this.x,i=this.y,n=this.z,r=t.mat;return this.x=e*r[0]+i*r[4]+n*r[8],this.y=e*r[1]+i*r[5]+n*r[9],this.z=e*r[2]+i*r[6]+n*r[10],this},n.transformCoord=function(t){var e=new cc.math.Vec4(this.x,this.y,this.z,1);return e.transform(t),this.x=e.x/e.w,this.y=e.y/e.w,this.z=e.z/e.w,this},n.scale=function(t){return this.x*=t,this.y*=t,this.z*=t,this},n.equals=function(t){var e=cc.math.EPSILON;return this.x<t.x+e&&this.x>t.x-e&&this.y<t.y+e&&this.y>t.y-e&&this.z<t.z+e&&this.z>t.z-e},n.inverseTransform=function(t){var e=t.mat,i=new cc.math.Vec3(this.x-e[12],this.y-e[13],this.z-e[14]);return this.x=i.x*e[0]+i.y*e[1]+i.z*e[2],this.y=i.x*e[4]+i.y*e[5]+i.z*e[6],this.z=i.x*e[8]+i.y*e[9]+i.z*e[10],this},n.inverseTransformNormal=function(t){var e=this.x,i=this.y,n=this.z,r=t.mat;return this.x=e*r[0]+i*r[1]+n*r[2],this.y=e*r[4]+i*r[5]+n*r[6],this.z=e*r[8]+i*r[9]+n*r[10],this},n.assignFrom=function(t){if(!t)return this;else return this.x=t.x,this.y=t.y,this.z=t.z,this},cc.math.Vec3.zero=function(t){return t.x=t.y=t.z=0,t},n.toTypeArray=function(){var t=new Float32Array(3);return t[0]=this.x,t[1]=this.y,t[2]=this.z,t}},{}],152:[function(t,e,i){cc.math.Vec4=function(t,e,i,n){if(t&&void 0===e)this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w;else this.x=t||0,this.y=e||0,this.z=i||0,this.w=n||0};var n=cc.math.Vec4.prototype;n.fill=function(t,e,i,n){if(t&&void 0===e)this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w;else this.x=t,this.y=e,this.z=i,this.w=n},n.add=function(t){if(!t)return this;else return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this},n.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},n.length=function(){return Math.sqrt(cc.math.square(this.x)+cc.math.square(this.y)+cc.math.square(this.z)+cc.math.square(this.w))},n.lengthSq=function(){return cc.math.square(this.x)+cc.math.square(this.y)+cc.math.square(this.z)+cc.math.square(this.w)},n.lerp=function(t,e){return this},n.normalize=function(){var t=1/this.length();return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},n.scale=function(t){return this.normalize(),this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},n.subtract=function(t){this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w},n.transform=function(t){var e=this.x,i=this.y,n=this.z,r=this.w,s=t.mat;return this.x=e*s[0]+i*s[4]+n*s[8]+r*s[12],this.y=e*s[1]+i*s[5]+n*s[9]+r*s[13],this.z=e*s[2]+i*s[6]+n*s[10]+r*s[14],this.w=e*s[3]+i*s[7]+n*s[11]+r*s[15],this},cc.math.Vec4.transformArray=function(t,e){for(var i=[],n=0;n<t.length;n++){var r=new cc.math.Vec4(t[n]);r.transform(e),i.push(r)}return i},n.equals=function(t){var e=cc.math.EPSILON;return this.x<t.x+e&&this.x>t.x-e&&this.y<t.y+e&&this.y>t.y-e&&this.z<t.z+e&&this.z>t.z-e&&this.w<t.w+e&&this.w>t.w-e},n.assignFrom=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},n.toTypeArray=function(){var t=new Float32Array(4);return t[0]=this.x,t[1]=this.y,t[2]=this.z,t[3]=this.w,t}},{}],153:[function(t,e,i){var n=cc._Class.extend({ctor:function(t){var e,i,n,r,s,o,a,c,l,h,u,d,f,_;for(this.data=t,this.pos=8,this.palette=[],this.imgData=[],this.transparency={},this.animation=null,this.text={},s=null;;){switch(e=this.readUInt32(),l=function(){var t,e;for(e=[],o=t=0;4>t;o=++t)e.push(String.fromCharCode(this.data[this.pos++]));return e}.call(this).join("")){case"IHDR":this.width=this.readUInt32(),this.height=this.readUInt32(),this.bits=this.data[this.pos++],this.colorType=this.data[this.pos++],this.compressionMethod=this.data[this.pos++],this.filterMethod=this.data[this.pos++],this.interlaceMethod=this.data[this.pos++];break;case"acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||1/0,frames:[]};break;case"PLTE":this.palette=this.read(e);break;case"fcTL":if(s)this.animation.frames.push(s);this.pos+=4,s={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()},r=this.readUInt16(),n=this.readUInt16()||100,s.delay=1e3*r/n,s.disposeOp=this.data[this.pos++],s.blendOp=this.data[this.pos++],s.data=[];break;case"IDAT":case"fdAT":if("fdAT"===l)this.pos+=4,e-=4;for(t=(null!=s?s.data:void 0)||this.imgData,o=d=0;e>=0?e>d:d>e;o=e>=0?++d:--d)t.push(this.data[this.pos++]);break;case"tRNS":switch(this.transparency={},this.colorType){case 3:if(this.transparency.indexed=this.read(e),h=255-this.transparency.indexed.length,h>0)for(o=f=0;h>=0?h>f:f>h;o=h>=0?++f:--f)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(e)[0];break;case 2:this.transparency.rgb=this.read(e)}break;case"tEXt":u=this.read(e),a=u.indexOf(0),c=String.fromCharCode.apply(String,u.slice(0,a)),this.text[c]=String.fromCharCode.apply(String,u.slice(a+1));break;case"IEND":if(s)this.animation.frames.push(s);if(this.colors=function(){switch(this.colorType){case 0:case 3:case 4:return 1;case 2:case 6:return 3}}.call(this),this.hasAlphaChannel=4===(_=this.colorType)||6===_,i=this.colors+(this.hasAlphaChannel?1:0),this.pixelBitlength=this.bits*i,this.colorSpace=function(){switch(this.colors){case 1:return"DeviceGray";case 3:return"DeviceRGB"}}.call(this),Uint8Array!=Array)this.imgData=new Uint8Array(this.imgData);return;default:this.pos+=e}if(this.pos+=4,this.pos>this.data.length)throw new Error("Incomplete or corrupt PNG file")}},read:function(t){var e,i,n;for(n=[],e=i=0;t>=0?t>i:i>t;e=t>=0?++i:--i)n.push(this.data[this.pos++]);return n},readUInt32:function(){var t,e,i,n;return t=this.data[this.pos++]<<24,e=this.data[this.pos++]<<16,i=this.data[this.pos++]<<8,n=this.data[this.pos++],t|e|i|n},readUInt16:function(){var t,e;return t=this.data[this.pos++]<<8,e=this.data[this.pos++],t|e},decodePixels:function(t){var e,i,n,r,s,o,a,c,l,h,u,d,f,_,p,g,m,v,y,T,C,x,S;if(null==t)t=this.imgData;if(0===t.length)return new Uint8Array(0);var b=new Zlib.Inflate(t,{index:0,verify:!1});for(t=b.decompress(),d=this.pixelBitlength/8,g=d*this.width,f=new Uint8Array(g*this.height),o=t.length,p=0,_=0,i=0;o>_;){switch(t[_++]){case 0:for(r=y=0;g>y;r=y+=1)f[i++]=t[_++];break;case 1:for(r=T=0;g>T;r=T+=1)e=t[_++],s=d>r?0:f[i-d],f[i++]=(e+s)%256;break;case 2:for(r=C=0;g>C;r=C+=1)e=t[_++],n=(r-r%d)/d,m=p&&f[(p-1)*g+n*d+r%d],f[i++]=(m+e)%256;break;case 3:for(r=x=0;g>x;r=x+=1)e=t[_++],n=(r-r%d)/d,s=d>r?0:f[i-d],m=p&&f[(p-1)*g+n*d+r%d],f[i++]=(e+Math.floor((s+m)/2))%256;break;case 4:for(r=S=0;g>S;r=S+=1){if(e=t[_++],n=(r-r%d)/d,s=d>r?0:f[i-d],0===p)m=v=0;else m=f[(p-1)*g+n*d+r%d],v=n&&f[(p-1)*g+(n-1)*d+r%d];if(a=s+m-v,c=Math.abs(a-s),h=Math.abs(a-m),u=Math.abs(a-v),h>=c&&u>=c)l=s;else if(u>=h)l=m;else l=v;f[i++]=(e+l)%256}break;default:throw new Error("Invalid filter algorithm: "+t[_-1])}p++}return f},copyToImageData:function(t,e){var i,n,r,s,o,a,c,l,h,u,d;if(n=this.colors,h=null,i=this.hasAlphaChannel,this.palette.length)h=null!=(d=this._decodedPalette)?d:this._decodedPalette=this.decodePalette(),n=4,i=!0;if(r=t.data||t,l=r.length,o=h||e,s=a=0,1===n)for(;l>s;)c=h?4*e[s/4]:a,u=o[c++],r[s++]=u,r[s++]=u,r[s++]=u,r[s++]=i?o[c++]:255,a=c;else for(;l>s;)c=h?4*e[s/4]:a,r[s++]=o[c++],r[s++]=o[c++],r[s++]=o[c++],r[s++]=i?o[c++]:255,a=c},decodePalette:function(){var t,e,i,n,r,s,o,a,c;for(i=this.palette,s=this.transparency.indexed||[],r=new Uint8Array((s.length||0)+i.length),n=0,t=0,e=o=0,a=i.length;a>o;e=o+=3)r[n++]=i[e],r[n++]=i[e+1],r[n++]=i[e+2],r[n++]=null!=(c=s[t++])?c:255;return r},render:function(t){var e,i;return t.width=this.width,t.height=this.height,e=t.getContext("2d"),i=e.createImageData(this.width,this.height),this.copyToImageData(i,this.decodePixels()),e.putImageData(i,0,0)}});e.exports=n},{}],154:[function(t,e,i){var n=cc.Class({name:"cc.ParticleAsset","extends":cc.RawAsset});cc.ParticleAsset=e.exports=n},{}],155:[function(t,e,i){var n=cc.BlendFunc.BlendFactor,r=cc.Enum({GRAVITY:0,RADIUS:1}),s=cc.Enum({FREE:0,RELATIVE:1,GROUPED:2}),o={preview:{"default":!0,editorOnly:!0,notify:!1,animatable:!1},_custom:!1,custom:{get:function(){return this._custom},set:function(t){if(false)return cc.warn("Custom should not be false if file is not specified.");if(this._custom!==t){if(this._custom=t,t)this._applyCustoms();else this._applyFile();if(!1)cc.engine.repaintInEditMode()}},animatable:!1},_file:{"default":"",url:cc.ParticleAsset},file:{get:function(){return this._file},set:function(t,e){if(this._file!==t)if(this._file=t,t){if(this._applyFile(),!1)cc.engine.repaintInEditMode()}else this.custom=!0},animatable:!1,url:cc.ParticleAsset},_texture:{"default":"",url:cc.Texture2D},texture:{get:function(){return this._texture},set:function(t){this._texture=t,this._sgNode.texture=t?cc.textureCache.addImage(t):null},url:cc.Texture2D},particleCount:{get:function(){return this._sgNode.particleCount},set:function(t){this._sgNode.particleCount=t},visible:!1},_srcBlendFactor:n.SRC_ALPHA,srcBlendFactor:{get:function(){return this._srcBlendFactor},set:function(t){this._srcBlendFactor=t,this._blendFunc.src=t,this._sgNode.setBlendFunc(this._blendFunc)},animatable:!1,type:n},_dstBlendFactor:n.ONE_MINUS_SRC_ALPHA,dstBlendFactor:{get:function(){return this._dstBlendFactor},set:function(t){this._dstBlendFactor=t,this._blendFunc.dst=t,this._sgNode.setBlendFunc(this._blendFunc)},animatable:!1,type:n},playOnLoad:!0,_autoRemoveOnFinish:!1,autoRemoveOnFinish:{get:function(){return this._autoRemoveOnFinish},set:function(t){if(this._autoRemoveOnFinish!==t)if(this._autoRemoveOnFinish=t,true)this._applyAutoRemove()},animatable:!1},active:{get:function(){return this._sgNode?this._sgNode.isActive():!1},visible:!1}},a=function(){for(var t={totalParticles:150,duration:-1,emissionRate:10,life:1,lifeVar:0,startColor:cc.Color.WHITE,startColorVar:cc.Color.BLACK,endColor:cc.color(255,255,255,0),endColorVar:cc.color(0,0,0,0),angle:90,angleVar:20,startSize:50,startSizeVar:0,endSize:0,endSizeVar:0,startSpin:0,startSpinVar:0,endSpin:0,endSpinVar:0,sourcePos:cc.p(0,0),posVar:cc.p(0,0),positionType:s.FREE,emitterMode:r.GRAVITY,gravity:cc.p(0,0),speed:180,speedVar:50,tangentialAccel:80,tangentialAccelVar:0,radialAccel:0,radialAccelVar:0,rotationIsDir:!1,startRadius:0,startRadiusVar:0,endRadius:0,endRadiusVar:0,rotatePerS:0,rotatePerSVar:0},e=Object.keys(t),i=0;i<e.length;++i){var n=e[i];!function(t,e){var i="_"+t;o[i]=e;var n=e.constructor,r=o[t]={};if(cc.isChildClassOf(n,cc.ValueType))r.get=function(){return new n(this[i])},r.type=n;else r.get=function(){return this[i]};if(cc.isChildClassOf(n,cc.ValueType))r.set=function(e){this[i]=new n(e),this._sgNode[t]=e};else if(false)r.set=function(e){if(this[i]=e,!isNaN(e))this._sgNode[t]=e;else cc.error("The new %s must not be NaN",t)};else r.set=function(e){this[i]=e,this._sgNode[t]=e}}(n,t[n])}return e}();o.positionType.type=s,o.emitterMode.type=r;var c=cc.Class({name:"cc.ParticleSystem","extends":cc._RendererUnderSG,editor:!1,ctor:function(){this._previewTimer=null,this._focused=!1,this._willStart=!1,this._blendFunc=new cc.BlendFunc(0,0)},properties:o,statics:{DURATION_INFINITY:-1,START_SIZE_EQUAL_TO_END_SIZE:-1,START_RADIUS_EQUAL_TO_END_RADIUS:-1,EmitterMode:r,PositionType:s},onLoad:function(){if(this._super(),true){if(this.playOnLoad)this.resetSystem();this._applyAutoRemove()}},onDestroy:function(){if(this._autoRemoveOnFinish)this.autoRemoveOnFinish=!1;this._super()},onFocusInEditor:!1,onLostFocusInEditor:!1,_createSgNode:function(){return new _ccsg.ParticleSystem},_initSgNode:function(){var t=this._sgNode;if(this._file)if(this._custom){var e=!this._texture;if(e)this._applyFile(this._applyCustoms.bind(this));else this._applyCustoms()}else this._applyFile();else if(this._custom)this._applyCustoms();t.stopSystem()},addParticle:function(){return this._sgNode.addParticle()},stopSystem:function(){this._sgNode.stopSystem()},resetSystem:function(){this._sgNode.resetSystem()},isFull:function(){return this.particleCount>=this._totalParticles},setDisplayFrame:function(t){if(t){var e=t.getTexture();if(e)this._texture=e.url;this._sgNode.setDisplayFrame(t)}},setTextureWithRect:function(t,e){if(t instanceof cc.Texture2D)this._texture=t.url;this._sgNode.setTextureWithRect(t,e)},_applyFile:function(t){var e=this._sgNode,i=this._file;if(i){var n=this;cc.loader.load(i,function(r,s){if(r||!s)throw r||new Error("Unkown error");e.particleCount=0;var o=e.isActive();if(e.initWithFile(i),s.textureUuid)cc.AssetLibrary.queryAssetInfo(s.textureUuid,function(t,e,i){n.texture=e});if(s.emissionRate)n.emissionRate=s.emissionRate;if(e.setPosition(0,0),!o)e.stopSystem();if(true)n._applyAutoRemove();if(t)t()})}},_applyCustoms:function(){for(var t=this._sgNode,e=t.isActive(),i=0;i<a.length;i++){var n=a[i];t[n]=this["_"+n]}if(this._blendFunc.src=this._srcBlendFactor,this._blendFunc.dst=this._dstBlendFactor,t.setBlendFunc(this._blendFunc),this._texture)t.texture=cc.textureCache.addImage(this._texture);if(!e)t.stopSystem();if(true)this._applyAutoRemove()},_applyAutoRemove:function(){var t=this._sgNode,e=this._autoRemoveOnFinish;if(t.autoRemoveOnFinish=e,e){cc.assert(!t.onExit);var i=this;t.onExit=function(){_ccsg.Node.prototype.onExit.call(this),i.node.destroy()}}else if(t.hasOwnProperty("onExit"))t.onExit=_ccsg.Node.prototype.onExit}});cc.ParticleSystem=e.exports=c},{}],156:[function(t,e,i){var n={_littleEndian:!1,_tiffData:null,_fileDirectories:[],getUint8:function(t){return this._tiffData[t]},getUint16:function(t){if(this._littleEndian)return this._tiffData[t+1]<<8|this._tiffData[t];else return this._tiffData[t]<<8|this._tiffData[t+1]},getUint32:function(t){var e=this._tiffData;if(this._littleEndian)return e[t+3]<<24|e[t+2]<<16|e[t+1]<<8|e[t];else return e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]},checkLittleEndian:function(){var t=this.getUint16(0);if(18761===t)this.littleEndian=!0;else if(19789===t)this.littleEndian=!1;else throw console.log(t),TypeError("Invalid byte order value.");return this.littleEndian},hasTowel:function(){if(42!==this.getUint16(2))throw RangeError("You forgot your towel!");return!0},getFieldTypeName:function(t){var e=this.fieldTypeNames;if(t in e)return e[t];else return null},getFieldTagName:function(t){var e=this.fieldTagNames;if(t in e)return e[t];else return console.log("Unknown Field Tag:",t),"Tag"+t},getFieldTypeLength:function(t){if(-1!==["BYTE","ASCII","SBYTE","UNDEFINED"].indexOf(t))return 1;else if(-1!==["SHORT","SSHORT"].indexOf(t))return 2;else if(-1!==["LONG","SLONG","FLOAT"].indexOf(t))return 4;else if(-1!==["RATIONAL","SRATIONAL","DOUBLE"].indexOf(t))return 8;return null},getFieldValues:function(t,e,i,n){var r=[],s=this.getFieldTypeLength(e),o=s*i;if(4>=o)if(this.littleEndian===!1)r.push(n>>>8*(4-s));else r.push(n);else for(var a=0;i>a;a++){var c=s*a;if(s>=8)if(-1!==["RATIONAL","SRATIONAL"].indexOf(e))r.push(this.getUint32(n+c)),r.push(this.getUint32(n+c+4));else cc.log("Can't handle this field type or size");else r.push(this.getBytes(s,n+c))}if("ASCII"===e)r.forEach(function(t,e,i){i[e]=String.fromCharCode(t)});return r},getBytes:function(t,e){if(0>=t)cc.log("No bytes requested");else if(1>=t)return this.getUint8(e);else if(2>=t)return this.getUint16(e);else if(3>=t)return this.getUint32(e)>>>8;else if(4>=t)return this.getUint32(e);else cc.log("Too many bytes requested")},getBits:function(t,e,i){i=i||0;var n,r,s=Math.floor(i/8),o=e+s,a=i+t,c=32-t;if(0>=a)console.log("No bits requested");else if(8>=a)n=24+i,r=this.getUint8(o);else if(16>=a)n=16+i,r=this.getUint16(o);else if(32>=a)n=i,r=this.getUint32(o);else console.log("Too many bits requested");return{bits:r<<n>>>c,byteOffset:o+Math.floor(a/8),bitOffset:a%8}},parseFileDirectory:function(t){for(var e=this.getUint16(t),i=[],n=t+2,r=0;e>r;n+=12,r++){var s=this.getUint16(n),o=this.getUint16(n+2),a=this.getUint32(n+4),c=this.getUint32(n+8),l=this.getFieldTagName(s),h=this.getFieldTypeName(o),u=this.getFieldValues(l,h,a,c);i[l]={type:h,values:u}}this._fileDirectories.push(i);var d=this.getUint32(n);if(0!==d)this.parseFileDirectory(d)},clampColorSample:function(t,e){var i=Math.pow(2,8-e);return Math.floor(t*i+(i-1))},parseTIFF:function(t,e){if(e=e||document.createElement("canvas"),this._tiffData=t,this.canvas=e,this.checkLittleEndian(),this.hasTowel()){var i=this.getUint32(4);this._fileDirectories.length=0,this.parseFileDirectory(i);var n=this._fileDirectories[0],r=n.ImageWidth.values[0],s=n.ImageLength.values[0];this.canvas.width=r,this.canvas.height=s;var o=[],a=n.Compression?n.Compression.values[0]:1,c=n.SamplesPerPixel.values[0],l=[],h=0,u=!1;if(n.BitsPerSample.values.forEach(function(t,e,i){if(l[e]={bitsPerSample:t,hasBytesPerSample:!1,bytesPerSample:void 0},t%8===0)l[e].hasBytesPerSample=!0,l[e].bytesPerSample=t/8;h+=t},this),h%8===0){u=!0;var d=h/8}var f=n.StripOffsets.values,_=f.length;if(n.StripByteCounts)var p=n.StripByteCounts.values;else if(cc.log("Missing StripByteCounts!"),1===_)var p=[Math.ceil(r*s*h/8)];else throw Error("Cannot recover from missing StripByteCounts");for(var g=0;_>g;g++){var m=f[g];o[g]=[];for(var v=p[g],y=0,T=0,C=1,x=!0,S=[],b=0,E=0,A=0;v>y;y+=C)switch(a){case 1:for(var w=0,S=[];c>w;w++)if(l[w].hasBytesPerSample){var O=l[w].bytesPerSample*w;S.push(this.getBytes(l[w].bytesPerSample,m+y+O))}else{var I=this.getBits(l[w].bitsPerSample,m+y,T);throw S.push(I.bits),y=I.byteOffset-m,T=I.bitOffset,RangeError("Cannot handle sub-byte bits per sample")}if(o[g].push(S),u)C=d;else throw C=0,RangeError("Cannot handle sub-byte bits per pixel");break;case 2:break;case 3:break;case 4:break;case 5:break;case 6:break;case 7:break;case 32773:if(x){x=!1;var R=1,P=1,N=this.getInt8(m+y);if(N>=0&&127>=N)R=N+1;else if(N>=-127&&-1>=N)P=-N+1;else x=!0}else{for(var L=this.getUint8(m+y),w=0;P>w;w++){if(l[E].hasBytesPerSample){if(A=A<<8*b|L,b++,b===l[E].bytesPerSample)S.push(A),A=b=0,E++}else throw RangeError("Cannot handle sub-byte bits per sample");if(E===c)o[g].push(S),S=[],E=0}if(R--,0===R)x=!0}C=1}}if(e.getContext){var F=this.canvas.getContext("2d");F.fillStyle="rgba(255, 255, 255, 0)";var D=n.RowsPerStrip?n.RowsPerStrip.values[0]:s,M=o.length,B=s%D,z=0===B?D:B,k=D,V=0,W=n.PhotometricInterpretation.values[0],U=[],G=0;if(n.ExtraSamples)U=n.ExtraSamples.values,G=U.length;if(n.ColorMap)var X=n.ColorMap.values,j=Math.pow(2,l[0].bitsPerSample);for(var g=0;M>g;g++){if(g+1===M)k=z;for(var Y=o[g].length,H=V*g,q=0,Q=0;Y>Q;q++)for(var Z=0;r>Z;Z++,Q++){var K=o[g][Q],J=0,$=0,tt=0,et=1;if(G>0)for(var it=0;G>it;it++)if(1===U[it]||2===U[it]){et=K[3+it]/256;break}switch(W){case 0:if(l[0].hasBytesPerSample)var nt=Math.pow(16,2*l[0].bytesPerSample);K.forEach(function(t,e,i){i[e]=nt-t});case 1:J=$=tt=this.clampColorSample(K[0],l[0].bitsPerSample);break;case 2:J=this.clampColorSample(K[0],l[0].bitsPerSample),$=this.clampColorSample(K[1],l[1].bitsPerSample),tt=this.clampColorSample(K[2],l[2].bitsPerSample);break;case 3:if(void 0===X)throw Error("Palette image missing color map");var rt=K[0];J=this.clampColorSample(X[rt],16),$=this.clampColorSample(X[j+rt],16),tt=this.clampColorSample(X[2*j+rt],16);break;default:throw RangeError("Unknown Photometric Interpretation:",W)}F.fillStyle="rgba("+J+", "+$+", "+tt+", "+et+")",F.fillRect(Z,H+q,1,1)}V=k}}return this.canvas}},fieldTagNames:{315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",
281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop"},fieldTypeNames:{1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE"}};e.exports=n},{}],157:[function(t,e,i){var n=function(t,e,i){this.value=t,this.location=e,this.hh=i||{}},r=cc.math,s=cc.macro;cc.GLProgram=cc._Class.extend({_glContext:null,_programObj:null,_vertShader:null,_fragShader:null,_uniforms:null,_hashForUniforms:null,_usesTime:!1,_updateUniformLocation:function(t,e,i){if(null==t)return!1;for(var r=!0,s=null,o=0;o<this._hashForUniforms.length;o++)if(this._hashForUniforms[o].location==t)s=this._hashForUniforms[o];if(!s)s=new n,s.location=t,s.value=e,this._hashForUniforms.push(s);else if(s.value==e)r=!1;else s.value=e;return r},_description:function(){return"<CCGLProgram = "+this.toString()+" | Program = "+this._programObj.toString()+", VertexShader = "+this._vertShader.toString()+", FragmentShader = "+this._fragShader.toString()+">"},_compileShader:function(t,e,i){if(!i||!t)return!1;var n=cc.GLProgram._isHighpSupported()?"precision highp float;\n":"precision mediump float;\n";i=n+"uniform mat4 CC_PMatrix;         \nuniform mat4 CC_MVMatrix;        \nuniform mat4 CC_MVPMatrix;       \nuniform vec4 CC_Time;            \nuniform vec4 CC_SinTime;         \nuniform vec4 CC_CosTime;         \nuniform vec4 CC_Random01;        \nuniform sampler2D CC_Texture0;   \n//CC INCLUDES END                \n"+i,this._glContext.shaderSource(t,i),this._glContext.compileShader(t);var r=this._glContext.getShaderParameter(t,this._glContext.COMPILE_STATUS);if(!r)if(cc.log("cocos2d: ERROR: Failed to compile shader:\n"+this._glContext.getShaderSource(t)),e===this._glContext.VERTEX_SHADER)cc.log("cocos2d: \n"+this.vertexShaderLog());else cc.log("cocos2d: \n"+this.fragmentShaderLog());return r===!0},ctor:function(t,e,i){this._uniforms=[],this._hashForUniforms=[],this._glContext=i||cc._renderContext,t&&e&&this.init(t,e)},destroyProgram:function(){this._vertShader=null,this._fragShader=null,this._uniforms=null,this._hashForUniforms=null,this._glContext.deleteProgram(this._programObj)},initWithVertexShaderByteArray:function(t,e){var i=this._glContext;if(this._programObj=i.createProgram(),this._vertShader=null,this._fragShader=null,t)if(this._vertShader=i.createShader(i.VERTEX_SHADER),!this._compileShader(this._vertShader,i.VERTEX_SHADER,t))cc.log("cocos2d: ERROR: Failed to compile vertex shader");if(e)if(this._fragShader=i.createShader(i.FRAGMENT_SHADER),!this._compileShader(this._fragShader,i.FRAGMENT_SHADER,e))cc.log("cocos2d: ERROR: Failed to compile fragment shader");if(this._vertShader)i.attachShader(this._programObj,this._vertShader);if(cc.checkGLErrorDebug(),this._fragShader)i.attachShader(this._programObj,this._fragShader);return this._hashForUniforms.length=0,cc.checkGLErrorDebug(),!0},initWithString:function(t,e){return this.initWithVertexShaderByteArray(t,e)},initWithVertexShaderFilename:function(t,e){var i=cc.loader.getRes(t);if(!i)throw new Error("Please load the resource firset : "+t);var n=cc.loader.getRes(e);if(!n)throw new Error("Please load the resource firset : "+e);return this.initWithVertexShaderByteArray(i,n)},init:function(t,e){return this.initWithVertexShaderFilename(t,e)},addAttribute:function(t,e){this._glContext.bindAttribLocation(this._programObj,e,t)},link:function(){if(!this._programObj)return cc.log("cc.GLProgram.link(): Cannot link invalid program"),!1;if(this._glContext.linkProgram(this._programObj),this._vertShader)this._glContext.deleteShader(this._vertShader);if(this._fragShader)this._glContext.deleteShader(this._fragShader);if(this._vertShader=null,this._fragShader=null,cc.game.config[cc.game.CONFIG_KEY.debugMode]){var t=this._glContext.getProgramParameter(this._programObj,this._glContext.LINK_STATUS);if(!t)return cc.log("cocos2d: ERROR: Failed to link program: "+this._glContext.getProgramInfoLog(this._programObj)),cc.gl.deleteProgram(this._programObj),this._programObj=null,!1}return!0},use:function(){cc.gl.useProgram(this._programObj)},updateUniforms:function(){this._uniforms[s.UNIFORM_PMATRIX]=this._glContext.getUniformLocation(this._programObj,s.UNIFORM_PMATRIX_S),this._uniforms[s.UNIFORM_MVMATRIX]=this._glContext.getUniformLocation(this._programObj,s.UNIFORM_MVMATRIX_S),this._uniforms[s.UNIFORM_MVPMATRIX]=this._glContext.getUniformLocation(this._programObj,s.UNIFORM_MVPMATRIX_S),this._uniforms[s.UNIFORM_TIME]=this._glContext.getUniformLocation(this._programObj,s.UNIFORM_TIME_S),this._uniforms[s.UNIFORM_SINTIME]=this._glContext.getUniformLocation(this._programObj,s.UNIFORM_SINTIME_S),this._uniforms[s.UNIFORM_COSTIME]=this._glContext.getUniformLocation(this._programObj,s.UNIFORM_COSTIME_S),this._usesTime=null!=this._uniforms[s.UNIFORM_TIME]||null!=this._uniforms[s.UNIFORM_SINTIME]||null!=this._uniforms[s.UNIFORM_COSTIME],this._uniforms[s.UNIFORM_RANDOM01]=this._glContext.getUniformLocation(this._programObj,s.UNIFORM_RANDOM01_S),this._uniforms[s.UNIFORM_SAMPLER]=this._glContext.getUniformLocation(this._programObj,s.UNIFORM_SAMPLER_S),this.use(),this.setUniformLocationWith1i(this._uniforms[s.UNIFORM_SAMPLER],0)},getUniformLocationForName:function(t){if(!t)throw new Error("cc.GLProgram.getUniformLocationForName(): uniform name should be non-null");if(!this._programObj)throw new Error("cc.GLProgram.getUniformLocationForName(): Invalid operation. Cannot get uniform location when program is not initialized");return this._glContext.getUniformLocation(this._programObj,t)},getUniformMVPMatrix:function(){return this._uniforms[s.UNIFORM_MVPMATRIX]},getUniformSampler:function(){return this._uniforms[s.UNIFORM_SAMPLER]},setUniformLocationWith1i:function(t,e){var i=this._updateUniformLocation(t,e);if(i)this._glContext.uniform1i(t,e)},setUniformLocationWith2i:function(t,e,i){var n=[e,i],r=this._updateUniformLocation(t,n);if(r)this._glContext.uniform2i(t,e,i)},setUniformLocationWith3i:function(t,e,i,n){var r=[e,i,n],s=this._updateUniformLocation(t,r);if(s)this._glContext.uniform3i(t,e,i,n)},setUniformLocationWith4i:function(t,e,i,n,r){var s=[e,i,n,r],o=this._updateUniformLocation(t,s);if(o)this._glContext.uniform4i(t,e,i,n,r)},setUniformLocationWith2iv:function(t,e,i){var n=this._updateUniformLocation(t,e);if(n)this._glContext.uniform2iv(t,e)},setUniformLocationWith3iv:function(t,e,i){var n=this._updateUniformLocation(t,e);if(n)this._glContext.uniform3iv(t,e)},setUniformLocationWith4iv:function(t,e,i){var n=this._updateUniformLocation(t,e);if(n)this._glContext.uniform4iv(t,e)},setUniformLocationI32:function(t,e){this.setUniformLocationWith1i(arguments[0],arguments[1])},setUniformLocationWith1f:function(t,e){var i=this._updateUniformLocation(t,e);if(i)this._glContext.uniform1f(t,e)},setUniformLocationWith2f:function(t,e,i){var n=[e,i],r=this._updateUniformLocation(t,n);if(r)this._glContext.uniform2f(t,e,i)},setUniformLocationWith3f:function(t,e,i,n){var r=[e,i,n],s=this._updateUniformLocation(t,r);if(s)this._glContext.uniform3f(t,e,i,n)},setUniformLocationWith4f:function(t,e,i,n,r){var s=[e,i,n,r],o=this._updateUniformLocation(t,s);if(o)this._glContext.uniform4f(t,e,i,n,r)},setUniformLocationWith2fv:function(t,e,i){var n=this._updateUniformLocation(t,e);if(n)this._glContext.uniform2fv(t,e)},setUniformLocationWith3fv:function(t,e,i){var n=this._updateUniformLocation(t,e);if(n)this._glContext.uniform3fv(t,e)},setUniformLocationWith4fv:function(t,e,i){var n=this._updateUniformLocation(t,e);if(n)this._glContext.uniform4fv(t,e)},setUniformLocationWithMatrix4fv:function(t,e,i){var n=this._updateUniformLocation(t,e);if(n)this._glContext.uniformMatrix4fv(t,!1,e)},setUniformLocationF32:function(){if(!(arguments.length<2))switch(arguments.length){case 2:this.setUniformLocationWith1f(arguments[0],arguments[1]);break;case 3:this.setUniformLocationWith2f(arguments[0],arguments[1],arguments[2]);break;case 4:this.setUniformLocationWith3f(arguments[0],arguments[1],arguments[2],arguments[3]);break;case 5:this.setUniformLocationWith4f(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4])}},setUniformsForBuiltins:function(){var t=new r.Matrix4,e=new r.Matrix4,i=new r.Matrix4;if(r.glGetMatrix(r.KM_GL_PROJECTION,t),r.glGetMatrix(r.KM_GL_MODELVIEW,e),r.mat4Multiply(i,t,e),this.setUniformLocationWithMatrix4fv(this._uniforms[s.UNIFORM_PMATRIX],t.mat,1),this.setUniformLocationWithMatrix4fv(this._uniforms[s.UNIFORM_MVMATRIX],e.mat,1),this.setUniformLocationWithMatrix4fv(this._uniforms[s.UNIFORM_MVPMATRIX],i.mat,1),this._usesTime){var n=cc.director,o=n.getTotalFrames()*n.getAnimationInterval();this.setUniformLocationWith4f(this._uniforms[s.UNIFORM_TIME],o/10,o,2*o,4*o),this.setUniformLocationWith4f(this._uniforms[s.UNIFORM_SINTIME],o/8,o/4,o/2,Math.sin(o)),this.setUniformLocationWith4f(this._uniforms[s.UNIFORM_COSTIME],o/8,o/4,o/2,Math.cos(o))}if(-1!==this._uniforms[s.UNIFORM_RANDOM01])this.setUniformLocationWith4f(this._uniforms[s.UNIFORM_RANDOM01],Math.random(),Math.random(),Math.random(),Math.random())},_setUniformsForBuiltinsForRenderer:function(t){if(t&&t._renderCmd){var e=new r.Matrix4,i=new r.Matrix4;if(r.glGetMatrix(r.KM_GL_PROJECTION,e),r.mat4Multiply(i,e,t._renderCmd._stackMatrix),this.setUniformLocationWithMatrix4fv(this._uniforms[s.UNIFORM_PMATRIX],e.mat,1),this.setUniformLocationWithMatrix4fv(this._uniforms[s.UNIFORM_MVMATRIX],t._renderCmd._stackMatrix.mat,1),this.setUniformLocationWithMatrix4fv(this._uniforms[s.UNIFORM_MVPMATRIX],i.mat,1),this._usesTime){var n=cc.director,o=n.getTotalFrames()*n.getAnimationInterval();this.setUniformLocationWith4f(this._uniforms[s.UNIFORM_TIME],o/10,o,2*o,4*o),this.setUniformLocationWith4f(this._uniforms[s.UNIFORM_SINTIME],o/8,o/4,o/2,Math.sin(o)),this.setUniformLocationWith4f(this._uniforms[s.UNIFORM_COSTIME],o/8,o/4,o/2,Math.cos(o))}if(-1!==this._uniforms[s.UNIFORM_RANDOM01])this.setUniformLocationWith4f(this._uniforms[s.UNIFORM_RANDOM01],Math.random(),Math.random(),Math.random(),Math.random())}},setUniformForModelViewProjectionMatrix:function(){this._glContext.uniformMatrix4fv(this._uniforms[s.UNIFORM_MVPMATRIX],!1,r.getMat4MultiplyValue(r.projection_matrix_stack.top,r.modelview_matrix_stack.top))},setUniformForModelViewProjectionMatrixWithMat4:function(t){r.mat4Multiply(t,r.projection_matrix_stack.top,r.modelview_matrix_stack.top),this._glContext.uniformMatrix4fv(this._uniforms[s.UNIFORM_MVPMATRIX],!1,t.mat)},setUniformForModelViewAndProjectionMatrixWithMat4:function(){this._glContext.uniformMatrix4fv(this._uniforms[s.UNIFORM_MVMATRIX],!1,r.modelview_matrix_stack.top.mat),this._glContext.uniformMatrix4fv(this._uniforms[s.UNIFORM_PMATRIX],!1,r.projection_matrix_stack.top.mat)},_setUniformForMVPMatrixWithMat4:function(t){if(!t)throw new Error("modelView matrix is undefined.");this._glContext.uniformMatrix4fv(this._uniforms[s.UNIFORM_MVMATRIX],!1,t.mat),this._glContext.uniformMatrix4fv(this._uniforms[s.UNIFORM_PMATRIX],!1,r.projection_matrix_stack.top.mat)},vertexShaderLog:function(){return this._glContext.getShaderInfoLog(this._vertShader)},getVertexShaderLog:function(){return this._glContext.getShaderInfoLog(this._vertShader)},getFragmentShaderLog:function(){return this._glContext.getShaderInfoLog(this._vertShader)},fragmentShaderLog:function(){return this._glContext.getShaderInfoLog(this._fragShader)},programLog:function(){return this._glContext.getProgramInfoLog(this._programObj)},getProgramLog:function(){return this._glContext.getProgramInfoLog(this._programObj)},reset:function(){this._vertShader=null,this._fragShader=null,this._uniforms.length=0,this._glContext.deleteProgram(this._programObj),this._programObj=null;for(var t=0;t<this._hashForUniforms.length;t++)this._hashForUniforms[t].value=null,this._hashForUniforms[t]=null;this._hashForUniforms.length=0},getProgram:function(){return this._programObj},retain:function(){},release:function(){}}),cc.GLProgram._highpSupported=null,cc.GLProgram._isHighpSupported=function(){if(null==cc.GLProgram._highpSupported){var t=cc._renderContext,e=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT);cc.GLProgram._highpSupported=0!==e.precision}return cc.GLProgram._highpSupported}},{}],158:[function(t,e,i){var n=-1,r=!1,s=!1,o=!1,a=cc.macro,c=a.ENABLE_GL_STATE_CACHE,l=0,h=0,u=null,d=0,f=0,_=0,p=0;if(c)if(l=16,h=-1,u=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],d=-1,f=-1,_=0,a.TEXTURE_ATLAS_USE_VAO)p=0;cc.gl={},cc.gl.invalidateStateCache=function(){if(cc.math.glFreeAll(),n=-1,r=!1,s=!1,o=!1,c){h=-1;for(var t=0;l>t;t++)u[t]=-1;d=-1,f=-1,_=0}},cc.gl.useProgram=c?function(t){if(t!==h)h=t,cc._renderContext.useProgram(t)}:function(t){cc._renderContext.useProgram(t)},cc.gl.deleteProgram=function(t){if(c)if(t===h)h=-1;gl.deleteProgram(t)},cc.gl.blendFunc=c?function(t,e){if(t!==d||e!==f)d=t,f=e,cc.gl.setBlending(t,e)}:cc.gl.setBlending,cc.gl.setBlending=function(t,e){var i=cc._renderContext;if(t===i.ONE&&e===i.ZERO)i.disable(i.BLEND);else i.enable(i.BLEND),cc._renderContext.blendFunc(t,e)},cc.gl.blendFuncForParticle=function(t,e){if(t!==d||e!==f){d=t,f=e;var i=cc._renderContext;if(t===i.ONE&&e===i.ZERO)i.disable(i.BLEND);else i.enable(i.BLEND),i.blendFuncSeparate(i.SRC_ALPHA,e,t,e)}},cc.gl.blendResetToCache=function(){var t=cc._renderContext;if(t.blendEquation(t.FUNC_ADD),c)cc.gl.setBlending(d,f);else cc.gl.setBlending(t.BLEND_SRC,t.BLEND_DST)},cc.gl.setProjectionMatrixDirty=function(){n=-1},cc.gl.enableVertexAttribs=function(t){var e=cc._renderContext,i=t&a.VERTEX_ATTRIB_FLAG_POSITION;if(i!==r){if(i)e.enableVertexAttribArray(a.VERTEX_ATTRIB_POSITION);else e.disableVertexAttribArray(a.VERTEX_ATTRIB_POSITION);r=i}var n=t&a.VERTEX_ATTRIB_FLAG_COLOR;if(n!==s){if(n)e.enableVertexAttribArray(a.VERTEX_ATTRIB_COLOR);else e.disableVertexAttribArray(a.VERTEX_ATTRIB_COLOR);s=n}var c=t&a.VERTEX_ATTRIB_FLAG_TEX_COORDS;if(c!==o){if(c)e.enableVertexAttribArray(a.VERTEX_ATTRIB_TEX_COORDS);else e.disableVertexAttribArray(a.VERTEX_ATTRIB_TEX_COORDS);o=c}},cc.gl.bindTexture2D=function(t){cc.gl.bindTexture2DN(0,t)},cc.gl.bindTexture2DN=c?function(t,e){if(u[t]!==e){u[t]=e;var i=cc._renderContext;if(i.activeTexture(i.TEXTURE0+t),e)i.bindTexture(i.TEXTURE_2D,e._webTextureObj);else i.bindTexture(i.TEXTURE_2D,null)}}:function(t,e){var i=cc._renderContext;if(i.activeTexture(i.TEXTURE0+t),e)i.bindTexture(i.TEXTURE_2D,e._webTextureObj);else i.bindTexture(i.TEXTURE_2D,null)},cc.gl.deleteTexture2D=function(t){cc.gl.deleteTexture2DN(0,t)},cc.gl.deleteTexture2DN=function(t,e){if(c)if(e===u[t])u[t]=-1;cc._renderContext.deleteTexture(e._webTextureObj)},cc.gl.bindVAO=function(t){if(a.TEXTURE_ATLAS_USE_VAO)if(c){if(p!==t)p=t}else;},cc.gl.enable=function(t){if(c);else;}},{}],159:[function(t,e,i){var n=cc.PresetShaders,r=cc.macro;cc.shaderCache={TYPE_POSITION_TEXTURECOLOR:0,TYPE_POSITION_TEXTURECOLOR_ALPHATEST:1,TYPE_POSITION_COLOR:2,TYPE_POSITION_TEXTURE:3,TYPE_POSITION_TEXTURE_UCOLOR:4,TYPE_POSITION_TEXTURE_A8COLOR:5,TYPE_POSITION_UCOLOR:6,TYPE_POSITION_LENGTH_TEXTURECOLOR:7,TYPE_MAX:8,_programs:{},_init:function(){return this.loadDefaultShaders(),!0},_loadDefaultShader:function(t,e){switch(e){case this.TYPE_POSITION_TEXTURECOLOR:t.initWithVertexShaderByteArray(n.POSITION_TEXTURE_COLOR_VERT,n.POSITION_TEXTURE_COLOR_FRAG),t.addAttribute(r.ATTRIBUTE_NAME_POSITION,r.VERTEX_ATTRIB_POSITION),t.addAttribute(r.ATTRIBUTE_NAME_COLOR,r.VERTEX_ATTRIB_COLOR),t.addAttribute(r.ATTRIBUTE_NAME_TEX_COORD,r.VERTEX_ATTRIB_TEX_COORDS);break;case this.TYPE_POSITION_TEXTURECOLOR_ALPHATEST:t.initWithVertexShaderByteArray(n.POSITION_TEXTURE_COLOR_VERT,n.POSITION_TEXTURE_COLOR_ALPHATEST_FRAG),t.addAttribute(r.ATTRIBUTE_NAME_POSITION,r.VERTEX_ATTRIB_POSITION),t.addAttribute(r.ATTRIBUTE_NAME_COLOR,r.VERTEX_ATTRIB_COLOR),t.addAttribute(r.ATTRIBUTE_NAME_TEX_COORD,r.VERTEX_ATTRIB_TEX_COORDS);break;case this.TYPE_POSITION_COLOR:t.initWithVertexShaderByteArray(n.POSITION_COLOR_VERT,n.POSITION_COLOR_FRAG),t.addAttribute(r.ATTRIBUTE_NAME_POSITION,r.VERTEX_ATTRIB_POSITION),t.addAttribute(r.ATTRIBUTE_NAME_COLOR,r.VERTEX_ATTRIB_COLOR);break;case this.TYPE_POSITION_TEXTURE:t.initWithVertexShaderByteArray(n.POSITION_TEXTURE_VERT,n.POSITION_TEXTURE_FRAG),t.addAttribute(r.ATTRIBUTE_NAME_POSITION,r.VERTEX_ATTRIB_POSITION),t.addAttribute(r.ATTRIBUTE_NAME_TEX_COORD,r.VERTEX_ATTRIB_TEX_COORDS);break;case this.TYPE_POSITION_TEXTURE_UCOLOR:t.initWithVertexShaderByteArray(n.POSITION_TEXTURE_UCOLOR_VERT,n.POSITION_TEXTURE_UCOLOR_FRAG),t.addAttribute(r.ATTRIBUTE_NAME_POSITION,r.VERTEX_ATTRIB_POSITION),t.addAttribute(r.ATTRIBUTE_NAME_TEX_COORD,r.VERTEX_ATTRIB_TEX_COORDS);break;case this.TYPE_POSITION_TEXTURE_A8COLOR:t.initWithVertexShaderByteArray(n.POSITION_TEXTURE_A8COLOR_VERT,n.POSITION_TEXTURE_A8COLOR_FRAG),t.addAttribute(r.ATTRIBUTE_NAME_POSITION,r.VERTEX_ATTRIB_POSITION),t.addAttribute(r.ATTRIBUTE_NAME_COLOR,r.VERTEX_ATTRIB_COLOR),t.addAttribute(r.ATTRIBUTE_NAME_TEX_COORD,r.VERTEX_ATTRIB_TEX_COORDS);break;case this.TYPE_POSITION_UCOLOR:t.initWithVertexShaderByteArray(n.POSITION_UCOLOR_VERT,n.POSITION_UCOLOR_FRAG),t.addAttribute("aVertex",r.VERTEX_ATTRIB_POSITION);break;case this.TYPE_POSITION_LENGTH_TEXTURECOLOR:t.initWithVertexShaderByteArray(n.POSITION_COLOR_LENGTH_TEXTURE_VERT,n.POSITION_COLOR_LENGTH_TEXTURE_FRAG),t.addAttribute(r.ATTRIBUTE_NAME_POSITION,r.VERTEX_ATTRIB_POSITION),t.addAttribute(r.ATTRIBUTE_NAME_TEX_COORD,r.VERTEX_ATTRIB_TEX_COORDS),t.addAttribute(r.ATTRIBUTE_NAME_COLOR,r.VERTEX_ATTRIB_COLOR);break;default:return void cc.log("cocos2d: cc.shaderCache._loadDefaultShader, error shader type")}t.link(),t.updateUniforms()},loadDefaultShaders:function(){var t=new cc.GLProgram;this._loadDefaultShader(t,this.TYPE_POSITION_TEXTURECOLOR),this._programs[r.SHADER_POSITION_TEXTURECOLOR]=t,this._programs.ShaderPositionTextureColor=t,t=new cc.GLProgram,this._loadDefaultShader(t,this.TYPE_POSITION_TEXTURECOLOR_ALPHATEST),this._programs[r.SHADER_POSITION_TEXTURECOLORALPHATEST]=t,this._programs.ShaderPositionTextureColorAlphaTest=t,t=new cc.GLProgram,this._loadDefaultShader(t,this.TYPE_POSITION_COLOR),this._programs[r.SHADER_POSITION_COLOR]=t,this._programs.ShaderPositionColor=t,t=new cc.GLProgram,this._loadDefaultShader(t,this.TYPE_POSITION_TEXTURE),this._programs[r.SHADER_POSITION_TEXTURE]=t,this._programs.ShaderPositionTexture=t,t=new cc.GLProgram,this._loadDefaultShader(t,this.TYPE_POSITION_TEXTURE_UCOLOR),this._programs[r.SHADER_POSITION_TEXTURE_UCOLOR]=t,this._programs.ShaderPositionTextureUColor=t,t=new cc.GLProgram,this._loadDefaultShader(t,this.TYPE_POSITION_TEXTURE_A8COLOR),this._programs[r.SHADER_POSITION_TEXTUREA8COLOR]=t,this._programs.ShaderPositionTextureA8Color=t,t=new cc.GLProgram,this._loadDefaultShader(t,this.TYPE_POSITION_UCOLOR),this._programs[r.SHADER_POSITION_UCOLOR]=t,this._programs.ShaderPositionUColor=t,t=new cc.GLProgram,this._loadDefaultShader(t,this.TYPE_POSITION_LENGTH_TEXTURECOLOR),this._programs[r.SHADER_POSITION_LENGTHTEXTURECOLOR]=t,this._programs.ShaderPositionLengthTextureColor=t},reloadDefaultShaders:function(){var t=this.programForKey(r.SHADER_POSITION_TEXTURECOLOR);t.reset(),this._loadDefaultShader(t,this.TYPE_POSITION_TEXTURECOLOR),t=this.programForKey(r.SHADER_POSITION_TEXTURECOLORALPHATEST),t.reset(),this._loadDefaultShader(t,this.TYPE_POSITION_TEXTURECOLOR_ALPHATEST),t=this.programForKey(r.SHADER_POSITION_COLOR),t.reset(),this._loadDefaultShader(t,this.TYPE_POSITION_COLOR),t=this.programForKey(r.SHADER_POSITION_TEXTURE),t.reset(),this._loadDefaultShader(t,this.TYPE_POSITION_TEXTURE),t=this.programForKey(r.SHADER_POSITION_TEXTURE_UCOLOR),t.reset(),this._loadDefaultShader(t,this.TYPE_POSITION_TEXTURE_UCOLOR),t=this.programForKey(r.SHADER_POSITION_TEXTUREA8COLOR),t.reset(),this._loadDefaultShader(t,this.TYPE_POSITION_TEXTURE_A8COLOR),t=this.programForKey(r.SHADER_POSITION_UCOLOR),t.reset(),this._loadDefaultShader(t,this.TYPE_POSITION_UCOLOR)},programForKey:function(t){return this._programs[t]},getProgram:function(t){return this._programs[t]},addProgram:function(t,e){this._programs[e]=t}}},{}],160:[function(t,e,i){cc.PresetShaders={POSITION_UCOLOR_FRAG:"precision lowp float;\nvarying vec4 v_fragmentColor;\nvoid main()                              \n{ \n    gl_FragColor = v_fragmentColor;      \n}\n",POSITION_UCOLOR_VERT:"attribute vec4 a_position;\nuniform    vec4 u_color;\nuniform float u_pointSize;\nvarying lowp vec4 v_fragmentColor; \nvoid main(void)   \n{\n    gl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;  \n    gl_PointSize = u_pointSize;          \n    v_fragmentColor = u_color;           \n}",POSITION_COLOR_FRAG:"precision lowp float; \nvarying vec4 v_fragmentColor; \nvoid main() \n{ \n     gl_FragColor = v_fragmentColor; \n} ",POSITION_COLOR_VERT:"attribute vec4 a_position;\nattribute vec4 a_color;\nvarying lowp vec4 v_fragmentColor;\nvoid main()\n{\n    gl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;  \n    v_fragmentColor = a_color;             \n}",POSITION_COLOR_LENGTH_TEXTURE_FRAG:"// #extension GL_OES_standard_derivatives : enable\nvarying mediump vec4 v_color;\nvarying mediump vec2 v_texcoord;\nvoid main()	\n{ \n// #if defined GL_OES_standard_derivatives	\n// gl_FragColor = v_color*smoothstep(0.0, length(fwidth(v_texcoord)), 1.0 - length(v_texcoord)); \n// #else	\ngl_FragColor = v_color * step(0.0, 1.0 - length(v_texcoord)); \n// #endif \n}",POSITION_COLOR_LENGTH_TEXTURE_VERT:"attribute mediump vec4 a_position; \nattribute mediump vec2 a_texcoord; \nattribute mediump vec4 a_color;	\nvarying mediump vec4 v_color; \nvarying mediump vec2 v_texcoord;	\nvoid main() \n{ \n     v_color = a_color;//vec4(a_color.rgb * a_color.a, a_color.a); \n     v_texcoord = a_texcoord; \n    gl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;  \n}",POSITION_TEXTURE_FRAG:"precision lowp float;   \nvarying vec2 v_texCoord;  \nvoid main() \n{  \n    gl_FragColor =  texture2D(CC_Texture0, v_texCoord);   \n}",POSITION_TEXTURE_VERT:"attribute vec4 a_position; \nattribute vec2 a_texCoord; \nvarying mediump vec2 v_texCoord; \nvoid main() \n{ \n    gl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;  \n    v_texCoord = a_texCoord;               \n}",POSITION_TEXTURE_UCOLOR_FRAG:"precision lowp float;  \nuniform vec4 u_color; \nvarying vec2 v_texCoord; \nvoid main() \n{  \n    gl_FragColor =  texture2D(CC_Texture0, v_texCoord) * u_color;    \n}",POSITION_TEXTURE_UCOLOR_VERT:"attribute vec4 a_position;\nattribute vec2 a_texCoord; \nvarying mediump vec2 v_texCoord; \nvoid main() \n{ \n    gl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;  \n    v_texCoord = a_texCoord;                 \n}",POSITION_TEXTURE_A8COLOR_FRAG:"precision lowp float;  \nvarying vec4 v_fragmentColor; \nvarying vec2 v_texCoord; \nvoid main() \n{ \n    gl_FragColor = vec4( v_fragmentColor.rgb,         \n        v_fragmentColor.a * texture2D(CC_Texture0, v_texCoord).a   \n    ); \n}",POSITION_TEXTURE_A8COLOR_VERT:"attribute vec4 a_position; \nattribute vec2 a_texCoord; \nattribute vec4 a_color;  \nvarying lowp vec4 v_fragmentColor; \nvarying mediump vec2 v_texCoord; \nvoid main() \n{ \n    gl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;  \n    v_fragmentColor = a_color; \n    v_texCoord = a_texCoord; \n}",POSITION_TEXTURE_COLOR_FRAG:"precision lowp float;\nvarying vec4 v_fragmentColor; \nvarying vec2 v_texCoord; \nvoid main() \n{ \n    gl_FragColor = v_fragmentColor * texture2D(CC_Texture0, v_texCoord); \n}",POSITION_TEXTURE_COLOR_VERT:"attribute vec4 a_position; \nattribute vec2 a_texCoord; \nattribute vec4 a_color;  \nvarying lowp vec4 v_fragmentColor; \nvarying mediump vec2 v_texCoord; \nvoid main() \n{ \n    gl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;  \n    v_fragmentColor = a_color; \n    v_texCoord = a_texCoord; \n}",POSITION_TEXTURE_COLOR_ALPHATEST_FRAG:"precision lowp float;   \nvarying vec4 v_fragmentColor; \nvarying vec2 v_texCoord;   \nuniform float CC_alpha_value; \nvoid main() \n{  \n    vec4 texColor = texture2D(CC_Texture0, v_texCoord);  \n    if ( texColor.a <= CC_alpha_value )          \n        discard; \n    gl_FragColor = texColor * v_fragmentColor;  \n}",EX_SWITCHMASK_FRAG:"precision lowp float; \nvarying vec4 v_fragmentColor; \nvarying vec2 v_texCoord; \nuniform sampler2D u_texture;  \nuniform sampler2D   u_mask;   \nvoid main()  \n{  \n    vec4 texColor   = texture2D(u_texture, v_texCoord);  \n    vec4 maskColor  = texture2D(u_mask, v_texCoord); \n    vec4 finalColor = vec4(texColor.r, texColor.g, texColor.b, maskColor.a * texColor.a);        \n    gl_FragColor    = v_fragmentColor * finalColor; \n}"}},{}],161:[function(t,e,i){t("./CCShaders"),t("./CCShaderCache"),t("./CCGLProgram"),t("./CCGLStateCache")},{"./CCGLProgram":157,"./CCGLStateCache":158,"./CCShaderCache":159,"./CCShaders":160}],162:[function(t,e,i){var n=cc.Class({name:"cc.TiledLayer","extends":cc._SGComponent,onEnable:function(){if(this._sgNode)this._sgNode.setVisible(!0)},onDisable:function(){if(this._sgNode)this._sgNode.setVisible(!1)},_initSgNode:function(){var t=this._sgNode;if(t){if(!this.enabledInHierarchy)t.setVisible(!1);if(!this.node._sizeProvider)this.node._sizeProvider=t;var e=this.node;t.setAnchorPoint(e.getAnchorPoint())}},_replaceSgNode:function(t){if(t!==this._sgNode){if(this._removeSgNode(),this.node._sizeProvider===this._sgNode)this.node._sizeProvider=null;if(t&&t instanceof _ccsg.TMXLayer)this._sgNode=t,this._sgNode.retain(),this._initSgNode();else this._sgNode=null}},getLayerName:function(){if(this._sgNode)return this._sgNode.getLayerName();else return""},setLayerName:function(t){if(this._sgNode)this._sgNode.setLayerName(t)},getProperty:function(t){if(this._sgNode)return this._sgNode.getProperty(t);else return null},getPositionAt:function(t,e){if(this._sgNode){if(void 0!==e)t=cc.p(t,e);return this._sgNode.getPositionAt(t)}return null},removeTileAt:function(t,e){if(this._sgNode){if(void 0!==e)t=cc.p(t,e);this._sgNode.removeTileAt(t)}},setTileGID:function(t,e,i,n){if(this._sgNode){if(!e)throw new Error("_ccsg.TMXLayer.setTileGID(): pos should be non-null");var r;if(void 0!==n)r=cc.p(e,i);else r=e,n=i;this._sgNode.setTileGID(t,r,n)}},getTileGIDAt:function(t,e){if(this._sgNode){if(void 0!==e)t=cc.p(t,e);return this._sgNode.getTileGIDAt(t)}return 0},getTileAt:function(t,e){if(this._sgNode){if(void 0!==e)t=cc.p(t,e);return this._sgNode.getTileAt(t)}return null},releaseMap:function(){if(this._sgNode)this._sgNode.releaseMap()},setContentSize:function(t,e){if(this._sgNode){if(void 0!==e)t=cc.size(t,e);this._sgNode.setContentSize(t)}},getTexture:function(){if(this._sgNode)return this._sgNode.getTexture();else return null},setTexture:function(t){if(this._sgNode)this._sgNode.setTexture(t)},getLayerSize:function(){if(this._sgNode)return this._sgNode.getLayerSize();else return cc.size(0,0)},setLayerSize:function(t){if(this._sgNode)this._sgNode.setLayerSize(t)},getMapTileSize:function(){if(this._sgNode)return this._sgNode.getMapTileSize();else return cc.size(0,0)},setMapTileSize:function(t){if(this._sgNode)this._sgNode.setMapTileSize(t)},getTiles:function(){if(this._sgNode)return this._sgNode.getTiles();else return null},setTiles:function(t){if(this._sgNode)this._sgNode.setTiles(t)},getTileset:function(){if(this._sgNode)return this._sgNode.getTileset();else return null},setTileset:function(t){if(this._sgNode)this._sgNode.setTileset(t)},getLayerOrientation:function(){if(this._sgNode)return this._sgNode.getLayerOrientation();else return 0},setLayerOrientation:function(t){if(this._sgNode)this._sgNode.setLayerOrientation(t)},getProperties:function(){if(this._sgNode)return this._sgNode.getProperties();else return null},setProperties:function(t){if(this._sgNode)this._sgNode.setProperties(t)}});cc.TiledLayer=e.exports=n},{}],163:[function(t,e,i){var n=cc.Enum({ORTHO:0,HEX:1,ISO:2}),r=cc.Enum({NONE:0,MAP:1,LAYER:2,OBJECTGROUP:3,OBJECT:4,TILE:5}),s=cc.Enum({HORIZONTAL:2147483648,VERTICAL:1073741824,DIAGONAL:536870912,FLIPPED_ALL:3758096384,FLIPPED_MASK:536870911}),o=cc.Class({name:"cc.TiledMap","extends":cc._RendererInSG,editor:!1,statics:{Orientation:n,Property:r,TileFlag:s},properties:{_isLoading:{"default":!1,serializable:!1},_detachedLayers:{"default":[],serializable:!1},_tmxFile:{"default":"",url:cc.TiledMapAsset},tmxFile:{get:function(){return this._tmxFile},set:function(t,e){if(this._tmxFile!==t)this._tmxFile=t,this._applyFile()},url:cc.TiledMapAsset},mapLoaded:{"default":[],type:cc.Component.EventHandler}},getMapSize:function(){return this._sgNode.getMapSize()},setMapSize:function(t){this._sgNode.setMapSize(t)},getTileSize:function(){return this._sgNode.getTileSize()},setTileSize:function(t){this._sgNode.setTileSize(t)},getMapOrientation:function(){return this._sgNode.getMapOrientation()},setMapOrientation:function(t){this._sgNode.setMapOrientation(t)},getObjectGroups:function(){return this._sgNode.getObjectGroups()},setObjectGroups:function(t){this._sgNode.setObjectGroups(t)},getProperties:function(){return this._sgNode.getProperties()},setProperties:function(t){this._sgNode.setProperties(t)},initWithTMXFile:function(t){this._tmxFile=t},initWithXML:function(t,e){this._tmxFile=null;var i=this,n=i._sgNode,r=new cc.TMXMapInfo(t,e);if(!r)return void i._onMapLoaded(new Error("Parse map info failed."));if(i._isLoading=!0,cc.sys.isNative)setTimeout(function(){n.initWithXML(t,e),i._onMapLoaded()},0);else this._preloadTextures(r,function(r,s){if(!r)n.initWithXML(t,e);i._onMapLoaded(r)})},allLayers:function(){for(var t=this.node.children,e=[],i=0,n=t.length;n>i;i++){var r=t[i],s=r.getComponent(cc.TiledLayer);if(s)e.push(s)}return e},getLayer:function(t){for(var e=this.node.children,i=0,n=e.length;n>i;i++){var r=e[i],s=r.getComponent(cc.TiledLayer);if(s&&s.getLayerName()===t)return s}return null},getObjectGroup:function(t){return this._sgNode.getObjectGroup(t)},getProperty:function(t){return this._sgNode.getProperty(t)},getPropertiesForGID:function(t){return this._sgNode.getPropertiesForGID(t)},onEnable:function(){if(this._super(),this._tmxFile&&!this._isLoading)this._refreshLayerEntities();this.node.on("anchor-changed",this._anchorChanged,this),this.node.on("child-added",this._childAdded,this),this.node.on("child-reorder",this._reorderChildren,this)},onDisable:function(){this._super();for(var t=this.node.getChildren(),e=t.length-1;e>=0;e--){var i=t[e],n=i.getComponent(cc.TiledLayer);if(n)n.enabled=!1}var r=this._plainNode;this._moveLayersInSgNode(r),this.node.off("anchor-changed",this._anchorChanged,this),this.node.off("child-added",this._childAdded,this),this.node.off("child-reorder",this._reorderChildren,this)},onDestroy:function(){this._super(),this._removeLayerEntities()},_createSgNode:function(){return new _ccsg.TMXTiledMap},_initSgNode:function(){this._applyFile()},_preloadTextures:function(t,e){
var i=t.getTilesets();if(i){var n=i.map(function(t){return t.sourceImage});cc.loader.load(n,function(t){e(t,n)})}else if(e)e()},_preloadTmx:function(t,e){var i=this;cc.loader.load(t,function(n){if(!n){var r=new cc.TMXMapInfo(t);if(!r)return void e(new Error("Parse map info failed."));else return void i._preloadTextures(r,e)}else if(e)e(n||new Error("Preload TMX failed: unknown error"))})},_onMapLoaded:function(t){if(this._isLoading=!1,!t)if(this._enabled)this._refreshLayerEntities(),this._anchorChanged();else this._moveLayersInSgNode(this._sgNode);if(1)cc.Component.EventHandler.emitEvents(this.mapLoaded,t)},_moveLayersInSgNode:function(t){this._detachedLayers.length=0;for(var e=t.getChildren(),i=e.length-1;i>=0;i--){var n=e[i];if(n instanceof _ccsg.TMXLayer){t.removeChild(n);var r=n.getLocalZOrder();this._detachedLayers.push({sgNode:n,zorder:r})}}},_removeLayerEntities:function(){for(var t=this.node.getChildren(),e=t.length-1;e>=0;e--){var i=t[e];if(i.isValid){var n=i.getComponent(cc.TiledLayer);if(n)if(i.removeComponent(cc.TiledLayer),!1)if(1===i._components.length&&0===i.getChildren().length)this.node.removeChild(i)}else;}},_refreshLayerEntities:function(){var t,e,i=this.node.getChildren(),n=[],r=[],s=[];for(t=0;t<this._detachedLayers.length;t++){var o=this._detachedLayers[t];this._sgNode.addChild(o.sgNode,o.zorder,o.zorder)}this._detachedLayers.length=0;var a=this._sgNode.allLayers().map(function(t){return t.getLayerName()});for(t=0,e=i.length;e>t;t++){var c=i[t],l=c.getComponent(cc.TiledLayer);if(l){var h=l.getLayerName();if(!h)h=c._name;if(a.indexOf(h)<0){if(1===c._components.length)n.push(c)}else{r.push(c);var u=this._sgNode.getLayer(h);l._replaceSgNode(u),l.enabled=!0}}else s.push({child:c,index:c.getSiblingIndex()})}for(t=0,e=n.length;e>t;t++)this.node.removeChild(n[t]);var d=r.map(function(t){var e=t.getComponent(cc.TiledLayer);return e.getLayerName()});for(t=0,e=a.length;e>t;t++){var f=a[t],_=this._sgNode.getLayer(f),p=d.indexOf(f);if(0>p){var g=this.node.getChildByName(f),m=null;if(g&&!g.getComponent(cc._SGComponent))m=g.addComponent(cc.TiledLayer);else g=new cc.Node(f),this.node.addChild(g),m=g.addComponent(cc.TiledLayer);if(!g||!m)cc.error("Add component TiledLayer into node failed.");m._replaceSgNode(_),g.setSiblingIndex(_.getLocalZOrder()),g.setAnchorPoint(this.node.getAnchorPoint())}else r[p].setSiblingIndex(_.getLocalZOrder())}for(t=0,e=s.length;e>t;t++){var o=s[t];o.child.setSiblingIndex(o.index)}this._reorderChildren()},_anchorChanged:function(){for(var t=this.node.children,e=this.node.getAnchorPoint(),i=0,n=t.length;n>i;i++){var r=t[i],s=r.getComponent(cc.TiledLayer);if(s)r.setAnchorPoint(e)}},_childAdded:function(t){var e=t.detail;if(e){var i=e.getComponent(cc.TiledLayer);if(!i){var n=this.node.getChildrenCount();if(e.setSiblingIndex(n),e._sgNode)e._sgNode.setLocalZOrder(n)}}},_reorderChildren:function(){for(var t=this.node.children,e=0,i=t.length;i>e;e++){var n=t[e],r=n.getComponent(cc.TiledLayer),s=n.getSiblingIndex();if(r){if(r._sgNode)r._sgNode.setLocalZOrder(s)}else if(n._sgNode)n._sgNode.setLocalZOrder(s)}},_applyFile:function(){var t=this._sgNode,e=this._tmxFile,i=this;if(e)if(i._isLoading=!0,cc.sys.isNative)setTimeout(function(){if(t.initWithTMXFile(e))i._onMapLoaded();else i._onMapLoaded(new Error("Parse map info failed."))},0);else this._preloadTmx(e,function(n,r){if(!n)t.initWithTMXFile(e);i._onMapLoaded(n)});else{for(var n=t.allLayers(),r=0,s=n.length;s>r;r++)t.removeChild(n[r]);if(i._enabled)i._removeLayerEntities()}}});cc.TiledMap=e.exports=o},{}],164:[function(t,e,i){var n=cc.Class({name:"cc.TiledMapAsset","extends":cc.RawAsset});cc.TiledMapAsset=n,e.exports=n},{}],165:[function(t,e,i){if(t("./cocos2d/core"),t("./cocos2d/animation"),t("./cocos2d/particle/CCParticleAsset"),!0)t("./cocos2d/particle/CCParticleSystem");if(t("./cocos2d/tilemap/CCTiledMapAsset"),!0)t("./cocos2d/tilemap/CCTiledMap"),t("./cocos2d/tilemap/CCTiledLayer");if(t("./extensions/spine"),!0){if(1)t("./cocos2d/actions"),t("./external/chipmunk/chipmunk.js");t("./extensions/ccpool/CCPool.js")}},{"./cocos2d/actions":8,"./cocos2d/animation":18,"./cocos2d/core":77,"./cocos2d/particle/CCParticleAsset":154,"./cocos2d/particle/CCParticleSystem":155,"./cocos2d/tilemap/CCTiledLayer":162,"./cocos2d/tilemap/CCTiledMap":163,"./cocos2d/tilemap/CCTiledMapAsset":164,"./extensions/ccpool/CCPool.js":166,"./extensions/spine":173,"./external/chipmunk/chipmunk.js":175}],166:[function(t,e,i){cc.pool={_pool:{},_releaseCB:function(){this.release()},_autoRelease:function(t){var e=void 0===t._running?!1:!t._running;cc.director.getScheduler().schedule(this._releaseCB,t,0,0,0,e)},putInPool:function(t){var e=cc.js._getClassId(t.constructor);if(e){if(!this._pool[e])this._pool[e]=[];t.retain&&t.retain(),t.unuse&&t.unuse(),this._pool[e].push(t)}},hasObject:function(t){var e=cc.js._getClassId(t),i=this._pool[e];if(!i||0===i.length)return!1;else return!0},removeObject:function(t){var e=cc.js._getClassId(t.constructor);if(e){var i=this._pool[e];if(i)for(var n=0;n<i.length;n++)if(t===i[n])t.release&&t.release(),i.splice(n,1)}},getFromPool:function(t){if(this.hasObject(t)){var e=cc.js._getClassId(t),i=this._pool[e],n=Array.prototype.slice.call(arguments);n.shift();var r=i.pop();return r.reuse&&r.reuse.apply(r,n),cc.sys.isNative&&r.release&&this._autoRelease(r),r}},drainAllPools:function(){for(var t in this._pool)for(var e=0;e<this._pool[t].length;e++){var i=this._pool[t][e];i.release&&i.release()}this._pool={}}}},{}],167:[function(t,e,i){var n=sp.spine;sp._SGSkeleton=_ccsg.Node.extend({_skeleton:null,_rootBone:null,_timeScale:1,_debugSlots:!1,_debugBones:!1,_premultipliedAlpha:!1,_ownsSkeletonData:null,_atlas:null,_blendFunc:null,ctor:function(t,e,i){if(_ccsg.Node.prototype.ctor.call(this),this._blendFunc={src:cc.macro.BLEND_SRC,dst:cc.macro.BLEND_DST},0===arguments.length)this.init();else this.initWithArgs(t,e,i)},_createRenderCmd:function(){if(cc._renderType===cc.game.RENDER_TYPE_CANVAS)return new sp._SGSkeleton.CanvasRenderCmd(this);else return new sp._SGSkeleton.WebGLRenderCmd(this)},init:function(){_ccsg.Node.prototype.init.call(this),this._blendFunc.src=cc.macro.ONE,this._blendFunc.dst=cc.macro.ONE_MINUS_SRC_ALPHA,this.scheduleUpdate()},setDebugSlotsEnabled:function(t){this._debugSlots=t},getDebugSlotsEnabled:function(){return this._debugSlots},setDebugBonesEnabled:function(t){this._debugBones=t},getDebugBonesEnabled:function(){return this._debugBones},setTimeScale:function(t){this._timeScale=t},getTimeScale:function(){return this._timeScale},initWithArgs:function(t,e,i){var r,s,o,a=t,c=e;if(cc.js.isString(a)){if(cc.js.isString(c)){var l=cc.loader.getRes(c);sp._atlasLoader.setAtlasFile(c),s=new n.Atlas(l,sp._atlasLoader)}else s=e;i=i||1/cc.director.getContentScaleFactor();var h=new n.AtlasAttachmentLoader(s),u=new n.SkeletonJson(h);u.scale=i;var d=cc.loader.getRes(a);r=u.readSkeletonData(d),s.dispose(u),o=!0}else r=t,o=e;this.setSkeletonData(r,o),this.init()},getBoundingBox:function(){for(var t=cc.macro.FLT_MAX,e=cc.macro.FLT_MAX,i=cc.macro.FLT_MIN,n=cc.macro.FLT_MIN,r=this.getScaleX(),s=this.getScaleY(),o=[],a=this._skeleton.slots,c=sp.VERTEX_INDEX,l=0,h=a.length;h>l;++l){var u=a[l],d=u.attachment;if(d&&d.type==sp.ATTACHMENT_TYPE.REGION)this._computeRegionAttachmentWorldVertices(d,u.bone.skeleton.x,u.bone.skeleton.y,u.bone,o),t=Math.min(t,o[c.X1]*r,o[c.X4]*r,o[c.X2]*r,o[c.X3]*r),e=Math.min(e,o[c.Y1]*s,o[c.Y4]*s,o[c.Y2]*s,o[c.Y3]*s),i=Math.max(i,o[c.X1]*r,o[c.X4]*r,o[c.X2]*r,o[c.X3]*r),n=Math.max(n,o[c.Y1]*s,o[c.Y4]*s,o[c.Y2]*s,o[c.Y3]*s);else;}var f=this.getPosition();return cc.rect(f.x+t,f.y+e,i-t,n-e)},_computeRegionAttachmentWorldVertices:function(t,e,i,n,r){var s=t.offset,o=sp.VERTEX_INDEX;e+=n.worldX,i+=n.worldY,r[o.X1]=s[o.X1]*n.m00+s[o.Y1]*n.m01+e,r[o.Y1]=s[o.X1]*n.m10+s[o.Y1]*n.m11+i,r[o.X2]=s[o.X2]*n.m00+s[o.Y2]*n.m01+e,r[o.Y2]=s[o.X2]*n.m10+s[o.Y2]*n.m11+i,r[o.X3]=s[o.X3]*n.m00+s[o.Y3]*n.m01+e,r[o.Y3]=s[o.X3]*n.m10+s[o.Y3]*n.m11+i,r[o.X4]=s[o.X4]*n.m00+s[o.Y4]*n.m01+e,r[o.Y4]=s[o.X4]*n.m10+s[o.Y4]*n.m11+i},updateWorldTransform:function(){this._skeleton.updateWorldTransform()},setToSetupPose:function(){this._skeleton.setToSetupPose()},setBonesToSetupPose:function(){this._skeleton.setBonesToSetupPose()},setSlotsToSetupPose:function(){this._skeleton.setSlotsToSetupPose()},findBone:function(t){return this._skeleton.findBone(t)},findSlot:function(t){return this._skeleton.findSlot(t)},setSkin:function(t){return this._skeleton.setSkinByName(t)},getAttachment:function(t,e){return this._skeleton.getAttachmentBySlotName(t,e)},setAttachment:function(t,e){this._skeleton.setAttachment(t,e)},setOpacityModifyRGB:function(t){this._premultipliedAlpha=t},isOpacityModifyRGB:function(){return this._premultipliedAlpha},setSkeletonData:function(t,e){if(null!=t.width&&null!=t.height)this.setContentSize(t.width/cc.director.getContentScaleFactor(),t.height/cc.director.getContentScaleFactor());this._skeleton=new n.Skeleton(t),this._skeleton.updateWorldTransform(),this._rootBone=this._skeleton.getRootBone(),this._ownsSkeletonData=e,this._renderCmd._createChildFormSkeletonData()},getTextureAtlas:function(t){return t.rendererObject.page.rendererObject},getBlendFunc:function(){return this._blendFunc},setBlendFunc:function(t,e){var i=this._blendFunc;if(void 0===e)i.src=t.src,i.dst=t.dst;else i.src=t,i.dst=e},update:function(t){this._skeleton.update(t)}})},{}],168:[function(t,e,i){var n=sp.spine,r=sp.AnimationEventType;sp._atlasPage_createTexture_webGL=function(t,e){var i=cc.textureCache.addImage(e);t.rendererObject=new cc.TextureAtlas(i,128),t.width=i.getPixelWidth(),t.height=i.getPixelHeight()},sp._atlasPage_createTexture_canvas=function(t,e){t._texture=cc.textureCache.addImage(e)},sp._atlasPage_disposeTexture=function(t){t.rendererObject.release()},sp._atlasLoader={spAtlasFile:null,setAtlasFile:function(t){this.spAtlasFile=t},load:function(t,e,i){var n=cc.path.join(cc.path.dirname(this.spAtlasFile),e);if(cc._renderType===cc.game.RENDER_TYPE_WEBGL)sp._atlasPage_createTexture_webGL(t,n);else sp._atlasPage_createTexture_canvas(t,n)},unload:function(t){}},sp.TrackEntryListeners=function(t,e,i,n){this.startListener=t||null,this.endListener=e||null,this.completeListener=i||null,this.eventListener=n||null},sp.TrackEntryListeners.getListeners=function(t){if(!t.rendererObject)t.rendererObject=new sp.TrackEntryListeners,t.listener=sp.trackEntryCallback;return t.rendererObject},sp.trackEntryCallback=function(t,e,i,n,r){t.rendererObject.onTrackEntryEvent(e,i,n,r)},sp._SGSkeletonAnimation=sp._SGSkeleton.extend({_state:null,_target:null,_callback:null,_ownsAnimationStateData:!1,_startListener:null,_endListener:null,_completeListener:null,_eventListener:null,init:function(){sp._SGSkeleton.prototype.init.call(this),this._ownsAnimationStateData=!0,this.setAnimationStateData(new n.AnimationStateData(this._skeleton.data))},setAnimationStateData:function(t){var e=new n.AnimationState(t);e.rendererObject=this,e.onStart=this._onAnimationStateStart.bind(this),e.onComplete=this._onAnimationStateComplete.bind(this),e.onEnd=this._onAnimationStateEnd.bind(this),e.onEvent=this._onAnimationStateEvent.bind(this),this._state=e},setMix:function(t,e,i){this._state.data.setMixByName(t,e,i)},setAnimationListener:function(t,e){this._target=t,this._callback=e},setAnimation:function(t,e,i){var n=this._skeleton.data.findAnimation(e);if(!n)return cc.log("Spine: Animation not found: "+e),null;else return this._state.setAnimation(t,n,i)},addAnimation:function(t,e,i,n){n=null==n?0:n;var r=this._skeleton.data.findAnimation(e);if(!r)return cc.log("Spine: Animation not found:"+e),null;else return this._state.addAnimation(t,r,i,n)},getCurrent:function(t){return this._state.getCurrent(t)},clearTracks:function(){this._state.clearTracks()},clearTrack:function(t){this._state.clearTrack(t)},update:function(t){this._super(t),t*=this._timeScale,this._state.update(t),this._state.apply(this._skeleton),this._skeleton.updateWorldTransform(),this._renderCmd._updateChild()},setStartListener:function(t){this._startListener=t},setEndListener:function(t){this._endListener=t},setCompleteListener:function(t){this._completeListener=t},setEventListener:function(t){this._eventListener=t},setTrackStartListener:function(t,e){sp.TrackEntryListeners.getListeners(t).startListener=e},setTrackEndListener:function(t,e){sp.TrackEntryListeners.getListeners(t).endListener=e},setTrackCompleteListener:function(t,e){sp.TrackEntryListeners.getListeners(t).completeListener=e},setTrackEventListener:function(t,e){sp.TrackEntryListeners.getListeners(t).eventListener=e},onTrackEntryEvent:function(t,e,i,n){var s=this._state.getCurrent(t);if(s.rendererObject){var o=s.rendererObject;switch(e){case r.START:if(o.startListener)o.startListener(t);break;case r.END:if(o.endListener)o.endListener(t);break;case r.COMPLETE:if(o.completeListener)o.completeListener(t,n);break;case r.EVENT:if(o.eventListener)o.eventListener(t,i)}}},onAnimationStateEvent:function(t,e,i,n){switch(e){case r.START:if(this._startListener)this._startListener(t);break;case r.END:if(this._endListener)this._endListener(t);break;case r.COMPLETE:if(this._completeListener)this._completeListener(t,n);break;case r.EVENT:if(this._eventListener)this._eventListener(t,i)}},getState:function(){return this._state},_onAnimationStateStart:function(t){this._animationStateCallback(t,r.START,null,0)},_onAnimationStateEnd:function(t){this._animationStateCallback(t,r.END,null,0)},_onAnimationStateComplete:function(t,e){this._animationStateCallback(t,r.COMPLETE,null,e)},_onAnimationStateEvent:function(t,e){this._animationStateCallback(t,r.EVENT,e,0)},_animationStateCallback:function(t,e,i,n){if(this.onAnimationStateEvent(t,e,i,n),this._target&&this._callback)this._callback.call(this._target,this,t,e,i,n)}})},{}],169:[function(t,e,i){var n=sp.spine;sp._SGSkeleton.CanvasRenderCmd=function(t){_ccsg.Node.CanvasRenderCmd.call(this,t),this._needDraw=!0};var r=sp._SGSkeleton.CanvasRenderCmd.prototype=Object.create(_ccsg.Node.CanvasRenderCmd.prototype);r.constructor=sp._SGSkeleton.CanvasRenderCmd,r.rendering=function(t,e,i){var n,r,s,o,a=this._node;t=t||cc._renderContext;var c=a._skeleton,l=c.drawOrder;for(n=0,r=l.length;r>n;n++)if(s=l[n],o=s._slotNode,o._visible&&o._renderCmd&&s.currentSprite)o._renderCmd.transform(this,!0),s.currentSprite._renderCmd.rendering(t,e,i),o._renderCmd._dirtyFlag=s.currentSprite._renderCmd._dirtyFlag=0;if(a._debugSlots||a._debugBones){t.setTransform(this._worldTransform,e,i),t.setGlobalAlpha(1);var h,u=cc._drawingUtil;if(a._debugSlots){u.setDrawColor(0,0,255,255),u.setLineWidth(1);var d=[];for(n=0,r=c.slots.length;r>n;n++)if(s=c.drawOrder[n],s.attachment&&s.attachment.type==sp.ATTACHMENT_TYPE.REGION)h=s.attachment,this._updateRegionAttachmentSlot(h,s,d),u.drawPoly(d,4,!0);else;}if(a._debugBones){var f;for(u.setLineWidth(2),u.setDrawColor(255,0,0,255),n=0,r=c.bones.length;r>n;n++){f=c.bones[n];var _=f.data.length*f.m00+f.worldX,p=f.data.length*f.m10+f.worldY;u.drawLine({x:f.worldX,y:f.worldY},{x:_,y:p})}for(u.setPointSize(4),u.setDrawColor(0,0,255,255),n=0,r=c.bones.length;r>n;n++)if(f=c.bones[n],u.drawPoint({x:f.worldX,y:f.worldY}),0===n)u.setDrawColor(0,255,0,255)}}},r._updateRegionAttachmentSlot=function(t,e,i){if(i){var n={},r=sp.VERTEX_INDEX,s=e.bone;t.computeVertices(s.skeleton.x,s.skeleton.y,s,n),i.length=0,i.push(cc.p(n[r.X1],n[r.Y1])),i.push(cc.p(n[r.X4],n[r.Y4])),i.push(cc.p(n[r.X3],n[r.Y3])),i.push(cc.p(n[r.X2],n[r.Y2]))}},r._createChildFormSkeletonData=function(){for(var t,e,i=this._node,r=i._skeleton,s=0,o=r.slots.length;o>s;s++){var a=r.slots[s],c=a.attachment,l=new _ccsg.Node;if(a._slotNode=l,c instanceof n.RegionAttachment)t=c.rendererObject.name,e=this._createSprite(a,c),a.currentSprite=e,a.currentSpriteName=t,l.addChild(e);else if(c instanceof n.MeshAttachment);}},r._createSprite=function(t,e){var i=e.rendererObject,n=(i.page._texture,new cc.Rect(i.x,i.y,i.width,i.height)),r=new _ccsg.Sprite;return r.initWithTexture(i.page._texture,n,i.rotate,!1),r._rect.width=e.width,r._rect.height=e.height,r.setContentSize(e.width,e.height),r.setRotation(-e.rotation),r.setScale(i.width/i.originalWidth*e.scaleX,i.height/i.originalHeight*e.scaleY),t.sprites=t.sprites||{},t.sprites[i.name]=r,r},r._updateChild=function(){var t,e,i,r,s,o,a=this._node._skeleton,c=a.slots;for(t=0,e=c.length;e>t;t++)if(r=c[t],s=r.attachment,o=r._slotNode,s){var l=s.type;if(l===n.AttachmentType.region){if(s.rendererObject)if(!r.currentSpriteName||r.currentSpriteName!==s.name){var h=s.rendererObject.name;if(void 0!==r.currentSprite)r.currentSprite.setVisible(!1);if(r.sprites=r.sprites||{},void 0!==r.sprites[h])r.sprites[h].setVisible(!0);else{var u=this._createSprite(r,s);o.addChild(u)}r.currentSprite=r.sprites[h],r.currentSpriteName=h}var d=r.bone;if(o.setPosition(d.worldX+s.x*d.m00+s.y*d.m01,d.worldY+s.x*d.m10+s.y*d.m11),o.setScale(d.worldScaleX,d.worldScaleY),i=r.currentSprite,i._flippedX=d.worldFlipX,i._flippedY=d.worldFlipY,i._flippedY||i._flippedX)o.setRotation(d.worldRotation),i.setRotation(s.rotation);else o.setRotation(-d.worldRotation),i.setRotation(-s.rotation);i._renderCmd._displayedOpacity=0|a.a*r.a*255;var f=0|a.r*r.r*255,_=0|a.g*r.g*255,p=0|a.b*r.b*255;i.setColor(cc.color(f,_,p)),i._renderCmd._updateColor()}else if(l===n.AttachmentType.skinnedmesh);else{o.setVisible(!1);continue}o.setVisible(!0)}else o.setVisible(!1)}},{}],170:[function(t,e,i){var n=sp.spine;sp._SGSkeleton.WebGLRenderCmd=function(t){_ccsg.Node.WebGLRenderCmd.call(this,t),this._needDraw=!0,this.setShaderProgram(cc.shaderCache.programForKey(cc.macro.SHADER_POSITION_TEXTURECOLOR)),this._tmpQuad=new cc.V3F_C4B_T2F_Quad};var r=sp._SGSkeleton.WebGLRenderCmd.prototype=Object.create(_ccsg.Node.WebGLRenderCmd.prototype);r.constructor=sp._SGSkeleton.WebGLRenderCmd,r.rendering=function(t){var e,i,r,s,o,a=this._node,c=this._tmpQuad,l=a.getColor(),h=a._skeleton,u=a._blendFunc,d=a._premultipliedAlpha,f=-1;if(this._shaderProgram.use(),this._shaderProgram._setUniformForMVPMatrixWithMat4(this._stackMatrix),h.r=l.r/255,h.g=l.g/255,h.b=l.b/255,h.a=a.getOpacity()/255,d)h.r*=h.a,h.g*=h.a,h.b*=h.a;for(s=0,o=h.drawOrder.length;o>s;s++)if(r=h.drawOrder[s],r.attachment){switch(i=r.attachment,r.attachment.type){case sp.ATTACHMENT_TYPE.REGION:this._updateRegionAttachmentQuad(i,r,c,d);break;case sp.ATTACHMENT_TYPE.MESH:this._updateMeshAttachmentQuad(i,r,c,d);break;case sp.ATTACHMENT_TYPE.SKINNED_MESH:break;default:continue}var _=a.getTextureAtlas(i);if(r.data.blendMode!==f){if(e)e.drawQuads(),e.removeAllQuads();switch(f=r.data.blendMode){case n.BlendMode.normal:cc.gl.blendFunc(d?cc.macro.ONE:cc.macro.SRC_ALPHA,cc.macro.ONE_MINUS_SRC_ALPHA);break;case n.BlendMode.additive:cc.gl.blendFunc(d?cc.macro.ONE:cc.macro.SRC_ALPHA,cc.macro.ONE);break;case n.BlendMode.multiply:cc.gl.blendFunc(cc.macro.DST_COLOR,cc.macro.ONE_MINUS_SRC_ALPHA);break;case n.BlendMode.screen:cc.gl.blendFunc(cc.macro.ONE,cc.macro.ONE_MINUS_SRC_COLOR);break;default:cc.gl.blendFunc(u.src,u.dst)}}else if(_!==e&&e)e.drawQuads(),e.removeAllQuads();e=_;var p=e.getTotalQuads();if(e.getCapacity()==p)if(e.drawQuads(),e.removeAllQuads(),!e.resizeCapacity(2*e.getCapacity()))return;e.updateQuad(c,p)}else;if(e)e.drawQuads(),e.removeAllQuads();if(a._debugBones||a._debugSlots){cc.math.glMatrixMode(cc.math.KM_GL_MODELVIEW),cc.current_stack.stack.push(cc.current_stack.top),cc.current_stack.top=this._stackMatrix;var g=cc._drawingUtil;if(a._debugSlots)for(g.setDrawColor(0,0,255,255),g.setLineWidth(1),s=0,o=h.slots.length;o>s;s++)if(r=h.drawOrder[s],r.attachment&&r.attachment.type==sp.ATTACHMENT_TYPE.REGION){i=r.attachment,this._updateRegionAttachmentQuad(i,r,c);var m=[];m.push(cc.p(c.bl.vertices.x,c.bl.vertices.y)),m.push(cc.p(c.br.vertices.x,c.br.vertices.y)),m.push(cc.p(c.tr.vertices.x,c.tr.vertices.y)),m.push(cc.p(c.tl.vertices.x,c.tl.vertices.y)),g.drawPoly(m,4,!0)}else;if(a._debugBones){var v;for(g.setLineWidth(2),g.setDrawColor(255,0,0,255),s=0,o=h.bones.length;o>s;s++){v=h.bones[s];var y=v.data.length*v.m00+v.worldX,T=v.data.length*v.m10+v.worldY;g.drawLine(cc.p(v.worldX,v.worldY),cc.p(y,T))}for(g.setPointSize(4),g.setDrawColor(0,0,255,255),s=0,o=h.bones.length;o>s;s++)if(v=h.bones[s],g.drawPoint(cc.p(v.worldX,v.worldY)),0==s)g.setDrawColor(0,255,0,255)}cc.math.glPopMatrix()}},r._createChildFormSkeletonData=function(){},r._updateChild=function(){},r._updateRegionAttachmentQuad=function(t,e,i,n){var r={};t.computeVertices(e.bone.skeleton.x,e.bone.skeleton.y,e.bone,r);var s=e.bone.skeleton.r*e.r*255,o=e.bone.skeleton.g*e.g*255,a=e.bone.skeleton.b*e.b*255,c=e.bone.skeleton.a*e.a;if(n)s*=c,o*=c,a*=c;var l=255*c;i.bl.colors.r=i.tl.colors.r=i.tr.colors.r=i.br.colors.r=s,i.bl.colors.g=i.tl.colors.g=i.tr.colors.g=i.br.colors.g=o,i.bl.colors.b=i.tl.colors.b=i.tr.colors.b=i.br.colors.b=a,i.bl.colors.a=i.tl.colors.a=i.tr.colors.a=i.br.colors.a=l;var h=sp.VERTEX_INDEX;i.bl.vertices.x=r[h.X1],i.bl.vertices.y=r[h.Y1],i.tl.vertices.x=r[h.X2],i.tl.vertices.y=r[h.Y2],i.tr.vertices.x=r[h.X3],i.tr.vertices.y=r[h.Y3],i.br.vertices.x=r[h.X4],i.br.vertices.y=r[h.Y4],i.bl.texCoords.u=t.uvs[h.X1],i.bl.texCoords.v=t.uvs[h.Y1],i.tl.texCoords.u=t.uvs[h.X2],i.tl.texCoords.v=t.uvs[h.Y2],i.tr.texCoords.u=t.uvs[h.X3],i.tr.texCoords.v=t.uvs[h.Y3],i.br.texCoords.u=t.uvs[h.X4],i.br.texCoords.v=t.uvs[h.Y4]},r._updateMeshAttachmentQuad=function(t,e,i,n){var r={};t.computeWorldVertices(e.bone.x,e.bone.y,e,r);var s=e.bone.skeleton.r*e.r*255,o=e.bone.skeleton.g*e.g*255,a=e.bone.skeleton.b*e.b*255,c=e.bone.skeleton.a*e.a;if(n)s*=c,o*=c,a*=c;var l=255*c;i.bl.colors.r=i.tl.colors.r=i.tr.colors.r=i.br.colors.r=s,i.bl.colors.g=i.tl.colors.g=i.tr.colors.g=i.br.colors.g=o,i.bl.colors.b=i.tl.colors.b=i.tr.colors.b=i.br.colors.b=a,i.bl.colors.a=i.tl.colors.a=i.tr.colors.a=i.br.colors.a=l;var h=sp.VERTEX_INDEX;i.bl.vertices.x=r[h.X1],i.bl.vertices.y=r[h.Y1],i.tl.vertices.x=r[h.X2],i.tl.vertices.y=r[h.Y2],i.tr.vertices.x=r[h.X3],i.tr.vertices.y=r[h.Y3],i.br.vertices.x=r[h.X4],i.br.vertices.y=r[h.Y4],i.bl.texCoords.u=t.uvs[h.X1],i.bl.texCoords.v=t.uvs[h.Y1],i.tl.texCoords.u=t.uvs[h.X2],i.tl.texCoords.v=t.uvs[h.Y2],i.tr.texCoords.u=t.uvs[h.X3],i.tr.texCoords.v=t.uvs[h.Y3],i.br.texCoords.u=t.uvs[h.X4],i.br.texCoords.v=t.uvs[h.Y4]}},{}],171:[function(t,e,i){var n=cc.Enum({"default":-1}),r=cc.Enum({"<None>":0});sp.Skeleton=cc.Class({name:"sp.Skeleton","extends":cc._RendererUnderSG,editor:!1,properties:{skeletonData:{"default":null,type:sp.SkeletonData,notify:function(){this.defaultSkin="",this.defaultAnimation="",this._refresh()},tooltip:"i18n:COMPONENT.skeleton.skeleton_data"},defaultSkin:{"default":"",visible:!1},defaultAnimation:{"default":"",visible:!1},animation:{get:function(){var t=this.getCurrent(0);return t&&t.animation.name||""},set:function(t){if(this.defaultAnimation=t,t)this.setAnimation(0,t,this.loop);else this.clearTrack(0),this.setToSetupPose()},visible:!1},_defaultSkinIndex:{get:function(){if(this.skeletonData&&this.defaultSkin){var t=this.skeletonData.getSkinsEnum();if(t){var e=t[this.defaultSkin];if(void 0!==e)return e}}return 0},set:function(t){var e;if(this.skeletonData)e=this.skeletonData.getSkinsEnum();if(!e)return cc.error('Failed to set _defaultSkinIndex for "%s" because its skeletonData is invalid.',this.name);var i=e[t];if(void 0!==i){if(this.defaultSkin=i,false)this._refresh()}else cc.error('Failed to set _defaultSkinIndex for "%s" because the index is out of range.',this.name)},type:n,visible:!0,displayName:"Default Skin",tooltip:"i18n:COMPONENT.skeleton.default_skin"},_animationIndex:{get:function(){var t=true?this.animation:this.defaultAnimation;if(this.skeletonData&&t){var e=this.skeletonData.getAnimsEnum();if(e){var i=e[t];if(void 0!==i)return i}}return 0},set:function(t){if(0===t)return void(this.animation="");var e;if(this.skeletonData)e=this.skeletonData.getAnimsEnum();if(!e)return cc.error('Failed to set _animationIndex for "%s" because its skeletonData is invalid.',this.name);var i=e[t];if(void 0!==i)this.animation=i;else cc.error('Failed to set _animationIndex for "%s" because the index is out of range.',this.name)},type:r,visible:!0,displayName:"Animation",tooltip:"i18n:COMPONENT.skeleton.animation"},loop:{"default":!0,type:Boolean,tooltip:"i18n:COMPONENT.skeleton.loop"},timeScale:{"default":1,notify:function(){if(this._sgNode)this._sgNode.setTimeScale(this.timeScale)},tooltip:"i18n:COMPONENT.skeleton.time_scale"},debugSlots:{"default":!1,notify:function(){if(this._sgNode)this._sgNode.setDebugSlotsEnabled(this.debugSlots)},editorOnly:!0,tooltip:"i18n:COMPONENT.skeleton.debug_slots"},debugBones:{"default":!1,notify:function(){if(this._sgNode)this._sgNode.setDebugBonesEnabled(this.debugBones)},editorOnly:!0,tooltip:"i18n:COMPONENT.skeleton.debug_bones"}},onLoad:function(){var t=cc.Object.Flags;this._objFlags|=t.IsAnchorLocked|t.IsSizeLocked,this.node.setContentSize(0,0),this._refresh()},_createSgNode:function(){if(this.skeletonData)if(!1){var t=this.skeletonData._uuid;if(!t)return cc.error("Can not render dynamic created SkeletonData"),null;var e=this.skeletonData.rawUrl,i=this.skeletonData.atlasUrl;if(i)if("string"!=typeof i)return cc.error("Invalid type of atlasFile, atlas should be registered as raw asset."),null;else return new sp._SGSkeletonAnimation(e,i,this.skeletonData.scale)}else{var n=this.skeletonData.getRuntimeData();if(n)return new sp._SGSkeletonAnimation(n,null,this.skeletonData.scale)}return null},_initSgNode:function(){var t=this._sgNode;if(t.setTimeScale(this.timeScale),this.defaultSkin)try{t.setSkin(this.defaultSkin)}catch(e){cc._throw(e)}if(this.animation=this.defaultAnimation,!1)t.setDebugSlotsEnabled(this.debugSlots),t.setDebugBonesEnabled(this.debugBones)},_getLocalBounds:!1,setToSetupPose:function(){if(this._sgNode)this._sgNode.setToSetupPose()},setBonesToSetupPose:function(){if(this._sgNode)this._sgNode.setBonesToSetupPose()},setSlotsToSetupPose:function(){if(this._sgNode)this._sgNode.setSlotsToSetupPose()},findBone:function(t){if(this._sgNode)return this._sgNode.findBone(t);else return null},findSlot:function(t){if(this._sgNode)return this._sgNode.findSlot(t);else return null},setSkin:function(t){if(this._sgNode)return this._sgNode.setSkin(t);else return null},getAttachment:function(t,e){if(this._sgNode)return this._sgNode.getAttachment(t,e);else return null},setAttachment:function(t,e){if(this._sgNode)this._sgNode.setAttachment(t,e)},setSkeletonData:function(t,e){if(this._sgNode)this._sgNode.setSkeletonData(t,e)},setAnimationStateData:function(t){if(this._sgNode)return this._sgNode.setAnimationStateData(t);else;},setMix:function(t,e,i){if(this._sgNode)this._sgNode.setMix(t,e,i)},setAnimationListener:function(t,e){if(this._sgNode)this._sgNode.setAnimationListener(t,e)},setAnimation:function(t,e,i){if(this._sgNode){var n=this._sgNode.setAnimation(t,e,i);if(false)this._sample(),this.clearTrack(t);return n}return null},_sample:function(){if(this._sgNode)this._sgNode.update(0)},addAnimation:function(t,e,i,n){if(this._sgNode)return this._sgNode.addAnimation(t,e,i,n);else return null},getCurrent:function(t){if(this._sgNode)return this._sgNode.getCurrent(t);else return null},clearTracks:function(){if(this._sgNode)this._sgNode.clearTracks()},clearTrack:function(t){if(this._sgNode)if(this._sgNode.clearTrack(t),false)this._sample()},_updateAnimEnum:!1,_updateSkinEnum:!1,_refreshInspector:!1,setStartListener:function(t){if(this._sgNode)this._sgNode.setStartListener(t)},setEndListener:function(t){if(this._sgNode)this._sgNode.setEndListener(t)},setCompleteListener:function(t){if(this._sgNode)this._sgNode.setCompleteListener(t)},setEventListener:function(t){if(this._sgNode)this._sgNode.setEventListener(t)},setTrackStartListener:function(t,e){if(this._sgNode)this._sgNode.setTrackStartListener(t,e)},setTrackEndListener:function(t,e){if(this._sgNode)this._sgNode.setTrackEndListener(t,e)},setTrackCompleteListener:function(t,e){if(this._sgNode)this._sgNode.setTrackCompleteListener(t,e)},setTrackEventListener:function(t,e){if(this._sgNode)this._sgNode.setTrackEventListener(t,e)},getState:function(){if(this._sgNode)return this._sgNode.getState();else;},_refresh:function(){var t=this;if(t._sgNode){if(t.node._sizeProvider===t._sgNode)t.node._sizeProvider=null;t._removeSgNode(),t._sgNode=null}var e=t._sgNode=t._createSgNode();if(e)if(e.retain(),e.setContentSize(0,0),t._initSgNode(),t._appendSgNode(e),!t.node._sizeProvider)t.node._sizeProvider=e;if(!1)t._updateAnimEnum(),t._updateSkinEnum(),t._refreshInspector()}})},{}],172:[function(t,e,i){var n=cc.Class({ctor:function(){this.asset=arguments[0]},getTexture:function(t){for(var e=this.asset.textures,i=0;i<e.length;i++){var n=e[i];if(n.endsWith(t))return cc.textureCache.addImage(n)}return null},load:function(t,e,i){var n=this.getTexture(e);if(n)if(cc._renderType===cc.game.RENDER_TYPE_WEBGL)t.rendererObject=new cc.TextureAtlas(n,128),t.width=n.getPixelWidth(),t.height=n.getPixelHeight();else t._texture=n;else cc.error('Failed to load spine atlas "$s"',e)},unload:function(t){}}),r=cc.Class({name:"sp.SkeletonData","extends":cc.Asset,ctor:function(){this.reset()},properties:{_skeletonJson:null,skeletonJson:{get:function(){return this._skeletonJson},set:function(t){this._skeletonJson=t,this.reset()}},_atlasText:"",atlasText:{get:function(){return this._atlasText},set:function(t){this._atlasText=t,this.reset()}},atlasUrl:{"default":"",url:cc.RawAsset},textures:{"default":[],url:[cc.Texture2D]},scale:1},createNode:function(t){var e=new cc.Node(this.name),i=e.addComponent(sp.Skeleton);return i.skeletonData=this,t(null,e)},reset:function(){if(this._skeletonCache=null,this._atlasCache=null,!1)this._skinsEnum=null,this._animsEnum=null},getRuntimeData:!0&&function(t){if(this._skeletonCache)return this._skeletonCache;if(!(this.textures&&this.textures.length>0)){if(!t)cc.error('Please re-import "%s" because its textures is not initialized! (This workflow will be improved in the future.)',this.name);return null}var e=this._getAtlas(t);if(!e)return null;var i=new sp.spine.AtlasAttachmentLoader(e),n=new sp.spine.SkeletonJson(i);n.scale=this.scale;var r=this.skeletonJson;return this._skeletonCache=n.readSkeletonData(r),e.dispose(n),this._skeletonCache},getSkinsEnum:!1,getAnimsEnum:!1,_getAtlas:!0&&function(t){if(this._atlasCache)return this._atlasCache;if(!this.atlasText){if(!t)cc.error('The atlas asset of "%s" is not exists!',this.name);return null}return this._atlasCache=new sp.spine.Atlas(this.atlasText,new n(this))}});sp.SkeletonData=e.exports=r},{}],173:[function(t,e,i){if(sp=!1?sp:{},sp.VERTEX_INDEX={X1:0,Y1:1,X2:2,Y2:3,X3:4,Y3:5,X4:6,Y4:7},sp.ATTACHMENT_TYPE={REGION:0,BOUNDING_BOX:1,MESH:2,SKINNED_MESH:3},sp.AnimationEventType=cc.Enum({START:0,END:1,COMPLETE:2,EVENT:3}),true){if(1)sp.spine=t("./lib/spine"),t("./SGSkeleton"),t("./SGSkeletonCanvasRenderCmd"),t("./SGSkeletonWebGLRenderCmd"),t("./SGSkeletonAnimation");t("./SkeletonData"),t("./Skeleton")}else t("./SkeletonData")},{"./SGSkeleton":167,"./SGSkeletonAnimation":168,"./SGSkeletonCanvasRenderCmd":169,"./SGSkeletonWebGLRenderCmd":170,"./Skeleton":171,"./SkeletonData":172,"./lib/spine":174}],174:[function(t,e,i){var n={radDeg:180/Math.PI,degRad:Math.PI/180,temp:[],Float32Array:"undefined"==typeof Float32Array?Array:Float32Array,Uint16Array:"undefined"==typeof Uint16Array?Array:Uint16Array};n.BoneData=function(t,e){this.name=t,this.parent=e},n.BoneData.prototype={length:0,x:0,y:0,rotation:0,scaleX:1,scaleY:1,inheritScale:!0,inheritRotation:!0,flipX:!1,flipY:!1},n.BlendMode={normal:0,additive:1,multiply:2,screen:3},n.SlotData=function(t,e){this.name=t,this.boneData=e},n.SlotData.prototype={r:1,g:1,b:1,a:1,attachmentName:null,blendMode:n.BlendMode.normal},n.IkConstraintData=function(t){this.name=t,this.bones=[]},n.IkConstraintData.prototype={target:null,bendDirection:1,mix:1},n.Bone=function(t,e,i){this.data=t,this.skeleton=e,this.parent=i,this.setToSetupPose()},n.Bone.yDown=!1,n.Bone.prototype={x:0,y:0,rotation:0,rotationIK:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,m00:0,m01:0,worldX:0,m10:0,m11:0,worldY:0,
worldRotation:0,worldScaleX:1,worldScaleY:1,worldFlipX:!1,worldFlipY:!1,updateWorldTransform:function(){var t=this.parent;if(t){if(this.worldX=this.x*t.m00+this.y*t.m01+t.worldX,this.worldY=this.x*t.m10+this.y*t.m11+t.worldY,this.data.inheritScale)this.worldScaleX=t.worldScaleX*this.scaleX,this.worldScaleY=t.worldScaleY*this.scaleY;else this.worldScaleX=this.scaleX,this.worldScaleY=this.scaleY;this.worldRotation=this.data.inheritRotation?t.worldRotation+this.rotationIK:this.rotationIK,this.worldFlipX=t.worldFlipX!=this.flipX,this.worldFlipY=t.worldFlipY!=this.flipY}else{var e=this.skeleton.flipX,i=this.skeleton.flipY;this.worldX=e?-this.x:this.x,this.worldY=i!=n.Bone.yDown?-this.y:this.y,this.worldScaleX=this.scaleX,this.worldScaleY=this.scaleY,this.worldRotation=this.rotationIK,this.worldFlipX=e!=this.flipX,this.worldFlipY=i!=this.flipY}var r=this.worldRotation*n.degRad,s=Math.cos(r),o=Math.sin(r);if(this.worldFlipX)this.m00=-s*this.worldScaleX,this.m01=o*this.worldScaleY;else this.m00=s*this.worldScaleX,this.m01=-o*this.worldScaleY;if(this.worldFlipY!=n.Bone.yDown)this.m10=-o*this.worldScaleX,this.m11=-s*this.worldScaleY;else this.m10=o*this.worldScaleX,this.m11=s*this.worldScaleY},setToSetupPose:function(){var t=this.data;this.x=t.x,this.y=t.y,this.rotation=t.rotation,this.rotationIK=this.rotation,this.scaleX=t.scaleX,this.scaleY=t.scaleY,this.flipX=t.flipX,this.flipY=t.flipY},worldToLocal:function(t){var e=t[0]-this.worldX,i=t[1]-this.worldY,r=this.m00,s=this.m10,o=this.m01,a=this.m11;if(this.worldFlipX!=(this.worldFlipY!=n.Bone.yDown))r=-r,a=-a;var c=1/(r*a-o*s);t[0]=e*r*c-i*o*c,t[1]=i*a*c-e*s*c},localToWorld:function(t){var e=t[0],i=t[1];t[0]=e*this.m00+i*this.m01+this.worldX,t[1]=e*this.m10+i*this.m11+this.worldY}},n.Slot=function(t,e){this.data=t,this.bone=e,this.setToSetupPose()},n.Slot.prototype={r:1,g:1,b:1,a:1,_attachmentTime:0,attachment:null,attachmentVertices:[],setAttachment:function(t){if(this.attachment!=t)this.attachment=t,this._attachmentTime=this.bone.skeleton.time,this.attachmentVertices.length=0},setAttachmentTime:function(t){this._attachmentTime=this.bone.skeleton.time-t},getAttachmentTime:function(){return this.bone.skeleton.time-this._attachmentTime},setToSetupPose:function(){var t=this.data;if(this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,!t.attachmentName)this.setAttachment(null);else for(var e=this.bone.skeleton.data.slots,i=0,n=e.length;n>i;i++)if(e[i]==t){this.attachment=null,this.setAttachment(this.bone.skeleton.getAttachmentBySlotIndex(i,t.attachmentName));break}}},n.IkConstraint=function(t,e){this.data=t,this.mix=t.mix,this.bendDirection=t.bendDirection,this.bones=[];for(var i=0,n=t.bones.length;n>i;i++)this.bones.push(e.findBone(t.bones[i].name));this.target=e.findBone(t.target.name)},n.IkConstraint.prototype={apply:function(){var t=this.target,e=this.bones;switch(e.length){case 1:n.IkConstraint.apply1(e[0],t.worldX,t.worldY,this.mix);break;case 2:n.IkConstraint.apply2(e[0],e[1],t.worldX,t.worldY,this.bendDirection,this.mix)}}},n.IkConstraint.apply1=function(t,e,i,r){var s=!t.data.inheritRotation||!t.parent?0:t.parent.worldRotation,o=t.rotation,a=Math.atan2(i-t.worldY,e-t.worldX)*n.radDeg;if(t.worldFlipX!=(t.worldFlipY!=n.Bone.yDown))a=-a;a-=s,t.rotationIK=o+(a-o)*r},n.IkConstraint.apply2=function(t,e,i,r,s,o){var a=e.rotation,c=t.rotation;if(!o)return e.rotationIK=a,void(t.rotationIK=c);var l,h,u=n.temp,d=t.parent;if(d)u[0]=i,u[1]=r,d.worldToLocal(u),i=(u[0]-t.x)*d.worldScaleX,r=(u[1]-t.y)*d.worldScaleY;else i-=t.x,r-=t.y;if(e.parent==t)l=e.x,h=e.y;else u[0]=e.x,u[1]=e.y,e.parent.localToWorld(u),t.worldToLocal(u),l=u[0],h=u[1];var f=l*t.worldScaleX,_=h*t.worldScaleY,p=Math.atan2(_,f),g=Math.sqrt(f*f+_*_),m=e.data.length*e.worldScaleX,v=2*g*m;if(1e-4>v)return void(e.rotationIK=a+(Math.atan2(r,i)*n.radDeg-c-a)*o);var y=(i*i+r*r-g*g-m*m)/v;if(-1>y)y=-1;else if(y>1)y=1;var T=Math.acos(y)*s,C=g+m*y,x=m*Math.sin(T),S=Math.atan2(r*C-i*x,i*C+r*x),b=(S-p)*n.radDeg-c;if(b>180)b-=360;else if(-180>b)b+=360;if(t.rotationIK=c+b*o,b=(T+p)*n.radDeg-a,b>180)b-=360;else if(-180>b)b+=360;e.rotationIK=a+(b+t.worldRotation-e.parent.worldRotation)*o},n.Skin=function(t){this.name=t,this.attachments={}},n.Skin.prototype={addAttachment:function(t,e,i){this.attachments[t+":"+e]=i},getAttachment:function(t,e){return this.attachments[t+":"+e]},_attachAll:function(t,e){for(var i in e.attachments){var n=i.indexOf(":"),r=parseInt(i.substring(0,n)),s=i.substring(n+1),o=t.slots[r];if(o.attachment&&o.attachment.name==s){var a=this.getAttachment(r,s);if(a)o.setAttachment(a)}}}},n.Animation=function(t,e,i){this.name=t,this.timelines=e,this.duration=i},n.Animation.prototype={apply:function(t,e,i,n,r){if(n&&0!=this.duration)i%=this.duration,e%=this.duration;for(var s=this.timelines,o=0,a=s.length;a>o;o++)s[o].apply(t,e,i,r,1)},mix:function(t,e,i,n,r,s){if(n&&0!=this.duration)i%=this.duration,e%=this.duration;for(var o=this.timelines,a=0,c=o.length;c>a;a++)o[a].apply(t,e,i,r,s)}},n.Animation.binarySearch=function(t,e,i){var n=0,r=Math.floor(t.length/i)-2;if(!r)return i;for(var s=r>>>1;;){if(t[(s+1)*i]<=e)n=s+1;else r=s;if(n==r)return(n+1)*i;s=n+r>>>1}},n.Animation.binarySearch1=function(t,e){var i=0,n=t.length-2;if(!n)return 1;for(var r=n>>>1;;){if(t[r+1]<=e)i=r+1;else n=r;if(i==n)return i+1;r=i+n>>>1}},n.Animation.linearSearch=function(t,e,i){for(var n=0,r=t.length-i;r>=n;n+=i)if(t[n]>e)return n;return-1},n.Curves=function(t){this.curves=[]},n.Curves.prototype={setLinear:function(t){this.curves[19*t]=0},setStepped:function(t){this.curves[19*t]=1},setCurve:function(t,e,i,n,r){var s=.1,o=s*s,a=o*s,c=3*s,l=3*o,h=6*o,u=6*a,d=2*-e+n,f=2*-i+r,_=3*(e-n)+1,p=3*(i-r)+1,g=e*c+d*l+_*a,m=i*c+f*l+p*a,v=d*h+_*u,y=f*h+p*u,T=_*u,C=p*u,x=19*t,S=this.curves;S[x++]=2;for(var b=g,E=m,A=x+19-1;A>x;x+=2)S[x]=b,S[x+1]=E,g+=v,m+=y,v+=T,y+=C,b+=g,E+=m},getCurvePercent:function(t,e){e=0>e?0:e>1?1:e;var i=this.curves,n=19*t,r=i[n];if(0===r)return e;if(1==r)return 0;n++;for(var s=0,o=n,a=n+19-1;a>n;n+=2)if(s=i[n],s>=e){var c,l;if(n==o)c=0,l=0;else c=i[n-2],l=i[n-1];return l+(i[n+1]-l)*(e-c)/(s-c)}var h=i[n-1];return h+(1-h)*(e-s)/(1-s)}},n.RotateTimeline=function(t){this.curves=new n.Curves(t),this.frames=[],this.frames.length=2*t},n.RotateTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/2},setFrame:function(t,e,i){t*=2,this.frames[t]=e,this.frames[t+1]=i},apply:function(t,e,i,r,s){var o=this.frames;if(!(i<o[0])){var a=t.bones[this.boneIndex];if(i>=o[o.length-2]){for(var c=a.data.rotation+o[o.length-1]-a.rotation;c>180;)c-=360;for(;-180>c;)c+=360;return void(a.rotation+=c*s)}var l=n.Animation.binarySearch(o,i,2),h=o[l-1],u=o[l],d=1-(i-u)/(o[l-2]-u);d=this.curves.getCurvePercent(l/2-1,d);for(var c=o[l+1]-h;c>180;)c-=360;for(;-180>c;)c+=360;for(c=a.data.rotation+(h+c*d)-a.rotation;c>180;)c-=360;for(;-180>c;)c+=360;a.rotation+=c*s}}},n.TranslateTimeline=function(t){this.curves=new n.Curves(t),this.frames=[],this.frames.length=3*t},n.TranslateTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(t,e,i,n){t*=3,this.frames[t]=e,this.frames[t+1]=i,this.frames[t+2]=n},apply:function(t,e,i,r,s){var o=this.frames;if(!(i<o[0])){var a=t.bones[this.boneIndex];if(i>=o[o.length-3])return a.x+=(a.data.x+o[o.length-2]-a.x)*s,void(a.y+=(a.data.y+o[o.length-1]-a.y)*s);var c=n.Animation.binarySearch(o,i,3),l=o[c-2],h=o[c-1],u=o[c],d=1-(i-u)/(o[c+-3]-u);d=this.curves.getCurvePercent(c/3-1,d),a.x+=(a.data.x+l+(o[c+1]-l)*d-a.x)*s,a.y+=(a.data.y+h+(o[c+2]-h)*d-a.y)*s}}},n.ScaleTimeline=function(t){this.curves=new n.Curves(t),this.frames=[],this.frames.length=3*t},n.ScaleTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(t,e,i,n){t*=3,this.frames[t]=e,this.frames[t+1]=i,this.frames[t+2]=n},apply:function(t,e,i,r,s){var o=this.frames;if(!(i<o[0])){var a=t.bones[this.boneIndex];if(i>=o[o.length-3])return a.scaleX+=(a.data.scaleX*o[o.length-2]-a.scaleX)*s,void(a.scaleY+=(a.data.scaleY*o[o.length-1]-a.scaleY)*s);var c=n.Animation.binarySearch(o,i,3),l=o[c-2],h=o[c-1],u=o[c],d=1-(i-u)/(o[c+-3]-u);d=this.curves.getCurvePercent(c/3-1,d),a.scaleX+=(a.data.scaleX*(l+(o[c+1]-l)*d)-a.scaleX)*s,a.scaleY+=(a.data.scaleY*(h+(o[c+2]-h)*d)-a.scaleY)*s}}},n.ColorTimeline=function(t){this.curves=new n.Curves(t),this.frames=[],this.frames.length=5*t},n.ColorTimeline.prototype={slotIndex:0,getFrameCount:function(){return this.frames.length/5},setFrame:function(t,e,i,n,r,s){t*=5,this.frames[t]=e,this.frames[t+1]=i,this.frames[t+2]=n,this.frames[t+3]=r,this.frames[t+4]=s},apply:function(t,e,i,r,s){var o=this.frames;if(!(i<o[0])){var a,c,l,h;if(i>=o[o.length-5]){var u=o.length-1;a=o[u-3],c=o[u-2],l=o[u-1],h=o[u]}else{var d=n.Animation.binarySearch(o,i,5),f=o[d-4],_=o[d-3],p=o[d-2],g=o[d-1],m=o[d],v=1-(i-m)/(o[d-5]-m);v=this.curves.getCurvePercent(d/5-1,v),a=f+(o[d+1]-f)*v,c=_+(o[d+2]-_)*v,l=p+(o[d+3]-p)*v,h=g+(o[d+4]-g)*v}var y=t.slots[this.slotIndex];if(1>s)y.r+=(a-y.r)*s,y.g+=(c-y.g)*s,y.b+=(l-y.b)*s,y.a+=(h-y.a)*s;else y.r=a,y.g=c,y.b=l,y.a=h}}},n.AttachmentTimeline=function(t){this.curves=new n.Curves(t),this.frames=[],this.frames.length=t,this.attachmentNames=[],this.attachmentNames.length=t},n.AttachmentTimeline.prototype={slotIndex:0,getFrameCount:function(){return this.frames.length},setFrame:function(t,e,i){this.frames[t]=e,this.attachmentNames[t]=i},apply:function(t,e,i,r,s){var o=this.frames;if(!(i<o[0])){if(e>i)e=-1;var a=i>=o[o.length-1]?o.length-1:n.Animation.binarySearch1(o,i)-1;if(!(o[a]<e)){var c=this.attachmentNames[a];t.slots[this.slotIndex].setAttachment(!c?null:t.getAttachmentBySlotIndex(this.slotIndex,c))}}else if(e>i)this.apply(t,e,Number.MAX_VALUE,null,0)}},n.EventTimeline=function(t){this.frames=[],this.frames.length=t,this.events=[],this.events.length=t},n.EventTimeline.prototype={getFrameCount:function(){return this.frames.length},setFrame:function(t,e,i){this.frames[t]=e,this.events[t]=i},apply:function(t,e,i,r,s){if(r){var o=this.frames,a=o.length;if(e>i)this.apply(t,e,Number.MAX_VALUE,r,s),e=-1;else if(e>=o[a-1])return;if(!(i<o[0])){var c;if(e<o[0])c=0;else{c=n.Animation.binarySearch1(o,e);for(var l=o[c];c>0&&o[c-1]==l;)c--}for(var h=this.events;a>c&&i>=o[c];c++)r.push(h[c])}}}},n.DrawOrderTimeline=function(t){this.frames=[],this.frames.length=t,this.drawOrders=[],this.drawOrders.length=t},n.DrawOrderTimeline.prototype={getFrameCount:function(){return this.frames.length},setFrame:function(t,e,i){this.frames[t]=e,this.drawOrders[t]=i},apply:function(t,e,i,r,s){var o=this.frames;if(!(i<o[0])){var a;if(i>=o[o.length-1])a=o.length-1;else a=n.Animation.binarySearch1(o,i)-1;var c=t.drawOrder,l=t.slots,h=this.drawOrders[a];if(!h)for(var u=0,d=l.length;d>u;u++)c[u]=l[u];else for(var u=0,d=h.length;d>u;u++)c[u]=t.slots[h[u]]}}},n.FfdTimeline=function(t){this.curves=new n.Curves(t),this.frames=[],this.frames.length=t,this.frameVertices=[],this.frameVertices.length=t},n.FfdTimeline.prototype={slotIndex:0,attachment:0,getFrameCount:function(){return this.frames.length},setFrame:function(t,e,i){this.frames[t]=e,this.frameVertices[t]=i},apply:function(t,e,i,r,s){var o=t.slots[this.slotIndex];if(o.attachment==this.attachment){var a=this.frames;if(!(i<a[0])){var c=this.frameVertices,l=c[0].length,h=o.attachmentVertices;if(h.length!=l)s=1;if(h.length=l,!(i>=a[a.length-1])){var u=n.Animation.binarySearch1(a,i),d=a[u],f=1-(i-d)/(a[u-1]-d);f=this.curves.getCurvePercent(u-1,0>f?0:f>1?1:f);var _=c[u-1],p=c[u];if(1>s)for(var g=0;l>g;g++){var m=_[g];h[g]+=(m+(p[g]-m)*f-h[g])*s}else for(var g=0;l>g;g++){var m=_[g];h[g]=m+(p[g]-m)*f}}else{var v=c[a.length-1];if(1>s)for(var g=0;l>g;g++)h[g]+=(v[g]-h[g])*s;else for(var g=0;l>g;g++)h[g]=v[g]}}}}},n.IkConstraintTimeline=function(t){this.curves=new n.Curves(t),this.frames=[],this.frames.length=3*t},n.IkConstraintTimeline.prototype={ikConstraintIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(t,e,i,n){t*=3,this.frames[t]=e,this.frames[t+1]=i,this.frames[t+2]=n},apply:function(t,e,i,r,s){var o=this.frames;if(!(i<o[0])){var a=t.ikConstraints[this.ikConstraintIndex];if(i>=o[o.length-3])return a.mix+=(o[o.length-2]-a.mix)*s,void(a.bendDirection=o[o.length-1]);var c=n.Animation.binarySearch(o,i,3),l=o[c+-2],h=o[c],u=1-(i-h)/(o[c+-3]-h);u=this.curves.getCurvePercent(c/3-1,u);var d=l+(o[c+1]-l)*u;a.mix+=(d-a.mix)*s,a.bendDirection=o[c+-1]}}},n.FlipXTimeline=function(t){this.curves=new n.Curves(t),this.frames=[],this.frames.length=2*t},n.FlipXTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/2},setFrame:function(t,e,i){t*=2,this.frames[t]=e,this.frames[t+1]=i?1:0},apply:function(t,e,i,r,s){var o=this.frames;if(!(i<o[0])){if(e>i)e=-1;var a=(i>=o[o.length-2]?o.length:n.Animation.binarySearch(o,i,2))-2;if(!(o[a]<e))t.bones[this.boneIndex].flipX=0!=o[a+1]}else if(e>i)this.apply(t,e,Number.MAX_VALUE,null,0)}},n.FlipYTimeline=function(t){this.curves=new n.Curves(t),this.frames=[],this.frames.length=2*t},n.FlipYTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/2},setFrame:function(t,e,i){t*=2,this.frames[t]=e,this.frames[t+1]=i?1:0},apply:function(t,e,i,r,s){var o=this.frames;if(!(i<o[0])){if(e>i)e=-1;var a=(i>=o[o.length-2]?o.length:n.Animation.binarySearch(o,i,2))-2;if(!(o[a]<e))t.bones[this.boneIndex].flipY=0!=o[a+1]}else if(e>i)this.apply(t,e,Number.MAX_VALUE,null,0)}},n.SkeletonData=function(){this.bones=[],this.slots=[],this.skins=[],this.events=[],this.animations=[],this.ikConstraints=[]},n.SkeletonData.prototype={name:null,defaultSkin:null,width:0,height:0,version:null,hash:null,findBone:function(t){for(var e=this.bones,i=0,n=e.length;n>i;i++)if(e[i].name==t)return e[i];return null},findBoneIndex:function(t){for(var e=this.bones,i=0,n=e.length;n>i;i++)if(e[i].name==t)return i;return-1},findSlot:function(t){for(var e=this.slots,i=0,n=e.length;n>i;i++)if(e[i].name==t)return slot[i];return null},findSlotIndex:function(t){for(var e=this.slots,i=0,n=e.length;n>i;i++)if(e[i].name==t)return i;return-1},findSkin:function(t){for(var e=this.skins,i=0,n=e.length;n>i;i++)if(e[i].name==t)return e[i];return null},findEvent:function(t){for(var e=this.events,i=0,n=e.length;n>i;i++)if(e[i].name==t)return e[i];return null},findAnimation:function(t){for(var e=this.animations,i=0,n=e.length;n>i;i++)if(e[i].name==t)return e[i];return null},findIkConstraint:function(t){for(var e=this.ikConstraints,i=0,n=e.length;n>i;i++)if(e[i].name==t)return e[i];return null}},n.Skeleton=function(t){this.data=t,this.bones=[];for(var e=0,i=t.bones.length;i>e;e++){var r=t.bones[e],s=!r.parent?null:this.bones[t.bones.indexOf(r.parent)];this.bones.push(new n.Bone(r,this,s))}this.slots=[],this.drawOrder=[];for(var e=0,i=t.slots.length;i>e;e++){var o=t.slots[e],a=this.bones[t.bones.indexOf(o.boneData)],c=new n.Slot(o,a);this.slots.push(c),this.drawOrder.push(c)}this.ikConstraints=[];for(var e=0,i=t.ikConstraints.length;i>e;e++)this.ikConstraints.push(new n.IkConstraint(t.ikConstraints[e],this));this.boneCache=[],this.updateCache()},n.Skeleton.prototype={x:0,y:0,skin:null,r:1,g:1,b:1,a:1,time:0,flipX:!1,flipY:!1,updateCache:function(){var t=this.ikConstraints,e=t.length,i=e+1,n=this.boneCache;if(n.length>i)n.length=i;for(var r=0,s=n.length;s>r;r++)n[r].length=0;for(;n.length<i;)n[n.length]=[];var o=n[0],a=this.bones;t:for(var r=0,s=a.length;s>r;r++){var c=a[r],l=c;do{for(var h=0;e>h;h++)for(var u=t[h],d=u.bones[0],f=u.bones[u.bones.length-1];;){if(l==f){n[h].push(c),n[h+1].push(c);continue t}if(f==d)break;f=f.parent}l=l.parent}while(l);o[o.length]=c}},updateWorldTransform:function(){for(var t=this.bones,e=0,i=t.length;i>e;e++){var n=t[e];n.rotationIK=n.rotation}for(var e=0,r=this.boneCache.length-1;;){for(var s=this.boneCache[e],o=0,a=s.length;a>o;o++)s[o].updateWorldTransform();if(e==r)break;this.ikConstraints[e].apply(),e++}},setToSetupPose:function(){this.setBonesToSetupPose(),this.setSlotsToSetupPose()},setBonesToSetupPose:function(){for(var t=this.bones,e=0,i=t.length;i>e;e++)t[e].setToSetupPose();for(var n=this.ikConstraints,e=0,i=n.length;i>e;e++){var r=n[e];r.bendDirection=r.data.bendDirection,r.mix=r.data.mix}},setSlotsToSetupPose:function(){for(var t=this.slots,e=this.drawOrder,i=0,n=t.length;n>i;i++)e[i]=t[i],t[i].setToSetupPose(i)},getRootBone:function(){return this.bones.length?this.bones[0]:null},findBone:function(t){for(var e=this.bones,i=0,n=e.length;n>i;i++)if(e[i].data.name==t)return e[i];return null},findBoneIndex:function(t){for(var e=this.bones,i=0,n=e.length;n>i;i++)if(e[i].data.name==t)return i;return-1},findSlot:function(t){for(var e=this.slots,i=0,n=e.length;n>i;i++)if(e[i].data.name==t)return e[i];return null},findSlotIndex:function(t){for(var e=this.slots,i=0,n=e.length;n>i;i++)if(e[i].data.name==t)return i;return-1},setSkinByName:function(t){var e=this.data.findSkin(t);if(!e)throw"Skin not found: "+t;this.setSkin(e)},setSkin:function(t){if(t)if(this.skin)t._attachAll(this,this.skin);else for(var e=this.slots,i=0,n=e.length;n>i;i++){var r=e[i],s=r.data.attachmentName;if(s){var o=t.getAttachment(i,s);if(o)r.setAttachment(o)}}this.skin=t},getAttachmentBySlotName:function(t,e){return this.getAttachmentBySlotIndex(this.data.findSlotIndex(t),e)},getAttachmentBySlotIndex:function(t,e){if(this.skin){var i=this.skin.getAttachment(t,e);if(i)return i}if(this.data.defaultSkin)return this.data.defaultSkin.getAttachment(t,e);else return null},setAttachment:function(t,e){for(var i=this.slots,n=0,r=i.length;r>n;n++){var s=i[n];if(s.data.name==t){var o=null;if(e)if(o=this.getAttachmentBySlotIndex(n,e),!o)throw"Attachment not found: "+e+", for slot: "+t;return void s.setAttachment(o)}}throw"Slot not found: "+t},findIkConstraint:function(t){for(var e=this.ikConstraints,i=0,n=e.length;n>i;i++)if(e[i].data.name==t)return e[i];return null},update:function(t){this.time+=t}},n.EventData=function(t){this.name=t},n.EventData.prototype={intValue:0,floatValue:0,stringValue:null},n.Event=function(t){this.data=t},n.Event.prototype={intValue:0,floatValue:0,stringValue:null},n.AttachmentType={region:0,boundingbox:1,mesh:2,skinnedmesh:3},n.RegionAttachment=function(t){this.name=t,this.offset=[],this.offset.length=8,this.uvs=[],this.uvs.length=8},n.RegionAttachment.prototype={type:n.AttachmentType.region,x:0,y:0,rotation:0,scaleX:1,scaleY:1,width:0,height:0,r:1,g:1,b:1,a:1,path:null,rendererObject:null,regionOffsetX:0,regionOffsetY:0,regionWidth:0,regionHeight:0,regionOriginalWidth:0,regionOriginalHeight:0,setUVs:function(t,e,i,n,r){var s=this.uvs;if(r)s[2]=t,s[3]=n,s[4]=t,s[5]=e,s[6]=i,s[7]=e,s[0]=i,s[1]=n;else s[0]=t,s[1]=n,s[2]=t,s[3]=e,s[4]=i,s[5]=e,s[6]=i,s[7]=n},updateOffset:function(){var t=this.width/this.regionOriginalWidth*this.scaleX,e=this.height/this.regionOriginalHeight*this.scaleY,i=-this.width/2*this.scaleX+this.regionOffsetX*t,r=-this.height/2*this.scaleY+this.regionOffsetY*e,s=i+this.regionWidth*t,o=r+this.regionHeight*e,a=this.rotation*n.degRad,c=Math.cos(a),l=Math.sin(a),h=i*c+this.x,u=i*l,d=r*c+this.y,f=r*l,_=s*c+this.x,p=s*l,g=o*c+this.y,m=o*l,v=this.offset;v[0]=h-f,v[1]=d+u,v[2]=h-m,v[3]=g+u,v[4]=_-m,v[5]=g+p,v[6]=_-f,v[7]=d+p},computeVertices:function(t,e,i,n){t+=i.worldX,e+=i.worldY;var r=i.m00,s=i.m01,o=i.m10,a=i.m11,c=this.offset;n[0]=c[0]*r+c[1]*s+t,n[1]=c[0]*o+c[1]*a+e,n[2]=c[2]*r+c[3]*s+t,n[3]=c[2]*o+c[3]*a+e,n[4]=c[4]*r+c[5]*s+t,n[5]=c[4]*o+c[5]*a+e,n[6]=c[6]*r+c[7]*s+t,n[7]=c[6]*o+c[7]*a+e}},n.MeshAttachment=function(t){this.name=t},n.MeshAttachment.prototype={type:n.AttachmentType.mesh,vertices:null,uvs:null,regionUVs:null,triangles:null,hullLength:0,r:1,g:1,b:1,a:1,path:null,rendererObject:null,regionU:0,regionV:0,regionU2:0,regionV2:0,regionRotate:!1,regionOffsetX:0,regionOffsetY:0,regionWidth:0,regionHeight:0,regionOriginalWidth:0,regionOriginalHeight:0,edges:null,width:0,height:0,updateUVs:function(){var t=this.regionU2-this.regionU,e=this.regionV2-this.regionV,i=this.regionUVs.length;if(!this.uvs||this.uvs.length!=i)this.uvs=new n.Float32Array(i);if(this.regionRotate)for(var r=0;i>r;r+=2)this.uvs[r]=this.regionU+this.regionUVs[r+1]*t,this.uvs[r+1]=this.regionV+e-this.regionUVs[r]*e;else for(var r=0;i>r;r+=2)this.uvs[r]=this.regionU+this.regionUVs[r]*t,this.uvs[r+1]=this.regionV+this.regionUVs[r+1]*e},computeWorldVertices:function(t,e,i,n){var r=i.bone;t+=r.worldX,e+=r.worldY;var s=r.m00,o=r.m01,a=r.m10,c=r.m11,l=this.vertices,h=l.length;if(i.attachmentVertices.length==h)l=i.attachmentVertices;for(var u=0;h>u;u+=2){var d=l[u],f=l[u+1];n[u]=d*s+f*o+t,n[u+1]=d*a+f*c+e}}},n.SkinnedMeshAttachment=function(t){this.name=t},n.SkinnedMeshAttachment.prototype={type:n.AttachmentType.skinnedmesh,bones:null,weights:null,uvs:null,regionUVs:null,triangles:null,hullLength:0,r:1,g:1,b:1,a:1,path:null,rendererObject:null,regionU:0,regionV:0,regionU2:0,regionV2:0,regionRotate:!1,regionOffsetX:0,regionOffsetY:0,regionWidth:0,regionHeight:0,regionOriginalWidth:0,regionOriginalHeight:0,edges:null,width:0,height:0,updateUVs:function(t,e,i,r,s){var o=this.regionU2-this.regionU,a=this.regionV2-this.regionV,c=this.regionUVs.length;if(!this.uvs||this.uvs.length!=c)this.uvs=new n.Float32Array(c);if(this.regionRotate)for(var l=0;c>l;l+=2)this.uvs[l]=this.regionU+this.regionUVs[l+1]*o,this.uvs[l+1]=this.regionV+a-this.regionUVs[l]*a;else for(var l=0;c>l;l+=2)this.uvs[l]=this.regionU+this.regionUVs[l]*o,this.uvs[l+1]=this.regionV+this.regionUVs[l+1]*a},computeWorldVertices:function(t,e,i,n){var r,s,o,a,c,l,h,u=i.bone.skeleton.bones,d=this.weights,f=this.bones,_=0,p=0,g=0,m=0,v=f.length;if(!i.attachmentVertices.length)for(;v>p;_+=2){for(s=0,o=0,r=f[p++]+p;r>p;p++,g+=3)a=u[f[p]],c=d[g],l=d[g+1],h=d[g+2],s+=(c*a.m00+l*a.m01+a.worldX)*h,o+=(c*a.m10+l*a.m11+a.worldY)*h;n[_]=s+t,n[_+1]=o+e}else for(var y=i.attachmentVertices;v>p;_+=2){for(s=0,o=0,r=f[p++]+p;r>p;p++,g+=3,m+=2)a=u[f[p]],c=d[g]+y[m],l=d[g+1]+y[m+1],h=d[g+2],s+=(c*a.m00+l*a.m01+a.worldX)*h,o+=(c*a.m10+l*a.m11+a.worldY)*h;n[_]=s+t,n[_+1]=o+e}}},n.BoundingBoxAttachment=function(t){this.name=t,this.vertices=[]},n.BoundingBoxAttachment.prototype={type:n.AttachmentType.boundingbox,computeWorldVertices:function(t,e,i,n){t+=i.worldX,e+=i.worldY;for(var r=i.m00,s=i.m01,o=i.m10,a=i.m11,c=this.vertices,l=0,h=c.length;h>l;l+=2){var u=c[l],d=c[l+1];n[l]=u*r+d*s+t,n[l+1]=u*o+d*a+e}}},n.AnimationStateData=function(t){this.skeletonData=t,this.animationToMixTime={}},n.AnimationStateData.prototype={defaultMix:0,setMixByName:function(t,e,i){var n=this.skeletonData.findAnimation(t);if(!n)throw"Animation not found: "+t;var r=this.skeletonData.findAnimation(e);if(!r)throw"Animation not found: "+e;this.setMix(n,r,i)},setMix:function(t,e,i){this.animationToMixTime[t.name+":"+e.name]=i},getMix:function(t,e){var i=t.name+":"+e.name;return this.animationToMixTime.hasOwnProperty(i)?this.animationToMixTime[i]:this.defaultMix}},n.TrackEntry=function(){},n.TrackEntry.prototype={next:null,previous:null,animation:null,loop:!1,delay:0,time:0,lastTime:-1,endTime:0,timeScale:1,mixTime:0,mixDuration:0,mix:1,onStart:null,onEnd:null,onComplete:null,onEvent:null},n.AnimationState=function(t){this.data=t,this.tracks=[],this.events=[]},n.AnimationState.prototype={onStart:null,onEnd:null,onComplete:null,onEvent:null,timeScale:1,update:function(t){t*=this.timeScale;for(var e=0;e<this.tracks.length;e++){var i=this.tracks[e];if(i){if(i.time+=t*i.timeScale,i.previous){var n=t*i.previous.timeScale;i.previous.time+=n,i.mixTime+=n}var r=i.next;if(r){if(r.time=i.lastTime-r.delay,r.time>=0)this.setCurrent(e,r)}else if(!i.loop&&i.lastTime>=i.endTime)this.clearTrack(e)}else;}},apply:function(t){for(var e=0;e<this.tracks.length;e++){var i=this.tracks[e];if(i){this.events.length=0;var n=i.time,r=i.lastTime,s=i.endTime,o=i.loop;if(!o&&n>s)n=s;var a=i.previous;if(!a)if(1==i.mix)i.animation.apply(t,i.lastTime,n,o,this.events);else i.animation.mix(t,i.lastTime,n,o,this.events,i.mix);else{var c=a.time;if(!a.loop&&c>a.endTime)c=a.endTime;a.animation.apply(t,c,c,a.loop,null);var l=i.mixTime/i.mixDuration*i.mix;if(l>=1)l=1,i.previous=null;i.animation.mix(t,i.lastTime,n,o,this.events,l)}for(var h=0,u=this.events.length;u>h;h++){var d=this.events[h];if(i.onEvent)i.onEvent(e,d);if(this.onEvent)this.onEvent(e,d)}if(o?r%s>n%s:s>r&&n>=s){var f=Math.floor(n/s);if(i.onComplete)i.onComplete(e,f);if(this.onComplete)this.onComplete(e,f)}i.lastTime=i.time}else;}},clearTracks:function(){for(var t=0,e=this.tracks.length;e>t;t++)this.clearTrack(t);this.tracks.length=0},clearTrack:function(t){if(!(t>=this.tracks.length)){var e=this.tracks[t];if(e){if(e.onEnd)e.onEnd(t);if(this.onEnd)this.onEnd(t);this.tracks[t]=null}}},_expandToIndex:function(t){if(t<this.tracks.length)return this.tracks[t];for(;t>=this.tracks.length;)this.tracks.push(null);return null},setCurrent:function(t,e){var i=this._expandToIndex(t);if(i){var n=i.previous;if(i.previous=null,i.onEnd)i.onEnd(t);if(this.onEnd)this.onEnd(t);if(e.mixDuration=this.data.getMix(i.animation,e.animation),e.mixDuration>0)if(e.mixTime=0,n&&i.mixTime/i.mixDuration<.5)e.previous=n;else e.previous=i}if(this.tracks[t]=e,e.onStart)e.onStart(t);if(this.onStart)this.onStart(t)},setAnimationByName:function(t,e,i){var n=this.data.skeletonData.findAnimation(e);if(!n)throw"Animation not found: "+e;return this.setAnimation(t,n,i)},setAnimation:function(t,e,i){var r=new n.TrackEntry;return r.animation=e,r.loop=i,r.endTime=e.duration,this.setCurrent(t,r),r},addAnimationByName:function(t,e,i,n){var r=this.data.skeletonData.findAnimation(e);if(!r)throw"Animation not found: "+e;return this.addAnimation(t,r,i,n)},addAnimation:function(t,e,i,r){var s=new n.TrackEntry;s.animation=e,s.loop=i,s.endTime=e.duration;var o=this._expandToIndex(t);if(o){for(;o.next;)o=o.next;o.next=s}else this.tracks[t]=s;if(0>=r)if(o)r+=o.endTime-this.data.getMix(o.animation,e);else r=0;return s.delay=r,s},getCurrent:function(t){if(t>=this.tracks.length)return null;else return this.tracks[t]}},n.SkeletonJson=function(t){this.attachmentLoader=t},n.SkeletonJson.prototype={scale:1,readSkeletonData:function(t,e){var i=new n.SkeletonData;i.name=e;var r=t.skeleton;if(r)i.hash=r.hash,i.version=r.spine,i.width=r.width||0,i.height=r.height||0;for(var s=t.bones,o=0,a=s.length;a>o;o++){var c=s[o],l=null;if(c.parent)if(l=i.findBone(c.parent),!l)throw"Parent bone not found: "+c.parent;var h=new n.BoneData(c.name,l);h.length=(c.length||0)*this.scale,h.x=(c.x||0)*this.scale,h.y=(c.y||0)*this.scale,h.rotation=c.rotation||0,h.scaleX=c.hasOwnProperty("scaleX")?c.scaleX:1,h.scaleY=c.hasOwnProperty("scaleY")?c.scaleY:1,h.inheritScale=c.hasOwnProperty("inheritScale")?c.inheritScale:!0,h.inheritRotation=c.hasOwnProperty("inheritRotation")?c.inheritRotation:!0,i.bones.push(h)}var u=t.ik;if(u)for(var o=0,a=u.length;a>o;o++){for(var d=u[o],f=new n.IkConstraintData(d.name),s=d.bones,_=0,p=s.length;p>_;_++){var g=i.findBone(s[_]);if(!g)throw"IK bone not found: "+s[_];f.bones.push(g)}if(f.target=i.findBone(d.target),!f.target)throw"Target bone not found: "+d.target;f.bendDirection=!d.hasOwnProperty("bendPositive")||d.bendPositive?1:-1,f.mix=d.hasOwnProperty("mix")?d.mix:1,i.ikConstraints.push(f)}for(var m=t.slots,o=0,a=m.length;a>o;o++){var v=m[o],h=i.findBone(v.bone);if(!h)throw"Slot bone not found: "+v.bone;var y=new n.SlotData(v.name,h),T=v.color;if(T)y.r=this.toColor(T,0),y.g=this.toColor(T,1),y.b=this.toColor(T,2),y.a=this.toColor(T,3);y.attachmentName=v.attachment,y.blendMode=n.BlendMode[v.blend||"normal"],i.slots.push(y)}var C=t.skins;for(var x in C)if(C.hasOwnProperty(x)){var S=C[x],b=new n.Skin(x);for(var E in S)if(S.hasOwnProperty(E)){var A=i.findSlotIndex(E),w=S[E];for(var O in w)if(w.hasOwnProperty(O)){var I=this.readAttachment(b,O,w[O]);if(I)b.addAttachment(A,O,I)}else;}else;if(i.skins.push(b),"default"==b.name)i.defaultSkin=b}else;var R=t.events;for(var P in R)if(R.hasOwnProperty(P)){var N=R[P],L=new n.EventData(P);L.intValue=N["int"]||0,L.floatValue=N["float"]||0,L.stringValue=N.string||null,i.events.push(L)}else;var F=t.animations;for(var D in F)if(F.hasOwnProperty(D))this.readAnimation(D,F[D],i);else;return i},readAttachment:function(t,e,i){e=i.name||e;var r=n.AttachmentType[i.type||"region"],s=i.path||e,o=this.scale;if(r==n.AttachmentType.region){var a=this.attachmentLoader.newRegionAttachment(t,e,s);if(!a)return null;a.path=s,a.x=(i.x||0)*o,a.y=(i.y||0)*o,a.scaleX=i.hasOwnProperty("scaleX")?i.scaleX:1,a.scaleY=i.hasOwnProperty("scaleY")?i.scaleY:1,a.rotation=i.rotation||0,a.width=(i.width||0)*o,a.height=(i.height||0)*o;var c=i.color;if(c)a.r=this.toColor(c,0),a.g=this.toColor(c,1),a.b=this.toColor(c,2),a.a=this.toColor(c,3);return a.updateOffset(),a}else if(r==n.AttachmentType.mesh){var l=this.attachmentLoader.newMeshAttachment(t,e,s);if(!l)return null;if(l.path=s,l.vertices=this.getFloatArray(i,"vertices",o),l.triangles=this.getIntArray(i,"triangles"),l.regionUVs=this.getFloatArray(i,"uvs",1),l.updateUVs(),c=i.color)l.r=this.toColor(c,0),l.g=this.toColor(c,1),l.b=this.toColor(c,2),l.a=this.toColor(c,3);if(l.hullLength=2*(i.hull||0),i.edges)l.edges=this.getIntArray(i,"edges");return l.width=(i.width||0)*o,l.height=(i.height||0)*o,l}else if(r==n.AttachmentType.skinnedmesh){var l=this.attachmentLoader.newSkinnedMeshAttachment(t,e,s);if(!l)return null;l.path=s;for(var h=this.getFloatArray(i,"uvs",1),u=this.getFloatArray(i,"vertices",1),d=[],f=[],_=0,p=u.length;p>_;){var g=0|u[_++];f[f.length]=g;for(var m=_+4*g;m>_;)f[f.length]=u[_],d[d.length]=u[_+1]*o,d[d.length]=u[_+2]*o,d[d.length]=u[_+3],_+=4}if(l.bones=f,l.weights=d,l.triangles=this.getIntArray(i,"triangles"),l.regionUVs=h,l.updateUVs(),c=i.color)l.r=this.toColor(c,0),l.g=this.toColor(c,1),l.b=this.toColor(c,2),l.a=this.toColor(c,3);if(l.hullLength=2*(i.hull||0),i.edges)l.edges=this.getIntArray(i,"edges");return l.width=(i.width||0)*o,l.height=(i.height||0)*o,l}else if(r==n.AttachmentType.boundingbox){for(var v=this.attachmentLoader.newBoundingBoxAttachment(t,e),u=i.vertices,_=0,p=u.length;p>_;_++)v.vertices.push(u[_]*o);return v}throw"Unknown attachment type: "+r},readAnimation:function(t,e,i){var r=[],s=0,o=e.slots;for(var a in o)if(o.hasOwnProperty(a)){var c=o[a],l=i.findSlotIndex(a);for(var h in c)if(c.hasOwnProperty(h)){var u=c[h];if("color"==h){var d=new n.ColorTimeline(u.length);d.slotIndex=l;for(var f=0,_=0,p=u.length;p>_;_++){var g=u[_],m=g.color,v=this.toColor(m,0),y=this.toColor(m,1),T=this.toColor(m,2),C=this.toColor(m,3);d.setFrame(f,g.time,v,y,T,C),this.readCurve(d,f,g),f++}r.push(d),s=Math.max(s,d.frames[5*d.getFrameCount()-5])}else if("attachment"==h){var d=new n.AttachmentTimeline(u.length);d.slotIndex=l;for(var f=0,_=0,p=u.length;p>_;_++){var g=u[_];d.setFrame(f++,g.time,g.name)}r.push(d),s=Math.max(s,d.frames[d.getFrameCount()-1])}else throw"Invalid timeline type for a slot: "+h+" ("+a+")"}else;}else;var x=e.bones;for(var S in x)if(x.hasOwnProperty(S)){var b=i.findBoneIndex(S);if(-1==b)throw"Bone not found: "+S;var E=x[S];for(var h in E)if(E.hasOwnProperty(h)){var u=E[h];if("rotate"==h){var d=new n.RotateTimeline(u.length);d.boneIndex=b;for(var f=0,_=0,p=u.length;p>_;_++){var g=u[_];d.setFrame(f,g.time,g.angle),this.readCurve(d,f,g),f++}r.push(d),s=Math.max(s,d.frames[2*d.getFrameCount()-2])}else if("translate"==h||"scale"==h){var d,A=1;if("scale"==h)d=new n.ScaleTimeline(u.length);else d=new n.TranslateTimeline(u.length),A=this.scale;d.boneIndex=b;for(var f=0,_=0,p=u.length;p>_;_++){var g=u[_],w=(g.x||0)*A,O=(g.y||0)*A;d.setFrame(f,g.time,w,O),this.readCurve(d,f,g),f++}r.push(d),s=Math.max(s,d.frames[3*d.getFrameCount()-3])}else if("flipX"==h||"flipY"==h){var w="flipX"==h,d=w?new n.FlipXTimeline(u.length):new n.FlipYTimeline(u.length);d.boneIndex=b;for(var I=w?"x":"y",f=0,_=0,p=u.length;p>_;_++){var g=u[_];d.setFrame(f,g.time,g[I]||!1),f++}r.push(d),s=Math.max(s,d.frames[2*d.getFrameCount()-2])}else throw"Invalid timeline type for a bone: "+h+" ("+S+")"}else;}else;var R=e.ik;for(var P in R)if(R.hasOwnProperty(P)){var N=i.findIkConstraint(P),u=R[P],d=new n.IkConstraintTimeline(u.length);
d.ikConstraintIndex=i.ikConstraints.indexOf(N);for(var f=0,_=0,p=u.length;p>_;_++){var g=u[_],L=g.hasOwnProperty("mix")?g.mix:1,F=!g.hasOwnProperty("bendPositive")||g.bendPositive?1:-1;d.setFrame(f,g.time,L,F),this.readCurve(d,f,g),f++}r.push(d),s=Math.max(s,d.frames[3*d.frameCount-3])}else;var D=e.ffd;for(var M in D){var B=i.findSkin(M),c=D[M];for(a in c){var l=i.findSlotIndex(a),z=c[a];for(var k in z){var u=z[k],d=new n.FfdTimeline(u.length),V=B.getAttachment(l,k);if(!V)throw"FFD attachment not found: "+k;d.slotIndex=l,d.attachment=V;var W,U=V.type==n.AttachmentType.mesh;if(U)W=V.vertices.length;else W=V.weights.length/3*2;for(var f=0,_=0,p=u.length;p>_;_++){var G,g=u[_];if(!g.vertices)if(U)G=V.vertices;else G=[],G.length=W;else{var X=g.vertices,G=[];G.length=W;var j=g.offset||0,Y=X.length;if(1==this.scale)for(var H=0;Y>H;H++)G[H+j]=X[H];else for(var H=0;Y>H;H++)G[H+j]=X[H]*this.scale;if(U)for(var q=V.vertices,H=0,Y=G.length;Y>H;H++)G[H]+=q[H]}d.setFrame(f,g.time,G),this.readCurve(d,f,g),f++}r[r.length]=d,s=Math.max(s,d.frames[d.frameCount-1])}}}var Q=e.drawOrder;if(!Q)Q=e.draworder;if(Q){for(var d=new n.DrawOrderTimeline(Q.length),Z=i.slots.length,f=0,_=0,p=Q.length;p>_;_++){var K=Q[_],J=null;if(K.offsets){J=[],J.length=Z;for(var H=Z-1;H>=0;H--)J[H]=-1;var $=K.offsets,tt=[];tt.length=Z-$.length;for(var et=0,it=0,H=0,Y=$.length;Y>H;H++){var nt=$[H],l=i.findSlotIndex(nt.slot);if(-1==l)throw"Slot not found: "+nt.slot;for(;et!=l;)tt[it++]=et++;J[et+nt.offset]=et++}for(;Z>et;)tt[it++]=et++;for(var H=Z-1;H>=0;H--)if(-1==J[H])J[H]=tt[--it]}d.setFrame(f++,K.time,J)}r.push(d),s=Math.max(s,d.frames[d.getFrameCount()-1])}var rt=e.events;if(rt){for(var d=new n.EventTimeline(rt.length),f=0,_=0,p=rt.length;p>_;_++){var st=rt[_],ot=i.findEvent(st.name);if(!ot)throw"Event not found: "+st.name;var at=new n.Event(ot);at.intValue=st.hasOwnProperty("int")?st["int"]:ot.intValue,at.floatValue=st.hasOwnProperty("float")?st["float"]:ot.floatValue,at.stringValue=st.hasOwnProperty("string")?st.string:ot.stringValue,d.setFrame(f++,st.time,at)}r.push(d),s=Math.max(s,d.frames[d.getFrameCount()-1])}i.animations.push(new n.Animation(t,r,s))},readCurve:function(t,e,i){var n=i.curve;if(!n)t.curves.setLinear(e);else if("stepped"==n)t.curves.setStepped(e);else if(n instanceof Array)t.curves.setCurve(e,n[0],n[1],n[2],n[3])},toColor:function(t,e){if(8!=t.length)throw"Color hexidecimal length must be 8, recieved: "+t;return parseInt(t.substring(2*e,2*e+2),16)/255},getFloatArray:function(t,e,i){var r=t[e],s=new n.Float32Array(r.length),o=0,a=r.length;if(1==i)for(;a>o;o++)s[o]=r[o];else for(;a>o;o++)s[o]=r[o]*i;return s},getIntArray:function(t,e){for(var i=t[e],r=new n.Uint16Array(i.length),s=0,o=i.length;o>s;s++)r[s]=0|i[s];return r}},n.Atlas=function(t,e){this.textureLoader=e,this.pages=[],this.regions=[];var i=new n.AtlasReader(t),r=[];r.length=4;for(var s=null;;){var o=i.readLine();if(null===o)break;if(o=i.trim(o),!o.length)s=null;else if(!s){if(s=new n.AtlasPage,s.name=o,2==i.readTuple(r))s.width=parseInt(r[0]),s.height=parseInt(r[1]),i.readTuple(r);s.format=n.Atlas.Format[r[0]],i.readTuple(r),s.minFilter=n.Atlas.TextureFilter[r[0]],s.magFilter=n.Atlas.TextureFilter[r[1]];var a=i.readValue();if(s.uWrap=n.Atlas.TextureWrap.clampToEdge,s.vWrap=n.Atlas.TextureWrap.clampToEdge,"x"==a)s.uWrap=n.Atlas.TextureWrap.repeat;else if("y"==a)s.vWrap=n.Atlas.TextureWrap.repeat;else if("xy"==a)s.uWrap=s.vWrap=n.Atlas.TextureWrap.repeat;e.load(s,o,this),this.pages.push(s)}else{var c=new n.AtlasRegion;c.name=o,c.page=s,c.rotate="true"==i.readValue(),i.readTuple(r);var l=parseInt(r[0]),h=parseInt(r[1]);i.readTuple(r);var u=parseInt(r[0]),d=parseInt(r[1]);if(c.u=l/s.width,c.v=h/s.height,c.rotate)c.u2=(l+d)/s.width,c.v2=(h+u)/s.height;else c.u2=(l+u)/s.width,c.v2=(h+d)/s.height;if(c.x=l,c.y=h,c.width=Math.abs(u),c.height=Math.abs(d),4==i.readTuple(r))if(c.splits=[parseInt(r[0]),parseInt(r[1]),parseInt(r[2]),parseInt(r[3])],4==i.readTuple(r))c.pads=[parseInt(r[0]),parseInt(r[1]),parseInt(r[2]),parseInt(r[3])],i.readTuple(r);c.originalWidth=parseInt(r[0]),c.originalHeight=parseInt(r[1]),i.readTuple(r),c.offsetX=parseInt(r[0]),c.offsetY=parseInt(r[1]),c.index=parseInt(i.readValue()),this.regions.push(c)}}},n.Atlas.prototype={findRegion:function(t){for(var e=this.regions,i=0,n=e.length;n>i;i++)if(e[i].name==t)return e[i];return null},dispose:function(){for(var t=this.pages,e=0,i=t.length;i>e;e++)this.textureLoader.unload(t[e].rendererObject)},updateUVs:function(t){for(var e=this.regions,i=0,n=e.length;n>i;i++){var r=e[i];if(r.page==t)if(r.u=r.x/t.width,r.v=r.y/t.height,r.rotate)r.u2=(r.x+r.height)/t.width,r.v2=(r.y+r.width)/t.height;else r.u2=(r.x+r.width)/t.width,r.v2=(r.y+r.height)/t.height;else;}}},n.Atlas.Format={alpha:0,intensity:1,luminanceAlpha:2,rgb565:3,rgba4444:4,rgb888:5,rgba8888:6},n.Atlas.TextureFilter={nearest:0,linear:1,mipMap:2,mipMapNearestNearest:3,mipMapLinearNearest:4,mipMapNearestLinear:5,mipMapLinearLinear:6},n.Atlas.TextureWrap={mirroredRepeat:0,clampToEdge:1,repeat:2},n.AtlasPage=function(){},n.AtlasPage.prototype={name:null,format:null,minFilter:null,magFilter:null,uWrap:null,vWrap:null,rendererObject:null,width:0,height:0},n.AtlasRegion=function(){},n.AtlasRegion.prototype={page:null,name:null,x:0,y:0,width:0,height:0,u:0,v:0,u2:0,v2:0,offsetX:0,offsetY:0,originalWidth:0,originalHeight:0,index:0,rotate:!1,splits:null,pads:null},n.AtlasReader=function(t){this.lines=t.split(/\r\n|\r|\n/)},n.AtlasReader.prototype={index:0,trim:function(t){return t.replace(/^\s+|\s+$/g,"")},readLine:function(){if(this.index>=this.lines.length)return null;else return this.lines[this.index++]},readValue:function(){var t=this.readLine(),e=t.indexOf(":");if(-1==e)throw"Invalid line: "+t;return this.trim(t.substring(e+1))},readTuple:function(t){var e=this.readLine(),i=e.indexOf(":");if(-1==i)throw"Invalid line: "+e;for(var n=0,r=i+1;3>n;n++){var s=e.indexOf(",",r);if(-1==s)break;t[n]=this.trim(e.substr(r,s-r)),r=s+1}return t[n]=this.trim(e.substring(r)),n+1}},n.AtlasAttachmentLoader=function(t){this.atlas=t},n.AtlasAttachmentLoader.prototype={newRegionAttachment:function(t,e,i){var r=this.atlas.findRegion(i);if(!r)throw"Region not found in atlas: "+i+" (region attachment: "+e+")";var s=new n.RegionAttachment(e);return s.rendererObject=r,s.setUVs(r.u,r.v,r.u2,r.v2,r.rotate),s.regionOffsetX=r.offsetX,s.regionOffsetY=r.offsetY,s.regionWidth=r.width,s.regionHeight=r.height,s.regionOriginalWidth=r.originalWidth,s.regionOriginalHeight=r.originalHeight,s},newMeshAttachment:function(t,e,i){var r=this.atlas.findRegion(i);if(!r)throw"Region not found in atlas: "+i+" (mesh attachment: "+e+")";var s=new n.MeshAttachment(e);return s.rendererObject=r,s.regionU=r.u,s.regionV=r.v,s.regionU2=r.u2,s.regionV2=r.v2,s.regionRotate=r.rotate,s.regionOffsetX=r.offsetX,s.regionOffsetY=r.offsetY,s.regionWidth=r.width,s.regionHeight=r.height,s.regionOriginalWidth=r.originalWidth,s.regionOriginalHeight=r.originalHeight,s},newSkinnedMeshAttachment:function(t,e,i){var r=this.atlas.findRegion(i);if(!r)throw"Region not found in atlas: "+i+" (skinned mesh attachment: "+e+")";var s=new n.SkinnedMeshAttachment(e);return s.rendererObject=r,s.regionU=r.u,s.regionV=r.v,s.regionU2=r.u2,s.regionV2=r.v2,s.regionRotate=r.rotate,s.regionOffsetX=r.offsetX,s.regionOffsetY=r.offsetY,s.regionWidth=r.width,s.regionHeight=r.height,s.regionOriginalWidth=r.originalWidth,s.regionOriginalHeight=r.originalHeight,s},newBoundingBoxAttachment:function(t,e){return new n.BoundingBoxAttachment(e)}},n.SkeletonBounds=function(){this.polygonPool=[],this.polygons=[],this.boundingBoxes=[]},n.SkeletonBounds.prototype={minX:0,minY:0,maxX:0,maxY:0,update:function(t,e){var i=t.slots,r=i.length,s=t.x,o=t.y,a=this.boundingBoxes,c=this.polygonPool,l=this.polygons;a.length=0;for(var h=0,u=l.length;u>h;h++)c.push(l[h]);l.length=0;for(var h=0;r>h;h++){var d=i[h],f=d.attachment;if(f.type==n.AttachmentType.boundingbox){a.push(f);var _,p=c.length;if(p>0)_=c[p-1],c.splice(p-1,1);else _=[];l.push(_),_.length=f.vertices.length,f.computeWorldVertices(s,o,d.bone,_)}else;}if(e)this.aabbCompute()},aabbCompute:function(){for(var t=this.polygons,e=Number.MAX_VALUE,i=Number.MAX_VALUE,n=Number.MIN_VALUE,r=Number.MIN_VALUE,s=0,o=t.length;o>s;s++)for(var a=t[s],c=0,l=a.length;l>c;c+=2){var h=a[c],u=a[c+1];e=Math.min(e,h),i=Math.min(i,u),n=Math.max(n,h),r=Math.max(r,u)}this.minX=e,this.minY=i,this.maxX=n,this.maxY=r},aabbContainsPoint:function(t,e){return t>=this.minX&&t<=this.maxX&&e>=this.minY&&e<=this.maxY},aabbIntersectsSegment:function(t,e,i,n){var r=this.minX,s=this.minY,o=this.maxX,a=this.maxY;if(r>=t&&r>=i||s>=e&&s>=n||t>=o&&i>=o||e>=a&&n>=a)return!1;var c=(n-e)/(i-t),l=c*(r-t)+e;if(l>s&&a>l)return!0;if(l=c*(o-t)+e,l>s&&a>l)return!0;var h=(s-e)/c+t;if(h>r&&o>h)return!0;if(h=(a-e)/c+t,h>r&&o>h)return!0;else return!1},aabbIntersectsSkeleton:function(t){return this.minX<t.maxX&&this.maxX>t.minX&&this.minY<t.maxY&&this.maxY>t.minY},containsPoint:function(t,e){for(var i=this.polygons,n=0,r=i.length;r>n;n++)if(this.polygonContainsPoint(i[n],t,e))return this.boundingBoxes[n];return null},intersectsSegment:function(t,e,i,n){for(var r=this.polygons,s=0,o=r.length;o>s;s++)if(r[s].intersectsSegment(t,e,i,n))return this.boundingBoxes[s];return null},polygonContainsPoint:function(t,e,i){for(var n=t.length,r=n-2,s=!1,o=0;n>o;o+=2){var a=t[o+1],c=t[r+1];if(i>a&&c>=i||i>c&&a>=i){var l=t[o];if(l+(i-a)/(c-a)*(t[r]-l)<e)s=!s}r=o}return s},polygonIntersectsSegment:function(t,e,i,n,r){for(var s=t.length,o=e-n,a=i-r,c=e*r-i*n,l=t[s-2],h=t[s-1],u=0;s>u;u+=2){var d=t[u],f=t[u+1],_=l*f-h*d,p=l-d,g=h-f,m=o*g-a*p,v=(c*p-o*_)/m;if((v>=l&&d>=v||v>=d&&l>=v)&&(v>=e&&n>=v||v>=n&&e>=v)){var y=(c*g-a*_)/m;if((y>=h&&f>=y||y>=f&&h>=y)&&(y>=i&&r>=y||y>=r&&i>=y))return!0}l=d,h=f}return!1},getPolygon:function(t){var e=this.boundingBoxes.indexOf(t);return-1==e?null:this.polygons[e]},getWidth:function(){return this.maxX-this.minX},getHeight:function(){return this.maxY-this.minY}},e.exports=n},{}],175:[function(t,e,i){Object.create=Object.create||function(t){function e(){}return e.prototype=t,new e};var n,r,s=function(t,e){if(!t)throw new Error("Assertion failed: "+e)},o=function(t,e){if(!t&&console&&console.warn)if(console.warn("ASSERTION FAILED: "+e),console.trace)console.trace()},a=function(t,e){return e>t?t:e},c=function(t,e){return t>e?t:e};if("object"==typeof window&&window.navigator.userAgent.indexOf("Firefox")>-1)n=Math.min,r=Math.max;else n=a,r=c;var l=function(t,e){return e>t?t+" "+e:e+" "+t},h=function(t,e){for(var i=0;i<t.length;i++)if(t[i]===e)return t[i]=t[t.length-1],void t.length--},u=function(t,e,i){var n=A(e,i),r=v(C(n,A(t,i))/D(n));return E(i,O(n,r))},d=function(t,e,i,n,r,s){var o=i-r,a=n-s,c=v(x(o,a,t-r,e-s)/M(o,a));return new y(r+o*c,s+a*c)};cp.momentForCircle=function(t,e,i,n){return t*(.5*(e*e+i*i)+D(n))},cp.areaForCircle=function(t,e){return Math.PI*Math.abs(t*t-e*e)},cp.momentForSegment=function(t,e,i){var n=O(E(e,i),.5);return t*(U(i,e)/12+D(n))},cp.areaForSegment=function(t,e,i){return i*(Math.PI*i+2*W(t,e))},cp.momentForPoly=function(t,e,i){for(var n=0,r=0,s=e.length,o=0;s>o;o+=2){var a=e[o]+i.x,c=e[o+1]+i.y,l=e[(o+2)%s]+i.x,h=e[(o+3)%s]+i.y,u=R(l,h,a,c),d=x(a,c,a,c)+x(a,c,l,h)+x(l,h,l,h);n+=u*d,r+=u}return t*n/(6*r)},cp.areaForPoly=function(t){for(var e=0,i=0,n=t.length;n>i;i+=2)e+=I(new y(t[i],t[i+1]),new y(t[(i+2)%n],t[(i+3)%n]));return-e/2},cp.centroidForPoly=function(t){for(var e=0,i=new y(0,0),n=0,r=t.length;r>n;n+=2){var s=new y(t[n],t[n+1]),o=new y(t[(n+2)%r],t[(n+3)%r]),a=I(s,o);e+=a,i=E(i,O(E(s,o),a))}return O(i,1/(3*e))},cp.recenterPoly=function(t){for(var e=cp.centroidForPoly(t),i=0;i<t.length;i+=2)t[i]-=e.x,t[i+1]-=e.y},cp.momentForBox=function(t,e,i){return t*(e*e+i*i)/12},cp.momentForBox2=function(t,e){var i=e.r-e.l,n=e.t-e.b,r=O([e.l+e.r,e.b+e.t],.5);return cp.momentForBox(t,i,n)+t*D(r)};var f=cp.loopIndexes=function(t){var e,i,n,r,s=0,o=0;e=n=t[0],i=r=t[1];for(var a=t.length>>1,c=1;a>c;c++){var l=t[2*c],h=t[2*c+1];if(e>l||l==e&&i>h)e=l,i=h,s=c;else if(l>n||l==n&&h>r)n=l,r=h,o=c}return[s,o]},_=function(t,e,i){var n=t[2*e];t[2*e]=t[2*i],t[2*i]=n,n=t[2*e+1],t[2*e+1]=t[2*i+1],t[2*i+1]=n},p=function(t,e,i,n,r,s){if(0===i)return 0;for(var o=0,a=e,c=A(r,n),l=s*S(c),h=e,u=e+i-1;u>=h;){var d=new y(t[2*h],t[2*h+1]),f=I(c,A(d,n));if(f>l){if(f>o)o=f,a=h;h++}else _(t,h,u),u--}if(a!=e)_(t,e,a);return h-e},g=function(t,e,i,n,r,s,o,a){if(0>n)return 0;else if(0==n)return e[2*a]=s.x,e[2*a+1]=s.y,1;else{var c=p(e,i,n,r,s,t),l=new y(e[2*i],e[2*i+1]),h=g(t,e,i+1,c-1,r,l,s,a),u=a+h++;e[2*u]=s.x,e[2*u+1]=s.y;var d=p(e,i+c,n-c,s,o,t),f=new y(e[2*(i+c)],e[2*(i+c)+1]);return h+g(t,e,i+c+1,d-1,s,f,o,a+h)}};cp.convexHull=function(t,e,i){if(e)for(var n=0;n<t.length;n++)e[n]=t[n];else e=t;var r=f(t),s=r[0],a=r[1];if(s==a)return e.length=2,e;_(e,0,s),_(e,1,0==a?s:a);var c=new y(e[0],e[1]),l=new y(e[2],e[3]),h=t.length>>1,u=g(i,e,2,h-2,c,l,c,1)+1;return e.length=2*u,o(it(e),"Internal error: cpConvexHull() and cpPolyValidate() did not agree.Please report this error with as much info as you can."),e};var m=function(t,e,i){return n(r(t,e),i)},v=function(t){return r(0,n(t,1))},y=cp.Vect=function(t,e){this.x=t,this.y=e};cp.v=function(t,e){return new y(t,e)};var T=cp.vzero=new y(0,0),C=cp.v.dot=function(t,e){return t.x*e.x+t.y*e.y},x=function(t,e,i,n){return t*i+e*n},S=cp.v.len=function(t){return Math.sqrt(C(t,t))},b=cp.v.len2=function(t,e){return Math.sqrt(t*t+e*e)},E=(cp.v.eql=function(t,e){return t.x===e.x&&t.y===e.y},cp.v.add=function(t,e){return new y(t.x+e.x,t.y+e.y)});y.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this};var A=cp.v.sub=function(t,e){return new y(t.x-e.x,t.y-e.y)};y.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this};var w=cp.v.neg=function(t){return new y(-t.x,-t.y)};y.prototype.neg=function(){return this.x=-this.x,this.y=-this.y,this};var O=cp.v.mult=function(t,e){return new y(t.x*e,t.y*e)};y.prototype.mult=function(t){return this.x*=t,this.y*=t,this};var I=cp.v.cross=function(t,e){return t.x*e.y-t.y*e.x},R=function(t,e,i,n){return t*n-e*i},P=cp.v.perp=function(t){return new y(-t.y,t.x)},N=(cp.v.pvrperp=function(t){return new y(t.y,-t.x)},cp.v.project=function(t,e){return O(e,C(t,e)/D(e))});y.prototype.project=function(t){return this.mult(C(this,t)/D(t)),this};var L=cp.v.rotate=function(t,e){return new y(t.x*e.x-t.y*e.y,t.x*e.y+t.y*e.x)};y.prototype.rotate=function(t){return this.x=this.x*t.x-this.y*t.y,this.y=this.x*t.y+this.y*t.x,this};var F=cp.v.unrotate=function(t,e){return new y(t.x*e.x+t.y*e.y,t.y*e.x-t.x*e.y)},D=cp.v.lengthsq=function(t){return C(t,t)},M=cp.v.lengthsq2=function(t,e){return t*t+e*e},B=cp.v.lerp=function(t,e,i){return E(O(t,1-i),O(e,i))},z=cp.v.normalize=function(t){return O(t,1/S(t))},k=cp.v.normalize_safe=function(t){return 0===t.x&&0===t.y?T:z(t)},V=cp.v.clamp=function(t,e){return C(t,t)>e*e?O(z(t),e):t},W=(cp.v.lerpconst=function(t,e,i){return E(t,V(A(e,t),i))},cp.v.dist=function(t,e){return S(A(t,e))}),U=cp.v.distsq=function(t,e){return D(A(t,e))},G=(cp.v.near=function(t,e,i){return U(t,e)<i*i},cp.v.slerp=function(t,e,i){var n=Math.acos(C(t,e));if(n){var r=1/Math.sin(n);return E(O(t,Math.sin((1-i)*n)*r),O(e,Math.sin(i*n)*r))}else return t}),X=(cp.v.slerpconst=function(t,e,i){var r=Math.acos(C(t,e));return G(t,e,n(i,r)/r)},cp.v.forangle=function(t){return new y(Math.cos(t),Math.sin(t))},cp.v.toangle=function(t){return Math.atan2(t.y,t.x)},cp.v.str=function(t){return"("+t.x.toFixed(3)+", "+t.y.toFixed(3)+")"},0),j=cp.BB=function(t,e,i,n){this.l=t,this.b=e,this.r=i,this.t=n,X++};cp.bb=function(t,e,i,n){return new j(t,e,i,n)};var Y=function(t,e){return new j(t.x-e,t.y-e,t.x+e,t.y+e)},H=function(t,e,i,n,r){return t.l<=n&&e<=t.r&&t.b<=r&&i<=t.t},q=0,Q=(cp.NO_GROUP=0,cp.ALL_LAYERS=-1);cp.resetShapeIdCounter=function(){q=0};var Z=cp.Shape=function(t){this.body=t,this.bb_l=this.bb_b=this.bb_r=this.bb_t=0,this.hashid=q++,this.sensor=!1,this.e=0,this.u=0,this.surface_v=T,this.collision_type=0,this.group=0,this.layers=Q,this.space=null,this.collisionCode=this.collisionCode};Z.prototype.setElasticity=function(t){this.e=t},Z.prototype.setFriction=function(t){this.body.activate(),this.u=t},Z.prototype.setLayers=function(t){this.body.activate(),this.layers=t},Z.prototype.setSensor=function(t){this.body.activate(),this.sensor=t},Z.prototype.setCollisionType=function(t){this.body.activate(),this.collision_type=t},Z.prototype.getBody=function(){return this.body},Z.prototype.active=function(){return this.body&&-1!==this.body.shapeList.indexOf(this)},Z.prototype.setBody=function(t){s(!this.active(),"You cannot change the body on an active shape. You must remove the shape from the space before changing the body."),this.body=t},Z.prototype.cacheBB=function(){return this.update(this.body.p,this.body.rot)},Z.prototype.update=function(t,e){s(!isNaN(e.x),"Rotation is NaN"),s(!isNaN(t.x),"Position is NaN"),this.cacheData(t,e)},Z.prototype.pointQuery=function(t){var e=this.nearestPointQuery(t);if(e.d<0)return e;else return},Z.prototype.getBB=function(){return new j(this.bb_l,this.bb_b,this.bb_r,this.bb_t)};var K=function(t,e,i){this.shape=t,this.p=e,this.d=i},J=function(t,e,i){this.shape=t,this.t=e,this.n=i};J.prototype.hitPoint=function(t,e){return B(t,e,this.t)},J.prototype.hitDist=function(t,e){return W(t,e)*this.t};var $=cp.CircleShape=function(t,e,i){this.c=this.tc=i,this.r=e,this.type="circle",Z.call(this,t)};$.prototype=Object.create(Z.prototype),$.prototype.cacheData=function(t,e){var i=this.tc=L(this.c,e).add(t),n=this.r;this.bb_l=i.x-n,this.bb_b=i.y-n,this.bb_r=i.x+n,this.bb_t=i.y+n},$.prototype.nearestPointQuery=function(t){var e=t.x-this.tc.x,i=t.y-this.tc.y,n=b(e,i),r=this.r,s=new y(this.tc.x+e*r/n,this.tc.y+i*r/n);return new K(this,s,n-r)};var tt=function(t,e,i,n,r,s){n=A(n,e),r=A(r,e);var o=C(n,n)-2*C(n,r)+C(r,r),a=-2*C(n,n)+2*C(n,r),c=C(n,n)-i*i,l=a*a-4*o*c;if(l>=0){var h=(-a-Math.sqrt(l))/(2*o);if(h>=0&&1>=h)return new J(t,h,z(B(n,r,h)))}};$.prototype.segmentQuery=function(t,e){return tt(this,this.tc,this.r,t,e)};var et=cp.SegmentShape=function(t,e,i,n){this.a=e,this.b=i,this.n=P(z(A(i,e))),this.ta=this.tb=this.tn=null,this.r=n,this.a_tangent=T,this.b_tangent=T,this.type="segment",Z.call(this,t)};et.prototype=Object.create(Z.prototype),et.prototype.cacheData=function(t,e){this.ta=E(t,L(this.a,e)),this.tb=E(t,L(this.b,e)),this.tn=L(this.n,e);var i,n,r,s;if(this.ta.x<this.tb.x)i=this.ta.x,n=this.tb.x;else i=this.tb.x,n=this.ta.x;if(this.ta.y<this.tb.y)r=this.ta.y,s=this.tb.y;else r=this.tb.y,s=this.ta.y;var o=this.r;this.bb_l=i-o,this.bb_b=r-o,this.bb_r=n+o,this.bb_t=s+o},et.prototype.nearestPointQuery=function(t){var e=u(t,this.ta,this.tb),i=t.x-e.x,n=t.y-e.y,r=b(i,n),s=this.r,o=r?E(e,O(new y(i,n),s/r)):e;return new K(this,o,r-s)},et.prototype.segmentQuery=function(t,e){var i=this.tn,n=C(A(this.ta,t),i),r=this.r,s=n>0?w(i):i,o=A(O(s,r),t),a=E(this.ta,o),c=E(this.tb,o),l=A(e,t);if(I(l,a)*I(l,c)<=0){var h=n+(n>0?-r:r),u=-h,d=C(l,i)-h;if(0>u*d)return new J(this,u/(u-d),s)}else if(0!==r){var f=tt(this,this.ta,this.r,t,e),_=tt(this,this.tb,this.r,t,e);if(f)return _&&_.t<f.t?_:f;else return _}},et.prototype.setNeighbors=function(t,e){this.a_tangent=A(t,this.a),this.b_tangent=A(e,this.b)},et.prototype.setEndpoints=function(t,e){this.a=t,this.b=e,this.n=P(z(A(e,t)))};var it=function(t){for(var e=t.length,i=0;e>i;i+=2){var n=t[i],r=t[i+1],s=t[(i+2)%e],o=t[(i+3)%e],a=t[(i+4)%e],c=t[(i+5)%e];if(R(s-n,o-r,a-s,c-o)>0)return!1}return!0},nt=cp.PolyShape=function(t,e,i){this.setVerts(e,i),this.type="poly",Z.call(this,t)};nt.prototype=Object.create(Z.prototype);var rt=function(t,e){this.n=t,this.d=e};rt.prototype.compare=function(t){return C(this.n,t)-this.d},nt.prototype.setVerts=function(t,e){s(t.length>=4,"Polygons require some verts"),s("number"==typeof t[0],"Polygon verticies should be specified in a flattened list (eg [x1,y1,x2,y2,x3,y3,...])"),s(it(t),"Polygon is concave or has a reversed winding. Consider using cpConvexHull()");var i=t.length,n=i>>1;this.verts=new Array(i),this.tVerts=new Array(i),this.planes=new Array(n),this.tPlanes=new Array(n);for(var r=0;i>r;r+=2){var o=t[r]+e.x,a=t[r+1]+e.y,c=t[(r+2)%i]+e.x,l=t[(r+3)%i]+e.y,h=z(P(new y(c-o,l-a)));this.verts[r]=o,this.verts[r+1]=a,this.planes[r>>1]=new rt(h,x(h.x,h.y,o,a)),this.tPlanes[r>>1]=new rt(new y(0,0),0)}};var st=(cp.BoxShape=function(t,e,i){var n=e/2,r=i/2;return st(t,new j(-n,-r,n,r))},cp.BoxShape2=function(t,e){var i=[e.l,e.b,e.l,e.t,e.r,e.t,e.r,e.b];return new nt(t,i,T)});nt.prototype.transformVerts=function(t,e){for(var i=this.verts,s=this.tVerts,o=1/0,a=-(1/0),c=1/0,l=-(1/0),h=0;h<i.length;h+=2){var u=i[h],d=i[h+1],f=t.x+u*e.x-d*e.y,_=t.y+u*e.y+d*e.x;s[h]=f,s[h+1]=_,o=n(o,f),a=r(a,f),c=n(c,_),l=r(l,_)}this.bb_l=o,this.bb_b=c,this.bb_r=a,this.bb_t=l},nt.prototype.transformAxes=function(t,e){for(var i=this.planes,n=this.tPlanes,r=0;r<i.length;r++){var s=L(i[r].n,e);n[r].n=s,n[r].d=C(t,s)+i[r].d}},nt.prototype.cacheData=function(t,e){this.transformAxes(t,e),this.transformVerts(t,e)},nt.prototype.nearestPointQuery=function(t){for(var e=this.tPlanes,i=this.tVerts,n=i[i.length-2],r=i[i.length-1],s=1/0,o=T,a=!1,c=0;c<e.length;c++){if(e[c].compare(t)>0)a=!0;var l=i[2*c],h=i[2*c+1],u=d(t.x,t.y,n,r,l,h),f=W(t,u);if(s>f)s=f,o=u;n=l,r=h}return new K(this,o,a?s:-s)},nt.prototype.segmentQuery=function(t,e){for(var i=this.tPlanes,n=this.tVerts,r=i.length,s=2*r,o=0;r>o;o++){var a=i[o].n,c=C(t,a);if(!(i[o].d>c)){var l=C(e,a),h=(i[o].d-c)/(l-c);if(!(0>h||h>1)){var u=B(t,e,h),d=-I(a,u),f=-R(a.x,a.y,n[2*o],n[2*o+1]),_=-R(a.x,a.y,n[(2*o+2)%s],n[(2*o+3)%s]);if(d>=f&&_>=d)return new J(this,h,a)}else;}else;}},nt.prototype.valueOnAxis=function(t,e){for(var i=this.tVerts,r=x(t.x,t.y,i[0],i[1]),s=2;s<i.length;s+=2)r=n(r,x(t.x,t.y,i[s],i[s+1]));return r-e},nt.prototype.containsVert=function(t,e){for(var i=this.tPlanes,n=0;n<i.length;n++){var r=i[n].n,s=x(r.x,r.y,t,e)-i[n].d;if(s>0)return!1}return!0},nt.prototype.containsVertPartial=function(t,e,i){for(var n=this.tPlanes,r=0;r<n.length;r++){var s=n[r].n;if(!(C(s,i)<0)){var o=x(s.x,s.y,t,e)-n[r].d;if(o>0)return!1}else;}return!0},nt.prototype.getNumVerts=function(){return this.verts.length/2},nt.prototype.getVert=function(t){return new y(this.verts[2*t],this.verts[2*t+1])};var ot=cp.Body=function(t,e){this.p=new y(0,0),this.vx=this.vy=0,this.f=new y(0,0),this.w=0,this.t=0,this.v_limit=1/0,this.w_limit=1/0,this.v_biasx=this.v_biasy=0,this.w_bias=0,this.space=null,this.shapeList=[],this.arbiterList=null,this.constraintList=null,this.nodeRoot=null,this.nodeNext=null,this.nodeIdleTime=0,this.setMass(t),this.setMoment(e),this.rot=new y(0,0),this.setAngle(0)},at=function(){var t=new ot(1/0,1/0);return t.nodeIdleTime=1/0,t};if(cp.StaticBody=at,"undefined"!=typeof DEBUG&&DEBUG){var ct=function(t,e){s(t.x==t.x&&t.y==t.y,e)},lt=function(t,e){s(Math.abs(t.x)!==1/0&&Math.abs(t.y)!==1/0,e)},ht=function(t,e){ct(t,e),lt(t,e)};ot.prototype.sanityCheck=function(){s(this.m===this.m&&this.m_inv===this.m_inv,"Body's mass is invalid."),s(this.i===this.i&&this.i_inv===this.i_inv,"Body's moment is invalid."),ht(this.p,"Body's position is invalid."),ht(this.f,"Body's force is invalid."),s(this.vx===this.vx&&Math.abs(this.vx)!==1/0,"Body's velocity is invalid."),s(this.vy===this.vy&&Math.abs(this.vy)!==1/0,"Body's velocity is invalid."),s(this.a===this.a&&Math.abs(this.a)!==1/0,"Body's angle is invalid."),s(this.w===this.w&&Math.abs(this.w)!==1/0,"Body's angular velocity is invalid."),s(this.t===this.t&&Math.abs(this.t)!==1/0,"Body's torque is invalid."),ht(this.rot,"Body's rotation vector is invalid."),s(this.v_limit===this.v_limit,"Body's velocity limit is invalid."),s(this.w_limit===this.w_limit,"Body's angular velocity limit is invalid.")}}else ot.prototype.sanityCheck=function(){};ot.prototype.getPos=function(){return this.p},ot.prototype.getVel=function(){return new y(this.vx,this.vy)},ot.prototype.getAngVel=function(){return this.w},ot.prototype.isSleeping=function(){return null!==this.nodeRoot},ot.prototype.isStatic=function(){return this.nodeIdleTime===1/0},ot.prototype.isRogue=function(){return null===this.space},ot.prototype.setMass=function(t){s(t>0,"Mass must be positive and non-zero."),this.activate(),this.m=t,this.m_inv=1/t},ot.prototype.setMoment=function(t){s(t>0,"Moment of Inertia must be positive and non-zero."),this.activate(),this.i=t,this.i_inv=1/t},ot.prototype.addShape=function(t){this.shapeList.push(t)},ot.prototype.removeShape=function(t){h(this.shapeList,t)};var ut=function(t,e,i){if(t===i)return t.next(e);else if(t.a===e)t.next_a=ut(t.next_a,e,i);else t.next_b=ut(t.next_b,e,i);return t};ot.prototype.removeConstraint=function(t){this.constraintList=ut(this.constraintList,this,t)},ot.prototype.setPos=function(t){if(this.activate(),this.sanityCheck(),t===T)t=cp.v(0,0);this.p=t},ot.prototype.setVel=function(t){this.activate(),this.vx=t.x,this.vy=t.y},ot.prototype.setAngVel=function(t){this.activate(),this.w=t},ot.prototype.setAngleInternal=function(t){s(!isNaN(t),"Internal Error: Attempting to set body's angle to NaN"),this.a=t,this.rot.x=Math.cos(t),this.rot.y=Math.sin(t)},ot.prototype.setAngle=function(t){this.activate(),this.sanityCheck(),this.setAngleInternal(t)},ot.prototype.velocity_func=function(t,e,i){var n=this.vx*e+(t.x+this.f.x*this.m_inv)*i,r=this.vy*e+(t.y+this.f.y*this.m_inv)*i,s=this.v_limit,o=n*n+r*r,a=o>s*s?s/Math.sqrt(o):1;this.vx=n*a,this.vy=r*a;var c=this.w_limit;this.w=m(this.w*e+this.t*this.i_inv*i,-c,c),this.sanityCheck()},ot.prototype.position_func=function(t){this.p.x+=(this.vx+this.v_biasx)*t,this.p.y+=(this.vy+this.v_biasy)*t,this.setAngleInternal(this.a+(this.w+this.w_bias)*t),this.v_biasx=this.v_biasy=0,this.w_bias=0,this.sanityCheck()},ot.prototype.resetForces=function(){this.activate(),this.f=new y(0,0),this.t=0},ot.prototype.applyForce=function(t,e){this.activate(),this.f=E(this.f,t),this.t+=I(e,t)},ot.prototype.applyImpulse=function(t,e){this.activate(),fe(this,t.x,t.y,e)},ot.prototype.getVelAtPoint=function(t){return E(new y(this.vx,this.vy),O(P(t),this.w))},ot.prototype.getVelAtWorldPoint=function(t){return this.getVelAtPoint(A(t,this.p))},ot.prototype.getVelAtLocalPoint=function(t){return this.getVelAtPoint(L(t,this.rot))},ot.prototype.eachShape=function(t){for(var e=0,i=this.shapeList.length;i>e;e++)t(this.shapeList[e])},ot.prototype.eachConstraint=function(t){for(var e=this.constraintList;e;){var i=e.next(this);t(e),e=i}},ot.prototype.eachArbiter=function(t){for(var e=this.arbiterList;e;){var i=e.next(this);e.swappedColl=this===e.body_b,t(e),e=i}},ot.prototype.local2World=function(t){return E(this.p,L(t,this.rot))},ot.prototype.world2Local=function(t){return F(A(t,this.p),this.rot)},ot.prototype.kineticEnergy=function(){var t=this.vx*this.vx+this.vy*this.vy,e=this.w*this.w;return(t?t*this.m:0)+(e?e*this.i:0)};var dt=cp.SpatialIndex=function(t){if(this.staticIndex=t,t){if(t.dynamicIndex)throw new Error("This static index is already associated with a dynamic index.");t.dynamicIndex=this}};dt.prototype.collideStatic=function(t,e){if(t.count>0){var i=t.query;this.each(function(t){i(t,new j(t.bb_l,t.bb_b,t.bb_r,t.bb_t),e)})}};var ft=cp.BBTree=function(t){dt.call(this,t),this.velocityFunc=null,this.leaves={},this.count=0,this.root=null,this.pooledNodes=null,this.pooledPairs=null,this.stamp=0};ft.prototype=Object.create(dt.prototype);var _t=0,pt=function(t,e,i){this.obj=null,this.bb_l=n(e.bb_l,i.bb_l),this.bb_b=n(e.bb_b,i.bb_b),this.bb_r=r(e.bb_r,i.bb_r),this.bb_t=r(e.bb_t,i.bb_t),this.parent=null,this.setA(e),this.setB(i)};ft.prototype.makeNode=function(t,e){var i=this.pooledNodes;if(i)return this.pooledNodes=i.parent,i.constructor(this,t,e),i;else return _t++,new pt(this,t,e)};var gt=0,mt=function(t,e){this.obj=e,t.getBB(e,this),this.parent=null,this.stamp=1,this.pairs=null,gt++};ft.prototype.getBB=function(t,e){var i=this.velocityFunc;if(i){var s=.1,o=(t.bb_r-t.bb_l)*s,a=(t.bb_t-t.bb_b)*s,c=O(i(t),.1);e.bb_l=t.bb_l+n(-o,c.x),e.bb_b=t.bb_b+n(-a,c.y),e.bb_r=t.bb_r+r(o,c.x),e.bb_t=t.bb_t+r(a,c.y)}else e.bb_l=t.bb_l,e.bb_b=t.bb_b,e.bb_r=t.bb_r,e.bb_t=t.bb_t},ft.prototype.getStamp=function(){var t=this.dynamicIndex;return t&&t.stamp?t.stamp:this.stamp},ft.prototype.incrementStamp=function(){if(this.dynamicIndex&&this.dynamicIndex.stamp)this.dynamicIndex.stamp++;else this.stamp++};var vt=0,yt=function(t,e,i,n){this.prevA=null,this.leafA=t,this.nextA=e,this.prevB=null,this.leafB=i,this.nextB=n};ft.prototype.makePair=function(t,e,i,n){var r=this.pooledPairs;if(r)return this.pooledPairs=r.prevA,r.prevA=null,r.leafA=t,r.nextA=e,r.prevB=null,r.leafB=i,r.nextB=n,r;else return vt++,new yt(t,e,i,n)},yt.prototype.recycle=function(t){this.prevA=t.pooledPairs,t.pooledPairs=this};var Tt=function(t,e,i){if(i)if(i.leafA===e)i.prevA=t;else i.prevB=t;if(t)if(t.leafA===e)t.nextA=i;else t.nextB=i;else e.pairs=i};mt.prototype.clearPairs=function(t){var e,i=this.pairs;for(this.pairs=null;i;){if(i.leafA===this)e=i.nextA,Tt(i.prevB,i.leafB,i.nextB);else e=i.nextB,Tt(i.prevA,i.leafA,i.nextA);i.recycle(t),i=e}};var Ct=function(t,e,i){var n=t.pairs,r=e.pairs,s=i.makePair(t,n,e,r);if(t.pairs=e.pairs=s,n)if(n.leafA===t)n.prevA=s;else n.prevB=s;if(r)if(r.leafA===e)r.prevA=s;else r.prevB=s};pt.prototype.recycle=function(t){this.parent=t.pooledNodes,t.pooledNodes=this},mt.prototype.recycle=function(t){},pt.prototype.setA=function(t){this.A=t,t.parent=this},pt.prototype.setB=function(t){this.B=t,t.parent=this},mt.prototype.isLeaf=!0,pt.prototype.isLeaf=!1,pt.prototype.otherChild=function(t){return this.A==t?this.B:this.A},pt.prototype.replaceChild=function(t,e,i){if(o(t==this.A||t==this.B,"Node is not a child of parent."),this.A==t)this.A.recycle(i),this.setA(e);else this.B.recycle(i),this.setB(e);for(var s=this;s;s=s.parent){var a=s.A,c=s.B;s.bb_l=n(a.bb_l,c.bb_l),s.bb_b=n(a.bb_b,c.bb_b),s.bb_r=r(a.bb_r,c.bb_r),s.bb_t=r(a.bb_t,c.bb_t)}},pt.prototype.bbArea=mt.prototype.bbArea=function(){return(this.bb_r-this.bb_l)*(this.bb_t-this.bb_b)};var xt=function(t,e){return(r(t.bb_r,e.bb_r)-n(t.bb_l,e.bb_l))*(r(t.bb_t,e.bb_t)-n(t.bb_b,e.bb_b))},St=function(t,e){return Math.abs(t.bb_l+t.bb_r-e.bb_l-e.bb_r)+Math.abs(t.bb_b+t.bb_t-e.bb_b-e.bb_t)},bt=function(t,e,i){if(null==t)return e;else if(t.isLeaf)return i.makeNode(e,t);else{var s=t.B.bbArea()+xt(t.A,e),o=t.A.bbArea()+xt(t.B,e);if(s===o)s=St(t.A,e),o=St(t.B,e);if(s>o)t.setB(bt(t.B,e,i));else t.setA(bt(t.A,e,i));return t.bb_l=n(t.bb_l,e.bb_l),t.bb_b=n(t.bb_b,e.bb_b),t.bb_r=r(t.bb_r,e.bb_r),t.bb_t=r(t.bb_t,e.bb_t),t}};pt.prototype.intersectsBB=mt.prototype.intersectsBB=function(t){return this.bb_l<=t.r&&t.l<=this.bb_r&&this.bb_b<=t.t&&t.b<=this.bb_t};var Et=function(t,e,i){if(t.intersectsBB(e))if(t.isLeaf)i(t.obj);else Et(t.A,e,i),Et(t.B,e,i)},At=function(t,e,i){var s=1/(i.x-e.x),o=t.bb_l==e.x?-(1/0):(t.bb_l-e.x)*s,a=t.bb_r==e.x?1/0:(t.bb_r-e.x)*s,c=n(o,a),l=r(o,a),h=1/(i.y-e.y),u=t.bb_b==e.y?-(1/0):(t.bb_b-e.y)*h,d=t.bb_t==e.y?1/0:(t.bb_t-e.y)*h,f=n(u,d),_=r(u,d);if(l>=f&&_>=c){var p=r(c,f),g=n(l,_);if(g>=0&&1>=p)return r(p,0)}return 1/0},wt=function(t,e,i,r,s){if(t.isLeaf)return s(t.obj);else{var o=At(t.A,e,i),a=At(t.B,e,i);if(a>o){if(r>o)r=n(r,wt(t.A,e,i,r,s));if(r>a)r=n(r,wt(t.B,e,i,r,s))}else{if(r>a)r=n(r,wt(t.B,e,i,r,s));if(r>o)r=n(r,wt(t.A,e,i,r,s))}return r}};ft.prototype.subtreeRecycle=function(t){if(t.isLeaf)this.subtreeRecycle(t.A),this.subtreeRecycle(t.B),t.recycle(this)};var Ot=function(t,e,i){if(e==t)return null;else{var n=e.parent;if(n==t){var r=t.otherChild(e);return r.parent=t.parent,t.recycle(i),r}else return n.parent.replaceChild(n,n.otherChild(e),i),t}},It=function(t,e){return t.bb_l<=e.bb_r&&e.bb_l<=t.bb_r&&t.bb_b<=e.bb_t&&e.bb_b<=t.bb_t};mt.prototype.markLeafQuery=function(t,e,i,n){if(It(t,this))if(e)Ct(t,this,i);else{if(this.stamp<t.stamp)Ct(this,t,i);if(n)n(t.obj,this.obj)}},pt.prototype.markLeafQuery=function(t,e,i,n){if(It(t,this))this.A.markLeafQuery(t,e,i,n),this.B.markLeafQuery(t,e,i,n)},mt.prototype.markSubtree=function(t,e,i){if(this.stamp==t.getStamp()){
if(e)e.markLeafQuery(this,!1,t,i);for(var n=this;n.parent;n=n.parent)if(n==n.parent.A)n.parent.B.markLeafQuery(this,!0,t,i);else n.parent.A.markLeafQuery(this,!1,t,i)}else for(var r=this.pairs;r;)if(this===r.leafB){if(i)i(r.leafA.obj,this.obj);r=r.nextB}else r=r.nextA},pt.prototype.markSubtree=function(t,e,i){this.A.markSubtree(t,e,i),this.B.markSubtree(t,e,i)},mt.prototype.containsObj=function(t){return this.bb_l<=t.bb_l&&this.bb_r>=t.bb_r&&this.bb_b<=t.bb_b&&this.bb_t>=t.bb_t},mt.prototype.update=function(t){var e=t.root,i=this.obj;if(!this.containsObj(i))return t.getBB(this.obj,this),e=Ot(e,this,t),t.root=bt(e,this,t),this.clearPairs(t),this.stamp=t.getStamp(),!0;else return!1},mt.prototype.addPairs=function(t){var e=t.dynamicIndex;if(e){var i=e.root;if(i)i.markLeafQuery(this,!0,e,null)}else{var n=t.staticIndex.root;this.markSubtree(t,n,null)}},ft.prototype.insert=function(t,e){var i=new mt(this,t);this.leaves[e]=i,this.root=bt(this.root,i,this),this.count++,i.stamp=this.getStamp(),i.addPairs(this),this.incrementStamp()},ft.prototype.remove=function(t,e){var i=this.leaves[e];delete this.leaves[e],this.root=Ot(this.root,i,this),this.count--,i.clearPairs(this),i.recycle(this)},ft.prototype.contains=function(t,e){return null!=this.leaves[e]};var Rt=function(t,e){};ft.prototype.reindexQuery=function(t){if(this.root){var e,i=this.leaves;for(e in i)i[e].update(this);var n=this.staticIndex,r=n&&n.root;if(this.root.markSubtree(this,r,t),n&&!r)this.collideStatic(this,n,t);this.incrementStamp()}},ft.prototype.reindex=function(){this.reindexQuery(Rt)},ft.prototype.reindexObject=function(t,e){var i=this.leaves[e];if(i){if(i.update(this))i.addPairs(this);this.incrementStamp()}},ft.prototype.pointQuery=function(t,e){this.query(new j(t.x,t.y,t.x,t.y),e)},ft.prototype.segmentQuery=function(t,e,i,n){if(this.root)wt(this.root,t,e,i,n)},ft.prototype.query=function(t,e){if(this.root)Et(this.root,t,e)},ft.prototype.count=function(){return this.count},ft.prototype.each=function(t){var e;for(e in this.leaves)t(this.leaves[e].obj)};var Pt=function(t,e,i,s,o){return(r(t.bb_r,s)-n(t.bb_l,e))*(r(t.bb_t,o)-n(t.bb_b,i))},Nt=function(t,e,i,s){if(1==s)return e[i];else if(2==s)return t.makeNode(e[i],e[i+1]);for(var o=e[i],a=o.bb_l,c=o.bb_b,l=o.bb_r,h=o.bb_t,u=i+s,d=i+1;u>d;d++)o=e[d],a=n(a,o.bb_l),c=n(c,o.bb_b),l=r(l,o.bb_r),h=r(h,o.bb_t);var f=l-a>h-c,_=new Array(2*s);if(f)for(var d=i;u>d;d++)_[2*d+0]=e[d].bb_l,_[2*d+1]=e[d].bb_r;else for(var d=i;u>d;d++)_[2*d+0]=e[d].bb_b,_[2*d+1]=e[d].bb_t;_.sort(function(t,e){return t-e});var p=.5*(_[s-1]+_[s]),g=a,m=c,v=l,y=h,T=a,C=c,x=l,S=h;if(f)v=T=p;else y=C=p;for(var b=u,E=i;b>E;){var o=e[E];if(Pt(o,T,C,x,S)<Pt(o,g,m,v,y))b--,e[E]=e[b],e[b]=o;else E++}if(b==s){for(var o=null,d=i;u>d;d++)o=bt(o,e[d],t);return o}return NodeNew(t,Nt(t,e,i,b-i),Nt(t,e,b,u-b))};ft.prototype.optimize=function(){var t=new Array(this.count),e=0;for(var i in this.leaves)t[e++]=this.nodes[i];tree.subtreeRecycle(root),this.root=Nt(tree,t,t.length)};var Lt=function(t,e){if(!t.isLeaf&&10>=e)Lt(t.A,e+1),Lt(t.B,e+1);for(var i="",n=0;e>n;n++)i+=" ";console.log(i+t.bb_b+" "+t.bb_t)};ft.prototype.log=function(){if(this.root)Lt(this.root,0)};var Ft=cp.CollisionHandler=function(){this.a=this.b=0};Ft.prototype.begin=function(t,e){return!0},Ft.prototype.preSolve=function(t,e){return!0},Ft.prototype.postSolve=function(t,e){},Ft.prototype.separate=function(t,e){};var Dt=function(t,e){this.e=0,this.u=0,this.surface_vr=T,this.a=t,this.body_a=t.body,this.b=e,this.body_b=e.body,this.thread_a_next=this.thread_a_prev=null,this.thread_b_next=this.thread_b_prev=null,this.contacts=null,this.stamp=0,this.handler=null,this.swappedColl=!1,this.state="first coll"};Dt.prototype.getShapes=function(){if(this.swappedColl)return[this.b,this.a];else return[this.a,this.b]},Dt.prototype.totalImpulse=function(){for(var t=this.contacts,e=new y(0,0),i=0,n=t.length;n>i;i++){var r=t[i];e.add(O(r.n,r.jnAcc))}return this.swappedColl?e:e.neg()},Dt.prototype.totalImpulseWithFriction=function(){for(var t=this.contacts,e=new y(0,0),i=0,n=t.length;n>i;i++){var r=t[i];e.add(new y(r.jnAcc,r.jtAcc).rotate(r.n))}return this.swappedColl?e:e.neg()},Dt.prototype.totalKE=function(){for(var t=(1-this.e)/(1+this.e),e=0,i=this.contacts,n=0,r=i.length;r>n;n++){var s=i[n],o=s.jnAcc,a=s.jtAcc;e+=t*o*o/s.nMass+a*a/s.tMass}return e},Dt.prototype.ignore=function(){this.state="ignore"},Dt.prototype.getA=function(){return this.swappedColl?this.b:this.a},Dt.prototype.getB=function(){return this.swappedColl?this.a:this.b},Dt.prototype.isFirstContact=function(){return"first coll"===this.state};var Mt=function(t,e,i){this.point=t,this.normal=e,this.dist=i};Dt.prototype.getContactPointSet=function(){var t,e=new Array(this.contacts.length);for(t=0;t<e.length;t++)e[t]=new Mt(this.contacts[t].p,this.contacts[t].n,this.contacts[t].dist);return e},Dt.prototype.getNormal=function(t){var e=this.contacts[t].n;return this.swappedColl?w(e):e},Dt.prototype.getPoint=function(t){return this.contacts[t].p},Dt.prototype.getDepth=function(t){return this.contacts[t].dist};var Bt=function(t,e,i,n){if(i)if(i.body_a===e)i.thread_a_next=n;else i.thread_b_next=n;else e.arbiterList=n;if(n)if(n.body_a===e)n.thread_a_prev=i;else n.thread_b_prev=i};Dt.prototype.unthread=function(){Bt(this,this.body_a,this.thread_a_prev,this.thread_a_next),Bt(this,this.body_b,this.thread_b_prev,this.thread_b_next),this.thread_a_prev=this.thread_a_next=null,this.thread_b_prev=this.thread_b_next=null},Dt.prototype.update=function(t,e,i,n){if(this.contacts)for(var r=0;r<this.contacts.length;r++)for(var s=this.contacts[r],o=0;o<t.length;o++){var a=t[o];if(a.hash===s.hash)a.jnAcc=s.jnAcc,a.jtAcc=s.jtAcc}if(this.contacts=t,this.handler=e,this.swappedColl=i.collision_type!==e.a,this.e=i.e*n.e,this.u=i.u*n.u,this.surface_vr=A(i.surface_v,n.surface_v),this.a=i,this.body_a=i.body,this.b=n,this.body_b=n.body,"cached"==this.state)this.state="first coll"},Dt.prototype.preStep=function(t,e,i){for(var r=this.body_a,s=this.body_b,o=0;o<this.contacts.length;o++){var a=this.contacts[o];a.r1=A(a.p,r.p),a.r2=A(a.p,s.p),a.nMass=1/me(r,s,a.r1,a.r2,a.n),a.tMass=1/me(r,s,a.r1,a.r2,P(a.n)),a.bias=-i*n(0,a.dist+e)/t,a.jBias=0,a.bounce=de(r,s,a.r1,a.r2,a.n)*this.e}},Dt.prototype.applyCachedImpulse=function(t){if(!this.isFirstContact())for(var e=this.body_a,i=this.body_b,n=0;n<this.contacts.length;n++){var r=this.contacts[n],s=r.n.x,o=r.n.y,a=s*r.jnAcc-o*r.jtAcc,c=s*r.jtAcc+o*r.jnAcc;_e(e,i,r.r1,r.r2,a*t,c*t)}};var zt=0,kt=0;Dt.prototype.applyImpulse=function(){zt++;for(var t=this.body_a,e=this.body_b,i=this.surface_vr,n=this.u,s=0;s<this.contacts.length;s++){kt++;var o=this.contacts[s],a=o.nMass,c=o.n,l=o.r1,h=o.r2,u=e.vx-h.y*e.w-(t.vx-l.y*t.w),d=e.vy+h.x*e.w-(t.vy+l.x*t.w),f=c.x*(e.v_biasx-h.y*e.w_bias-t.v_biasx+l.y*t.w_bias)+c.y*(h.x*e.w_bias+e.v_biasy-l.x*t.w_bias-t.v_biasy),_=x(u,d,c.x,c.y),p=x(u+i.x,d+i.y,-c.y,c.x),g=(o.bias-f)*a,v=o.jBias;o.jBias=r(v+g,0);var y=-(o.bounce+_)*a,T=o.jnAcc;o.jnAcc=r(T+y,0);var C=n*o.jnAcc,S=-p*o.tMass,b=o.jtAcc;o.jtAcc=m(b+S,-C,C);var E=c.x*(o.jBias-v),A=c.y*(o.jBias-v);pe(t,-E,-A,l),pe(e,E,A,h);var w=o.jnAcc-T,O=o.jtAcc-b;_e(t,e,l,h,c.x*w-c.y*O,c.x*O+c.y*w)}},Dt.prototype.callSeparate=function(t){var e=t.lookupHandler(this.a.collision_type,this.b.collision_type);e.separate(this,t)},Dt.prototype.next=function(t){return this.body_a==t?this.thread_a_next:this.thread_b_next};var Vt=0,Wt=function(t,e,i,n){this.p=t,this.n=e,this.dist=i,this.r1=this.r2=T,this.nMass=this.tMass=this.bounce=this.bias=0,this.jnAcc=this.jtAcc=this.jBias=0,this.hash=n,Vt++},Ut=[],Gt=function(t,e,i,n){var r=i+n,s=A(e,t),o=D(s);if(!(o>=r*r)){var a=Math.sqrt(o);return new Wt(E(t,O(s,.5+(i-.5*r)/(a?a:1/0))),a?O(s,1/a):new y(1,0),a-r,0)}},Xt=function(t,e){var i=Gt(t.tc,e.tc,t.r,e.r);return i?[i]:Ut},jt=function(t,e){var i=e.ta,n=e.tb,r=t.tc,s=A(n,i),o=v(C(s,A(r,i))/D(s)),a=E(i,O(s,o)),c=Gt(r,a,t.r,e.r);if(c){var l=c.n;return 0===o&&C(l,e.a_tangent)<0||1===o&&C(l,e.b_tangent)<0?Ut:[c]}else return Ut},Yt=0,Ht=function(t,e){var i=0,n=t.valueOnAxis(e[0].n,e[0].d);if(n>0)return-1;for(var r=1;r<e.length;r++){var s=t.valueOnAxis(e[r].n,e[r].d);if(s>0)return-1;else if(s>n)n=s,i=r}return Yt=n,i},qt=function(t,e,i,n){for(var r=[],s=t.tVerts,o=0;o<s.length;o+=2){var a=s[o],c=s[o+1];if(e.containsVertPartial(a,c,w(i)))r.push(new Wt(new y(a,c),i,n,l(t.hashid,o)))}for(var h=e.tVerts,o=0;o<h.length;o+=2){var a=h[o],c=h[o+1];if(t.containsVertPartial(a,c,i))r.push(new Wt(new y(a,c),i,n,l(e.hashid,o)))}return r},Qt=function(t,e,i,n){for(var r=[],s=t.tVerts,o=0;o<s.length;o+=2){var a=s[o],c=s[o+1];if(e.containsVert(a,c))r.push(new Wt(new y(a,c),i,n,l(t.hashid,o>>1)))}for(var h=e.tVerts,o=0;o<h.length;o+=2){var a=h[o],c=h[o+1];if(t.containsVert(a,c))r.push(new Wt(new y(a,c),i,n,l(e.hashid,o>>1)))}return r.length?r:qt(t,e,i,n)},Zt=function(t,e){var i=Ht(e,t.tPlanes);if(-1==i)return Ut;var n=Yt,r=Ht(t,e.tPlanes);if(-1==r)return Ut;var s=Yt;if(n>s)return Qt(t,e,t.tPlanes[i].n,n);else return Qt(t,e,w(e.tPlanes[r].n),s)},Kt=function(t,e,i){var r=C(e,t.ta)-t.r,s=C(e,t.tb)-t.r;return n(r,s)-i},Jt=function(t,e,i,n,r){for(var s=I(e.tn,e.ta),o=I(e.tn,e.tb),a=O(e.tn,r),c=i.tVerts,h=0;h<c.length;h+=2){var u=c[h],d=c[h+1];if(x(u,d,a.x,a.y)<C(e.tn,e.ta)*r+e.r){var f=R(e.tn.x,e.tn.y,u,d);if(s>=f&&f>=o)t.push(new Wt(new y(u,d),a,n,l(i.hashid,h)))}}},$t=function(t,e){var i=[],n=e.tPlanes,r=n.length,s=C(t.tn,t.ta),o=e.valueOnAxis(t.tn,s)-t.r,a=e.valueOnAxis(w(t.tn),-s)-t.r;if(a>0||o>0)return Ut;var c=0,h=Kt(t,n[0].n,n[0].d);if(h>0)return Ut;for(var u=0;r>u;u++){var d=Kt(t,n[u].n,n[u].d);if(d>0)return Ut;else if(d>h)h=d,c=u}var f=w(n[c].n),_=E(t.ta,O(f,t.r)),p=E(t.tb,O(f,t.r));if(e.containsVert(_.x,_.y))i.push(new Wt(_,f,h,l(t.hashid,0)));if(e.containsVert(p.x,p.y))i.push(new Wt(p,f,h,l(t.hashid,1)));if(o>=h||a>=h)if(o>a)Jt(i,t,e,o,1);else Jt(i,t,e,a,-1);if(0===i.length){var g,m=2*c,v=e.tVerts,T=new y(v[m],v[m+1]);if(g=Gt(t.ta,T,t.r,0,i))return[g];if(g=Gt(t.tb,T,t.r,0,i))return[g];var x=2*r,S=new y(v[(m+2)%x],v[(m+3)%x]);if(g=Gt(t.ta,S,t.r,0,i))return[g];if(g=Gt(t.tb,S,t.r,0,i))return[g]}return i},te=function(t,e){for(var i=e.tPlanes,n=0,r=C(i[0].n,t.tc)-i[0].d-t.r,s=0;s<i.length;s++){var o=C(i[s].n,t.tc)-i[s].d-t.r;if(o>0)return Ut;else if(o>r)r=o,n=s}var a=i[n].n,c=e.tVerts,l=c.length,h=n<<1,u=c[h],d=c[h+1],f=c[(h+2)%l],_=c[(h+3)%l],p=R(a.x,a.y,u,d),g=R(a.x,a.y,f,_),m=I(a,t.tc);if(g>m){var v=Gt(t.tc,new y(f,_),t.r,0,v);return v?[v]:Ut}else if(p>m)return[new Wt(A(t.tc,O(a,t.r+r/2)),w(a),r,0)];else{var v=Gt(t.tc,new y(u,d),t.r,0,v);return v?[v]:Ut}};$.prototype.collisionCode=0,et.prototype.collisionCode=1,nt.prototype.collisionCode=2,$.prototype.collisionTable=[Xt,jt,te],et.prototype.collisionTable=[null,function(t,e){return Ut},$t],nt.prototype.collisionTable=[null,null,Zt];var ee=cp.collideShapes=function(t,e){return s(t.collisionCode<=e.collisionCode,"Collided shapes must be sorted by type"),t.collisionTable[e.collisionCode](t,e)},ie=new Ft,ne=cp.Space=function(){this.stamp=0,this.curr_dt=0,this.bodies=[],this.rousedBodies=[],this.sleepingComponents=[],this.staticShapes=new ft(null),this.activeShapes=new ft(this.staticShapes),this.arbiters=[],this.contactBuffersHead=null,this.cachedArbiters={},this.constraints=[],this.locked=0,this.collisionHandlers={},this.defaultHandler=ie,this.postStepCallbacks=[],this.iterations=10,this.gravity=T,this.damping=1,this.idleSpeedThreshold=0,this.sleepTimeThreshold=1/0,this.collisionSlop=.1,this.collisionBias=Math.pow(.9,60),this.collisionPersistence=3,this.enableContactGraph=!1,this.staticBody=new ot(1/0,1/0),this.staticBody.nodeIdleTime=1/0,this.collideShapes=this.makeCollideShapes()};ne.prototype.getCurrentTimeStep=function(){return this.curr_dt},ne.prototype.setIterations=function(t){this.iterations=t},ne.prototype.isLocked=function(){return this.locked};var re=function(t){s(!t.locked,"This addition/removal cannot be done safely during a call to cpSpaceStep()  or during a query. Put these calls into a post-step callback.")};ne.prototype.addCollisionHandler=function(t,e,i,n,r,s){re(this),this.removeCollisionHandler(t,e);var o=new Ft;if(o.a=t,o.b=e,i)o.begin=i;if(n)o.preSolve=n;if(r)o.postSolve=r;if(s)o.separate=s;this.collisionHandlers[l(t,e)]=o},ne.prototype.removeCollisionHandler=function(t,e){re(this),delete this.collisionHandlers[l(t,e)]},ne.prototype.setDefaultCollisionHandler=function(t,e,i,n){re(this);var r=new Ft;if(t)r.begin=t;if(e)r.preSolve=e;if(i)r.postSolve=i;if(n)r.separate=n;this.defaultHandler=r},ne.prototype.lookupHandler=function(t,e){return this.collisionHandlers[l(t,e)]||this.defaultHandler},ne.prototype.addShape=function(t){var e=t.body;if(e.isStatic())return this.addStaticShape(t);else return s(!t.space,"This shape is already added to a space and cannot be added to another."),re(this),e.activate(),e.addShape(t),t.update(e.p,e.rot),this.activeShapes.insert(t,t.hashid),t.space=this,t},ne.prototype.addStaticShape=function(t){s(!t.space,"This shape is already added to a space and cannot be added to another."),re(this);var e=t.body;return e.addShape(t),t.update(e.p,e.rot),this.staticShapes.insert(t,t.hashid),t.space=this,t},ne.prototype.addBody=function(t){return s(!t.isStatic(),"Static bodies cannot be added to a space as they are not meant to be simulated."),s(!t.space,"This body is already added to a space and cannot be added to another."),re(this),this.bodies.push(t),t.space=this,t},ne.prototype.addConstraint=function(t){s(!t.space,"This shape is already added to a space and cannot be added to another."),re(this);var e=t.a,i=t.b;return e.activate(),i.activate(),this.constraints.push(t),t.next_a=e.constraintList,e.constraintList=t,t.next_b=i.constraintList,i.constraintList=t,t.space=this,t},ne.prototype.filterArbiters=function(t,e){for(var i in this.cachedArbiters){var n=this.cachedArbiters[i];if(t===n.body_a&&(e===n.a||null===e)||t===n.body_b&&(e===n.b||null===e)){if(e&&"cached"!==n.state)n.callSeparate(this);n.unthread(),h(this.arbiters,n),delete this.cachedArbiters[i]}}},ne.prototype.removeShape=function(t){var e=t.body;if(e.isStatic())this.removeStaticShape(t);else s(this.containsShape(t),"Cannot remove a shape that was not added to the space. (Removed twice maybe?)"),re(this),e.activate(),e.removeShape(t),this.filterArbiters(e,t),this.activeShapes.remove(t,t.hashid),t.space=null},ne.prototype.removeStaticShape=function(t){s(this.containsShape(t),"Cannot remove a static or sleeping shape that was not added to the space. (Removed twice maybe?)"),re(this);var e=t.body;if(e.isStatic())e.activateStatic(t);e.removeShape(t),this.filterArbiters(e,t),this.staticShapes.remove(t,t.hashid),t.space=null},ne.prototype.removeBody=function(t){s(this.containsBody(t),"Cannot remove a body that was not added to the space. (Removed twice maybe?)"),re(this),t.activate(),h(this.bodies,t),t.space=null},ne.prototype.removeConstraint=function(t){s(this.containsConstraint(t),"Cannot remove a constraint that was not added to the space. (Removed twice maybe?)"),re(this),t.a.activate(),t.b.activate(),h(this.constraints,t),t.a.removeConstraint(t),t.b.removeConstraint(t),t.space=null},ne.prototype.containsShape=function(t){return t.space===this},ne.prototype.containsBody=function(t){return t.space==this},ne.prototype.containsConstraint=function(t){return t.space==this},ne.prototype.uncacheArbiter=function(t){delete this.cachedArbiters[l(t.a.hashid,t.b.hashid)],h(this.arbiters,t)},ne.prototype.eachBody=function(t){this.lock();for(var e=this.bodies,i=0;i<e.length;i++)t(e[i]);for(var n=this.sleepingComponents,i=0;i<n.length;i++)for(var r=n[i],s=r;s;){var o=s.nodeNext;t(s),s=o}this.unlock(!0)},ne.prototype.eachShape=function(t){this.lock(),this.activeShapes.each(t),this.staticShapes.each(t),this.unlock(!0)},ne.prototype.eachConstraint=function(t){this.lock();for(var e=this.constraints,i=0;i<e.length;i++)t(e[i]);this.unlock(!0)},ne.prototype.reindexStatic=function(){s(!this.locked,"You cannot manually reindex objects while the space is locked. Wait until the current query or step is complete."),this.staticShapes.each(function(t){var e=t.body;t.update(e.p,e.rot)}),this.staticShapes.reindex()},ne.prototype.reindexShape=function(t){s(!this.locked,"You cannot manually reindex objects while the space is locked. Wait until the current query or step is complete.");var e=t.body;t.update(e.p,e.rot),this.activeShapes.reindexObject(t,t.hashid),this.staticShapes.reindexObject(t,t.hashid)},ne.prototype.reindexShapesForBody=function(t){for(var e=t.shapeList;e;e=e.next)this.reindexShape(e)},ne.prototype.useSpatialHash=function(t,e){throw new Error("Spatial Hash not implemented.")},ne.prototype.activateBody=function(t){if(s(!t.isRogue(),"Internal error: Attempting to activate a rogue body."),this.locked){if(-1===this.rousedBodies.indexOf(t))this.rousedBodies.push(t)}else{this.bodies.push(t);for(var e=0;e<t.shapeList.length;e++){var i=t.shapeList[e];this.staticShapes.remove(i,i.hashid),this.activeShapes.insert(i,i.hashid)}for(var n=t.arbiterList;n;n=n.next(t)){var r=n.body_a;if(t===r||r.isStatic()){var o=n.a,a=n.b;this.cachedArbiters[l(o.hashid,a.hashid)]=n,n.stamp=this.stamp,n.handler=this.lookupHandler(o.collision_type,a.collision_type),this.arbiters.push(n)}}for(var c=t.constraintList;c;c=c.nodeNext){var r=c.a;if(t===r||r.isStatic())this.constraints.push(c)}}},ne.prototype.deactivateBody=function(t){s(!t.isRogue(),"Internal error: Attempting to deactivate a rogue body."),h(this.bodies,t);for(var e=0;e<t.shapeList.length;e++){var i=t.shapeList[e];this.activeShapes.remove(i,i.hashid),this.staticShapes.insert(i,i.hashid)}for(var n=t.arbiterList;n;n=n.next(t)){var r=n.body_a;if(t===r||r.isStatic())this.uncacheArbiter(n)}for(var o=t.constraintList;o;o=o.nodeNext){var r=o.a;if(t===r||r.isStatic())h(this.constraints,o)}};var se=function(t){return t?t.nodeRoot:null},oe=function(t){if(t&&t.isSleeping(t)){s(!t.isRogue(),"Internal Error: componentActivate() called on a rogue body.");for(var e=t.space,i=t;i;){var n=i.nodeNext;i.nodeIdleTime=0,i.nodeRoot=null,i.nodeNext=null,e.activateBody(i),i=n}h(e.sleepingComponents,t)}};ot.prototype.activate=function(){if(!this.isRogue())this.nodeIdleTime=0,oe(se(this))},ot.prototype.activateStatic=function(t){s(this.isStatic(),"Body.activateStatic() called on a non-static body.");for(var e=this.arbiterList;e;e=e.next(this))if(!t||t==e.a||t==e.b)(e.body_a==this?e.body_b:e.body_a).activate()},ot.prototype.pushArbiter=function(t){o(null===(t.body_a===this?t.thread_a_next:t.thread_b_next),"Internal Error: Dangling contact graph pointers detected. (A)"),o(null===(t.body_a===this?t.thread_a_prev:t.thread_b_prev),"Internal Error: Dangling contact graph pointers detected. (B)");var e=this.arbiterList;if(o(null===e||null===(e.body_a===this?e.thread_a_prev:e.thread_b_prev),"Internal Error: Dangling contact graph pointers detected. (C)"),t.body_a===this)t.thread_a_next=e;else t.thread_b_next=e;if(e)if(e.body_a===this)e.thread_a_prev=t;else e.thread_b_prev=t;this.arbiterList=t};var ae=function(t,e){if(e.nodeRoot=t,e!==t)e.nodeNext=t.nodeNext,t.nodeNext=e},ce=function(t,e){if(!e.isRogue()){var i=se(e);if(null==i){ae(t,e);for(var n=e.arbiterList;n;n=n.next(e))ce(t,e==n.body_a?n.body_b:n.body_a);for(var r=e.constraintList;r;r=r.next(e))ce(t,e==r.a?r.b:r.a)}else o(i===t,"Internal Error: Inconsistency detected in the contact graph.")}},le=function(t,e){for(var i=t;i;i=i.nodeNext)if(i.nodeIdleTime<e)return!0;return!1};ne.prototype.processComponents=function(t){for(var e=this.sleepTimeThreshold!==1/0,i=this.bodies,n=0;n<i.length;n++){var r=i[n];o(null===r.nodeNext,"Internal Error: Dangling next pointer detected in contact graph."),o(null===r.nodeRoot,"Internal Error: Dangling root pointer detected in contact graph.")}if(e)for(var s=this.idleSpeedThreshold,a=s?s*s:D(this.gravity)*t*t,n=0;n<i.length;n++){var r=i[n],c=a?r.m*a:0;r.nodeIdleTime=r.kineticEnergy()>c?0:r.nodeIdleTime+t}for(var l=this.arbiters,n=0,h=l.length;h>n;n++){var u=l[n],d=u.body_a,f=u.body_b;if(e){if(f.isRogue()&&!f.isStatic()||d.isSleeping())d.activate();if(d.isRogue()&&!d.isStatic()||f.isSleeping())f.activate()}d.pushArbiter(u),f.pushArbiter(u)}if(e){for(var _=this.constraints,n=0;n<_.length;n++){var p=_[n],d=p.a,f=p.b;if(f.isRogue()&&!f.isStatic())d.activate();if(d.isRogue()&&!d.isStatic())f.activate()}for(var n=0;n<i.length;){var r=i[n];if(null===se(r))if(ce(r,r),!le(r,this.sleepTimeThreshold)){this.sleepingComponents.push(r);for(var g=r;g;g=g.nodeNext)this.deactivateBody(g);continue}n++,r.nodeRoot=null,r.nodeNext=null}}},ot.prototype.sleep=function(){this.sleepWithGroup(null)},ot.prototype.sleepWithGroup=function(t){s(!this.isStatic()&&!this.isRogue(),"Rogue and static bodies cannot be put to sleep.");var e=this.space;if(s(e,"Cannot put a rogue body to sleep."),s(!e.locked,"Bodies cannot be put to sleep during a query or a call to cpSpaceStep(). Put these calls into a post-step callback."),s(null===t||t.isSleeping(),"Cannot use a non-sleeping body as a group identifier."),this.isSleeping())return void s(se(this)===se(t),"The body is already sleeping and it's group cannot be reassigned.");for(var i=0;i<this.shapeList.length;i++)this.shapeList[i].update(this.p,this.rot);if(e.deactivateBody(this),t){var n=se(t);this.nodeRoot=n,this.nodeNext=n.nodeNext,this.nodeIdleTime=0,n.nodeNext=this}else this.nodeRoot=this,this.nodeNext=null,this.nodeIdleTime=0,e.sleepingComponents.push(this);h(e.bodies,this)},ne.prototype.activateShapesTouchingShape=function(t){if(this.sleepTimeThreshold!==1/0)this.shapeQuery(t,function(t,e){t.body.activate()})},ne.prototype.pointQuery=function(t,e,i,n){var r=function(r){if((!r.group||i!==r.group)&&e&r.layers&&r.pointQuery(t))n(r)},s=new j(t.x,t.y,t.x,t.y);this.lock(),this.activeShapes.query(s,r),this.staticShapes.query(s,r),this.unlock(!0)},ne.prototype.pointQueryFirst=function(t,e,i){var n=null;return this.pointQuery(t,e,i,function(t){if(!t.sensor)n=t}),n},ne.prototype.nearestPointQuery=function(t,e,i,n,r){var s=function(s){if((!s.group||n!==s.group)&&i&s.layers){var o=s.nearestPointQuery(t);if(o.d<e)r(s,o.d,o.p)}},o=Y(t,e);this.lock(),this.activeShapes.query(o,s),this.staticShapes.query(o,s),this.unlock(!0)},ne.prototype.nearestPointQueryNearest=function(t,e,i,n){var r,s=function(s){if((!s.group||n!==s.group)&&i&s.layers&&!s.sensor){var o=s.nearestPointQuery(t);if(o.d<e&&(!r||o.d<r.d))r=o}},o=Y(t,e);return this.activeShapes.query(o,s),this.staticShapes.query(o,s),r},ne.prototype.segmentQuery=function(t,e,i,n,r){var s=function(s){var o;if((!s.group||n!==s.group)&&i&s.layers&&(o=s.segmentQuery(t,e)))r(s,o.t,o.n);return 1};this.lock(),this.staticShapes.segmentQuery(t,e,1,s),this.activeShapes.segmentQuery(t,e,1,s),this.unlock(!0)},ne.prototype.segmentQueryFirst=function(t,e,i,n){var r=null,s=function(s){var o;if((!s.group||n!==s.group)&&i&s.layers&&!s.sensor&&(o=s.segmentQuery(t,e))&&(null===r||o.t<r.t))r=o;return r?r.t:1};return this.staticShapes.segmentQuery(t,e,1,s),this.activeShapes.segmentQuery(t,e,r?r.t:1,s),r},ne.prototype.bbQuery=function(t,e,i,n){var r=function(r){if((!r.group||i!==r.group)&&e&r.layers&&H(t,r.bb_l,r.bb_b,r.bb_r,r.bb_t))n(r)};this.lock(),this.activeShapes.query(t,r),this.staticShapes.query(t,r),this.unlock(!0)},ne.prototype.shapeQuery=function(t,e){var i=t.body;if(i)t.update(i.p,i.rot);var n=new j(t.bb_l,t.bb_b,t.bb_r,t.bb_t),r=!1,s=function(i){var n=t;if((!n.group||n.group!==i.group)&&n.layers&i.layers&&n!==i){var s;if(n.collisionCode<=i.collisionCode)s=ee(n,i);else{s=ee(i,n);for(var o=0;o<s.length;o++)s[o].n=w(s[o].n)}if(s.length)if(r=!(n.sensor||i.sensor),e){for(var a=new Array(s.length),o=0;o<s.length;o++)a[o]=new Mt(s[o].p,s[o].n,s[o].dist);e(i,a)}}};return this.lock(),this.activeShapes.query(n,s),this.staticShapes.query(n,s),this.unlock(!0),r},ne.prototype.addPostStepCallback=function(t){o(this.locked,"Adding a post-step callback when the space is not locked is unnecessary. Post-step callbacks will not called until the end of the next call to cpSpaceStep() or the next query."),this.postStepCallbacks.push(t)},ne.prototype.runPostStepCallbacks=function(){for(var t=0;t<this.postStepCallbacks.length;t++)this.postStepCallbacks[t]();this.postStepCallbacks=[]},ne.prototype.lock=function(){this.locked++},ne.prototype.unlock=function(t){if(this.locked--,s(this.locked>=0,"Internal Error: Space lock underflow."),0===this.locked&&t){for(var e=this.rousedBodies,i=0;i<e.length;i++)this.activateBody(e[i]);e.length=0,this.runPostStepCallbacks()}},ne.prototype.makeCollideShapes=function(){var t=this;return function(e,i){var n=t;if(e.bb_l<=i.bb_r&&i.bb_l<=e.bb_r&&e.bb_b<=i.bb_t&&i.bb_b<=e.bb_t&&e.body!==i.body&&(!e.group||e.group!==i.group)&&e.layers&i.layers){var r=n.lookupHandler(e.collision_type,i.collision_type),s=e.sensor||i.sensor;if(!s||r!==ie){if(e.collisionCode>i.collisionCode){var o=e;e=i,i=o}var a=ee(e,i);if(0!==a.length){var c=l(e.hashid,i.hashid),h=n.cachedArbiters[c];if(!h)h=n.cachedArbiters[c]=new Dt(e,i);if(h.update(a,r,e,i),"first coll"==h.state&&!r.begin(h,n))h.ignore();if("ignore"!==h.state&&r.preSolve(h,n)&&!s)n.arbiters.push(h);else if(h.contacts=null,"ignore"!==h.state)h.state="normal";h.stamp=n.stamp}}}}},ne.prototype.arbiterSetFilter=function(t){var e=this.stamp-t.stamp,i=t.body_a,n=t.body_b;if((i.isStatic()||i.isSleeping())&&(n.isStatic()||n.isSleeping()))return!0;if(e>=1&&"cached"!=t.state)t.callSeparate(this),t.state="cached";if(e>=this.collisionPersistence)return t.contacts=null,!1;else return!0};var he=function(t){var e=t.body;t.update(e.p,e.rot)};ne.prototype.step=function(t){if(0!==t){s(0===T.x&&0===T.y,"vzero is invalid"),this.stamp++;var e=this.curr_dt;this.curr_dt=t;var i,n,r,o=this.bodies,a=this.constraints,c=this.arbiters;for(i=0;i<c.length;i++){var l=c[i];if(l.state="normal",!l.body_a.isSleeping()&&!l.body_b.isSleeping())l.unthread()}for(c.length=0,this.lock(),i=0;i<o.length;i++)o[i].position_func(t);this.activeShapes.each(he),this.activeShapes.reindexQuery(this.collideShapes),this.unlock(!1),this.processComponents(t),this.lock();for(r in this.cachedArbiters)if(!this.arbiterSetFilter(this.cachedArbiters[r]))delete this.cachedArbiters[r];var h=this.collisionSlop,u=1-Math.pow(this.collisionBias,t);for(i=0;i<c.length;i++)c[i].preStep(t,h,u);for(i=0;i<a.length;i++){var d=a[i];d.preSolve(this),d.preStep(t)}var f=Math.pow(this.damping,t),_=this.gravity;for(i=0;i<o.length;i++)o[i].velocity_func(_,f,t);var p=0===e?0:t/e;for(i=0;i<c.length;i++)c[i].applyCachedImpulse(p);for(i=0;i<a.length;i++)a[i].applyCachedImpulse(p);for(i=0;i<this.iterations;i++){for(n=0;n<c.length;n++)c[n].applyImpulse();for(n=0;n<a.length;n++)a[n].applyImpulse()}for(i=0;i<a.length;i++)a[i].postSolve(this);for(i=0;i<c.length;i++)c[i].handler.postSolve(c[i],this);this.unlock(!0)}};var ue=function(t,e,i,n){var r=t.vx+-i.y*t.w,s=t.vy+i.x*t.w,o=e.vx+-n.y*e.w,a=e.vy+n.x*e.w;return new y(o-r,a-s)},de=function(t,e,i,n,r){var s=t.vx+-i.y*t.w,o=t.vy+i.x*t.w,a=e.vx+-n.y*e.w,c=e.vy+n.x*e.w;return x(a-s,c-o,r.x,r.y)},fe=function(t,e,i,n){t.vx+=e*t.m_inv,t.vy+=i*t.m_inv,t.w+=t.i_inv*(n.x*i-n.y*e)},_e=function(t,e,i,n,r,s){fe(t,-r,-s,i),fe(e,r,s,n)},pe=function(t,e,i,n){t.v_biasx+=e*t.m_inv,t.v_biasy+=i*t.m_inv,t.w_bias+=t.i_inv*R(n.x,n.y,e,i)},ge=function(t,e,i){var n=I(e,i);return t.m_inv+t.i_inv*n*n},me=function(t,e,i,n,r){var s=ge(t,i,r)+ge(e,n,r);return o(0!==s,"Unsolvable collision or constraint."),s},ve=function(t,e,i,n,r,s){var a,c,l,h,u=t.m_inv+e.m_inv;a=u,c=0,l=0,h=u;var d=t.i_inv,f=i.x*i.x*d,_=i.y*i.y*d,p=-i.x*i.y*d;a+=_,c+=p,l+=p,h+=f;var g=e.i_inv,m=n.x*n.x*g,v=n.y*n.y*g,y=-n.x*n.y*g;a+=v,c+=y,l+=y,h+=m;var T=a*h-c*l;o(0!==T,"Unsolvable constraint.");var C=1/T;r.x=h*C,r.y=-c*C,s.x=-l*C,s.y=a*C},ye=function(t,e,i){return new y(C(t,e),C(t,i))},Te=function(t,e){return 1-Math.pow(t,e)},Ce=cp.Constraint=function(t,e){this.a=t,this.b=e,this.space=null,this.next_a=null,this.next_b=null,this.maxForce=1/0,this.errorBias=Math.pow(.9,60),this.maxBias=1/0};Ce.prototype.activateBodies=function(){if(this.a)this.a.activate();if(this.b)this.b.activate()},Ce.prototype.preStep=function(t){},Ce.prototype.applyCachedImpulse=function(t){},Ce.prototype.applyImpulse=function(){},Ce.prototype.getImpulse=function(){return 0},Ce.prototype.preSolve=function(t){},Ce.prototype.postSolve=function(t){},Ce.prototype.next=function(t){return this.a===t?this.next_a:this.next_b};var xe=cp.PinJoint=function(t,e,i,n){Ce.call(this,t,e),this.anchr1=i,this.anchr2=n;var r=t?E(t.p,L(i,t.rot)):i,s=e?E(e.p,L(n,e.rot)):n;this.dist=S(A(s,r)),o(this.dist>0,"You created a 0 length pin joint. A pivot joint will be much more stable."),this.r1=this.r2=null,this.n=null,this.nMass=0,this.jnAcc=this.jnMax=0,this.bias=0};xe.prototype=Object.create(Ce.prototype),xe.prototype.preStep=function(t){var e=this.a,i=this.b;this.r1=L(this.anchr1,e.rot),this.r2=L(this.anchr2,i.rot);var n=A(E(i.p,this.r2),E(e.p,this.r1)),r=S(n);this.n=O(n,1/(r?r:1/0)),this.nMass=1/me(e,i,this.r1,this.r2,this.n);var s=this.maxBias;this.bias=m(-Te(this.errorBias,t)*(r-this.dist)/t,-s,s),this.jnMax=this.maxForce*t},xe.prototype.applyCachedImpulse=function(t){var e=O(this.n,this.jnAcc*t);_e(this.a,this.b,this.r1,this.r2,e.x,e.y)},xe.prototype.applyImpulse=function(){var t=this.a,e=this.b,i=this.n,n=de(t,e,this.r1,this.r2,i),r=(this.bias-n)*this.nMass,s=this.jnAcc;this.jnAcc=m(s+r,-this.jnMax,this.jnMax),r=this.jnAcc-s,_e(t,e,this.r1,this.r2,i.x*r,i.y*r)},xe.prototype.getImpulse=function(){return Math.abs(this.jnAcc)};var Se=cp.SlideJoint=function(t,e,i,n,r,s){Ce.call(this,t,e),this.anchr1=i,this.anchr2=n,this.min=r,this.max=s,this.r1=this.r2=this.n=null,this.nMass=0,this.jnAcc=this.jnMax=0,this.bias=0};Se.prototype=Object.create(Ce.prototype),Se.prototype.preStep=function(t){var e=this.a,i=this.b;this.r1=L(this.anchr1,e.rot),this.r2=L(this.anchr2,i.rot);var n=A(E(i.p,this.r2),E(e.p,this.r1)),r=S(n),s=0;if(r>this.max)s=r-this.max,this.n=k(n);else if(r<this.min)s=this.min-r,this.n=w(k(n));else this.n=T,this.jnAcc=0;this.nMass=1/me(e,i,this.r1,this.r2,this.n);var o=this.maxBias;this.bias=m(-Te(this.errorBias,t)*s/t,-o,o),this.jnMax=this.maxForce*t},Se.prototype.applyCachedImpulse=function(t){var e=this.jnAcc*t;_e(this.a,this.b,this.r1,this.r2,this.n.x*e,this.n.y*e)},Se.prototype.applyImpulse=function(){if(0!==this.n.x||0!==this.n.y){var t=this.a,e=this.b,i=this.n,n=this.r1,r=this.r2,s=ue(t,e,n,r),o=C(s,i),a=(this.bias-o)*this.nMass,c=this.jnAcc;this.jnAcc=m(c+a,-this.jnMax,0),a=this.jnAcc-c,_e(t,e,this.r1,this.r2,i.x*a,i.y*a)}},Se.prototype.getImpulse=function(){return Math.abs(this.jnAcc)};var be=cp.PivotJoint=function(t,e,i,n){if(Ce.call(this,t,e),"undefined"==typeof n){var r=i;i=t?t.world2Local(r):r,n=e?e.world2Local(r):r}this.anchr1=i,this.anchr2=n,this.r1=this.r2=T,this.k1=new y(0,0),this.k2=new y(0,0),this.jAcc=T,this.jMaxLen=0,this.bias=T};be.prototype=Object.create(Ce.prototype),be.prototype.preStep=function(t){var e=this.a,i=this.b;this.r1=L(this.anchr1,e.rot),this.r2=L(this.anchr2,i.rot),ve(e,i,this.r1,this.r2,this.k1,this.k2),this.jMaxLen=this.maxForce*t;var n=A(E(i.p,this.r2),E(e.p,this.r1));this.bias=V(O(n,-Te(this.errorBias,t)/t),this.maxBias)},be.prototype.applyCachedImpulse=function(t){_e(this.a,this.b,this.r1,this.r2,this.jAcc.x*t,this.jAcc.y*t)},be.prototype.applyImpulse=function(){var t=this.a,e=this.b,i=this.r1,n=this.r2,r=ue(t,e,i,n),s=ye(A(this.bias,r),this.k1,this.k2),o=this.jAcc;this.jAcc=V(E(this.jAcc,s),this.jMaxLen),_e(t,e,this.r1,this.r2,this.jAcc.x-o.x,this.jAcc.y-o.y)},be.prototype.getImpulse=function(){return S(this.jAcc)};var Ee=cp.GrooveJoint=function(t,e,i,n,r){Ce.call(this,t,e),this.grv_a=i,this.grv_b=n,this.grv_n=P(z(A(n,i))),this.anchr2=r,this.grv_tn=null,this.clamp=0,this.r1=this.r2=null,this.k1=new y(0,0),this.k2=new y(0,0),this.jAcc=T,this.jMaxLen=0,this.bias=null};Ee.prototype=Object.create(Ce.prototype),Ee.prototype.preStep=function(t){var e=this.a,i=this.b,n=e.local2World(this.grv_a),r=e.local2World(this.grv_b),s=L(this.grv_n,e.rot),o=C(n,s);this.grv_tn=s,this.r2=L(this.anchr2,i.rot);var a=I(E(i.p,this.r2),s);
if(a<=I(n,s))this.clamp=1,this.r1=A(n,e.p);else if(a>=I(r,s))this.clamp=-1,this.r1=A(r,e.p);else this.clamp=0,this.r1=A(E(O(P(s),-a),O(s,o)),e.p);ve(e,i,this.r1,this.r2,this.k1,this.k2),this.jMaxLen=this.maxForce*t;var c=A(E(i.p,this.r2),E(e.p,this.r1));this.bias=V(O(c,-Te(this.errorBias,t)/t),this.maxBias)},Ee.prototype.applyCachedImpulse=function(t){_e(this.a,this.b,this.r1,this.r2,this.jAcc.x*t,this.jAcc.y*t)},Ee.prototype.grooveConstrain=function(t){var e=this.grv_tn,i=this.clamp*I(t,e)>0?t:N(t,e);return V(i,this.jMaxLen)},Ee.prototype.applyImpulse=function(){var t=this.a,e=this.b,i=this.r1,n=this.r2,r=ue(t,e,i,n),s=ye(A(this.bias,r),this.k1,this.k2),o=this.jAcc;this.jAcc=this.grooveConstrain(E(o,s)),_e(t,e,this.r1,this.r2,this.jAcc.x-o.x,this.jAcc.y-o.y)},Ee.prototype.getImpulse=function(){return S(this.jAcc)},Ee.prototype.setGrooveA=function(t){this.grv_a=t,this.grv_n=P(z(A(this.grv_b,t))),this.activateBodies()},Ee.prototype.setGrooveB=function(t){this.grv_b=t,this.grv_n=P(z(A(t,this.grv_a))),this.activateBodies()};var Ae=function(t,e){return(t.restLength-e)*t.stiffness},we=cp.DampedSpring=function(t,e,i,n,r,s,o){Ce.call(this,t,e),this.anchr1=i,this.anchr2=n,this.restLength=r,this.stiffness=s,this.damping=o,this.springForceFunc=Ae,this.target_vrn=this.v_coef=0,this.r1=this.r2=null,this.nMass=0,this.n=null};we.prototype=Object.create(Ce.prototype),we.prototype.preStep=function(t){var e=this.a,i=this.b;this.r1=L(this.anchr1,e.rot),this.r2=L(this.anchr2,i.rot);var n=A(E(i.p,this.r2),E(e.p,this.r1)),r=S(n);this.n=O(n,1/(r?r:1/0));var s=me(e,i,this.r1,this.r2,this.n);o(0!==s,"Unsolvable this."),this.nMass=1/s,this.target_vrn=0,this.v_coef=1-Math.exp(-this.damping*t*s);var a=this.springForceFunc(this,r);_e(e,i,this.r1,this.r2,this.n.x*a*t,this.n.y*a*t)},we.prototype.applyCachedImpulse=function(t){},we.prototype.applyImpulse=function(){var t=this.a,e=this.b,i=this.n,n=this.r1,r=this.r2,s=de(t,e,n,r,i),o=(this.target_vrn-s)*this.v_coef;this.target_vrn=s+o,o*=this.nMass,_e(t,e,this.r1,this.r2,this.n.x*o,this.n.y*o)},we.prototype.getImpulse=function(){return 0};var Oe=function(t,e){return(e-t.restAngle)*t.stiffness},Ie=cp.DampedRotarySpring=function(t,e,i,n,r){Ce.call(this,t,e),this.restAngle=i,this.stiffness=n,this.damping=r,this.springTorqueFunc=Oe,this.target_wrn=0,this.w_coef=0,this.iSum=0};Ie.prototype=Object.create(Ce.prototype),Ie.prototype.preStep=function(t){var e=this.a,i=this.b,n=e.i_inv+i.i_inv;o(0!==n,"Unsolvable spring."),this.iSum=1/n,this.w_coef=1-Math.exp(-this.damping*t*n),this.target_wrn=0;var r=this.springTorqueFunc(this,e.a-i.a)*t;e.w-=r*e.i_inv,i.w+=r*i.i_inv},Ie.prototype.applyImpulse=function(){var t=this.a,e=this.b,i=t.w-e.w,n=(this.target_wrn-i)*this.w_coef;this.target_wrn=i+n;var r=n*this.iSum;t.w+=r*t.i_inv,e.w-=r*e.i_inv};var Re=cp.RotaryLimitJoint=function(t,e,i,n){Ce.call(this,t,e),this.min=i,this.max=n,this.jAcc=0,this.iSum=this.bias=this.jMax=0};Re.prototype=Object.create(Ce.prototype),Re.prototype.preStep=function(t){var e=this.a,i=this.b,n=i.a-e.a,r=0;if(n>this.max)r=this.max-n;else if(n<this.min)r=this.min-n;this.iSum=1/(1/e.i+1/i.i);var s=this.maxBias;if(this.bias=m(-Te(this.errorBias,t)*r/t,-s,s),this.jMax=this.maxForce*t,!this.bias)this.jAcc=0},Re.prototype.applyCachedImpulse=function(t){var e=this.a,i=this.b,n=this.jAcc*t;e.w-=n*e.i_inv,i.w+=n*i.i_inv},Re.prototype.applyImpulse=function(){if(this.bias){var t=this.a,e=this.b,i=e.w-t.w,n=-(this.bias+i)*this.iSum,r=this.jAcc;if(this.bias<0)this.jAcc=m(r+n,0,this.jMax);else this.jAcc=m(r+n,-this.jMax,0);n=this.jAcc-r,t.w-=n*t.i_inv,e.w+=n*e.i_inv}},Re.prototype.getImpulse=function(){return Math.abs(joint.jAcc)};var Pe=cp.RatchetJoint=function(t,e,i,n){Ce.call(this,t,e),this.angle=0,this.phase=i,this.ratchet=n,this.angle=(e?e.a:0)-(t?t.a:0),this.iSum=this.bias=this.jAcc=this.jMax=0};Pe.prototype=Object.create(Ce.prototype),Pe.prototype.preStep=function(t){var e=this.a,i=this.b,n=this.angle,r=this.phase,s=this.ratchet,o=i.a-e.a,a=n-o,c=0;if(a*s>0)c=a;else this.angle=Math.floor((o-r)/s)*s+r;this.iSum=1/(e.i_inv+i.i_inv);var l=this.maxBias;if(this.bias=m(-Te(this.errorBias,t)*c/t,-l,l),this.jMax=this.maxForce*t,!this.bias)this.jAcc=0},Pe.prototype.applyCachedImpulse=function(t){var e=this.a,i=this.b,n=this.jAcc*t;e.w-=n*e.i_inv,i.w+=n*i.i_inv},Pe.prototype.applyImpulse=function(){if(this.bias){var t=this.a,e=this.b,i=e.w-t.w,n=this.ratchet,r=-(this.bias+i)*this.iSum,s=this.jAcc;this.jAcc=m((s+r)*n,0,this.jMax*Math.abs(n))/n,r=this.jAcc-s,t.w-=r*t.i_inv,e.w+=r*e.i_inv}},Pe.prototype.getImpulse=function(t){return Math.abs(t.jAcc)};var Ne=cp.GearJoint=function(t,e,i,n){Ce.call(this,t,e),this.phase=i,this.ratio=n,this.ratio_inv=1/n,this.jAcc=0,this.iSum=this.bias=this.jMax=0};Ne.prototype=Object.create(Ce.prototype),Ne.prototype.preStep=function(t){var e=this.a,i=this.b;this.iSum=1/(e.i_inv*this.ratio_inv+this.ratio*i.i_inv);var n=this.maxBias;this.bias=m(-Te(this.errorBias,t)*(i.a*this.ratio-e.a-this.phase)/t,-n,n),this.jMax=this.maxForce*t},Ne.prototype.applyCachedImpulse=function(t){var e=this.a,i=this.b,n=this.jAcc*t;e.w-=n*e.i_inv*this.ratio_inv,i.w+=n*i.i_inv},Ne.prototype.applyImpulse=function(){var t=this.a,e=this.b,i=e.w*this.ratio-t.w,n=(this.bias-i)*this.iSum,r=this.jAcc;this.jAcc=m(r+n,-this.jMax,this.jMax),n=this.jAcc-r,t.w-=n*t.i_inv*this.ratio_inv,e.w+=n*e.i_inv},Ne.prototype.getImpulse=function(){return Math.abs(this.jAcc)},Ne.prototype.setRatio=function(t){this.ratio=t,this.ratio_inv=1/t,this.activateBodies()};var Le=cp.SimpleMotor=function(t,e,i){Ce.call(this,t,e),this.rate=i,this.jAcc=0,this.iSum=this.jMax=0};Le.prototype=Object.create(Ce.prototype),Le.prototype.preStep=function(t){this.iSum=1/(this.a.i_inv+this.b.i_inv),this.jMax=this.maxForce*t},Le.prototype.applyCachedImpulse=function(t){var e=this.a,i=this.b,n=this.jAcc*t;e.w-=n*e.i_inv,i.w+=n*i.i_inv},Le.prototype.applyImpulse=function(){var t=this.a,e=this.b,i=e.w-t.w+this.rate,n=-i*this.iSum,r=this.jAcc;this.jAcc=m(r+n,-this.jMax,this.jMax),n=this.jAcc-r,t.w-=n*t.i_inv,e.w+=n*e.i_inv},Le.prototype.getImpulse=function(){return Math.abs(this.jAcc)}},{}],176:[function(require,module,exports){eval('if(typeof CC_TEST=="undefined")CC_TEST=typeof describe!="undefined"||typeof QUnit=="object";if(typeof CC_EDITOR=="undefined")CC_EDITOR=typeof Editor=="object"&&typeof process=="object"&&"electron" in process.versions;if(typeof CC_DEV=="undefined")CC_DEV=CC_EDITOR||CC_TEST;if(typeof CC_JSB=="undefined")CC_JSB=false;'),require("./predefine");var isCoreLevel=!1;if(!isCoreLevel)require("./bin/modular-cocos2d");else cc._initDebugSetting(1);if(require("./extends"),!1)cc._require=require;if(isCoreLevel)Editor.versions.cocos2d=require("./package.json").version;else if(!1)require("./cocos2d/deprecated");module.exports=cc},{"./bin/modular-cocos2d":3,"./cocos2d/deprecated":139,"./extends":165,"./package.json":void 0,"./predefine":178}],177:[function(t,e,i){if(!String.prototype.startsWith)String.prototype.startsWith=function(t,e){return e=e||0,this.lastIndexOf(t,e)===e};if(!String.prototype.endsWith)String.prototype.endsWith=function(t,e){if("undefined"==typeof e||e>this.length)e=this.length;e-=t.length;var i=this.indexOf(t,e);return-1!==i&&i===e}},{}],178:[function(t,e,i){if(cc={},_ccsg={},!1)cc._Test={};if(t("./CCDebugger"),cc._initDebugSetting(cc.DebugMode.INFO),t("./polyfill/string"),t("./cocos2d/core/platform/js"),t("./cocos2d/core/value-types"),t("./cocos2d/core/utils"),t("./cocos2d/core/platform/CCInputManager"),t("./cocos2d/core/platform/CCInputExtension"),t("./cocos2d/core/event"),t("./cocos2d/core/platform/CCSys"),t("./cocos2d/core/platform/CCMacro"),t("./cocos2d/core/load-pipeline"),t("./cocos2d/core/textures"),1)if(t("./cocos2d/kazmath"),t("./cocos2d/core/CCDirector"),t("./cocos2d/core/CCDirectorWebGL"),t("./cocos2d/core/CCDirectorCanvas"),!0)t("./cocos2d/core/platform/CCSAXParser"),t("./cocos2d/core/platform/CCView"),t("./cocos2d/core/platform/CCScreen"),t("./cocos2d/core/CCActionManager"),t("./cocos2d/core/CCScheduler"),t("./cocos2d/core/event-manager"),t("./cocos2d/core/renderer"),t("./cocos2d/shaders"),t("./cocos2d/compression"),t("./CCBoot.js"),t("./cocos2d/core/CCGame");ccui={},ccs={},cp={}},{"./CCBoot.js":1,"./CCDebugger":2,"./cocos2d/compression":26,"./cocos2d/core/CCActionManager":28,"./cocos2d/core/CCDirector":29,"./cocos2d/core/CCDirectorCanvas":30,"./cocos2d/core/CCDirectorWebGL":31,"./cocos2d/core/CCGame":32,"./cocos2d/core/CCScheduler":35,"./cocos2d/core/event":76,"./cocos2d/core/event-manager":72,"./cocos2d/core/load-pipeline":82,"./cocos2d/core/platform/CCInputExtension":89,"./cocos2d/core/platform/CCInputManager":90,"./cocos2d/core/platform/CCMacro":91,"./cocos2d/core/platform/CCSAXParser":93,"./cocos2d/core/platform/CCScreen":94,"./cocos2d/core/platform/CCSys":95,"./cocos2d/core/platform/CCView":96,"./cocos2d/core/platform/js":105,"./cocos2d/core/renderer":114,"./cocos2d/core/textures":120,"./cocos2d/core/utils":125,"./cocos2d/core/value-types":138,"./cocos2d/kazmath":143,"./cocos2d/shaders":161,"./polyfill/string":177}]},{},[176]);
//# sourceMappingURL=cocos2d-js-min.js.map